{"ast":null,"code":"import { extend, addClass, removeClass, setValue, closest, select } from '@syncfusion/ej2-base';\nimport { remove, classList } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, isUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { parentsUntil, inArray, refreshForeignData, getObject, alignFrozenEditForm, gridActionHandler, addRemoveEventListener } from '../base/util';\nimport { splitFrozenRowObjectCells, getGridRowElements } from '../base/util';\nimport { sliceElements, getCellByColAndRowIndex, getMovableTbody, getFrozenRightTbody } from '../base/util';\nimport { getGridRowObjects } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\nimport * as literals from '../base/string-literals';\n/**\n * `BatchEdit` module is used to handle batch editing actions.\n *\n * @hidden\n */\n\nvar BatchEdit =\n/** @class */\nfunction () {\n  function BatchEdit(parent, serviceLocator, renderer) {\n    this.cellDetails = {};\n    this.originalCell = {};\n    this.cloneCell = {};\n    this.editNext = false;\n    this.preventSaveCell = false;\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.renderer = renderer;\n    this.focus = serviceLocator.getService('focus');\n    this.addEventListener();\n  }\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.evtHandlers = [{\n      event: events.click,\n      handler: this.clickHandler\n    }, {\n      event: events.dblclick,\n      handler: this.dblClickHandler\n    }, {\n      event: events.beforeCellFocused,\n      handler: this.onBeforeCellFocused\n    }, {\n      event: events.cellFocused,\n      handler: this.onCellFocused\n    }, {\n      event: events.doubleTap,\n      handler: this.dblClickHandler\n    }, {\n      event: events.keyPressed,\n      handler: this.keyDownHandler\n    }, {\n      event: events.editNextValCell,\n      handler: this.editNextValCell\n    }, {\n      event: events.closeBatch,\n      handler: this.closeForm\n    }, {\n      event: events.destroy,\n      handler: this.destroy\n    }];\n    addRemoveEventListener(this.parent, this.evtHandlers, true, this);\n    this.dataBoundFunction = this.dataBound.bind(this);\n    this.batchCancelFunction = this.batchCancel.bind(this);\n    this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n    this.parent.addEventListener(events.batchCancel, this.batchCancelFunction);\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    addRemoveEventListener(this.parent, this.evtHandlers, false);\n    this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n    this.parent.removeEventListener(events.batchCancel, this.batchCancelFunction);\n  };\n\n  BatchEdit.prototype.batchCancel = function () {\n    this.parent.focusModule.restoreFocus();\n  };\n\n  BatchEdit.prototype.dataBound = function () {\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  BatchEdit.prototype.clickHandler = function (e) {\n    if (!parentsUntil(e.target, this.parent.element.id + '_add', true)) {\n      if (this.parent.isEdit && closest(this.form, 'td') !== closest(e.target, 'td')) {\n        this.saveCell();\n        this.editNextValCell();\n      }\n\n      if (parentsUntil(e.target, literals.rowCell) && !this.parent.isEdit) {\n        this.setCellIdx(e.target);\n      }\n    }\n  };\n\n  BatchEdit.prototype.dblClickHandler = function (e) {\n    var target = parentsUntil(e.target, literals.rowCell);\n    var tr = parentsUntil(e.target, literals.row);\n    var rowIndex = tr && parseInt(tr.getAttribute(literals.ariaRowIndex), 10);\n    var colIndex = target && parseInt(target.getAttribute(literals.ariaColIndex), 10);\n\n    if (!isNullOrUndefined(target) && !isNullOrUndefined(rowIndex) && !isNaN(colIndex) && !target.parentElement.classList.contains(literals.editedRow)) {\n      this.editCell(rowIndex, this.parent.getColumns()[colIndex].field, this.isAddRow(rowIndex));\n    }\n  };\n\n  BatchEdit.prototype.onBeforeCellFocused = function (e) {\n    if (this.parent.isEdit && this.validateFormObj() && (e.byClick || ['tab', 'shiftTab', 'enter', 'shiftEnter'].indexOf(e.keyArgs.action) > -1)) {\n      e.cancel = true;\n\n      if (e.byClick) {\n        e.clickArgs.preventDefault();\n      } else {\n        e.keyArgs.preventDefault();\n      }\n    }\n  };\n\n  BatchEdit.prototype.onCellFocused = function (e) {\n    var frzCols = this.parent.getFrozenLeftCount();\n    var frzRightCols = this.parent.getFrozenRightColumnsCount();\n    var mCont = this.parent.getContent().querySelector('.' + literals.movableContent);\n    var mHdr = this.parent.getHeaderContent().querySelector('.' + literals.movableHeader);\n    var clear = (!e.container.isContent || !e.container.isDataCell) && !(this.parent.frozenRows && e.container.isHeader);\n\n    if (!e.byKey || clear) {\n      if (this.parent.isEdit && clear) {\n        this.saveCell();\n      }\n\n      return;\n    }\n\n    var _a = e.container.indexes,\n        rowIndex = _a[0],\n        cellIndex = _a[1];\n\n    if (frzCols && (mCont.contains(e.element) || this.parent.frozenRows && mHdr.contains(e.element))) {\n      cellIndex += frzCols;\n    }\n\n    if (frzRightCols) {\n      var frHdr = this.parent.getHeaderContent().querySelector('.e-frozen-right-header');\n      var frCont = this.parent.getContent().querySelector('.e-frozen-right-content');\n\n      if (frCont.contains(e.element) || this.parent.frozenRows && frHdr.contains(e.element)) {\n        cellIndex += frzCols + this.parent.getMovableColumnsCount();\n      }\n    }\n\n    if (this.parent.frozenRows && e.container.isContent) {\n      rowIndex += this.parent.frozenRows;\n    }\n\n    var isEdit = this.parent.isEdit;\n\n    if (!this.parent.element.getElementsByClassName('e-popup-open').length) {\n      isEdit = isEdit && !this.validateFormObj();\n\n      switch (e.keyArgs.action) {\n        case 'tab':\n        case 'shiftTab':\n          // eslint-disable-next-line no-case-declarations\n          var col = this.parent.getColumns()[e.indexes[1]];\n\n          if (col && !this.parent.isEdit) {\n            this.editCell(e.indexes[0], col.field);\n          }\n\n          if (isEdit || this.parent.isLastCellPrimaryKey) {\n            this.editCellFromIndex(rowIndex, cellIndex);\n          }\n\n          break;\n\n        case 'enter':\n        case 'shiftEnter':\n          e.keyArgs.preventDefault(); // eslint-disable-next-line no-case-declarations\n\n          var args = {\n            cancel: false,\n            keyArgs: e.keyArgs\n          };\n          this.parent.notify('beforeFocusCellEdit', args);\n\n          if (!args.cancel && isEdit) {\n            this.editCell(rowIndex, this.cellDetails.column.field);\n          }\n\n          break;\n\n        case 'f2':\n          this.editCellFromIndex(rowIndex, cellIndex);\n          this.focus.focus();\n          break;\n      }\n    }\n  };\n\n  BatchEdit.prototype.isAddRow = function (index) {\n    return this.parent.getDataRows()[index].classList.contains('e-insertedrow');\n  };\n\n  BatchEdit.prototype.editCellFromIndex = function (rowIdx, cellIdx) {\n    this.cellDetails.rowIndex = rowIdx;\n    this.cellDetails.cellIndex = cellIdx;\n    this.editCell(rowIdx, this.parent.getColumns()[cellIdx].field, this.isAddRow(rowIdx));\n  };\n\n  BatchEdit.prototype.closeEdit = function () {\n    var _this = this;\n\n    var gObj = this.parent;\n    var rows = this.parent.getRowsObject();\n    var argument = {\n      cancel: false,\n      batchChanges: this.getBatchChanges()\n    };\n    gObj.notify(events.beforeBatchCancel, argument);\n\n    if (argument.cancel) {\n      return;\n    }\n\n    if (gObj.isEdit) {\n      this.saveCell(true);\n    }\n\n    this.isAdded = false;\n    gObj.clearSelection();\n    var allRows = getGridRowObjects(this.parent);\n\n    var _loop_1 = function (i) {\n      var isInsert = false;\n      var isDirty = rows[i].isDirty;\n      gridActionHandler(this_1.parent, function (tableName, rows) {\n        isInsert = _this.removeBatchElementChanges(rows[i], isDirty);\n\n        if (isInsert) {\n          rows.splice(i, 1);\n        }\n      }, allRows);\n\n      if (isInsert) {\n        i--;\n      }\n\n      out_i_1 = i;\n    };\n\n    var this_1 = this,\n        out_i_1;\n\n    for (var i = 0; i < rows.length; i++) {\n      _loop_1(i);\n\n      i = out_i_1;\n    }\n\n    if (!gObj.getContentTable().querySelector('tr.e-row')) {\n      gObj.renderModule.renderEmptyRow();\n    }\n\n    var args = {\n      requestType: 'batchCancel',\n      rows: this.parent.getRowsObject()\n    };\n    gObj.notify(events.batchCancel, {\n      rows: this.parent.getRowsObject().length ? this.parent.getRowsObject() : [new Row({\n        isDataRow: true,\n        cells: [new Cell({\n          isDataCell: true,\n          visible: true\n        })]\n      })]\n    });\n    gObj.selectRow(this.cellDetails.rowIndex);\n    this.refreshRowIdx();\n    gObj.notify(events.toolbarRefresh, {});\n    this.parent.notify(events.tooltipDestroy, {});\n    args = {\n      requestType: 'batchCancel',\n      rows: this.parent.getRowsObject()\n    };\n    gObj.trigger(events.batchCancel, args);\n  };\n\n  BatchEdit.prototype.removeBatchElementChanges = function (row, isDirty) {\n    var gObj = this.parent;\n    var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n    var isInstertedRemoved = false;\n\n    if (isDirty) {\n      row.isDirty = isDirty;\n      var tr = gObj.getRowElementByUID(row.uid);\n\n      if (tr) {\n        if (tr.classList.contains('e-insertedrow')) {\n          remove(tr);\n          isInstertedRemoved = true;\n        } else {\n          refreshForeignData(row, this.parent.getForeignKeyColumns(), row.data);\n          delete row.changes;\n          delete row.edit;\n          row.isDirty = false;\n          classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n          rowRenderer.refresh(row, gObj.getColumns(), false);\n        }\n\n        if (this.parent.aggregates.length > 0) {\n          var type = 'type';\n          var editType = [];\n          editType[type] = 'cancel';\n          this.parent.notify(events.refreshFooterRenderer, editType);\n\n          if (this.parent.groupSettings.columns.length > 0) {\n            this.parent.notify(events.groupAggregates, editType);\n          }\n        }\n      }\n    }\n\n    return isInstertedRemoved;\n  };\n\n  BatchEdit.prototype.removeHideAndSelection = function (tr) {\n    if (tr.classList.contains('e-hiddenrow')) {\n      tr.removeAttribute('aria-selected');\n      var tdElements = [].slice.call(tr.getElementsByClassName('e-selectionbackground'));\n\n      for (var i = 0; i < tdElements.length; i++) {\n        removeClass([tdElements[i]], ['e-selectionbackground', 'e-active']);\n      }\n    }\n\n    classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n  };\n\n  BatchEdit.prototype.deleteRecord = function (fieldname, data) {\n    this.saveCell();\n\n    if (this.validateFormObj()) {\n      this.saveCell(true);\n    }\n\n    this.isAdded = false;\n    this.bulkDelete(fieldname, data);\n\n    if (this.parent.aggregates.length > 0) {\n      this.parent.notify(events.refreshFooterRenderer, {});\n\n      if (this.parent.groupSettings.columns.length > 0) {\n        this.parent.notify(events.groupAggregates, {});\n      }\n    }\n  };\n\n  BatchEdit.prototype.addRecord = function (data) {\n    this.bulkAddRow(data);\n  };\n\n  BatchEdit.prototype.endEdit = function () {\n    if (this.parent.isEdit && this.validateFormObj()) {\n      return;\n    }\n\n    this.batchSave();\n  };\n\n  BatchEdit.prototype.closeForm = function () {\n    for (var i = 0; i < Object.keys(this.originalCell).length; i++) {\n      for (var j = 0; j < Object.keys(this.cloneCell).length; j++) {\n        if (Object.keys(this.originalCell)[i] === Object.keys(this.cloneCell)[j]) {\n          this.cloneCell[Object.keys(this.cloneCell)[j]].replaceWith(this.originalCell[Object.keys(this.originalCell)[i]]);\n\n          if (this.originalCell[Object.keys(this.originalCell)[i]].classList.contains('e-selectionbackground')) {\n            this.originalCell[Object.keys(this.originalCell)[i]].classList.remove('e-selectionbackground', 'e-cellselectionbackground', 'e-active');\n          }\n        }\n      }\n    }\n\n    this.cloneCell = {};\n    this.originalCell = {};\n  };\n\n  BatchEdit.prototype.validateFormObj = function () {\n    return this.parent.editModule.formObj && !this.parent.editModule.formObj.validate();\n  };\n\n  BatchEdit.prototype.batchSave = function () {\n    var gObj = this.parent;\n    var deletedRecords = 'deletedRecords';\n\n    if (gObj.isCheckBoxSelection) {\n      var checkAllBox = gObj.element.querySelector('.e-checkselectall').parentElement;\n\n      if (checkAllBox.classList.contains('e-checkbox-disabled') && gObj.pageSettings.totalRecordsCount > gObj.currentViewData.length) {\n        removeClass([checkAllBox], ['e-checkbox-disabled']);\n      }\n    }\n\n    this.saveCell();\n\n    if (gObj.isEdit || this.editNextValCell() || gObj.isEdit) {\n      return;\n    }\n\n    var changes = this.getBatchChanges();\n\n    if (this.parent.selectionSettings.type === 'Multiple' && changes[deletedRecords].length && this.parent.selectionSettings.persistSelection) {\n      changes[deletedRecords] = this.removeSelectedData;\n      this.removeSelectedData = [];\n    }\n\n    var original = {\n      changedRecords: this.parent.getRowsObject().filter(function (row) {\n        return row.isDirty && ['add', 'delete'].indexOf(row.edit) === -1;\n      }).map(function (row) {\n        return row.data;\n      })\n    };\n    var args = {\n      batchChanges: changes,\n      cancel: false\n    };\n    gObj.trigger(events.beforeBatchSave, args, function (beforeBatchSaveArgs) {\n      if (beforeBatchSaveArgs.cancel) {\n        return;\n      }\n\n      gObj.showSpinner();\n      gObj.notify(events.bulkSave, {\n        changes: changes,\n        original: original\n      });\n    });\n  };\n\n  BatchEdit.prototype.getBatchChanges = function () {\n    var changes = {\n      addedRecords: [],\n      deletedRecords: [],\n      changedRecords: []\n    };\n    var rows = this.parent.getRowsObject();\n\n    for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n      var row = rows_1[_i];\n\n      if (row.isDirty) {\n        switch (row.edit) {\n          case 'add':\n            changes.addedRecords.push(row.changes);\n            break;\n\n          case 'delete':\n            changes.deletedRecords.push(row.data);\n            break;\n\n          default:\n            changes.changedRecords.push(row.changes);\n        }\n      }\n    }\n\n    return changes;\n  };\n  /**\n   * @param {string} uid - specifes the uid\n   * @returns {void}\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.removeRowObjectFromUID = function (uid) {\n    var rows = this.parent.getRowsObject();\n    var i = 0;\n\n    for (var len = rows.length; i < len; i++) {\n      if (rows[i].uid === uid) {\n        break;\n      }\n    }\n\n    gridActionHandler(this.parent, function (tableName, rows) {\n      rows.splice(i, 1);\n    }, getGridRowObjects(this.parent));\n  };\n  /**\n   * @param {Row<Column>} row - specifies the row object\n   * @returns {void}\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addRowObject = function (row) {\n    var gObj = this.parent;\n    var isTop = gObj.editSettings.newRowPosition === 'Top';\n    gridActionHandler(this.parent, function (tableName, rows) {\n      var rowClone = row.clone();\n      rowClone.cells = splitFrozenRowObjectCells(gObj, rowClone.cells, tableName);\n\n      if (isTop) {\n        rows.unshift(rowClone);\n      } else {\n        rows.push(rowClone);\n      }\n    }, getGridRowObjects(this.parent), true);\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  BatchEdit.prototype.bulkDelete = function (fieldname, data) {\n    var _this = this;\n\n    this.removeSelectedData = [];\n    var gObj = this.parent;\n    var index = gObj.selectedRowIndex;\n    var selectedRows = gObj.getSelectedRows();\n    var args = {\n      primaryKey: this.parent.getPrimaryKeyFieldNames(),\n      rowIndex: index,\n      rowData: data ? data : gObj.getSelectedRecords()[0],\n      cancel: false\n    };\n\n    if (data) {\n      args.row = gObj.editModule.deleteRowUid ? gObj.getRowElementByUID(gObj.editModule.deleteRowUid) : gObj.getRows()[gObj.getCurrentViewRecords().indexOf(data)];\n    } else {\n      args.row = data ? gObj.getRows()[index] : selectedRows[0];\n    }\n\n    if (!args.row) {\n      return;\n    } // tslint:disable-next-line:max-func-body-length\n\n\n    gObj.trigger(events.beforeBatchDelete, args, function (beforeBatchDeleteArgs) {\n      if (beforeBatchDeleteArgs.cancel) {\n        return;\n      }\n\n      _this.removeSelectedData = gObj.getSelectedRecords();\n      gObj.clearSelection();\n      beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row ? beforeBatchDeleteArgs.row : data ? gObj.getRows()[index] : selectedRows[0];\n\n      if (_this.parent.isFrozenGrid()) {\n        if (data) {\n          index = parseInt(beforeBatchDeleteArgs.row.getAttribute(literals.ariaRowIndex), 10);\n          selectedRows = [];\n          selectedRows.push(gObj.getRowByIndex(index));\n          selectedRows.push(gObj.getMovableRowByIndex(index));\n\n          if (gObj.getFrozenMode() === literals.leftRight) {\n            selectedRows.push(gObj.getFrozenRightRowByIndex(index));\n          }\n        }\n\n        for (var i = 0; i < selectedRows.length; i++) {\n          var uid = selectedRows[i].getAttribute('data-uid');\n\n          if (selectedRows[i].classList.contains('e-insertedrow')) {\n            _this.removeRowObjectFromUID(uid);\n\n            remove(selectedRows[i]);\n          } else {\n            var rowObj = gObj.getRowObjectFromUID(uid);\n            rowObj.isDirty = true;\n            rowObj.edit = 'delete';\n            classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n\n            if (gObj.frozenRows && index < gObj.frozenRows && gObj.getMovableDataRows().length >= gObj.frozenRows) {\n              gObj.getMovableHeaderTbody().appendChild(gObj.getMovableRowByIndex(gObj.frozenRows - 1));\n              gObj.getFrozenHeaderTbody().appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n\n              if (gObj.getFrozenMode() === literals.leftRight) {\n                gObj.getFrozenRightHeaderTbody().appendChild(gObj.getFrozenRightRowByIndex(gObj.frozenRows - 1));\n              }\n            }\n\n            if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n              gObj.getHeaderTable().querySelector(literals.tbody).appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n            }\n          }\n\n          delete selectedRows[i];\n        }\n      } else if (!_this.parent.isFrozenGrid() && (selectedRows.length === 1 || data)) {\n        var uid = beforeBatchDeleteArgs.row.getAttribute('data-uid');\n        uid = data && _this.parent.editModule.deleteRowUid ? uid = _this.parent.editModule.deleteRowUid : uid;\n\n        if (beforeBatchDeleteArgs.row.classList.contains('e-insertedrow')) {\n          _this.removeRowObjectFromUID(uid);\n\n          remove(beforeBatchDeleteArgs.row);\n        } else {\n          var rowObj = gObj.getRowObjectFromUID(uid);\n          rowObj.isDirty = true;\n          rowObj.edit = 'delete';\n          classList(beforeBatchDeleteArgs.row, ['e-hiddenrow', 'e-updatedtd'], []);\n        }\n\n        delete beforeBatchDeleteArgs.row;\n      } else {\n        for (var i = 0; i < selectedRows.length; i++) {\n          var uniqueid = selectedRows[i].getAttribute('data-uid');\n\n          if (selectedRows[i].classList.contains('e-insertedrow')) {\n            _this.removeRowObjectFromUID(uniqueid);\n\n            remove(selectedRows[i]);\n          } else {\n            classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n            var selectedRow = gObj.getRowObjectFromUID(uniqueid);\n            selectedRow.isDirty = true;\n            selectedRow.edit = 'delete';\n            delete selectedRows[i];\n          }\n        }\n      }\n\n      _this.refreshRowIdx();\n\n      if (data) {\n        gObj.editModule.deleteRowUid = undefined;\n\n        if (gObj.getSelectedRows().length) {\n          index = parseInt(gObj.getSelectedRows()[0].getAttribute(literals.ariaRowIndex), 10);\n        }\n      }\n\n      if (!gObj.isCheckBoxSelection) {\n        gObj.selectRow(index);\n      }\n\n      gObj.trigger(events.batchDelete, beforeBatchDeleteArgs);\n      gObj.notify(events.batchDelete, {\n        rows: _this.parent.getRowsObject()\n      });\n      gObj.notify(events.toolbarRefresh, {});\n    });\n  };\n\n  BatchEdit.prototype.refreshRowIdx = function () {\n    var gObj = this.parent;\n    var rows = gObj.getAllDataRows(true);\n    var dataRows = getGridRowElements(this.parent);\n    var dataObjects = getGridRowObjects(this.parent);\n\n    var _loop_2 = function (i, j, len) {\n      if (rows[i].classList.contains(literals.row) && !rows[i].classList.contains('e-hiddenrow')) {\n        gridActionHandler(this_2.parent, function (tableName, rowElements, rowObjects) {\n          rowElements[i].setAttribute(literals.ariaRowIndex, j.toString());\n          rowObjects[i].index = j;\n        }, dataRows, null, dataObjects);\n        j++;\n      } else {\n        gridActionHandler(this_2.parent, function (tableName, rowElements, rowObjects) {\n          rowElements[i].removeAttribute(literals.ariaRowIndex);\n          rowObjects[i].index = -1;\n        }, dataRows, null, dataObjects);\n      }\n\n      out_j_1 = j;\n    };\n\n    var this_2 = this,\n        out_j_1;\n\n    for (var i = 0, j = 0, len = rows.length; i < len; i++) {\n      _loop_2(i, j, len);\n\n      j = out_j_1;\n    }\n  };\n\n  BatchEdit.prototype.getIndexFromData = function (data) {\n    return inArray(data, this.parent.getCurrentViewRecords());\n  };\n\n  BatchEdit.prototype.bulkAddRow = function (data) {\n    var _this = this;\n\n    var gObj = this.parent;\n\n    if (!gObj.editSettings.allowAdding) {\n      return;\n    }\n\n    if (gObj.isEdit) {\n      this.saveCell();\n      this.parent.notify(events.editNextValCell, {});\n    }\n\n    if (gObj.isEdit) {\n      return;\n    }\n\n    this.parent.element.classList.add('e-editing');\n    var defaultData = data ? data : this.getDefaultData();\n    var args = {\n      defaultData: defaultData,\n      primaryKey: gObj.getPrimaryKeyFieldNames(),\n      cancel: false\n    };\n    gObj.trigger(events.beforeBatchAdd, args, function (beforeBatchAddArgs) {\n      if (beforeBatchAddArgs.cancel) {\n        return;\n      }\n\n      _this.isAdded = true;\n      gObj.clearSelection();\n      var mTr;\n      var frTr;\n      var row = new RowRenderer(_this.serviceLocator, null, _this.parent);\n      var model = new RowModelGenerator(_this.parent);\n      var modelData = model.generateRows([beforeBatchAddArgs.defaultData]);\n      var tr = row.render(modelData[0], gObj.getColumns());\n      var col;\n      var index;\n\n      for (var i = 0; i < _this.parent.groupSettings.columns.length; i++) {\n        tr.insertBefore(_this.parent.createElement('td', {\n          className: 'e-indentcell'\n        }), tr.firstChild);\n        modelData[0].cells.unshift(new Cell({\n          cellType: CellType.Indent\n        }));\n      }\n\n      var tbody = gObj.getContentTable().querySelector(literals.tbody);\n      tr.classList.add('e-insertedrow');\n\n      if (tbody.querySelector('.e-emptyrow')) {\n        var emptyRow = tbody.querySelector('.e-emptyrow');\n        emptyRow.parentNode.removeChild(emptyRow);\n\n        _this.removeFrozenTbody();\n      }\n\n      if (gObj.isFrozenGrid()) {\n        frTr = tr.cloneNode(true);\n        mTr = _this.renderMovable(tr, frTr);\n        tr = gObj.getFrozenMode() === 'Right' ? frTr : tr;\n\n        _this.renderFrozenAddRow(tr, mTr, frTr);\n      }\n\n      if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n        tbody = gObj.getHeaderTable().querySelector(literals.tbody);\n      } else {\n        tbody = gObj.getContentTable().querySelector(literals.tbody);\n      }\n\n      if (_this.parent.editSettings.newRowPosition === 'Top') {\n        tbody.insertBefore(tr, tbody.firstChild);\n      } else {\n        tbody.appendChild(tr);\n      }\n\n      addClass([].slice.call(tr.getElementsByClassName(literals.rowCell)), ['e-updatedtd']);\n      modelData[0].isDirty = true;\n      modelData[0].changes = extend({}, {}, modelData[0].data, true);\n      modelData[0].edit = 'add';\n\n      _this.addRowObject(modelData[0]);\n\n      _this.refreshRowIdx();\n\n      _this.focus.forgetPrevious();\n\n      gObj.notify(events.batchAdd, {\n        rows: _this.parent.getRowsObject(),\n        args: {\n          isFrozen: _this.parent.isFrozenGrid()\n        }\n      });\n\n      var changes = _this.getBatchChanges();\n\n      var btmIdx = _this.getBottomIndex();\n\n      if (_this.parent.editSettings.newRowPosition === 'Top') {\n        gObj.selectRow(0);\n      } else {\n        gObj.selectRow(btmIdx);\n      }\n\n      if (!data) {\n        index = _this.findNextEditableCell(0, true);\n        col = gObj.getColumns()[index];\n\n        if (_this.parent.editSettings.newRowPosition === 'Top') {\n          _this.editCell(0, col.field, true);\n        } else {\n          _this.editCell(btmIdx, col.field, true);\n        }\n      }\n\n      if (_this.parent.aggregates.length > 0 && (data || changes[literals.addedRecords].length)) {\n        _this.parent.notify(events.refreshFooterRenderer, {});\n      }\n\n      var args1 = {\n        defaultData: beforeBatchAddArgs.defaultData,\n        row: tr,\n        columnObject: col,\n        columnIndex: index,\n        primaryKey: beforeBatchAddArgs.primaryKey,\n        cell: tr.cells[index]\n      };\n      gObj.trigger(events.batchAdd, args1);\n\n      if (gObj.isFrozenGrid()) {\n        alignFrozenEditForm(mTr.querySelector('td:not(.e-hide)'), tr.querySelector('td:not(.e-hide)'));\n      }\n    });\n  };\n\n  BatchEdit.prototype.renderFrozenAddRow = function (tr, mTr, frTr) {\n    var gObj = this.parent;\n    var mTbody = getMovableTbody(this.parent);\n    var frTbody = getFrozenRightTbody(this.parent);\n\n    if (gObj.editSettings.newRowPosition === 'Top') {\n      mTbody.insertBefore(mTr, mTbody.firstChild);\n    } else {\n      mTbody.appendChild(mTr);\n    }\n\n    addClass([].slice.call(mTr.getElementsByClassName(literals.rowCell)), ['e-updatedtd']);\n\n    if (frTbody && frTr) {\n      if (gObj.editSettings.newRowPosition === 'Top') {\n        frTbody.insertBefore(frTr, frTbody.firstChild);\n      } else {\n        frTbody.appendChild(frTr);\n      }\n\n      addClass([].slice.call(frTr.getElementsByClassName(literals.rowCell)), ['e-updatedtd']);\n      alignFrozenEditForm(frTr.querySelector('td:not(.e-hide)'), tr.querySelector('td:not(.e-hide)'));\n    }\n\n    if (gObj.height === 'auto') {\n      gObj.notify(events.frozenHeight, {});\n    }\n  };\n\n  BatchEdit.prototype.removeFrozenTbody = function () {\n    var gObj = this.parent;\n\n    if (gObj.isFrozenGrid()) {\n      var moveTbody = gObj.getContent().querySelector('.' + literals.movableContent).querySelector(literals.tbody);\n      moveTbody.firstElementChild.parentNode.removeChild(moveTbody.firstElementChild);\n\n      if (gObj.getFrozenMode() === literals.leftRight) {\n        var frTbody = gObj.getContent().querySelector('.e-frozen-right-content').querySelector(literals.tbody);\n        frTbody.firstElementChild.parentNode.removeChild(frTbody.firstElementChild);\n      }\n    }\n  };\n\n  BatchEdit.prototype.renderMovable = function (ele, rightEle) {\n    var mEle = ele.cloneNode(true);\n    var movable = this.parent.getMovableColumnsCount();\n    var left = this.parent.getFrozenLeftCount();\n    var right = this.parent.getFrozenRightColumnsCount();\n    sliceElements(ele, 0, left);\n    sliceElements(mEle, left, right ? mEle.children.length - right : mEle.children.length);\n    sliceElements(rightEle, left + movable, rightEle.children.length);\n    return mEle;\n  };\n\n  BatchEdit.prototype.findNextEditableCell = function (columnIndex, isAdd, isValOnly) {\n    var cols = this.parent.getColumns();\n    var endIndex = cols.length;\n    var validation;\n\n    for (var i = columnIndex; i < endIndex; i++) {\n      validation = isValOnly ? isNullOrUndefined(cols[i].validationRules) : false;\n\n      if (!isAdd && this.checkNPCell(cols[i])) {\n        return i;\n      } else if (isAdd && !cols[i].template && cols[i].visible && cols[i].allowEditing && !(cols[i].isIdentity && cols[i].isPrimaryKey) && !validation) {\n        return i;\n      }\n    }\n\n    return -1;\n  };\n\n  BatchEdit.prototype.checkNPCell = function (col) {\n    return !col.template && col.visible && !col.isPrimaryKey && !col.isIdentity && col.allowEditing;\n  };\n\n  BatchEdit.prototype.getDefaultData = function () {\n    var gObj = this.parent;\n    var data = {};\n    var dValues = {\n      'number': 0,\n      'string': null,\n      'boolean': false,\n      'date': null,\n      'datetime': null\n    };\n\n    for (var _i = 0, _a = gObj.columnModel; _i < _a.length; _i++) {\n      var col = _a[_i];\n\n      if (col.field) {\n        setValue(col.field, Object.keys(col).indexOf('defaultValue') >= 0 ? col.defaultValue : dValues[col.type], data);\n      }\n    }\n\n    return data;\n  };\n\n  BatchEdit.prototype.setCellIdx = function (target) {\n    var gLen = 0;\n\n    if (this.parent.allowGrouping) {\n      gLen = this.parent.groupSettings.columns.length;\n    }\n\n    this.cellDetails.cellIndex = target.cellIndex - gLen;\n    this.cellDetails.rowIndex = parseInt(target.getAttribute('index'), 10);\n  };\n\n  BatchEdit.prototype.editCell = function (index, field, isAdd) {\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    this.index = index;\n    this.field = field;\n    this.isAdd = isAdd;\n    var checkEdit = gObj.isEdit && !(this.cellDetails.column.field === field && this.cellDetails.rowIndex === index && this.parent.getDataRows().length - 1 !== index);\n\n    if (gObj.editSettings.allowEditing) {\n      if (!checkEdit && col.allowEditing) {\n        this.editCellExtend(index, field, isAdd);\n      } else if (checkEdit) {\n        this.editNext = true;\n        this.saveCell();\n      }\n    }\n  };\n\n  BatchEdit.prototype.editCellExtend = function (index, field, isAdd) {\n    var _this = this;\n\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    var keys = gObj.getPrimaryKeyFieldNames();\n\n    if (gObj.isEdit) {\n      return;\n    }\n\n    var row;\n    var mRowData;\n    var rowData = extend({}, {}, this.getDataByIndex(index), true);\n\n    if (col.getFreezeTableName() === 'movable' || col.getFreezeTableName() === literals.frozenRight) {\n      row = col.getFreezeTableName() === 'movable' ? gObj.getMovableDataRows()[index] : gObj.getFrozenRightDataRows()[index];\n      mRowData = this.parent.getRowObjectFromUID(row.getAttribute('data-uid'));\n      rowData = mRowData.changes ? extend({}, {}, mRowData.changes, true) : rowData;\n    } else {\n      row = gObj.getDataRows()[index];\n      rowData = extend({}, {}, this.getDataByIndex(index), true);\n    }\n\n    if (keys[0] === col.field && !row.classList.contains('e-insertedrow') || col.columns || col.isPrimaryKey && col.isIdentity) {\n      this.parent.isLastCellPrimaryKey = true;\n      return;\n    }\n\n    this.parent.isLastCellPrimaryKey = false;\n    this.parent.element.classList.add('e-editing');\n    var rowObj = gObj.getRowObjectFromUID(row.getAttribute('data-uid'));\n    var cells = [].slice.apply(row.cells);\n    var args = {\n      columnName: col.field,\n      isForeignKey: !isNullOrUndefined(col.foreignKeyValue),\n      primaryKey: keys,\n      rowData: rowData,\n      validationRules: extend({}, col.validationRules ? col.validationRules : {}),\n      value: getObject(col.field, rowData),\n      type: !isAdd ? 'edit' : 'add',\n      cancel: false,\n      foreignKeyData: rowObj && rowObj.foreignKeyData\n    };\n    args.cell = cells[this.getColIndex(cells, this.getCellIdx(col.uid))];\n    args.row = row;\n    args.columnObject = col;\n\n    if (!args.cell) {\n      return;\n    }\n\n    gObj.trigger(events.cellEdit, args, function (cellEditArgs) {\n      if (cellEditArgs.cancel) {\n        return;\n      }\n\n      cellEditArgs.cell = cellEditArgs.cell ? cellEditArgs.cell : cells[_this.getColIndex(cells, _this.getCellIdx(col.uid))];\n      cellEditArgs.row = cellEditArgs.row ? cellEditArgs.row : row;\n      cellEditArgs.columnObject = cellEditArgs.columnObject ? cellEditArgs.columnObject : col;\n      cellEditArgs.columnObject.index = isNullOrUndefined(cellEditArgs.columnObject.index) ? 0 : cellEditArgs.columnObject.index;\n      _this.cellDetails = {\n        rowData: rowData,\n        column: col,\n        value: cellEditArgs.value,\n        isForeignKey: cellEditArgs.isForeignKey,\n        rowIndex: index,\n        cellIndex: parseInt(cellEditArgs.cell.getAttribute(literals.ariaColIndex), 10),\n        foreignKeyData: cellEditArgs.foreignKeyData\n      };\n\n      if (cellEditArgs.cell.classList.contains('e-updatedtd')) {\n        _this.isColored = true;\n        cellEditArgs.cell.classList.remove('e-updatedtd');\n      }\n\n      gObj.isEdit = true;\n      gObj.clearSelection();\n\n      if (!gObj.isCheckBoxSelection || !gObj.isPersistSelection) {\n        gObj.selectRow(_this.cellDetails.rowIndex, true);\n      }\n\n      _this.renderer.update(cellEditArgs);\n\n      _this.parent.notify(events.batchEditFormRendered, cellEditArgs);\n\n      _this.form = select('#' + gObj.element.id + 'EditForm', gObj.element);\n      gObj.editModule.applyFormValidation([col]);\n      _this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n    });\n  };\n\n  BatchEdit.prototype.updateCell = function (rowIndex, field, value) {\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    var index = gObj.getColumnIndexByField(field);\n\n    if (col && !col.isPrimaryKey && col.allowEditing) {\n      var td = getCellByColAndRowIndex(this.parent, col, rowIndex, index);\n      var rowObj = col.getFreezeTableName() === 'movable' ? this.parent.getMovableRowsObject()[rowIndex] : col.getFreezeTableName() === literals.frozenRight ? gObj.getFrozenRightRowsObject()[rowIndex] : gObj.getRowObjectFromUID(td.parentElement.getAttribute('data-uid'));\n      this.refreshTD(td, col, rowObj, value);\n      this.parent.trigger(events.queryCellInfo, {\n        cell: this.newReactTd || td,\n        column: col,\n        data: rowObj.changes\n      });\n    }\n  };\n\n  BatchEdit.prototype.setChanges = function (rowObj, field, value) {\n    var currentRowObj;\n\n    if (!this.parent.isFrozenGrid()) {\n      if (!rowObj.changes) {\n        rowObj.changes = extend({}, {}, rowObj.data, true);\n      }\n\n      if (!isNullOrUndefined(field)) {\n        DataUtil.setValue(field, value, rowObj.changes);\n      }\n\n      if (rowObj.data[field] !== value) {\n        var type = this.parent.getColumnByField(field).type;\n\n        if (type === 'date' || type === 'datetime') {\n          if (new Date(rowObj.data[field]).toString() !== new Date(value).toString()) {\n            rowObj.isDirty = true;\n          }\n        } else {\n          rowObj.isDirty = true;\n        }\n      }\n    } else {\n      var rowEle = this.parent.getRowElementByUID(rowObj.uid);\n      var rowIndex = parseInt(rowEle.getAttribute(literals.ariaRowIndex), 10);\n      currentRowObj = this.parent.getRowsObject()[rowIndex];\n\n      if (!currentRowObj.changes) {\n        currentRowObj.changes = extend({}, {}, rowObj.data, true);\n      }\n\n      if (!isNullOrUndefined(field)) {\n        setValue(field, value, currentRowObj.changes);\n      }\n\n      var movableRowObject = this.parent.getMovableRowsObject()[rowIndex];\n      movableRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n\n      if (rowObj.data[field] !== value) {\n        movableRowObject.isDirty = true;\n        currentRowObj.isDirty = true;\n      }\n\n      if (this.parent.getFrozenMode() === literals.leftRight) {\n        var frRowObject = this.parent.getFrozenRightRowsObject()[rowIndex];\n        frRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n\n        if (rowObj.data[field] !== value) {\n          frRowObject.isDirty = true;\n        }\n      }\n    }\n  };\n\n  BatchEdit.prototype.updateRow = function (index, data) {\n    var keys = Object.keys(data);\n\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n      var col = keys_1[_i];\n      this.updateCell(index, col, data[col]);\n    }\n  };\n\n  BatchEdit.prototype.getCellIdx = function (uid) {\n    var cIdx = this.parent.getColumnIndexByUid(uid) + this.parent.groupSettings.columns.length;\n\n    if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n      cIdx++;\n    }\n\n    if (this.parent.isRowDragable()) {\n      cIdx++;\n    }\n\n    return cIdx;\n  };\n\n  BatchEdit.prototype.refreshTD = function (td, column, rowObj, value) {\n    var cell = new CellRenderer(this.parent, this.serviceLocator);\n    var rowcell;\n    value = column.type === 'number' && !isNullOrUndefined(value) ? parseFloat(value) : value;\n    this.setChanges(rowObj, column.field, value);\n    var frzCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount() || this.parent.getFrozenRightColumnsCount();\n    frzCols = frzCols && this.parent.isRowDragable() ? frzCols + 1 : frzCols;\n    refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n\n    if (frzCols && column.getFreezeTableName() === 'movable' && this.parent.getColumns().length === rowObj.cells.length) {\n      rowcell = rowObj.cells.slice(frzCols, rowObj.cells.length);\n    } else {\n      rowcell = rowObj.cells;\n    }\n\n    var parentElement;\n    var cellIndex;\n\n    if (this.parent.isReact) {\n      parentElement = td.parentElement;\n      cellIndex = td.cellIndex;\n    }\n\n    var index = 0;\n\n    if (frzCols) {\n      index = column.getFreezeTableName() === 'movable' && this.parent.getFrozenMode() !== 'Right' ? frzCols : column.getFreezeTableName() === literals.frozenRight ? this.parent.getFrozenLeftColumnsCount() + this.parent.getMovableColumnsCount() : index;\n    }\n\n    cell.refreshTD(td, rowcell[this.getCellIdx(column.uid) - index], rowObj.changes, {\n      'index': this.getCellIdx(column.uid)\n    });\n\n    if (this.parent.isReact) {\n      this.newReactTd = parentElement.cells[cellIndex];\n      parentElement.cells[cellIndex].classList.add('e-updatedtd');\n    } else {\n      td.classList.add('e-updatedtd');\n    }\n\n    td.classList.add('e-updatedtd');\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n\n  BatchEdit.prototype.getColIndex = function (cells, index) {\n    var cIdx = 0;\n\n    if (this.parent.allowGrouping && this.parent.groupSettings.columns) {\n      cIdx = this.parent.groupSettings.columns.length;\n    }\n\n    if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n      cIdx++;\n    }\n\n    if (this.parent.isRowDragable()) {\n      cIdx++;\n    }\n\n    for (var m = 0; m < cells.length; m++) {\n      var colIndex = parseInt(cells[m].getAttribute(literals.ariaColIndex), 10);\n\n      if (colIndex === index - cIdx) {\n        return m;\n      }\n    }\n\n    return -1;\n  };\n\n  BatchEdit.prototype.editNextValCell = function () {\n    var gObj = this.parent;\n    var btmIdx = this.getBottomIndex();\n\n    if (this.isAdded && !gObj.isEdit) {\n      for (var i = this.cellDetails.cellIndex; i < gObj.getColumns().length; i++) {\n        if (gObj.isEdit) {\n          return;\n        }\n\n        var index = this.findNextEditableCell(this.cellDetails.cellIndex + 1, true, true);\n        var col = gObj.getColumns()[index];\n\n        if (col) {\n          if (this.parent.editSettings.newRowPosition === 'Bottom') {\n            this.editCell(btmIdx, col.field, true);\n          } else {\n            var args = {\n              index: 0,\n              column: col\n            };\n            this.parent.notify(events.nextCellIndex, args);\n            this.editCell(args.index, col.field, true);\n          }\n\n          this.saveCell();\n        }\n      }\n\n      if (!gObj.isEdit) {\n        this.isAdded = false;\n      }\n    }\n  };\n\n  BatchEdit.prototype.escapeCellEdit = function () {\n    var args = this.generateCellArgs();\n    args.value = args.previousValue;\n    this.successCallBack(args, args.cell.parentElement, args.column, true)(args);\n  };\n\n  BatchEdit.prototype.generateCellArgs = function () {\n    var gObj = this.parent;\n    this.parent.element.classList.remove('e-editing');\n    var column = this.cellDetails.column;\n    var obj = {};\n    obj[column.field] = getObject(column.field, this.cellDetails.rowData);\n    var editedData = gObj.editModule.getCurrentEditedData(this.form, obj);\n    var cloneEditedData = extend({}, editedData);\n    editedData = extend({}, editedData, this.cellDetails.rowData);\n    var value = getObject(column.field, cloneEditedData);\n\n    if (!isNullOrUndefined(column.field) && !isUndefined(value)) {\n      setValue(column.field, value, editedData);\n    }\n\n    var args = {\n      columnName: column.field,\n      value: getObject(column.field, editedData),\n      rowData: this.cellDetails.rowData,\n      column: column,\n      previousValue: this.cellDetails.value,\n      isForeignKey: this.cellDetails.isForeignKey,\n      cancel: false\n    };\n    args.cell = this.form.parentElement;\n    args.columnObject = column;\n    return args;\n  };\n\n  BatchEdit.prototype.saveCell = function (isForceSave) {\n    if (this.preventSaveCell || !this.form) {\n      return;\n    }\n\n    var gObj = this.parent;\n\n    if (!isForceSave && (!gObj.isEdit || this.validateFormObj())) {\n      return;\n    }\n\n    this.preventSaveCell = true;\n    var args = this.generateCellArgs();\n    var tr = args.cell.parentElement;\n    var col = args.column;\n\n    if (!isForceSave) {\n      gObj.trigger(events.cellSave, args, this.successCallBack(args, tr, col));\n      gObj.notify(events.batchForm, {\n        formObj: this.form\n      });\n    } else {\n      this.successCallBack(args, tr, col)(args);\n    }\n  };\n\n  BatchEdit.prototype.successCallBack = function (cellSaveArgs, tr, column, isEscapeCellEdit) {\n    var _this = this;\n\n    return function (cellSaveArgs) {\n      var gObj = _this.parent;\n      cellSaveArgs.cell = cellSaveArgs.cell ? cellSaveArgs.cell : _this.form.parentElement;\n      cellSaveArgs.columnObject = cellSaveArgs.columnObject ? cellSaveArgs.columnObject : column;\n      cellSaveArgs.columnObject.index = isNullOrUndefined(cellSaveArgs.columnObject.index) ? 0 : cellSaveArgs.columnObject.index;\n\n      if (cellSaveArgs.cancel) {\n        _this.preventSaveCell = false;\n\n        if (_this.editNext) {\n          _this.editNext = false;\n\n          if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n            return;\n          }\n\n          _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n        }\n\n        return;\n      }\n\n      gObj.editModule.destroyWidgets([column]);\n      gObj.isEdit = false;\n      gObj.editModule.destroyForm();\n\n      _this.parent.notify(events.tooltipDestroy, {});\n\n      var rowObj = parentsUntil(cellSaveArgs.cell, literals.movableContent) || parentsUntil(cellSaveArgs.cell, literals.movableHeader) ? gObj.getRowObjectFromUID(tr.getAttribute('data-uid'), true) : gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n\n      if (gObj.getFrozenMode() === literals.leftRight && (parentsUntil(cellSaveArgs.cell, 'e-frozen-right-header') || parentsUntil(cellSaveArgs.cell, 'e-frozen-right-content'))) {\n        rowObj = gObj.getRowObjectFromUID(tr.getAttribute('data-uid'), false, true);\n      }\n\n      _this.refreshTD(cellSaveArgs.cell, column, rowObj, cellSaveArgs.value);\n\n      if (_this.parent.isReact) {\n        cellSaveArgs.cell = _this.newReactTd;\n      }\n\n      removeClass([tr], [literals.editedRow, 'e-batchrow']);\n      removeClass([cellSaveArgs.cell], ['e-editedbatchcell', 'e-boolcell']);\n\n      if (!isNullOrUndefined(cellSaveArgs.value) && cellSaveArgs.value.toString() === (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString() && !_this.isColored || isNullOrUndefined(cellSaveArgs.value) && isNullOrUndefined(rowObj.data[column.field]) && isNullOrUndefined(_this.cellDetails.value) && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n        cellSaveArgs.cell.classList.remove('e-updatedtd');\n      }\n\n      if (isNullOrUndefined(isEscapeCellEdit)) {\n        gObj.trigger(events.cellSaved, cellSaveArgs);\n      }\n\n      gObj.notify(events.toolbarRefresh, {});\n      _this.isColored = false;\n\n      if (_this.parent.aggregates.length > 0) {\n        _this.parent.notify(events.refreshFooterRenderer, {});\n\n        if (_this.parent.groupSettings.columns.length > 0 && !_this.isAddRow(_this.cellDetails.rowIndex)) {\n          _this.parent.notify(events.groupAggregates, {});\n        }\n      }\n\n      _this.preventSaveCell = false;\n\n      if (_this.editNext) {\n        _this.editNext = false;\n\n        if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n          return;\n        }\n\n        var col = gObj.getColumnByField(_this.field);\n\n        if (col && col.allowEditing) {\n          _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n        }\n      }\n\n      if (isEscapeCellEdit) {\n        gObj.notify(events.restoreFocus, {});\n      }\n    };\n  };\n\n  BatchEdit.prototype.getDataByIndex = function (index) {\n    var row = this.parent.getRowObjectFromUID(this.parent.getDataRows()[index].getAttribute('data-uid'));\n    return row.changes ? row.changes : row.data;\n  };\n\n  BatchEdit.prototype.keyDownHandler = function (e) {\n    if ((e.action === 'tab' || e.action === 'shiftTab') && this.parent.isEdit) {\n      var gObj = this.parent;\n      var btmIdx = this.getBottomIndex();\n      var rowcell = parentsUntil(e.target, literals.rowCell);\n\n      if (rowcell) {\n        var cell = rowcell.querySelector('.e-field');\n\n        if (cell) {\n          var visibleColumns = this.parent.getVisibleColumns();\n          var columnIndex = e.action === 'tab' ? visibleColumns.length - 1 : 0;\n\n          if (visibleColumns[columnIndex].field === cell.getAttribute('id').slice(this.parent.element.id.length)) {\n            if (this.cellDetails.rowIndex === btmIdx && e.action === 'tab') {\n              if (gObj.editSettings.newRowPosition === 'Top') {\n                gObj.editSettings.newRowPosition = 'Bottom';\n                this.addRecord();\n                gObj.editSettings.newRowPosition = 'Top';\n              } else {\n                this.addRecord();\n              }\n            } else {\n              this.saveCell();\n            }\n          }\n        }\n      }\n    }\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addCancelWhilePaging = function () {\n    if (this.validateFormObj()) {\n      this.parent.notify(events.destroyForm, {});\n      this.parent.isEdit = false;\n      this.isColored = false;\n    }\n  };\n\n  BatchEdit.prototype.getBottomIndex = function () {\n    var changes = this.getBatchChanges();\n    return this.parent.getCurrentViewRecords().length + changes[literals.addedRecords].length - changes[literals.deletedRecords].length - 1;\n  };\n\n  return BatchEdit;\n}();\n\nexport { BatchEdit };","map":{"version":3,"names":["extend","addClass","removeClass","setValue","closest","select","remove","classList","isNullOrUndefined","isUndefined","CellType","parentsUntil","inArray","refreshForeignData","getObject","alignFrozenEditForm","gridActionHandler","addRemoveEventListener","splitFrozenRowObjectCells","getGridRowElements","sliceElements","getCellByColAndRowIndex","getMovableTbody","getFrozenRightTbody","getGridRowObjects","events","RowRenderer","CellRenderer","Row","Cell","RowModelGenerator","DataUtil","literals","BatchEdit","parent","serviceLocator","renderer","cellDetails","originalCell","cloneCell","editNext","preventSaveCell","focus","getService","addEventListener","prototype","isDestroyed","evtHandlers","event","click","handler","clickHandler","dblclick","dblClickHandler","beforeCellFocused","onBeforeCellFocused","cellFocused","onCellFocused","doubleTap","keyPressed","keyDownHandler","editNextValCell","closeBatch","closeForm","destroy","dataBoundFunction","dataBound","bind","batchCancelFunction","batchCancel","removeEventListener","focusModule","restoreFocus","notify","toolbarRefresh","e","target","element","id","isEdit","form","saveCell","rowCell","setCellIdx","tr","row","rowIndex","parseInt","getAttribute","ariaRowIndex","colIndex","ariaColIndex","isNaN","parentElement","contains","editedRow","editCell","getColumns","field","isAddRow","validateFormObj","byClick","indexOf","keyArgs","action","cancel","clickArgs","preventDefault","frzCols","getFrozenLeftCount","frzRightCols","getFrozenRightColumnsCount","mCont","getContent","querySelector","movableContent","mHdr","getHeaderContent","movableHeader","clear","container","isContent","isDataCell","frozenRows","isHeader","byKey","_a","indexes","cellIndex","frHdr","frCont","getMovableColumnsCount","getElementsByClassName","length","col","isLastCellPrimaryKey","editCellFromIndex","args","column","index","getDataRows","rowIdx","cellIdx","closeEdit","_this","gObj","rows","getRowsObject","argument","batchChanges","getBatchChanges","beforeBatchCancel","isAdded","clearSelection","allRows","_loop_1","i","isInsert","isDirty","this_1","tableName","removeBatchElementChanges","splice","out_i_1","getContentTable","renderModule","renderEmptyRow","requestType","isDataRow","cells","visible","selectRow","refreshRowIdx","tooltipDestroy","trigger","rowRenderer","isInstertedRemoved","getRowElementByUID","uid","getForeignKeyColumns","data","changes","edit","refresh","aggregates","type","editType","refreshFooterRenderer","groupSettings","columns","groupAggregates","removeHideAndSelection","removeAttribute","tdElements","slice","call","deleteRecord","fieldname","bulkDelete","addRecord","bulkAddRow","endEdit","batchSave","Object","keys","j","replaceWith","editModule","formObj","validate","deletedRecords","isCheckBoxSelection","checkAllBox","pageSettings","totalRecordsCount","currentViewData","selectionSettings","persistSelection","removeSelectedData","original","changedRecords","filter","map","beforeBatchSave","beforeBatchSaveArgs","showSpinner","bulkSave","addedRecords","_i","rows_1","push","removeRowObjectFromUID","len","addRowObject","isTop","editSettings","newRowPosition","rowClone","clone","unshift","selectedRowIndex","selectedRows","getSelectedRows","primaryKey","getPrimaryKeyFieldNames","rowData","getSelectedRecords","deleteRowUid","getRows","getCurrentViewRecords","beforeBatchDelete","beforeBatchDeleteArgs","isFrozenGrid","getRowByIndex","getMovableRowByIndex","getFrozenMode","leftRight","getFrozenRightRowByIndex","rowObj","getRowObjectFromUID","getMovableDataRows","getMovableHeaderTbody","appendChild","getFrozenHeaderTbody","getFrozenRightHeaderTbody","getHeaderTable","tbody","uniqueid","selectedRow","undefined","batchDelete","getAllDataRows","dataRows","dataObjects","_loop_2","this_2","rowElements","rowObjects","setAttribute","toString","out_j_1","getIndexFromData","allowAdding","add","defaultData","getDefaultData","beforeBatchAdd","beforeBatchAddArgs","mTr","frTr","model","modelData","generateRows","render","insertBefore","createElement","className","firstChild","cellType","Indent","emptyRow","parentNode","removeChild","removeFrozenTbody","cloneNode","renderMovable","renderFrozenAddRow","forgetPrevious","batchAdd","isFrozen","btmIdx","getBottomIndex","findNextEditableCell","args1","columnObject","columnIndex","cell","mTbody","frTbody","height","frozenHeight","moveTbody","firstElementChild","ele","rightEle","mEle","movable","left","right","children","isAdd","isValOnly","cols","endIndex","validation","validationRules","checkNPCell","template","allowEditing","isIdentity","isPrimaryKey","dValues","columnModel","defaultValue","gLen","allowGrouping","getColumnByField","checkEdit","editCellExtend","mRowData","getDataByIndex","getFreezeTableName","frozenRight","getFrozenRightDataRows","apply","columnName","isForeignKey","foreignKeyValue","value","foreignKeyData","getColIndex","getCellIdx","cellEdit","cellEditArgs","isColored","isPersistSelection","update","batchEditFormRendered","applyFormValidation","style","display","updateCell","getColumnIndexByField","td","getMovableRowsObject","getFrozenRightRowsObject","refreshTD","queryCellInfo","newReactTd","setChanges","currentRowObj","Date","rowEle","movableRowObject","frRowObject","updateRow","keys_1","cIdx","getColumnIndexByUid","detailTemplate","childGrid","isRowDragable","rowcell","parseFloat","getFrozenColumns","getFrozenLeftColumnsCount","isReact","m","nextCellIndex","escapeCellEdit","generateCellArgs","previousValue","successCallBack","obj","editedData","getCurrentEditedData","cloneEditedData","isForceSave","cellSave","batchForm","cellSaveArgs","isEscapeCellEdit","destroyWidgets","destroyForm","cellSaved","visibleColumns","getVisibleColumns","addCancelWhilePaging"],"sources":["C:/Users/shahj/OneDrive/Documents/GitHub/Admin Dashboard/Frontend/node_modules/@syncfusion/ej2-grids/src/grid/actions/batch-edit.js"],"sourcesContent":["import { extend, addClass, removeClass, setValue, closest, select } from '@syncfusion/ej2-base';\nimport { remove, classList } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, isUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { parentsUntil, inArray, refreshForeignData, getObject, alignFrozenEditForm, gridActionHandler, addRemoveEventListener } from '../base/util';\nimport { splitFrozenRowObjectCells, getGridRowElements } from '../base/util';\nimport { sliceElements, getCellByColAndRowIndex, getMovableTbody, getFrozenRightTbody } from '../base/util';\nimport { getGridRowObjects } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\nimport * as literals from '../base/string-literals';\n/**\n * `BatchEdit` module is used to handle batch editing actions.\n *\n * @hidden\n */\nvar BatchEdit = /** @class */ (function () {\n    function BatchEdit(parent, serviceLocator, renderer) {\n        this.cellDetails = {};\n        this.originalCell = {};\n        this.cloneCell = {};\n        this.editNext = false;\n        this.preventSaveCell = false;\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.renderer = renderer;\n        this.focus = serviceLocator.getService('focus');\n        this.addEventListener();\n    }\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    BatchEdit.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.evtHandlers = [{ event: events.click, handler: this.clickHandler },\n            { event: events.dblclick, handler: this.dblClickHandler },\n            { event: events.beforeCellFocused, handler: this.onBeforeCellFocused },\n            { event: events.cellFocused, handler: this.onCellFocused },\n            { event: events.doubleTap, handler: this.dblClickHandler },\n            { event: events.keyPressed, handler: this.keyDownHandler },\n            { event: events.editNextValCell, handler: this.editNextValCell },\n            { event: events.closeBatch, handler: this.closeForm },\n            { event: events.destroy, handler: this.destroy }];\n        addRemoveEventListener(this.parent, this.evtHandlers, true, this);\n        this.dataBoundFunction = this.dataBound.bind(this);\n        this.batchCancelFunction = this.batchCancel.bind(this);\n        this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n        this.parent.addEventListener(events.batchCancel, this.batchCancelFunction);\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    BatchEdit.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        addRemoveEventListener(this.parent, this.evtHandlers, false);\n        this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n        this.parent.removeEventListener(events.batchCancel, this.batchCancelFunction);\n    };\n    BatchEdit.prototype.batchCancel = function () {\n        this.parent.focusModule.restoreFocus();\n    };\n    BatchEdit.prototype.dataBound = function () {\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    BatchEdit.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    BatchEdit.prototype.clickHandler = function (e) {\n        if (!parentsUntil(e.target, this.parent.element.id + '_add', true)) {\n            if (this.parent.isEdit && closest(this.form, 'td') !== closest(e.target, 'td')) {\n                this.saveCell();\n                this.editNextValCell();\n            }\n            if (parentsUntil(e.target, literals.rowCell) && !this.parent.isEdit) {\n                this.setCellIdx(e.target);\n            }\n        }\n    };\n    BatchEdit.prototype.dblClickHandler = function (e) {\n        var target = parentsUntil(e.target, literals.rowCell);\n        var tr = parentsUntil(e.target, literals.row);\n        var rowIndex = tr && parseInt(tr.getAttribute(literals.ariaRowIndex), 10);\n        var colIndex = target && parseInt(target.getAttribute(literals.ariaColIndex), 10);\n        if (!isNullOrUndefined(target) && !isNullOrUndefined(rowIndex) && !isNaN(colIndex)\n            && !target.parentElement.classList.contains(literals.editedRow)) {\n            this.editCell(rowIndex, this.parent.getColumns()[colIndex].field, this.isAddRow(rowIndex));\n        }\n    };\n    BatchEdit.prototype.onBeforeCellFocused = function (e) {\n        if (this.parent.isEdit && this.validateFormObj() &&\n            (e.byClick || (['tab', 'shiftTab', 'enter', 'shiftEnter'].indexOf(e.keyArgs.action) > -1))) {\n            e.cancel = true;\n            if (e.byClick) {\n                e.clickArgs.preventDefault();\n            }\n            else {\n                e.keyArgs.preventDefault();\n            }\n        }\n    };\n    BatchEdit.prototype.onCellFocused = function (e) {\n        var frzCols = this.parent.getFrozenLeftCount();\n        var frzRightCols = this.parent.getFrozenRightColumnsCount();\n        var mCont = this.parent.getContent().querySelector('.' + literals.movableContent);\n        var mHdr = this.parent.getHeaderContent().querySelector('.' + literals.movableHeader);\n        var clear = (!e.container.isContent || !e.container.isDataCell) && !(this.parent.frozenRows && e.container.isHeader);\n        if (!e.byKey || clear) {\n            if (this.parent.isEdit && clear) {\n                this.saveCell();\n            }\n            return;\n        }\n        var _a = e.container.indexes, rowIndex = _a[0], cellIndex = _a[1];\n        if (frzCols && (mCont.contains(e.element) || (this.parent.frozenRows && mHdr.contains(e.element)))) {\n            cellIndex += frzCols;\n        }\n        if (frzRightCols) {\n            var frHdr = this.parent.getHeaderContent().querySelector('.e-frozen-right-header');\n            var frCont = this.parent.getContent().querySelector('.e-frozen-right-content');\n            if (frCont.contains(e.element) || (this.parent.frozenRows && frHdr.contains(e.element))) {\n                cellIndex += (frzCols + this.parent.getMovableColumnsCount());\n            }\n        }\n        if (this.parent.frozenRows && e.container.isContent) {\n            rowIndex += this.parent.frozenRows;\n        }\n        var isEdit = this.parent.isEdit;\n        if (!this.parent.element.getElementsByClassName('e-popup-open').length) {\n            isEdit = isEdit && !this.validateFormObj();\n            switch (e.keyArgs.action) {\n                case 'tab':\n                case 'shiftTab':\n                    // eslint-disable-next-line no-case-declarations\n                    var col = this.parent.getColumns()[e.indexes[1]];\n                    if (col && !this.parent.isEdit) {\n                        this.editCell(e.indexes[0], col.field);\n                    }\n                    if (isEdit || this.parent.isLastCellPrimaryKey) {\n                        this.editCellFromIndex(rowIndex, cellIndex);\n                    }\n                    break;\n                case 'enter':\n                case 'shiftEnter':\n                    e.keyArgs.preventDefault();\n                    // eslint-disable-next-line no-case-declarations\n                    var args = { cancel: false, keyArgs: e.keyArgs };\n                    this.parent.notify('beforeFocusCellEdit', args);\n                    if (!args.cancel && isEdit) {\n                        this.editCell(rowIndex, this.cellDetails.column.field);\n                    }\n                    break;\n                case 'f2':\n                    this.editCellFromIndex(rowIndex, cellIndex);\n                    this.focus.focus();\n                    break;\n            }\n        }\n    };\n    BatchEdit.prototype.isAddRow = function (index) {\n        return this.parent.getDataRows()[index].classList.contains('e-insertedrow');\n    };\n    BatchEdit.prototype.editCellFromIndex = function (rowIdx, cellIdx) {\n        this.cellDetails.rowIndex = rowIdx;\n        this.cellDetails.cellIndex = cellIdx;\n        this.editCell(rowIdx, this.parent.getColumns()[cellIdx].field, this.isAddRow(rowIdx));\n    };\n    BatchEdit.prototype.closeEdit = function () {\n        var _this = this;\n        var gObj = this.parent;\n        var rows = this.parent.getRowsObject();\n        var argument = { cancel: false, batchChanges: this.getBatchChanges() };\n        gObj.notify(events.beforeBatchCancel, argument);\n        if (argument.cancel) {\n            return;\n        }\n        if (gObj.isEdit) {\n            this.saveCell(true);\n        }\n        this.isAdded = false;\n        gObj.clearSelection();\n        var allRows = getGridRowObjects(this.parent);\n        var _loop_1 = function (i) {\n            var isInsert = false;\n            var isDirty = rows[i].isDirty;\n            gridActionHandler(this_1.parent, function (tableName, rows) {\n                isInsert = _this.removeBatchElementChanges(rows[i], isDirty);\n                if (isInsert) {\n                    rows.splice(i, 1);\n                }\n            }, allRows);\n            if (isInsert) {\n                i--;\n            }\n            out_i_1 = i;\n        };\n        var this_1 = this, out_i_1;\n        for (var i = 0; i < rows.length; i++) {\n            _loop_1(i);\n            i = out_i_1;\n        }\n        if (!gObj.getContentTable().querySelector('tr.e-row')) {\n            gObj.renderModule.renderEmptyRow();\n        }\n        var args = {\n            requestType: 'batchCancel', rows: this.parent.getRowsObject()\n        };\n        gObj.notify(events.batchCancel, {\n            rows: this.parent.getRowsObject().length ? this.parent.getRowsObject() :\n                [new Row({ isDataRow: true, cells: [new Cell({ isDataCell: true, visible: true })] })]\n        });\n        gObj.selectRow(this.cellDetails.rowIndex);\n        this.refreshRowIdx();\n        gObj.notify(events.toolbarRefresh, {});\n        this.parent.notify(events.tooltipDestroy, {});\n        args = { requestType: 'batchCancel', rows: this.parent.getRowsObject() };\n        gObj.trigger(events.batchCancel, args);\n    };\n    BatchEdit.prototype.removeBatchElementChanges = function (row, isDirty) {\n        var gObj = this.parent;\n        var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n        var isInstertedRemoved = false;\n        if (isDirty) {\n            row.isDirty = isDirty;\n            var tr = gObj.getRowElementByUID(row.uid);\n            if (tr) {\n                if (tr.classList.contains('e-insertedrow')) {\n                    remove(tr);\n                    isInstertedRemoved = true;\n                }\n                else {\n                    refreshForeignData(row, this.parent.getForeignKeyColumns(), row.data);\n                    delete row.changes;\n                    delete row.edit;\n                    row.isDirty = false;\n                    classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n                    rowRenderer.refresh(row, gObj.getColumns(), false);\n                }\n                if (this.parent.aggregates.length > 0) {\n                    var type = 'type';\n                    var editType = [];\n                    editType[type] = 'cancel';\n                    this.parent.notify(events.refreshFooterRenderer, editType);\n                    if (this.parent.groupSettings.columns.length > 0) {\n                        this.parent.notify(events.groupAggregates, editType);\n                    }\n                }\n            }\n        }\n        return isInstertedRemoved;\n    };\n    BatchEdit.prototype.removeHideAndSelection = function (tr) {\n        if (tr.classList.contains('e-hiddenrow')) {\n            tr.removeAttribute('aria-selected');\n            var tdElements = [].slice.call(tr.getElementsByClassName('e-selectionbackground'));\n            for (var i = 0; i < tdElements.length; i++) {\n                removeClass([tdElements[i]], ['e-selectionbackground', 'e-active']);\n            }\n        }\n        classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n    };\n    BatchEdit.prototype.deleteRecord = function (fieldname, data) {\n        this.saveCell();\n        if (this.validateFormObj()) {\n            this.saveCell(true);\n        }\n        this.isAdded = false;\n        this.bulkDelete(fieldname, data);\n        if (this.parent.aggregates.length > 0) {\n            this.parent.notify(events.refreshFooterRenderer, {});\n            if (this.parent.groupSettings.columns.length > 0) {\n                this.parent.notify(events.groupAggregates, {});\n            }\n        }\n    };\n    BatchEdit.prototype.addRecord = function (data) {\n        this.bulkAddRow(data);\n    };\n    BatchEdit.prototype.endEdit = function () {\n        if (this.parent.isEdit && this.validateFormObj()) {\n            return;\n        }\n        this.batchSave();\n    };\n    BatchEdit.prototype.closeForm = function () {\n        for (var i = 0; i < Object.keys(this.originalCell).length; i++) {\n            for (var j = 0; j < Object.keys(this.cloneCell).length; j++) {\n                if (Object.keys(this.originalCell)[i] === Object.keys(this.cloneCell)[j]) {\n                    this.cloneCell[Object.keys(this.cloneCell)[j]].replaceWith(this.originalCell[Object.keys(this.originalCell)[i]]);\n                    if (this.originalCell[Object.keys(this.originalCell)[i]].classList.contains('e-selectionbackground')) {\n                        this.originalCell[Object.keys(this.originalCell)[i]]\n                            .classList.remove('e-selectionbackground', 'e-cellselectionbackground', 'e-active');\n                    }\n                }\n            }\n        }\n        this.cloneCell = {};\n        this.originalCell = {};\n    };\n    BatchEdit.prototype.validateFormObj = function () {\n        return this.parent.editModule.formObj && !this.parent.editModule.formObj.validate();\n    };\n    BatchEdit.prototype.batchSave = function () {\n        var gObj = this.parent;\n        var deletedRecords = 'deletedRecords';\n        if (gObj.isCheckBoxSelection) {\n            var checkAllBox = gObj.element.querySelector('.e-checkselectall').parentElement;\n            if (checkAllBox.classList.contains('e-checkbox-disabled') &&\n                gObj.pageSettings.totalRecordsCount > gObj.currentViewData.length) {\n                removeClass([checkAllBox], ['e-checkbox-disabled']);\n            }\n        }\n        this.saveCell();\n        if (gObj.isEdit || this.editNextValCell() || gObj.isEdit) {\n            return;\n        }\n        var changes = this.getBatchChanges();\n        if (this.parent.selectionSettings.type === 'Multiple' && changes[deletedRecords].length &&\n            this.parent.selectionSettings.persistSelection) {\n            changes[deletedRecords] = this.removeSelectedData;\n            this.removeSelectedData = [];\n        }\n        var original = {\n            changedRecords: this.parent.getRowsObject()\n                .filter(function (row) { return row.isDirty && ['add', 'delete'].indexOf(row.edit) === -1; })\n                .map(function (row) { return row.data; })\n        };\n        var args = { batchChanges: changes, cancel: false };\n        gObj.trigger(events.beforeBatchSave, args, function (beforeBatchSaveArgs) {\n            if (beforeBatchSaveArgs.cancel) {\n                return;\n            }\n            gObj.showSpinner();\n            gObj.notify(events.bulkSave, { changes: changes, original: original });\n        });\n    };\n    BatchEdit.prototype.getBatchChanges = function () {\n        var changes = {\n            addedRecords: [],\n            deletedRecords: [],\n            changedRecords: []\n        };\n        var rows = this.parent.getRowsObject();\n        for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n            var row = rows_1[_i];\n            if (row.isDirty) {\n                switch (row.edit) {\n                    case 'add':\n                        changes.addedRecords.push(row.changes);\n                        break;\n                    case 'delete':\n                        changes.deletedRecords.push(row.data);\n                        break;\n                    default:\n                        changes.changedRecords.push(row.changes);\n                }\n            }\n        }\n        return changes;\n    };\n    /**\n     * @param {string} uid - specifes the uid\n     * @returns {void}\n     * @hidden\n     */\n    BatchEdit.prototype.removeRowObjectFromUID = function (uid) {\n        var rows = this.parent.getRowsObject();\n        var i = 0;\n        for (var len = rows.length; i < len; i++) {\n            if (rows[i].uid === uid) {\n                break;\n            }\n        }\n        gridActionHandler(this.parent, function (tableName, rows) {\n            rows.splice(i, 1);\n        }, getGridRowObjects(this.parent));\n    };\n    /**\n     * @param {Row<Column>} row - specifies the row object\n     * @returns {void}\n     * @hidden\n     */\n    BatchEdit.prototype.addRowObject = function (row) {\n        var gObj = this.parent;\n        var isTop = gObj.editSettings.newRowPosition === 'Top';\n        gridActionHandler(this.parent, function (tableName, rows) {\n            var rowClone = row.clone();\n            rowClone.cells = splitFrozenRowObjectCells(gObj, rowClone.cells, tableName);\n            if (isTop) {\n                rows.unshift(rowClone);\n            }\n            else {\n                rows.push(rowClone);\n            }\n        }, getGridRowObjects(this.parent), true);\n    };\n    // tslint:disable-next-line:max-func-body-length\n    BatchEdit.prototype.bulkDelete = function (fieldname, data) {\n        var _this = this;\n        this.removeSelectedData = [];\n        var gObj = this.parent;\n        var index = gObj.selectedRowIndex;\n        var selectedRows = gObj.getSelectedRows();\n        var args = {\n            primaryKey: this.parent.getPrimaryKeyFieldNames(),\n            rowIndex: index,\n            rowData: data ? data : gObj.getSelectedRecords()[0],\n            cancel: false\n        };\n        if (data) {\n            args.row = gObj.editModule.deleteRowUid ? gObj.getRowElementByUID(gObj.editModule.deleteRowUid)\n                : gObj.getRows()[gObj.getCurrentViewRecords().indexOf(data)];\n        }\n        else {\n            args.row = data ? gObj.getRows()[index] : selectedRows[0];\n        }\n        if (!args.row) {\n            return;\n        }\n        // tslint:disable-next-line:max-func-body-length\n        gObj.trigger(events.beforeBatchDelete, args, function (beforeBatchDeleteArgs) {\n            if (beforeBatchDeleteArgs.cancel) {\n                return;\n            }\n            _this.removeSelectedData = gObj.getSelectedRecords();\n            gObj.clearSelection();\n            beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row ?\n                beforeBatchDeleteArgs.row : data ? gObj.getRows()[index] : selectedRows[0];\n            if (_this.parent.isFrozenGrid()) {\n                if (data) {\n                    index = parseInt(beforeBatchDeleteArgs.row.getAttribute(literals.ariaRowIndex), 10);\n                    selectedRows = [];\n                    selectedRows.push(gObj.getRowByIndex(index));\n                    selectedRows.push(gObj.getMovableRowByIndex(index));\n                    if (gObj.getFrozenMode() === literals.leftRight) {\n                        selectedRows.push(gObj.getFrozenRightRowByIndex(index));\n                    }\n                }\n                for (var i = 0; i < selectedRows.length; i++) {\n                    var uid = selectedRows[i].getAttribute('data-uid');\n                    if (selectedRows[i].classList.contains('e-insertedrow')) {\n                        _this.removeRowObjectFromUID(uid);\n                        remove(selectedRows[i]);\n                    }\n                    else {\n                        var rowObj = gObj.getRowObjectFromUID(uid);\n                        rowObj.isDirty = true;\n                        rowObj.edit = 'delete';\n                        classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n                        if (gObj.frozenRows && index < gObj.frozenRows && gObj.getMovableDataRows().length >= gObj.frozenRows) {\n                            gObj.getMovableHeaderTbody().appendChild(gObj.getMovableRowByIndex(gObj.frozenRows - 1));\n                            gObj.getFrozenHeaderTbody().appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n                            if (gObj.getFrozenMode() === literals.leftRight) {\n                                gObj.getFrozenRightHeaderTbody().appendChild(gObj.getFrozenRightRowByIndex(gObj.frozenRows - 1));\n                            }\n                        }\n                        if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n                            gObj.getHeaderTable().querySelector(literals.tbody).appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n                        }\n                    }\n                    delete selectedRows[i];\n                }\n            }\n            else if (!_this.parent.isFrozenGrid() && (selectedRows.length === 1 || data)) {\n                var uid = beforeBatchDeleteArgs.row.getAttribute('data-uid');\n                uid = data && _this.parent.editModule.deleteRowUid ? uid = _this.parent.editModule.deleteRowUid : uid;\n                if (beforeBatchDeleteArgs.row.classList.contains('e-insertedrow')) {\n                    _this.removeRowObjectFromUID(uid);\n                    remove(beforeBatchDeleteArgs.row);\n                }\n                else {\n                    var rowObj = gObj.getRowObjectFromUID(uid);\n                    rowObj.isDirty = true;\n                    rowObj.edit = 'delete';\n                    classList(beforeBatchDeleteArgs.row, ['e-hiddenrow', 'e-updatedtd'], []);\n                }\n                delete beforeBatchDeleteArgs.row;\n            }\n            else {\n                for (var i = 0; i < selectedRows.length; i++) {\n                    var uniqueid = selectedRows[i].getAttribute('data-uid');\n                    if (selectedRows[i].classList.contains('e-insertedrow')) {\n                        _this.removeRowObjectFromUID(uniqueid);\n                        remove(selectedRows[i]);\n                    }\n                    else {\n                        classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n                        var selectedRow = gObj.getRowObjectFromUID(uniqueid);\n                        selectedRow.isDirty = true;\n                        selectedRow.edit = 'delete';\n                        delete selectedRows[i];\n                    }\n                }\n            }\n            _this.refreshRowIdx();\n            if (data) {\n                gObj.editModule.deleteRowUid = undefined;\n                if (gObj.getSelectedRows().length) {\n                    index = parseInt(gObj.getSelectedRows()[0].getAttribute(literals.ariaRowIndex), 10);\n                }\n            }\n            if (!gObj.isCheckBoxSelection) {\n                gObj.selectRow(index);\n            }\n            gObj.trigger(events.batchDelete, beforeBatchDeleteArgs);\n            gObj.notify(events.batchDelete, { rows: _this.parent.getRowsObject() });\n            gObj.notify(events.toolbarRefresh, {});\n        });\n    };\n    BatchEdit.prototype.refreshRowIdx = function () {\n        var gObj = this.parent;\n        var rows = gObj.getAllDataRows(true);\n        var dataRows = getGridRowElements(this.parent);\n        var dataObjects = getGridRowObjects(this.parent);\n        var _loop_2 = function (i, j, len) {\n            if (rows[i].classList.contains(literals.row) && !rows[i].classList.contains('e-hiddenrow')) {\n                gridActionHandler(this_2.parent, function (tableName, rowElements, rowObjects) {\n                    rowElements[i].setAttribute(literals.ariaRowIndex, j.toString());\n                    rowObjects[i].index = j;\n                }, dataRows, null, dataObjects);\n                j++;\n            }\n            else {\n                gridActionHandler(this_2.parent, function (tableName, rowElements, rowObjects) {\n                    rowElements[i].removeAttribute(literals.ariaRowIndex);\n                    rowObjects[i].index = -1;\n                }, dataRows, null, dataObjects);\n            }\n            out_j_1 = j;\n        };\n        var this_2 = this, out_j_1;\n        for (var i = 0, j = 0, len = rows.length; i < len; i++) {\n            _loop_2(i, j, len);\n            j = out_j_1;\n        }\n    };\n    BatchEdit.prototype.getIndexFromData = function (data) {\n        return inArray(data, this.parent.getCurrentViewRecords());\n    };\n    BatchEdit.prototype.bulkAddRow = function (data) {\n        var _this = this;\n        var gObj = this.parent;\n        if (!gObj.editSettings.allowAdding) {\n            return;\n        }\n        if (gObj.isEdit) {\n            this.saveCell();\n            this.parent.notify(events.editNextValCell, {});\n        }\n        if (gObj.isEdit) {\n            return;\n        }\n        this.parent.element.classList.add('e-editing');\n        var defaultData = data ? data : this.getDefaultData();\n        var args = {\n            defaultData: defaultData,\n            primaryKey: gObj.getPrimaryKeyFieldNames(),\n            cancel: false\n        };\n        gObj.trigger(events.beforeBatchAdd, args, function (beforeBatchAddArgs) {\n            if (beforeBatchAddArgs.cancel) {\n                return;\n            }\n            _this.isAdded = true;\n            gObj.clearSelection();\n            var mTr;\n            var frTr;\n            var row = new RowRenderer(_this.serviceLocator, null, _this.parent);\n            var model = new RowModelGenerator(_this.parent);\n            var modelData = model.generateRows([beforeBatchAddArgs.defaultData]);\n            var tr = row.render(modelData[0], gObj.getColumns());\n            var col;\n            var index;\n            for (var i = 0; i < _this.parent.groupSettings.columns.length; i++) {\n                tr.insertBefore(_this.parent.createElement('td', { className: 'e-indentcell' }), tr.firstChild);\n                modelData[0].cells.unshift(new Cell({ cellType: CellType.Indent }));\n            }\n            var tbody = gObj.getContentTable().querySelector(literals.tbody);\n            tr.classList.add('e-insertedrow');\n            if (tbody.querySelector('.e-emptyrow')) {\n                var emptyRow = tbody.querySelector('.e-emptyrow');\n                emptyRow.parentNode.removeChild(emptyRow);\n                _this.removeFrozenTbody();\n            }\n            if (gObj.isFrozenGrid()) {\n                frTr = tr.cloneNode(true);\n                mTr = _this.renderMovable(tr, frTr);\n                tr = gObj.getFrozenMode() === 'Right' ? frTr : tr;\n                _this.renderFrozenAddRow(tr, mTr, frTr);\n            }\n            if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n                tbody = gObj.getHeaderTable().querySelector(literals.tbody);\n            }\n            else {\n                tbody = gObj.getContentTable().querySelector(literals.tbody);\n            }\n            if (_this.parent.editSettings.newRowPosition === 'Top') {\n                tbody.insertBefore(tr, tbody.firstChild);\n            }\n            else {\n                tbody.appendChild(tr);\n            }\n            addClass([].slice.call(tr.getElementsByClassName(literals.rowCell)), ['e-updatedtd']);\n            modelData[0].isDirty = true;\n            modelData[0].changes = extend({}, {}, modelData[0].data, true);\n            modelData[0].edit = 'add';\n            _this.addRowObject(modelData[0]);\n            _this.refreshRowIdx();\n            _this.focus.forgetPrevious();\n            gObj.notify(events.batchAdd, { rows: _this.parent.getRowsObject(), args: { isFrozen: _this.parent.isFrozenGrid() } });\n            var changes = _this.getBatchChanges();\n            var btmIdx = _this.getBottomIndex();\n            if (_this.parent.editSettings.newRowPosition === 'Top') {\n                gObj.selectRow(0);\n            }\n            else {\n                gObj.selectRow(btmIdx);\n            }\n            if (!data) {\n                index = _this.findNextEditableCell(0, true);\n                col = gObj.getColumns()[index];\n                if (_this.parent.editSettings.newRowPosition === 'Top') {\n                    _this.editCell(0, col.field, true);\n                }\n                else {\n                    _this.editCell(btmIdx, col.field, true);\n                }\n            }\n            if (_this.parent.aggregates.length > 0 && (data || changes[literals.addedRecords].length)) {\n                _this.parent.notify(events.refreshFooterRenderer, {});\n            }\n            var args1 = {\n                defaultData: beforeBatchAddArgs.defaultData, row: tr,\n                columnObject: col, columnIndex: index, primaryKey: beforeBatchAddArgs.primaryKey, cell: tr.cells[index]\n            };\n            gObj.trigger(events.batchAdd, args1);\n            if (gObj.isFrozenGrid()) {\n                alignFrozenEditForm(mTr.querySelector('td:not(.e-hide)'), tr.querySelector('td:not(.e-hide)'));\n            }\n        });\n    };\n    BatchEdit.prototype.renderFrozenAddRow = function (tr, mTr, frTr) {\n        var gObj = this.parent;\n        var mTbody = getMovableTbody(this.parent);\n        var frTbody = getFrozenRightTbody(this.parent);\n        if (gObj.editSettings.newRowPosition === 'Top') {\n            mTbody.insertBefore(mTr, mTbody.firstChild);\n        }\n        else {\n            mTbody.appendChild(mTr);\n        }\n        addClass([].slice.call(mTr.getElementsByClassName(literals.rowCell)), ['e-updatedtd']);\n        if (frTbody && frTr) {\n            if (gObj.editSettings.newRowPosition === 'Top') {\n                frTbody.insertBefore(frTr, frTbody.firstChild);\n            }\n            else {\n                frTbody.appendChild(frTr);\n            }\n            addClass([].slice.call(frTr.getElementsByClassName(literals.rowCell)), ['e-updatedtd']);\n            alignFrozenEditForm(frTr.querySelector('td:not(.e-hide)'), tr.querySelector('td:not(.e-hide)'));\n        }\n        if (gObj.height === 'auto') {\n            gObj.notify(events.frozenHeight, {});\n        }\n    };\n    BatchEdit.prototype.removeFrozenTbody = function () {\n        var gObj = this.parent;\n        if (gObj.isFrozenGrid()) {\n            var moveTbody = gObj.getContent().querySelector('.' + literals.movableContent).querySelector(literals.tbody);\n            (moveTbody.firstElementChild).parentNode.removeChild(moveTbody.firstElementChild);\n            if (gObj.getFrozenMode() === literals.leftRight) {\n                var frTbody = gObj.getContent().querySelector('.e-frozen-right-content').querySelector(literals.tbody);\n                (frTbody.firstElementChild).parentNode.removeChild(frTbody.firstElementChild);\n            }\n        }\n    };\n    BatchEdit.prototype.renderMovable = function (ele, rightEle) {\n        var mEle = ele.cloneNode(true);\n        var movable = this.parent.getMovableColumnsCount();\n        var left = this.parent.getFrozenLeftCount();\n        var right = this.parent.getFrozenRightColumnsCount();\n        sliceElements(ele, 0, left);\n        sliceElements(mEle, left, right ? mEle.children.length - right : mEle.children.length);\n        sliceElements(rightEle, left + movable, rightEle.children.length);\n        return mEle;\n    };\n    BatchEdit.prototype.findNextEditableCell = function (columnIndex, isAdd, isValOnly) {\n        var cols = this.parent.getColumns();\n        var endIndex = cols.length;\n        var validation;\n        for (var i = columnIndex; i < endIndex; i++) {\n            validation = isValOnly ? isNullOrUndefined(cols[i].validationRules) : false;\n            if (!isAdd && this.checkNPCell(cols[i])) {\n                return i;\n            }\n            else if (isAdd && !cols[i].template && cols[i].visible && cols[i].allowEditing &&\n                !(cols[i].isIdentity && cols[i].isPrimaryKey) && !validation) {\n                return i;\n            }\n        }\n        return -1;\n    };\n    BatchEdit.prototype.checkNPCell = function (col) {\n        return !col.template && col.visible && !col.isPrimaryKey && !col.isIdentity && col.allowEditing;\n    };\n    BatchEdit.prototype.getDefaultData = function () {\n        var gObj = this.parent;\n        var data = {};\n        var dValues = { 'number': 0, 'string': null, 'boolean': false, 'date': null, 'datetime': null };\n        for (var _i = 0, _a = (gObj.columnModel); _i < _a.length; _i++) {\n            var col = _a[_i];\n            if (col.field) {\n                setValue(col.field, Object.keys(col).indexOf('defaultValue') >= 0 ? col.defaultValue : dValues[col.type], data);\n            }\n        }\n        return data;\n    };\n    BatchEdit.prototype.setCellIdx = function (target) {\n        var gLen = 0;\n        if (this.parent.allowGrouping) {\n            gLen = this.parent.groupSettings.columns.length;\n        }\n        this.cellDetails.cellIndex = target.cellIndex - gLen;\n        this.cellDetails.rowIndex = parseInt(target.getAttribute('index'), 10);\n    };\n    BatchEdit.prototype.editCell = function (index, field, isAdd) {\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        this.index = index;\n        this.field = field;\n        this.isAdd = isAdd;\n        var checkEdit = gObj.isEdit && !(this.cellDetails.column.field === field\n            && (this.cellDetails.rowIndex === index && this.parent.getDataRows().length - 1 !== index));\n        if (gObj.editSettings.allowEditing) {\n            if (!checkEdit && col.allowEditing) {\n                this.editCellExtend(index, field, isAdd);\n            }\n            else if (checkEdit) {\n                this.editNext = true;\n                this.saveCell();\n            }\n        }\n    };\n    BatchEdit.prototype.editCellExtend = function (index, field, isAdd) {\n        var _this = this;\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        var keys = gObj.getPrimaryKeyFieldNames();\n        if (gObj.isEdit) {\n            return;\n        }\n        var row;\n        var mRowData;\n        var rowData = extend({}, {}, this.getDataByIndex(index), true);\n        if (col.getFreezeTableName() === 'movable' || col.getFreezeTableName() === literals.frozenRight) {\n            row = col.getFreezeTableName() === 'movable' ? gObj.getMovableDataRows()[index] : gObj.getFrozenRightDataRows()[index];\n            mRowData = this.parent.getRowObjectFromUID(row.getAttribute('data-uid'));\n            rowData = mRowData.changes ? extend({}, {}, mRowData.changes, true) : rowData;\n        }\n        else {\n            row = gObj.getDataRows()[index];\n            rowData = extend({}, {}, this.getDataByIndex(index), true);\n        }\n        if ((keys[0] === col.field && !row.classList.contains('e-insertedrow')) || col.columns ||\n            (col.isPrimaryKey && col.isIdentity)) {\n            this.parent.isLastCellPrimaryKey = true;\n            return;\n        }\n        this.parent.isLastCellPrimaryKey = false;\n        this.parent.element.classList.add('e-editing');\n        var rowObj = gObj.getRowObjectFromUID(row.getAttribute('data-uid'));\n        var cells = [].slice.apply(row.cells);\n        var args = {\n            columnName: col.field, isForeignKey: !isNullOrUndefined(col.foreignKeyValue),\n            primaryKey: keys, rowData: rowData,\n            validationRules: extend({}, col.validationRules ? col.validationRules : {}),\n            value: getObject(col.field, rowData),\n            type: !isAdd ? 'edit' : 'add', cancel: false,\n            foreignKeyData: rowObj && rowObj.foreignKeyData\n        };\n        args.cell = cells[this.getColIndex(cells, this.getCellIdx(col.uid))];\n        args.row = row;\n        args.columnObject = col;\n        if (!args.cell) {\n            return;\n        }\n        gObj.trigger(events.cellEdit, args, function (cellEditArgs) {\n            if (cellEditArgs.cancel) {\n                return;\n            }\n            cellEditArgs.cell = cellEditArgs.cell ? cellEditArgs.cell : cells[_this.getColIndex(cells, _this.getCellIdx(col.uid))];\n            cellEditArgs.row = cellEditArgs.row ? cellEditArgs.row : row;\n            cellEditArgs.columnObject = cellEditArgs.columnObject ? cellEditArgs.columnObject : col;\n            cellEditArgs.columnObject.index = isNullOrUndefined(cellEditArgs.columnObject.index) ? 0 : cellEditArgs.columnObject.index;\n            _this.cellDetails = {\n                rowData: rowData, column: col, value: cellEditArgs.value, isForeignKey: cellEditArgs.isForeignKey, rowIndex: index,\n                cellIndex: parseInt(cellEditArgs.cell.getAttribute(literals.ariaColIndex), 10),\n                foreignKeyData: cellEditArgs.foreignKeyData\n            };\n            if (cellEditArgs.cell.classList.contains('e-updatedtd')) {\n                _this.isColored = true;\n                cellEditArgs.cell.classList.remove('e-updatedtd');\n            }\n            gObj.isEdit = true;\n            gObj.clearSelection();\n            if (!gObj.isCheckBoxSelection || !gObj.isPersistSelection) {\n                gObj.selectRow(_this.cellDetails.rowIndex, true);\n            }\n            _this.renderer.update(cellEditArgs);\n            _this.parent.notify(events.batchEditFormRendered, cellEditArgs);\n            _this.form = select('#' + gObj.element.id + 'EditForm', gObj.element);\n            gObj.editModule.applyFormValidation([col]);\n            _this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n        });\n    };\n    BatchEdit.prototype.updateCell = function (rowIndex, field, value) {\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        var index = gObj.getColumnIndexByField(field);\n        if (col && !col.isPrimaryKey && col.allowEditing) {\n            var td = getCellByColAndRowIndex(this.parent, col, rowIndex, index);\n            var rowObj = col.getFreezeTableName() === 'movable' ? this.parent.getMovableRowsObject()[rowIndex] :\n                col.getFreezeTableName() === literals.frozenRight ? gObj.getFrozenRightRowsObject()[rowIndex]\n                    : gObj.getRowObjectFromUID(td.parentElement.getAttribute('data-uid'));\n            this.refreshTD(td, col, rowObj, value);\n            this.parent.trigger(events.queryCellInfo, {\n                cell: this.newReactTd || td, column: col, data: rowObj.changes\n            });\n        }\n    };\n    BatchEdit.prototype.setChanges = function (rowObj, field, value) {\n        var currentRowObj;\n        if (!this.parent.isFrozenGrid()) {\n            if (!rowObj.changes) {\n                rowObj.changes = extend({}, {}, rowObj.data, true);\n            }\n            if (!isNullOrUndefined(field)) {\n                DataUtil.setValue(field, value, rowObj.changes);\n            }\n            if (rowObj.data[field] !== value) {\n                var type = this.parent.getColumnByField(field).type;\n                if ((type === 'date' || type === 'datetime')) {\n                    if (new Date(rowObj.data[field]).toString() !== new Date(value).toString()) {\n                        rowObj.isDirty = true;\n                    }\n                }\n                else {\n                    rowObj.isDirty = true;\n                }\n            }\n        }\n        else {\n            var rowEle = this.parent.getRowElementByUID(rowObj.uid);\n            var rowIndex = parseInt(rowEle.getAttribute(literals.ariaRowIndex), 10);\n            currentRowObj = this.parent.getRowsObject()[rowIndex];\n            if (!currentRowObj.changes) {\n                currentRowObj.changes = extend({}, {}, rowObj.data, true);\n            }\n            if (!isNullOrUndefined(field)) {\n                setValue(field, value, currentRowObj.changes);\n            }\n            var movableRowObject = this.parent.getMovableRowsObject()[rowIndex];\n            movableRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n            if (rowObj.data[field] !== value) {\n                movableRowObject.isDirty = true;\n                currentRowObj.isDirty = true;\n            }\n            if (this.parent.getFrozenMode() === literals.leftRight) {\n                var frRowObject = this.parent.getFrozenRightRowsObject()[rowIndex];\n                frRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n                if (rowObj.data[field] !== value) {\n                    frRowObject.isDirty = true;\n                }\n            }\n        }\n    };\n    BatchEdit.prototype.updateRow = function (index, data) {\n        var keys = Object.keys(data);\n        for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n            var col = keys_1[_i];\n            this.updateCell(index, col, data[col]);\n        }\n    };\n    BatchEdit.prototype.getCellIdx = function (uid) {\n        var cIdx = this.parent.getColumnIndexByUid(uid) + this.parent.groupSettings.columns.length;\n        if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n            cIdx++;\n        }\n        if (this.parent.isRowDragable()) {\n            cIdx++;\n        }\n        return cIdx;\n    };\n    BatchEdit.prototype.refreshTD = function (td, column, rowObj, value) {\n        var cell = new CellRenderer(this.parent, this.serviceLocator);\n        var rowcell;\n        value = column.type === 'number' && !isNullOrUndefined(value) ? parseFloat(value) : value;\n        this.setChanges(rowObj, column.field, value);\n        var frzCols = this.parent.getFrozenColumns() || this.parent.getFrozenLeftColumnsCount()\n            || this.parent.getFrozenRightColumnsCount();\n        frzCols = frzCols && this.parent.isRowDragable() ? frzCols + 1 : frzCols;\n        refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n        if (frzCols && column.getFreezeTableName() === 'movable' && this.parent.getColumns().length === rowObj.cells.length) {\n            rowcell = rowObj.cells.slice(frzCols, rowObj.cells.length);\n        }\n        else {\n            rowcell = rowObj.cells;\n        }\n        var parentElement;\n        var cellIndex;\n        if (this.parent.isReact) {\n            parentElement = td.parentElement;\n            cellIndex = td.cellIndex;\n        }\n        var index = 0;\n        if (frzCols) {\n            index = column.getFreezeTableName() === 'movable' && this.parent.getFrozenMode() !== 'Right'\n                ? frzCols : column.getFreezeTableName() === literals.frozenRight\n                ? this.parent.getFrozenLeftColumnsCount() + this.parent.getMovableColumnsCount() : index;\n        }\n        cell.refreshTD(td, rowcell[this.getCellIdx(column.uid) - index], rowObj.changes, { 'index': this.getCellIdx(column.uid) });\n        if (this.parent.isReact) {\n            this.newReactTd = parentElement.cells[cellIndex];\n            parentElement.cells[cellIndex].classList.add('e-updatedtd');\n        }\n        else {\n            td.classList.add('e-updatedtd');\n        }\n        td.classList.add('e-updatedtd');\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    BatchEdit.prototype.getColIndex = function (cells, index) {\n        var cIdx = 0;\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns) {\n            cIdx = this.parent.groupSettings.columns.length;\n        }\n        if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n            cIdx++;\n        }\n        if (this.parent.isRowDragable()) {\n            cIdx++;\n        }\n        for (var m = 0; m < cells.length; m++) {\n            var colIndex = parseInt(cells[m].getAttribute(literals.ariaColIndex), 10);\n            if (colIndex === index - cIdx) {\n                return m;\n            }\n        }\n        return -1;\n    };\n    BatchEdit.prototype.editNextValCell = function () {\n        var gObj = this.parent;\n        var btmIdx = this.getBottomIndex();\n        if (this.isAdded && !gObj.isEdit) {\n            for (var i = this.cellDetails.cellIndex; i < gObj.getColumns().length; i++) {\n                if (gObj.isEdit) {\n                    return;\n                }\n                var index = this.findNextEditableCell(this.cellDetails.cellIndex + 1, true, true);\n                var col = gObj.getColumns()[index];\n                if (col) {\n                    if (this.parent.editSettings.newRowPosition === 'Bottom') {\n                        this.editCell(btmIdx, col.field, true);\n                    }\n                    else {\n                        var args = { index: 0, column: col };\n                        this.parent.notify(events.nextCellIndex, args);\n                        this.editCell(args.index, col.field, true);\n                    }\n                    this.saveCell();\n                }\n            }\n            if (!gObj.isEdit) {\n                this.isAdded = false;\n            }\n        }\n    };\n    BatchEdit.prototype.escapeCellEdit = function () {\n        var args = this.generateCellArgs();\n        args.value = args.previousValue;\n        this.successCallBack(args, args.cell.parentElement, args.column, true)(args);\n    };\n    BatchEdit.prototype.generateCellArgs = function () {\n        var gObj = this.parent;\n        this.parent.element.classList.remove('e-editing');\n        var column = this.cellDetails.column;\n        var obj = {};\n        obj[column.field] = getObject(column.field, this.cellDetails.rowData);\n        var editedData = gObj.editModule.getCurrentEditedData(this.form, obj);\n        var cloneEditedData = extend({}, editedData);\n        editedData = extend({}, editedData, this.cellDetails.rowData);\n        var value = getObject(column.field, cloneEditedData);\n        if (!isNullOrUndefined(column.field) && !isUndefined(value)) {\n            setValue(column.field, value, editedData);\n        }\n        var args = {\n            columnName: column.field,\n            value: getObject(column.field, editedData),\n            rowData: this.cellDetails.rowData,\n            column: column,\n            previousValue: this.cellDetails.value,\n            isForeignKey: this.cellDetails.isForeignKey,\n            cancel: false\n        };\n        args.cell = this.form.parentElement;\n        args.columnObject = column;\n        return args;\n    };\n    BatchEdit.prototype.saveCell = function (isForceSave) {\n        if (this.preventSaveCell || !this.form) {\n            return;\n        }\n        var gObj = this.parent;\n        if (!isForceSave && (!gObj.isEdit || this.validateFormObj())) {\n            return;\n        }\n        this.preventSaveCell = true;\n        var args = this.generateCellArgs();\n        var tr = args.cell.parentElement;\n        var col = args.column;\n        if (!isForceSave) {\n            gObj.trigger(events.cellSave, args, this.successCallBack(args, tr, col));\n            gObj.notify(events.batchForm, { formObj: this.form });\n        }\n        else {\n            this.successCallBack(args, tr, col)(args);\n        }\n    };\n    BatchEdit.prototype.successCallBack = function (cellSaveArgs, tr, column, isEscapeCellEdit) {\n        var _this = this;\n        return function (cellSaveArgs) {\n            var gObj = _this.parent;\n            cellSaveArgs.cell = cellSaveArgs.cell ? cellSaveArgs.cell : _this.form.parentElement;\n            cellSaveArgs.columnObject = cellSaveArgs.columnObject ? cellSaveArgs.columnObject : column;\n            cellSaveArgs.columnObject.index = isNullOrUndefined(cellSaveArgs.columnObject.index) ? 0 : cellSaveArgs.columnObject.index;\n            if (cellSaveArgs.cancel) {\n                _this.preventSaveCell = false;\n                if (_this.editNext) {\n                    _this.editNext = false;\n                    if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n                        return;\n                    }\n                    _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n                }\n                return;\n            }\n            gObj.editModule.destroyWidgets([column]);\n            gObj.isEdit = false;\n            gObj.editModule.destroyForm();\n            _this.parent.notify(events.tooltipDestroy, {});\n            var rowObj = parentsUntil(cellSaveArgs.cell, literals.movableContent)\n                || parentsUntil(cellSaveArgs.cell, literals.movableHeader) ? gObj.getRowObjectFromUID(tr.getAttribute('data-uid'), true)\n                : gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n            if (gObj.getFrozenMode() === literals.leftRight && (parentsUntil(cellSaveArgs.cell, 'e-frozen-right-header')\n                || parentsUntil(cellSaveArgs.cell, 'e-frozen-right-content'))) {\n                rowObj = gObj.getRowObjectFromUID(tr.getAttribute('data-uid'), false, true);\n            }\n            _this.refreshTD(cellSaveArgs.cell, column, rowObj, cellSaveArgs.value);\n            if (_this.parent.isReact) {\n                cellSaveArgs.cell = _this.newReactTd;\n            }\n            removeClass([tr], [literals.editedRow, 'e-batchrow']);\n            removeClass([cellSaveArgs.cell], ['e-editedbatchcell', 'e-boolcell']);\n            if (!isNullOrUndefined(cellSaveArgs.value) && cellSaveArgs.value.toString() ===\n                (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString() && !_this.isColored\n                || (isNullOrUndefined(cellSaveArgs.value) && isNullOrUndefined(rowObj.data[column.field]) &&\n                    isNullOrUndefined(_this.cellDetails.value) && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow'))) {\n                cellSaveArgs.cell.classList.remove('e-updatedtd');\n            }\n            if (isNullOrUndefined(isEscapeCellEdit)) {\n                gObj.trigger(events.cellSaved, cellSaveArgs);\n            }\n            gObj.notify(events.toolbarRefresh, {});\n            _this.isColored = false;\n            if (_this.parent.aggregates.length > 0) {\n                _this.parent.notify(events.refreshFooterRenderer, {});\n                if (_this.parent.groupSettings.columns.length > 0 && !_this.isAddRow(_this.cellDetails.rowIndex)) {\n                    _this.parent.notify(events.groupAggregates, {});\n                }\n            }\n            _this.preventSaveCell = false;\n            if (_this.editNext) {\n                _this.editNext = false;\n                if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n                    return;\n                }\n                var col = gObj.getColumnByField(_this.field);\n                if (col && col.allowEditing) {\n                    _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n                }\n            }\n            if (isEscapeCellEdit) {\n                gObj.notify(events.restoreFocus, {});\n            }\n        };\n    };\n    BatchEdit.prototype.getDataByIndex = function (index) {\n        var row = this.parent.getRowObjectFromUID(this.parent.getDataRows()[index].getAttribute('data-uid'));\n        return row.changes ? row.changes : row.data;\n    };\n    BatchEdit.prototype.keyDownHandler = function (e) {\n        if ((e.action === 'tab' || e.action === 'shiftTab') && this.parent.isEdit) {\n            var gObj = this.parent;\n            var btmIdx = this.getBottomIndex();\n            var rowcell = parentsUntil(e.target, literals.rowCell);\n            if (rowcell) {\n                var cell = rowcell.querySelector('.e-field');\n                if (cell) {\n                    var visibleColumns = this.parent.getVisibleColumns();\n                    var columnIndex = e.action === 'tab' ? visibleColumns.length - 1 : 0;\n                    if (visibleColumns[columnIndex].field === cell.getAttribute('id').slice(this.parent.element.id.length)) {\n                        if (this.cellDetails.rowIndex === btmIdx && e.action === 'tab') {\n                            if (gObj.editSettings.newRowPosition === 'Top') {\n                                gObj.editSettings.newRowPosition = 'Bottom';\n                                this.addRecord();\n                                gObj.editSettings.newRowPosition = 'Top';\n                            }\n                            else {\n                                this.addRecord();\n                            }\n                        }\n                        else {\n                            this.saveCell();\n                        }\n                    }\n                }\n            }\n        }\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    BatchEdit.prototype.addCancelWhilePaging = function () {\n        if (this.validateFormObj()) {\n            this.parent.notify(events.destroyForm, {});\n            this.parent.isEdit = false;\n            this.isColored = false;\n        }\n    };\n    BatchEdit.prototype.getBottomIndex = function () {\n        var changes = this.getBatchChanges();\n        return this.parent.getCurrentViewRecords().length + changes[literals.addedRecords].length -\n            changes[literals.deletedRecords].length - 1;\n    };\n    return BatchEdit;\n}());\nexport { BatchEdit };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}