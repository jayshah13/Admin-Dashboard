{"ast":null,"code":"/**\n * `Selection` module is used to handle RTE Selections.\n */\nimport { NodeSelection } from './../../selection/index';\nimport { NodeCutter } from './nodecutter';\nimport { InsertMethods } from './insert-methods';\nimport { IsFormatted } from './isformatted';\nimport { isIDevice, setEditFrameFocus } from '../../common/util';\nimport { isNullOrUndefined as isNOU, Browser, closest, detach } from '@syncfusion/ej2-base';\nimport { DOMNode } from './dom-node';\n\nvar SelectionCommands =\n/** @class */\nfunction () {\n  function SelectionCommands() {}\n  /**\n   * applyFormat method\n   *\n   * @param {Document} docElement - specifies the document\n   * @param {string} format - specifies the string value\n   * @param {Node} endNode - specifies the end node\n   * @param {string} enterAction - specifies the enter key action\n   * @param {string} value - specifies the string value\n   * @param {string} selector - specifies the string\n   * @returns {void}\n   * @hidden\n    */\n\n\n  SelectionCommands.applyFormat = function (docElement, format, endNode, enterAction, value, selector) {\n    this.enterAction = enterAction;\n    var validFormats = ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'uppercase', 'lowercase', 'fontcolor', 'fontname', 'fontsize', 'backgroundcolor'];\n\n    if (validFormats.indexOf(format) > -1) {\n      if (format === 'backgroundcolor' && value === '') {\n        value = 'transparent';\n      }\n\n      var domSelection = new NodeSelection();\n      var domNode = new DOMNode(endNode, docElement);\n      var nodeCutter = new NodeCutter();\n      var isFormatted = new IsFormatted();\n      var range = domSelection.getRange(docElement);\n      var save = domSelection.save(range, docElement);\n      var nodes = range.collapsed ? domSelection.getSelectionNodeCollection(range) : domSelection.getSelectionNodeCollectionBr(range);\n      var isCollapsed = false;\n      var isFormat = false;\n      var isCursor = false;\n      var preventRestore = false;\n      var isFontStyle = ['fontcolor', 'fontname', 'fontsize', 'backgroundcolor'].indexOf(format) > -1;\n\n      if (range.collapsed) {\n        if (nodes.length > 0) {\n          isCollapsed = true;\n          range = nodeCutter.GetCursorRange(docElement, range, nodes[0]);\n        } else if (range.startContainer.nodeType === 3 && range.startContainer.parentElement.childElementCount > 0 && range.startOffset > 0 && range.startContainer.parentElement.firstElementChild.tagName.toLowerCase() !== 'br') {\n          isCollapsed = true;\n          range = nodeCutter.GetCursorRange(docElement, range, range.startContainer);\n          nodes.push(range.startContainer);\n        } else {\n          var cursorNode = this.insertCursorNode(docElement, domSelection, range, isFormatted, nodeCutter, format, value, endNode);\n          domSelection.endContainer = domSelection.startContainer = domSelection.getNodeArray(cursorNode, true);\n          var childNodes = cursorNode.nodeName === 'BR' && cursorNode.parentNode.childNodes;\n\n          if (!isNOU(childNodes) && childNodes.length === 1 && childNodes[0].nodeName === 'BR' && nodes.length === 0) {\n            domSelection.setSelectionText(docElement, range.startContainer, range.endContainer, 0, 0);\n            preventRestore = true;\n          } else {\n            domSelection.endOffset = domSelection.startOffset = 1;\n          }\n\n          if (cursorNode.nodeName === 'BR' && cursorNode.parentNode.textContent.length === 0) {\n            preventRestore = true;\n          }\n        }\n      }\n\n      isCursor = range.collapsed;\n      var isSubSup = false;\n\n      for (var index = 0; index < nodes.length; index++) {\n        var formatNode = isFormatted.getFormattedNode(nodes[index], format, endNode);\n\n        if (formatNode === null) {\n          if (format === 'subscript') {\n            formatNode = isFormatted.getFormattedNode(nodes[index], 'superscript', endNode);\n            isSubSup = formatNode === null ? false : true;\n          } else if (format === 'superscript') {\n            formatNode = isFormatted.getFormattedNode(nodes[index], 'subscript', endNode);\n            isSubSup = formatNode === null ? false : true;\n          }\n        }\n\n        if (index === 0 && formatNode === null) {\n          isFormat = true;\n        }\n\n        if (formatNode !== null && (!isFormat || isFontStyle)) {\n          nodes[index] = this.removeFormat(nodes, index, formatNode, isCursor, isFormat, isFontStyle, range, nodeCutter, format, value, domSelection, endNode, domNode);\n        } else {\n          nodes[index] = this.insertFormat(docElement, nodes, index, formatNode, isCursor, isFormat, isFontStyle, range, nodeCutter, format, value);\n        }\n\n        domSelection = this.applySelection(nodes, domSelection, nodeCutter, index, isCollapsed);\n      }\n\n      if (isIDevice()) {\n        setEditFrameFocus(endNode, selector);\n      }\n\n      if (!preventRestore) {\n        save.restore();\n      }\n\n      if (isSubSup) {\n        this.applyFormat(docElement, format, endNode, enterAction);\n      }\n    }\n  };\n\n  SelectionCommands.insertCursorNode = function (docElement, domSelection, range, isFormatted, nodeCutter, format, value, endNode) {\n    var cursorNodes = domSelection.getNodeCollection(range);\n    var domNode = new DOMNode(endNode, docElement);\n    var cursorFormat = cursorNodes.length > 0 ? cursorNodes.length > 1 && range.startContainer === range.endContainer ? this.getCursorFormat(isFormatted, cursorNodes, format, endNode) : isFormatted.getFormattedNode(cursorNodes[0], format, endNode) : null;\n    var cursorNode = null;\n\n    if (cursorFormat) {\n      cursorNode = cursorNodes[0];\n\n      if (cursorFormat.firstChild.textContent.charCodeAt(0) === 8203 && cursorFormat.firstChild.nodeType === 3) {\n        var isCursorEqual = false;\n        var regEx = new RegExp(String.fromCharCode(8203), 'g');\n        var emptySpaceNode = void 0;\n\n        if (cursorFormat.firstChild === cursorNode) {\n          cursorNode.textContent = cursorFormat.parentElement && (domNode.isBlockNode(cursorFormat.parentElement) && cursorFormat.parentElement.textContent.length <= 1 ? cursorFormat.parentElement.childElementCount > 1 : cursorFormat.childElementCount === 0) && (cursorFormat.parentElement.textContent.length > 1 || cursorFormat.parentElement.firstChild && cursorFormat.parentElement.firstChild.nodeType === 1) ? cursorNode.textContent : cursorNode.textContent.replace(regEx, '');\n          emptySpaceNode = cursorNode;\n          isCursorEqual = true;\n        } else {\n          cursorFormat.firstChild.textContent = cursorFormat.firstChild.textContent.replace(regEx, '');\n          emptySpaceNode = cursorFormat.firstChild;\n        }\n\n        var pointer = void 0;\n\n        if (emptySpaceNode.textContent.length === 0) {\n          if (!isNOU(emptySpaceNode.previousSibling)) {\n            cursorNode = emptySpaceNode.previousSibling;\n            pointer = emptySpaceNode.textContent.length - 1;\n            domSelection.setCursorPoint(docElement, emptySpaceNode, pointer);\n          } else if (!isNOU(emptySpaceNode.parentElement) && emptySpaceNode.parentElement.textContent.length === 0) {\n            var brElem = document.createElement('BR');\n            emptySpaceNode.parentElement.appendChild(brElem);\n            detach(emptySpaceNode);\n            cursorNode = brElem;\n            domSelection.setCursorPoint(docElement, cursorNode.parentElement, 0);\n          }\n        }\n      }\n\n      if (['fontcolor', 'fontname', 'fontsize', 'backgroundcolor'].indexOf(format) > -1) {\n        if (format === 'fontcolor') {\n          cursorFormat.style.color = value;\n        } else if (format === 'fontname') {\n          cursorFormat.style.fontFamily = value;\n        } else if (format === 'fontsize') {\n          cursorFormat.style.fontSize = value;\n        } else {\n          cursorFormat.style.backgroundColor = value;\n        }\n\n        cursorNode = cursorFormat;\n      } else {\n        InsertMethods.unwrap(cursorFormat);\n      }\n    } else {\n      if (cursorNodes.length > 1 && range.startOffset > 0 && cursorNodes[0].firstElementChild && cursorNodes[0].firstElementChild.tagName.toLowerCase() === 'br') {\n        cursorNodes[0].innerHTML = '';\n      }\n\n      if (cursorNodes.length === 1 && range.startOffset === 0 && (cursorNodes[0].nodeName === 'BR' || cursorNodes[0].nextSibling.nodeName === 'BR')) {\n        detach(cursorNodes[0].nodeName === '#text' ? cursorNodes[0].nextSibling : cursorNodes[0]);\n      }\n\n      cursorNode = this.getInsertNode(docElement, range, format, value).firstChild;\n    }\n\n    return cursorNode;\n  };\n\n  SelectionCommands.getCursorFormat = function (isFormatted, cursorNodes, format, endNode) {\n    var currentNode;\n\n    for (var index = 0; index < cursorNodes.length; index++) {\n      currentNode = cursorNodes[index].lastElementChild ? cursorNodes[index].lastElementChild : cursorNodes[index];\n    }\n\n    return isFormatted.getFormattedNode(currentNode, format, endNode);\n  };\n\n  SelectionCommands.removeFormat = function (nodes, index, formatNode, isCursor, isFormat, isFontStyle, range, nodeCutter, format, value, domSelection, endNode, domNode) {\n    var splitNode = null;\n    var startText = range.startContainer.nodeName === '#text' ? range.startContainer.textContent.substring(range.startOffset, range.startContainer.textContent.length) : range.startContainer.textContent;\n\n    if (!(range.startContainer === range.endContainer && range.startOffset === 0 && range.endOffset === range.startContainer.length)) {\n      var nodeIndex = [];\n      var cloneNode = nodes[index];\n\n      do {\n        nodeIndex.push(domSelection.getIndex(cloneNode));\n        cloneNode = cloneNode.parentNode;\n      } while (cloneNode && cloneNode !== formatNode);\n\n      if (nodes[index].nodeName !== 'BR') {\n        cloneNode = splitNode = isCursor && formatNode.textContent.length - 1 === range.startOffset ? nodeCutter.SplitNode(range, formatNode, true) : nodeCutter.GetSpliceNode(range, formatNode);\n      }\n\n      if (!isCursor) {\n        while (cloneNode && cloneNode.childNodes.length > 0 && nodeIndex.length - 1 >= 0 && cloneNode.childNodes.length > nodeIndex[nodeIndex.length - 1]) {\n          cloneNode = cloneNode.childNodes[nodeIndex[nodeIndex.length - 1]];\n          nodeIndex.pop();\n        }\n\n        if (nodes[index].nodeName !== 'BR') {\n          if (cloneNode.nodeType === 3 && !(isCursor && cloneNode.nodeValue === '')) {\n            nodes[index] = cloneNode;\n          } else {\n            var divNode = document.createElement('div');\n            divNode.innerHTML = '&#8203;';\n\n            if (cloneNode.nodeType !== 3) {\n              cloneNode.insertBefore(divNode.firstChild, cloneNode.firstChild);\n              nodes[index] = cloneNode.firstChild;\n            } else {\n              cloneNode.parentNode.insertBefore(divNode.firstChild, cloneNode);\n              nodes[index] = cloneNode.previousSibling;\n              cloneNode.parentNode.removeChild(cloneNode);\n            }\n          }\n        }\n      } else {\n        var lastNode = splitNode;\n\n        for (; lastNode.firstChild !== null && lastNode.firstChild.nodeType !== 3; null) {\n          lastNode = lastNode.firstChild;\n        }\n\n        lastNode.innerHTML = '&#8203;';\n        nodes[index] = lastNode.firstChild;\n      }\n    }\n\n    var fontStyle;\n\n    if (format === 'backgroundcolor') {\n      fontStyle = formatNode.style.fontSize;\n    }\n\n    var bgStyle;\n\n    if (format === 'fontsize') {\n      var bg = closest(nodes[index].parentElement, 'span[style*=' + 'background-color' + ']');\n\n      if (!isNOU(bg)) {\n        bgStyle = bg.style.backgroundColor;\n      }\n    }\n\n    var formatNodeStyles = formatNode.getAttribute('style');\n    var formatNodeTagName = formatNode.tagName;\n    var child = InsertMethods.unwrap(formatNode);\n\n    if (child[0] && !isFontStyle) {\n      var nodeTraverse = child[index] ? child[index] : child[0];\n      var textNode = nodeTraverse;\n\n      for (; nodeTraverse && nodeTraverse.parentElement && nodeTraverse.parentElement !== endNode; // eslint-disable-next-line\n      nodeTraverse = nodeTraverse) {\n        if (nodeTraverse.parentElement && nodeTraverse.parentElement.tagName.toLocaleLowerCase() === formatNode.tagName.toLocaleLowerCase() && (nodeTraverse.parentElement.childElementCount > 1 || range.startOffset > 1)) {\n          if (textNode.parentElement && textNode.parentElement.tagName.toLocaleLowerCase() === formatNode.tagName.toLocaleLowerCase()) {\n            if (range.startOffset === range.endOffset && textNode.nodeType !== 1 && !isNOU(textNode.textContent) && textNode.parentElement.childElementCount > 1) {\n              range.setStart(textNode, 0);\n              range.setEnd(textNode, textNode.textContent.length);\n              nodeCutter.SplitNode(range, textNode.parentElement, false);\n            }\n          }\n\n          if (nodeTraverse.parentElement.tagName.toLocaleLowerCase() === 'span') {\n            if (formatNode.style.textDecoration === 'underline' && nodeTraverse.parentElement.style.textDecoration !== 'underline') {\n              nodeTraverse = nodeTraverse.parentElement;\n              continue;\n            }\n          }\n\n          InsertMethods.unwrap(nodeTraverse.parentElement);\n          nodeTraverse = !isNOU(nodeTraverse.parentElement) && !domNode.isBlockNode(nodeTraverse.parentElement) ? textNode : nodeTraverse.parentElement;\n        } else {\n          nodeTraverse = nodeTraverse.parentElement;\n        }\n      }\n    }\n\n    if (child.length > 0 && isFontStyle) {\n      for (var num = 0; num < child.length; num++) {\n        if (child[num].nodeType !== 3 || child[num].textContent && child[num].textContent.trim().length > 0) {\n          child[num] = InsertMethods.Wrap(child[num], this.GetFormatNode(format, value, formatNodeTagName, formatNodeStyles));\n\n          if (child[num].textContent === startText) {\n            if (num === 0) {\n              range.setStartBefore(child[num]);\n            } else if (num === child.length - 1) {\n              range.setEndAfter(child[num]);\n            }\n          }\n        }\n      }\n\n      var currentNodeElem = nodes[index].parentElement;\n\n      if (!isNOU(fontStyle) && fontStyle !== '') {\n        currentNodeElem.style.fontSize = fontStyle;\n      }\n\n      if (!isNOU(bgStyle) && bgStyle !== '') {\n        currentNodeElem.style.backgroundColor = bgStyle;\n      }\n\n      if (format === 'backgroundcolor' && !isNOU(fontStyle) && fontStyle !== '' && currentNodeElem.parentElement.innerHTML === currentNodeElem.outerHTML) {\n        var curParentElem = currentNodeElem.parentElement;\n        curParentElem.parentElement.insertBefore(currentNodeElem, curParentElem);\n        detach(curParentElem);\n      }\n\n      if (format === 'fontsize' || format === 'fontcolor') {\n        var liElement = nodes[index].parentElement;\n        var parentElement = nodes[index].parentElement;\n\n        while (!isNOU(parentElement) && parentElement.tagName.toLowerCase() !== 'li') {\n          parentElement = parentElement.parentElement;\n          liElement = parentElement;\n        }\n\n        if (!isNOU(liElement) && liElement.tagName.toLowerCase() === 'li' && liElement.textContent.trim() === nodes[index].textContent.trim()) {\n          if (format === 'fontsize') {\n            liElement.style.fontSize = value;\n          } else {\n            liElement.style.color = value;\n            liElement.style.textDecoration = 'inherit';\n          }\n        }\n      }\n    }\n\n    return nodes[index];\n  };\n\n  SelectionCommands.insertFormat = function (docElement, nodes, index, formatNode, isCursor, isFormat, isFontStyle, range, nodeCutter, format, value) {\n    if (!isCursor) {\n      if (formatNode === null && isFormat || isFontStyle) {\n        if (nodes[index].nodeName !== 'BR') {\n          nodes[index] = nodeCutter.GetSpliceNode(range, nodes[index]);\n          nodes[index].textContent = nodeCutter.TrimLineBreak(nodes[index].textContent);\n        }\n\n        if (format === 'uppercase' || format === 'lowercase') {\n          nodes[index].textContent = format === 'uppercase' ? nodes[index].textContent.toLocaleUpperCase() : nodes[index].textContent.toLocaleLowerCase();\n        } else if (!(isFontStyle === true && value === '')) {\n          var element = this.GetFormatNode(format, value);\n\n          if (format === 'fontsize' || format === 'fontcolor') {\n            var liElement = nodes[index].parentElement;\n            var parentElement = nodes[index].parentElement;\n\n            while (!isNOU(parentElement) && parentElement.tagName.toLowerCase() !== 'li') {\n              parentElement = parentElement.parentElement;\n              liElement = parentElement;\n            }\n\n            if (!isNOU(liElement) && liElement.tagName.toLowerCase() === 'li' && liElement.textContent.trim() === nodes[index].textContent.trim()) {\n              if (format === 'fontsize') {\n                liElement.style.fontSize = value;\n              } else {\n                liElement.style.color = value;\n                liElement.style.textDecoration = 'inherit';\n              }\n            }\n\n            nodes[index] = this.applyStyles(nodes, index, element);\n\n            if (format === 'fontsize') {\n              var bg = closest(nodes[index].parentElement, 'span[style*=' + 'background-color' + ']');\n\n              if (!isNOU(bg)) {\n                nodes[index].parentElement.style.backgroundColor = bg.style.backgroundColor;\n              }\n            }\n          } else {\n            nodes[index] = this.applyStyles(nodes, index, element);\n          }\n        }\n      } else {\n        nodes[index] = nodeCutter.GetSpliceNode(range, nodes[index]);\n      }\n    } else {\n      if (format !== 'uppercase' && format !== 'lowercase') {\n        var element = this.getInsertNode(docElement, range, format, value);\n        nodes[index] = element.firstChild;\n        nodeCutter.position = 1;\n      } else {\n        nodeCutter.position = range.startOffset;\n      }\n    }\n\n    return nodes[index];\n  };\n\n  SelectionCommands.applyStyles = function (nodes, index, element) {\n    if (!(nodes[index].nodeName === 'BR' && this.enterAction === 'BR')) {\n      nodes[index] = index === nodes.length - 1 || nodes[index].nodeName === 'BR' ? InsertMethods.Wrap(nodes[index], element) : InsertMethods.WrapBefore(nodes[index], element, true);\n      nodes[index] = this.getChildNode(nodes[index], element);\n    }\n\n    return nodes[index];\n  };\n\n  SelectionCommands.getInsertNode = function (docElement, range, format, value) {\n    var element = this.GetFormatNode(format, value);\n    element.innerHTML = '&#8203;';\n\n    if (Browser.isIE) {\n      var frag = docElement.createDocumentFragment();\n      frag.appendChild(element);\n      range.insertNode(frag);\n    } else {\n      range.insertNode(element);\n    }\n\n    return element;\n  };\n\n  SelectionCommands.getChildNode = function (node, element) {\n    if (node === undefined || node === null) {\n      element.innerHTML = '&#8203;';\n      node = element.firstChild;\n    }\n\n    return node;\n  };\n\n  SelectionCommands.applySelection = function (nodes, domSelection, nodeCutter, index, isCollapsed) {\n    if (nodes.length === 1 && !isCollapsed) {\n      domSelection.startContainer = domSelection.getNodeArray(nodes[index], true);\n      domSelection.endContainer = domSelection.startContainer;\n      domSelection.startOffset = 0;\n      domSelection.endOffset = nodes[index].textContent.length;\n    } else if (nodes.length === 1 && isCollapsed) {\n      domSelection.startContainer = domSelection.getNodeArray(nodes[index], true);\n      domSelection.endContainer = domSelection.startContainer;\n      domSelection.startOffset = nodeCutter.position;\n      domSelection.endOffset = nodeCutter.position;\n    } else if (index === 0) {\n      domSelection.startContainer = domSelection.getNodeArray(nodes[index], true);\n      domSelection.startOffset = 0;\n    } else if (index === nodes.length - 1) {\n      domSelection.endContainer = domSelection.getNodeArray(nodes[index], false);\n      domSelection.endOffset = nodes[index].textContent.length;\n    }\n\n    return domSelection;\n  };\n\n  SelectionCommands.GetFormatNode = function (format, value, tagName, styles) {\n    var node;\n\n    switch (format) {\n      case 'bold':\n        return document.createElement('strong');\n\n      case 'italic':\n        return document.createElement('em');\n\n      case 'underline':\n        node = document.createElement('span');\n        this.updateStyles(node, tagName, styles);\n        node.style.textDecoration = 'underline';\n        return node;\n\n      case 'strikethrough':\n        node = document.createElement('span');\n        this.updateStyles(node, tagName, styles);\n        node.style.textDecoration = 'line-through';\n        return node;\n\n      case 'superscript':\n        return document.createElement('sup');\n\n      case 'subscript':\n        return document.createElement('sub');\n\n      case 'fontcolor':\n        node = document.createElement('span');\n        this.updateStyles(node, tagName, styles);\n        node.style.color = value;\n        node.style.textDecoration = 'inherit';\n        return node;\n\n      case 'fontname':\n        node = document.createElement('span');\n        this.updateStyles(node, tagName, styles);\n        node.style.fontFamily = value;\n        return node;\n\n      case 'fontsize':\n        node = document.createElement('span');\n        this.updateStyles(node, tagName, styles);\n        node.style.fontSize = value;\n        return node;\n\n      default:\n        node = document.createElement('span');\n        this.updateStyles(node, tagName, styles);\n        node.style.backgroundColor = value;\n        return node;\n    }\n  };\n\n  SelectionCommands.updateStyles = function (ele, tag, styles) {\n    if (styles !== null && tag === 'SPAN') {\n      ele.setAttribute('style', styles);\n    }\n  };\n\n  SelectionCommands.enterAction = 'P';\n  return SelectionCommands;\n}();\n\nexport { SelectionCommands };","map":{"version":3,"names":["NodeSelection","NodeCutter","InsertMethods","IsFormatted","isIDevice","setEditFrameFocus","isNullOrUndefined","isNOU","Browser","closest","detach","DOMNode","SelectionCommands","applyFormat","docElement","format","endNode","enterAction","value","selector","validFormats","indexOf","domSelection","domNode","nodeCutter","isFormatted","range","getRange","save","nodes","collapsed","getSelectionNodeCollection","getSelectionNodeCollectionBr","isCollapsed","isFormat","isCursor","preventRestore","isFontStyle","length","GetCursorRange","startContainer","nodeType","parentElement","childElementCount","startOffset","firstElementChild","tagName","toLowerCase","push","cursorNode","insertCursorNode","endContainer","getNodeArray","childNodes","nodeName","parentNode","setSelectionText","endOffset","textContent","isSubSup","index","formatNode","getFormattedNode","removeFormat","insertFormat","applySelection","restore","cursorNodes","getNodeCollection","cursorFormat","getCursorFormat","firstChild","charCodeAt","isCursorEqual","regEx","RegExp","String","fromCharCode","emptySpaceNode","isBlockNode","replace","pointer","previousSibling","setCursorPoint","brElem","document","createElement","appendChild","style","color","fontFamily","fontSize","backgroundColor","unwrap","innerHTML","nextSibling","getInsertNode","currentNode","lastElementChild","splitNode","startText","substring","nodeIndex","cloneNode","getIndex","SplitNode","GetSpliceNode","pop","nodeValue","divNode","insertBefore","removeChild","lastNode","fontStyle","bgStyle","bg","formatNodeStyles","getAttribute","formatNodeTagName","child","nodeTraverse","textNode","toLocaleLowerCase","setStart","setEnd","textDecoration","num","trim","Wrap","GetFormatNode","setStartBefore","setEndAfter","currentNodeElem","outerHTML","curParentElem","liElement","TrimLineBreak","toLocaleUpperCase","element","applyStyles","position","WrapBefore","getChildNode","isIE","frag","createDocumentFragment","insertNode","node","undefined","styles","updateStyles","ele","tag","setAttribute"],"sources":["C:/Users/shahj/OneDrive/Documents/GitHub/Multifunctional-React-Dashboard/node_modules/@syncfusion/ej2-richtexteditor/src/editor-manager/plugin/selection-commands.js"],"sourcesContent":["/**\n * `Selection` module is used to handle RTE Selections.\n */\nimport { NodeSelection } from './../../selection/index';\nimport { NodeCutter } from './nodecutter';\nimport { InsertMethods } from './insert-methods';\nimport { IsFormatted } from './isformatted';\nimport { isIDevice, setEditFrameFocus } from '../../common/util';\nimport { isNullOrUndefined as isNOU, Browser, closest, detach } from '@syncfusion/ej2-base';\nimport { DOMNode } from './dom-node';\nvar SelectionCommands = /** @class */ (function () {\n    function SelectionCommands() {\n    }\n    /**\n     * applyFormat method\n     *\n     * @param {Document} docElement - specifies the document\n     * @param {string} format - specifies the string value\n     * @param {Node} endNode - specifies the end node\n     * @param {string} enterAction - specifies the enter key action\n     * @param {string} value - specifies the string value\n     * @param {string} selector - specifies the string\n     * @returns {void}\n     * @hidden\n\n     */\n    SelectionCommands.applyFormat = function (docElement, format, endNode, enterAction, value, selector) {\n        this.enterAction = enterAction;\n        var validFormats = ['bold', 'italic', 'underline', 'strikethrough', 'superscript',\n            'subscript', 'uppercase', 'lowercase', 'fontcolor', 'fontname', 'fontsize', 'backgroundcolor'];\n        if (validFormats.indexOf(format) > -1) {\n            if (format === 'backgroundcolor' && value === '') {\n                value = 'transparent';\n            }\n            var domSelection = new NodeSelection();\n            var domNode = new DOMNode(endNode, docElement);\n            var nodeCutter = new NodeCutter();\n            var isFormatted = new IsFormatted();\n            var range = domSelection.getRange(docElement);\n            var save = domSelection.save(range, docElement);\n            var nodes = range.collapsed ? domSelection.getSelectionNodeCollection(range) :\n                domSelection.getSelectionNodeCollectionBr(range);\n            var isCollapsed = false;\n            var isFormat = false;\n            var isCursor = false;\n            var preventRestore = false;\n            var isFontStyle = (['fontcolor', 'fontname', 'fontsize', 'backgroundcolor'].indexOf(format) > -1);\n            if (range.collapsed) {\n                if (nodes.length > 0) {\n                    isCollapsed = true;\n                    range = nodeCutter.GetCursorRange(docElement, range, nodes[0]);\n                }\n                else if (range.startContainer.nodeType === 3 && range.startContainer.parentElement.childElementCount > 0 &&\n                    range.startOffset > 0 && range.startContainer.parentElement.firstElementChild.tagName.toLowerCase() !== 'br') {\n                    isCollapsed = true;\n                    range = nodeCutter.GetCursorRange(docElement, range, range.startContainer);\n                    nodes.push(range.startContainer);\n                }\n                else {\n                    var cursorNode = this.insertCursorNode(docElement, domSelection, range, isFormatted, nodeCutter, format, value, endNode);\n                    domSelection.endContainer = domSelection.startContainer = domSelection.getNodeArray(cursorNode, true);\n                    var childNodes = cursorNode.nodeName === 'BR' && cursorNode.parentNode.childNodes;\n                    if (!isNOU(childNodes) && childNodes.length === 1 && childNodes[0].nodeName === 'BR' && nodes.length === 0) {\n                        domSelection.setSelectionText(docElement, range.startContainer, range.endContainer, 0, 0);\n                        preventRestore = true;\n                    }\n                    else {\n                        domSelection.endOffset = domSelection.startOffset = 1;\n                    }\n                    if (cursorNode.nodeName === 'BR' && cursorNode.parentNode.textContent.length === 0) {\n                        preventRestore = true;\n                    }\n                }\n            }\n            isCursor = range.collapsed;\n            var isSubSup = false;\n            for (var index = 0; index < nodes.length; index++) {\n                var formatNode = isFormatted.getFormattedNode(nodes[index], format, endNode);\n                if (formatNode === null) {\n                    if (format === 'subscript') {\n                        formatNode = isFormatted.getFormattedNode(nodes[index], 'superscript', endNode);\n                        isSubSup = formatNode === null ? false : true;\n                    }\n                    else if (format === 'superscript') {\n                        formatNode = isFormatted.getFormattedNode(nodes[index], 'subscript', endNode);\n                        isSubSup = formatNode === null ? false : true;\n                    }\n                }\n                if (index === 0 && formatNode === null) {\n                    isFormat = true;\n                }\n                if (formatNode !== null && (!isFormat || isFontStyle)) {\n                    nodes[index] = this.removeFormat(nodes, index, formatNode, isCursor, isFormat, isFontStyle, range, nodeCutter, format, value, domSelection, endNode, domNode);\n                }\n                else {\n                    nodes[index] = this.insertFormat(docElement, nodes, index, formatNode, isCursor, isFormat, isFontStyle, range, nodeCutter, format, value);\n                }\n                domSelection = this.applySelection(nodes, domSelection, nodeCutter, index, isCollapsed);\n            }\n            if (isIDevice()) {\n                setEditFrameFocus(endNode, selector);\n            }\n            if (!preventRestore) {\n                save.restore();\n            }\n            if (isSubSup) {\n                this.applyFormat(docElement, format, endNode, enterAction);\n            }\n        }\n    };\n    SelectionCommands.insertCursorNode = function (docElement, domSelection, range, isFormatted, nodeCutter, format, value, endNode) {\n        var cursorNodes = domSelection.getNodeCollection(range);\n        var domNode = new DOMNode(endNode, docElement);\n        var cursorFormat = (cursorNodes.length > 0) ?\n            (cursorNodes.length > 1 && range.startContainer === range.endContainer) ?\n                this.getCursorFormat(isFormatted, cursorNodes, format, endNode) :\n                isFormatted.getFormattedNode(cursorNodes[0], format, endNode) : null;\n        var cursorNode = null;\n        if (cursorFormat) {\n            cursorNode = cursorNodes[0];\n            if (cursorFormat.firstChild.textContent.charCodeAt(0) === 8203 && cursorFormat.firstChild.nodeType === 3) {\n                var isCursorEqual = false;\n                var regEx = new RegExp(String.fromCharCode(8203), 'g');\n                var emptySpaceNode = void 0;\n                if (cursorFormat.firstChild === cursorNode) {\n                    cursorNode.textContent = (cursorFormat.parentElement && (domNode.isBlockNode(cursorFormat.parentElement) &&\n                        cursorFormat.parentElement.textContent.length <= 1 ? cursorFormat.parentElement.childElementCount > 1 :\n                        cursorFormat.childElementCount === 0) &&\n                        (cursorFormat.parentElement.textContent.length > 1 ||\n                            cursorFormat.parentElement.firstChild && cursorFormat.parentElement.firstChild.nodeType === 1) ?\n                        cursorNode.textContent : cursorNode.textContent.replace(regEx, ''));\n                    emptySpaceNode = cursorNode;\n                    isCursorEqual = true;\n                }\n                else {\n                    cursorFormat.firstChild.textContent = cursorFormat.firstChild.textContent.replace(regEx, '');\n                    emptySpaceNode = cursorFormat.firstChild;\n                }\n                var pointer = void 0;\n                if (emptySpaceNode.textContent.length === 0) {\n                    if (!isNOU(emptySpaceNode.previousSibling)) {\n                        cursorNode = emptySpaceNode.previousSibling;\n                        pointer = emptySpaceNode.textContent.length - 1;\n                        domSelection.setCursorPoint(docElement, emptySpaceNode, pointer);\n                    }\n                    else if (!isNOU(emptySpaceNode.parentElement) && emptySpaceNode.parentElement.textContent.length === 0) {\n                        var brElem = document.createElement('BR');\n                        emptySpaceNode.parentElement.appendChild(brElem);\n                        detach(emptySpaceNode);\n                        cursorNode = brElem;\n                        domSelection.setCursorPoint(docElement, cursorNode.parentElement, 0);\n                    }\n                }\n            }\n            if ((['fontcolor', 'fontname', 'fontsize', 'backgroundcolor'].indexOf(format) > -1)) {\n                if (format === 'fontcolor') {\n                    cursorFormat.style.color = value;\n                }\n                else if (format === 'fontname') {\n                    cursorFormat.style.fontFamily = value;\n                }\n                else if (format === 'fontsize') {\n                    cursorFormat.style.fontSize = value;\n                }\n                else {\n                    cursorFormat.style.backgroundColor = value;\n                }\n                cursorNode = cursorFormat;\n            }\n            else {\n                InsertMethods.unwrap(cursorFormat);\n            }\n        }\n        else {\n            if (cursorNodes.length > 1 && range.startOffset > 0 && (cursorNodes[0].firstElementChild &&\n                cursorNodes[0].firstElementChild.tagName.toLowerCase() === 'br')) {\n                cursorNodes[0].innerHTML = '';\n            }\n            if (cursorNodes.length === 1 && range.startOffset === 0 && (cursorNodes[0].nodeName === 'BR' ||\n                cursorNodes[0].nextSibling.nodeName === 'BR')) {\n                detach(cursorNodes[0].nodeName === '#text' ? cursorNodes[0].nextSibling : cursorNodes[0]);\n            }\n            cursorNode = this.getInsertNode(docElement, range, format, value).firstChild;\n        }\n        return cursorNode;\n    };\n    SelectionCommands.getCursorFormat = function (isFormatted, cursorNodes, format, endNode) {\n        var currentNode;\n        for (var index = 0; index < cursorNodes.length; index++) {\n            currentNode = cursorNodes[index].lastElementChild ?\n                cursorNodes[index].lastElementChild : cursorNodes[index];\n        }\n        return isFormatted.getFormattedNode(currentNode, format, endNode);\n    };\n    SelectionCommands.removeFormat = function (nodes, index, formatNode, isCursor, isFormat, isFontStyle, range, nodeCutter, format, value, domSelection, endNode, domNode) {\n        var splitNode = null;\n        var startText = range.startContainer.nodeName === '#text' ?\n            range.startContainer.textContent.substring(range.startOffset, range.startContainer.textContent.length) :\n            range.startContainer.textContent;\n        if (!(range.startContainer === range.endContainer && range.startOffset === 0\n            && range.endOffset === range.startContainer.length)) {\n            var nodeIndex = [];\n            var cloneNode = nodes[index];\n            do {\n                nodeIndex.push(domSelection.getIndex(cloneNode));\n                cloneNode = cloneNode.parentNode;\n            } while (cloneNode && (cloneNode !== formatNode));\n            if (nodes[index].nodeName !== 'BR') {\n                cloneNode = splitNode = (isCursor && (formatNode.textContent.length - 1) === range.startOffset) ?\n                    nodeCutter.SplitNode(range, formatNode, true)\n                    : nodeCutter.GetSpliceNode(range, formatNode);\n            }\n            if (!isCursor) {\n                while (cloneNode && cloneNode.childNodes.length > 0 && ((nodeIndex.length - 1) >= 0)\n                    && (cloneNode.childNodes.length > nodeIndex[nodeIndex.length - 1])) {\n                    cloneNode = cloneNode.childNodes[nodeIndex[nodeIndex.length - 1]];\n                    nodeIndex.pop();\n                }\n                if (nodes[index].nodeName !== 'BR') {\n                    if (cloneNode.nodeType === 3 && !(isCursor && cloneNode.nodeValue === '')) {\n                        nodes[index] = cloneNode;\n                    }\n                    else {\n                        var divNode = document.createElement('div');\n                        divNode.innerHTML = '&#8203;';\n                        if (cloneNode.nodeType !== 3) {\n                            cloneNode.insertBefore(divNode.firstChild, cloneNode.firstChild);\n                            nodes[index] = cloneNode.firstChild;\n                        }\n                        else {\n                            cloneNode.parentNode.insertBefore(divNode.firstChild, cloneNode);\n                            nodes[index] = cloneNode.previousSibling;\n                            cloneNode.parentNode.removeChild(cloneNode);\n                        }\n                    }\n                }\n            }\n            else {\n                var lastNode = splitNode;\n                for (; lastNode.firstChild !== null && lastNode.firstChild.nodeType !== 3; null) {\n                    lastNode = lastNode.firstChild;\n                }\n                lastNode.innerHTML = '&#8203;';\n                nodes[index] = lastNode.firstChild;\n            }\n        }\n        var fontStyle;\n        if (format === 'backgroundcolor') {\n            fontStyle = formatNode.style.fontSize;\n        }\n        var bgStyle;\n        if (format === 'fontsize') {\n            var bg = closest(nodes[index].parentElement, 'span[style*=' + 'background-color' + ']');\n            if (!isNOU(bg)) {\n                bgStyle = bg.style.backgroundColor;\n            }\n        }\n        var formatNodeStyles = formatNode.getAttribute('style');\n        var formatNodeTagName = formatNode.tagName;\n        var child = InsertMethods.unwrap(formatNode);\n        if (child[0] && !isFontStyle) {\n            var nodeTraverse = child[index] ? child[index] : child[0];\n            var textNode = nodeTraverse;\n            for (; nodeTraverse && nodeTraverse.parentElement && nodeTraverse.parentElement !== endNode; \n            // eslint-disable-next-line\n            nodeTraverse = nodeTraverse) {\n                if (nodeTraverse.parentElement && nodeTraverse.parentElement.tagName.toLocaleLowerCase()\n                    === formatNode.tagName.toLocaleLowerCase() &&\n                    (nodeTraverse.parentElement.childElementCount > 1 || range.startOffset > 1)) {\n                    if (textNode.parentElement && textNode.parentElement.tagName.toLocaleLowerCase()\n                        === formatNode.tagName.toLocaleLowerCase()) {\n                        if ((range.startOffset === range.endOffset) && textNode.nodeType !== 1 &&\n                            !isNOU(textNode.textContent) && textNode.parentElement.childElementCount > 1) {\n                            range.setStart(textNode, 0);\n                            range.setEnd(textNode, textNode.textContent.length);\n                            nodeCutter.SplitNode(range, textNode.parentElement, false);\n                        }\n                    }\n                    if (nodeTraverse.parentElement.tagName.toLocaleLowerCase() === 'span') {\n                        if (formatNode.style.textDecoration === 'underline' &&\n                            nodeTraverse.parentElement.style.textDecoration !== 'underline') {\n                            nodeTraverse = nodeTraverse.parentElement;\n                            continue;\n                        }\n                    }\n                    InsertMethods.unwrap(nodeTraverse.parentElement);\n                    nodeTraverse = !isNOU(nodeTraverse.parentElement) && !domNode.isBlockNode(nodeTraverse.parentElement) ? textNode :\n                        nodeTraverse.parentElement;\n                }\n                else {\n                    nodeTraverse = nodeTraverse.parentElement;\n                }\n            }\n        }\n        if (child.length > 0 && isFontStyle) {\n            for (var num = 0; num < child.length; num++) {\n                if (child[num].nodeType !== 3 || (child[num].textContent && child[num].textContent.trim().length > 0)) {\n                    child[num] = InsertMethods.Wrap(child[num], this.GetFormatNode(format, value, formatNodeTagName, formatNodeStyles));\n                    if (child[num].textContent === startText) {\n                        if (num === 0) {\n                            range.setStartBefore(child[num]);\n                        }\n                        else if (num === child.length - 1) {\n                            range.setEndAfter(child[num]);\n                        }\n                    }\n                }\n            }\n            var currentNodeElem = nodes[index].parentElement;\n            if (!isNOU(fontStyle) && fontStyle !== '') {\n                currentNodeElem.style.fontSize = fontStyle;\n            }\n            if (!isNOU(bgStyle) && bgStyle !== '') {\n                currentNodeElem.style.backgroundColor = bgStyle;\n            }\n            if ((format === 'backgroundcolor' && !isNOU(fontStyle) && fontStyle !== '') &&\n                currentNodeElem.parentElement.innerHTML === currentNodeElem.outerHTML) {\n                var curParentElem = currentNodeElem.parentElement;\n                curParentElem.parentElement.insertBefore(currentNodeElem, curParentElem);\n                detach(curParentElem);\n            }\n            if (format === 'fontsize' || format === 'fontcolor') {\n                var liElement = nodes[index].parentElement;\n                var parentElement = nodes[index].parentElement;\n                while (!isNOU(parentElement) && parentElement.tagName.toLowerCase() !== 'li') {\n                    parentElement = parentElement.parentElement;\n                    liElement = parentElement;\n                }\n                if (!isNOU(liElement) && liElement.tagName.toLowerCase() === 'li' &&\n                    liElement.textContent.trim() === nodes[index].textContent.trim()) {\n                    if (format === 'fontsize') {\n                        liElement.style.fontSize = value;\n                    }\n                    else {\n                        liElement.style.color = value;\n                        liElement.style.textDecoration = 'inherit';\n                    }\n                }\n            }\n        }\n        return nodes[index];\n    };\n    SelectionCommands.insertFormat = function (docElement, nodes, index, formatNode, isCursor, isFormat, isFontStyle, range, nodeCutter, format, value) {\n        if (!isCursor) {\n            if ((formatNode === null && isFormat) || isFontStyle) {\n                if (nodes[index].nodeName !== 'BR') {\n                    nodes[index] = nodeCutter.GetSpliceNode(range, nodes[index]);\n                    nodes[index].textContent = nodeCutter.TrimLineBreak(nodes[index].textContent);\n                }\n                if (format === 'uppercase' || format === 'lowercase') {\n                    nodes[index].textContent = (format === 'uppercase') ? nodes[index].textContent.toLocaleUpperCase()\n                        : nodes[index].textContent.toLocaleLowerCase();\n                }\n                else if (!(isFontStyle === true && value === '')) {\n                    var element = this.GetFormatNode(format, value);\n                    if (format === 'fontsize' || format === 'fontcolor') {\n                        var liElement = nodes[index].parentElement;\n                        var parentElement = nodes[index].parentElement;\n                        while (!isNOU(parentElement) && parentElement.tagName.toLowerCase() !== 'li') {\n                            parentElement = parentElement.parentElement;\n                            liElement = parentElement;\n                        }\n                        if (!isNOU(liElement) && liElement.tagName.toLowerCase() === 'li' &&\n                            liElement.textContent.trim() === nodes[index].textContent.trim()) {\n                            if (format === 'fontsize') {\n                                liElement.style.fontSize = value;\n                            }\n                            else {\n                                liElement.style.color = value;\n                                liElement.style.textDecoration = 'inherit';\n                            }\n                        }\n                        nodes[index] = this.applyStyles(nodes, index, element);\n                        if (format === 'fontsize') {\n                            var bg = closest(nodes[index].parentElement, 'span[style*=' + 'background-color' + ']');\n                            if (!isNOU(bg)) {\n                                nodes[index].parentElement.style.backgroundColor = bg.style.backgroundColor;\n                            }\n                        }\n                    }\n                    else {\n                        nodes[index] = this.applyStyles(nodes, index, element);\n                    }\n                }\n            }\n            else {\n                nodes[index] = nodeCutter.GetSpliceNode(range, nodes[index]);\n            }\n        }\n        else {\n            if (format !== 'uppercase' && format !== 'lowercase') {\n                var element = this.getInsertNode(docElement, range, format, value);\n                nodes[index] = element.firstChild;\n                nodeCutter.position = 1;\n            }\n            else {\n                nodeCutter.position = range.startOffset;\n            }\n        }\n        return nodes[index];\n    };\n    SelectionCommands.applyStyles = function (nodes, index, element) {\n        if (!(nodes[index].nodeName === 'BR' && this.enterAction === 'BR')) {\n            nodes[index] = (index === (nodes.length - 1)) || nodes[index].nodeName === 'BR' ?\n                InsertMethods.Wrap(nodes[index], element)\n                : InsertMethods.WrapBefore(nodes[index], element, true);\n            nodes[index] = this.getChildNode(nodes[index], element);\n        }\n        return nodes[index];\n    };\n    SelectionCommands.getInsertNode = function (docElement, range, format, value) {\n        var element = this.GetFormatNode(format, value);\n        element.innerHTML = '&#8203;';\n        if (Browser.isIE) {\n            var frag = docElement.createDocumentFragment();\n            frag.appendChild(element);\n            range.insertNode(frag);\n        }\n        else {\n            range.insertNode(element);\n        }\n        return element;\n    };\n    SelectionCommands.getChildNode = function (node, element) {\n        if (node === undefined || node === null) {\n            element.innerHTML = '&#8203;';\n            node = element.firstChild;\n        }\n        return node;\n    };\n    SelectionCommands.applySelection = function (nodes, domSelection, nodeCutter, index, isCollapsed) {\n        if (nodes.length === 1 && !isCollapsed) {\n            domSelection.startContainer = domSelection.getNodeArray(nodes[index], true);\n            domSelection.endContainer = domSelection.startContainer;\n            domSelection.startOffset = 0;\n            domSelection.endOffset = nodes[index].textContent.length;\n        }\n        else if (nodes.length === 1 && isCollapsed) {\n            domSelection.startContainer = domSelection.getNodeArray(nodes[index], true);\n            domSelection.endContainer = domSelection.startContainer;\n            domSelection.startOffset = nodeCutter.position;\n            domSelection.endOffset = nodeCutter.position;\n        }\n        else if (index === 0) {\n            domSelection.startContainer = domSelection.getNodeArray(nodes[index], true);\n            domSelection.startOffset = 0;\n        }\n        else if (index === nodes.length - 1) {\n            domSelection.endContainer = domSelection.getNodeArray(nodes[index], false);\n            domSelection.endOffset = nodes[index].textContent.length;\n        }\n        return domSelection;\n    };\n    SelectionCommands.GetFormatNode = function (format, value, tagName, styles) {\n        var node;\n        switch (format) {\n            case 'bold':\n                return document.createElement('strong');\n            case 'italic':\n                return document.createElement('em');\n            case 'underline':\n                node = document.createElement('span');\n                this.updateStyles(node, tagName, styles);\n                node.style.textDecoration = 'underline';\n                return node;\n            case 'strikethrough':\n                node = document.createElement('span');\n                this.updateStyles(node, tagName, styles);\n                node.style.textDecoration = 'line-through';\n                return node;\n            case 'superscript':\n                return document.createElement('sup');\n            case 'subscript':\n                return document.createElement('sub');\n            case 'fontcolor':\n                node = document.createElement('span');\n                this.updateStyles(node, tagName, styles);\n                node.style.color = value;\n                node.style.textDecoration = 'inherit';\n                return node;\n            case 'fontname':\n                node = document.createElement('span');\n                this.updateStyles(node, tagName, styles);\n                node.style.fontFamily = value;\n                return node;\n            case 'fontsize':\n                node = document.createElement('span');\n                this.updateStyles(node, tagName, styles);\n                node.style.fontSize = value;\n                return node;\n            default:\n                node = document.createElement('span');\n                this.updateStyles(node, tagName, styles);\n                node.style.backgroundColor = value;\n                return node;\n        }\n    };\n    SelectionCommands.updateStyles = function (ele, tag, styles) {\n        if (styles !== null && tag === 'SPAN') {\n            ele.setAttribute('style', styles);\n        }\n    };\n    SelectionCommands.enterAction = 'P';\n    return SelectionCommands;\n}());\nexport { SelectionCommands };\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,aAAT,QAA8B,yBAA9B;AACA,SAASC,UAAT,QAA2B,cAA3B;AACA,SAASC,aAAT,QAA8B,kBAA9B;AACA,SAASC,WAAT,QAA4B,eAA5B;AACA,SAASC,SAAT,EAAoBC,iBAApB,QAA6C,mBAA7C;AACA,SAASC,iBAAiB,IAAIC,KAA9B,EAAqCC,OAArC,EAA8CC,OAA9C,EAAuDC,MAAvD,QAAqE,sBAArE;AACA,SAASC,OAAT,QAAwB,YAAxB;;AACA,IAAIC,iBAAiB;AAAG;AAAe,YAAY;EAC/C,SAASA,iBAAT,GAA6B,CAC5B;EACD;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;EAEIA,iBAAiB,CAACC,WAAlB,GAAgC,UAAUC,UAAV,EAAsBC,MAAtB,EAA8BC,OAA9B,EAAuCC,WAAvC,EAAoDC,KAApD,EAA2DC,QAA3D,EAAqE;IACjG,KAAKF,WAAL,GAAmBA,WAAnB;IACA,IAAIG,YAAY,GAAG,CAAC,MAAD,EAAS,QAAT,EAAmB,WAAnB,EAAgC,eAAhC,EAAiD,aAAjD,EACf,WADe,EACF,WADE,EACW,WADX,EACwB,WADxB,EACqC,UADrC,EACiD,UADjD,EAC6D,iBAD7D,CAAnB;;IAEA,IAAIA,YAAY,CAACC,OAAb,CAAqBN,MAArB,IAA+B,CAAC,CAApC,EAAuC;MACnC,IAAIA,MAAM,KAAK,iBAAX,IAAgCG,KAAK,KAAK,EAA9C,EAAkD;QAC9CA,KAAK,GAAG,aAAR;MACH;;MACD,IAAII,YAAY,GAAG,IAAItB,aAAJ,EAAnB;MACA,IAAIuB,OAAO,GAAG,IAAIZ,OAAJ,CAAYK,OAAZ,EAAqBF,UAArB,CAAd;MACA,IAAIU,UAAU,GAAG,IAAIvB,UAAJ,EAAjB;MACA,IAAIwB,WAAW,GAAG,IAAItB,WAAJ,EAAlB;MACA,IAAIuB,KAAK,GAAGJ,YAAY,CAACK,QAAb,CAAsBb,UAAtB,CAAZ;MACA,IAAIc,IAAI,GAAGN,YAAY,CAACM,IAAb,CAAkBF,KAAlB,EAAyBZ,UAAzB,CAAX;MACA,IAAIe,KAAK,GAAGH,KAAK,CAACI,SAAN,GAAkBR,YAAY,CAACS,0BAAb,CAAwCL,KAAxC,CAAlB,GACRJ,YAAY,CAACU,4BAAb,CAA0CN,KAA1C,CADJ;MAEA,IAAIO,WAAW,GAAG,KAAlB;MACA,IAAIC,QAAQ,GAAG,KAAf;MACA,IAAIC,QAAQ,GAAG,KAAf;MACA,IAAIC,cAAc,GAAG,KAArB;MACA,IAAIC,WAAW,GAAI,CAAC,WAAD,EAAc,UAAd,EAA0B,UAA1B,EAAsC,iBAAtC,EAAyDhB,OAAzD,CAAiEN,MAAjE,IAA2E,CAAC,CAA/F;;MACA,IAAIW,KAAK,CAACI,SAAV,EAAqB;QACjB,IAAID,KAAK,CAACS,MAAN,GAAe,CAAnB,EAAsB;UAClBL,WAAW,GAAG,IAAd;UACAP,KAAK,GAAGF,UAAU,CAACe,cAAX,CAA0BzB,UAA1B,EAAsCY,KAAtC,EAA6CG,KAAK,CAAC,CAAD,CAAlD,CAAR;QACH,CAHD,MAIK,IAAIH,KAAK,CAACc,cAAN,CAAqBC,QAArB,KAAkC,CAAlC,IAAuCf,KAAK,CAACc,cAAN,CAAqBE,aAArB,CAAmCC,iBAAnC,GAAuD,CAA9F,IACLjB,KAAK,CAACkB,WAAN,GAAoB,CADf,IACoBlB,KAAK,CAACc,cAAN,CAAqBE,aAArB,CAAmCG,iBAAnC,CAAqDC,OAArD,CAA6DC,WAA7D,OAA+E,IADvG,EAC6G;UAC9Gd,WAAW,GAAG,IAAd;UACAP,KAAK,GAAGF,UAAU,CAACe,cAAX,CAA0BzB,UAA1B,EAAsCY,KAAtC,EAA6CA,KAAK,CAACc,cAAnD,CAAR;UACAX,KAAK,CAACmB,IAAN,CAAWtB,KAAK,CAACc,cAAjB;QACH,CALI,MAMA;UACD,IAAIS,UAAU,GAAG,KAAKC,gBAAL,CAAsBpC,UAAtB,EAAkCQ,YAAlC,EAAgDI,KAAhD,EAAuDD,WAAvD,EAAoED,UAApE,EAAgFT,MAAhF,EAAwFG,KAAxF,EAA+FF,OAA/F,CAAjB;UACAM,YAAY,CAAC6B,YAAb,GAA4B7B,YAAY,CAACkB,cAAb,GAA8BlB,YAAY,CAAC8B,YAAb,CAA0BH,UAA1B,EAAsC,IAAtC,CAA1D;UACA,IAAII,UAAU,GAAGJ,UAAU,CAACK,QAAX,KAAwB,IAAxB,IAAgCL,UAAU,CAACM,UAAX,CAAsBF,UAAvE;;UACA,IAAI,CAAC9C,KAAK,CAAC8C,UAAD,CAAN,IAAsBA,UAAU,CAACf,MAAX,KAAsB,CAA5C,IAAiDe,UAAU,CAAC,CAAD,CAAV,CAAcC,QAAd,KAA2B,IAA5E,IAAoFzB,KAAK,CAACS,MAAN,KAAiB,CAAzG,EAA4G;YACxGhB,YAAY,CAACkC,gBAAb,CAA8B1C,UAA9B,EAA0CY,KAAK,CAACc,cAAhD,EAAgEd,KAAK,CAACyB,YAAtE,EAAoF,CAApF,EAAuF,CAAvF;YACAf,cAAc,GAAG,IAAjB;UACH,CAHD,MAIK;YACDd,YAAY,CAACmC,SAAb,GAAyBnC,YAAY,CAACsB,WAAb,GAA2B,CAApD;UACH;;UACD,IAAIK,UAAU,CAACK,QAAX,KAAwB,IAAxB,IAAgCL,UAAU,CAACM,UAAX,CAAsBG,WAAtB,CAAkCpB,MAAlC,KAA6C,CAAjF,EAAoF;YAChFF,cAAc,GAAG,IAAjB;UACH;QACJ;MACJ;;MACDD,QAAQ,GAAGT,KAAK,CAACI,SAAjB;MACA,IAAI6B,QAAQ,GAAG,KAAf;;MACA,KAAK,IAAIC,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAG/B,KAAK,CAACS,MAAlC,EAA0CsB,KAAK,EAA/C,EAAmD;QAC/C,IAAIC,UAAU,GAAGpC,WAAW,CAACqC,gBAAZ,CAA6BjC,KAAK,CAAC+B,KAAD,CAAlC,EAA2C7C,MAA3C,EAAmDC,OAAnD,CAAjB;;QACA,IAAI6C,UAAU,KAAK,IAAnB,EAAyB;UACrB,IAAI9C,MAAM,KAAK,WAAf,EAA4B;YACxB8C,UAAU,GAAGpC,WAAW,CAACqC,gBAAZ,CAA6BjC,KAAK,CAAC+B,KAAD,CAAlC,EAA2C,aAA3C,EAA0D5C,OAA1D,CAAb;YACA2C,QAAQ,GAAGE,UAAU,KAAK,IAAf,GAAsB,KAAtB,GAA8B,IAAzC;UACH,CAHD,MAIK,IAAI9C,MAAM,KAAK,aAAf,EAA8B;YAC/B8C,UAAU,GAAGpC,WAAW,CAACqC,gBAAZ,CAA6BjC,KAAK,CAAC+B,KAAD,CAAlC,EAA2C,WAA3C,EAAwD5C,OAAxD,CAAb;YACA2C,QAAQ,GAAGE,UAAU,KAAK,IAAf,GAAsB,KAAtB,GAA8B,IAAzC;UACH;QACJ;;QACD,IAAID,KAAK,KAAK,CAAV,IAAeC,UAAU,KAAK,IAAlC,EAAwC;UACpC3B,QAAQ,GAAG,IAAX;QACH;;QACD,IAAI2B,UAAU,KAAK,IAAf,KAAwB,CAAC3B,QAAD,IAAaG,WAArC,CAAJ,EAAuD;UACnDR,KAAK,CAAC+B,KAAD,CAAL,GAAe,KAAKG,YAAL,CAAkBlC,KAAlB,EAAyB+B,KAAzB,EAAgCC,UAAhC,EAA4C1B,QAA5C,EAAsDD,QAAtD,EAAgEG,WAAhE,EAA6EX,KAA7E,EAAoFF,UAApF,EAAgGT,MAAhG,EAAwGG,KAAxG,EAA+GI,YAA/G,EAA6HN,OAA7H,EAAsIO,OAAtI,CAAf;QACH,CAFD,MAGK;UACDM,KAAK,CAAC+B,KAAD,CAAL,GAAe,KAAKI,YAAL,CAAkBlD,UAAlB,EAA8Be,KAA9B,EAAqC+B,KAArC,EAA4CC,UAA5C,EAAwD1B,QAAxD,EAAkED,QAAlE,EAA4EG,WAA5E,EAAyFX,KAAzF,EAAgGF,UAAhG,EAA4GT,MAA5G,EAAoHG,KAApH,CAAf;QACH;;QACDI,YAAY,GAAG,KAAK2C,cAAL,CAAoBpC,KAApB,EAA2BP,YAA3B,EAAyCE,UAAzC,EAAqDoC,KAArD,EAA4D3B,WAA5D,CAAf;MACH;;MACD,IAAI7B,SAAS,EAAb,EAAiB;QACbC,iBAAiB,CAACW,OAAD,EAAUG,QAAV,CAAjB;MACH;;MACD,IAAI,CAACiB,cAAL,EAAqB;QACjBR,IAAI,CAACsC,OAAL;MACH;;MACD,IAAIP,QAAJ,EAAc;QACV,KAAK9C,WAAL,CAAiBC,UAAjB,EAA6BC,MAA7B,EAAqCC,OAArC,EAA8CC,WAA9C;MACH;IACJ;EACJ,CAnFD;;EAoFAL,iBAAiB,CAACsC,gBAAlB,GAAqC,UAAUpC,UAAV,EAAsBQ,YAAtB,EAAoCI,KAApC,EAA2CD,WAA3C,EAAwDD,UAAxD,EAAoET,MAApE,EAA4EG,KAA5E,EAAmFF,OAAnF,EAA4F;IAC7H,IAAImD,WAAW,GAAG7C,YAAY,CAAC8C,iBAAb,CAA+B1C,KAA/B,CAAlB;IACA,IAAIH,OAAO,GAAG,IAAIZ,OAAJ,CAAYK,OAAZ,EAAqBF,UAArB,CAAd;IACA,IAAIuD,YAAY,GAAIF,WAAW,CAAC7B,MAAZ,GAAqB,CAAtB,GACd6B,WAAW,CAAC7B,MAAZ,GAAqB,CAArB,IAA0BZ,KAAK,CAACc,cAAN,KAAyBd,KAAK,CAACyB,YAA1D,GACI,KAAKmB,eAAL,CAAqB7C,WAArB,EAAkC0C,WAAlC,EAA+CpD,MAA/C,EAAuDC,OAAvD,CADJ,GAEIS,WAAW,CAACqC,gBAAZ,CAA6BK,WAAW,CAAC,CAAD,CAAxC,EAA6CpD,MAA7C,EAAqDC,OAArD,CAHW,GAGqD,IAHxE;IAIA,IAAIiC,UAAU,GAAG,IAAjB;;IACA,IAAIoB,YAAJ,EAAkB;MACdpB,UAAU,GAAGkB,WAAW,CAAC,CAAD,CAAxB;;MACA,IAAIE,YAAY,CAACE,UAAb,CAAwBb,WAAxB,CAAoCc,UAApC,CAA+C,CAA/C,MAAsD,IAAtD,IAA8DH,YAAY,CAACE,UAAb,CAAwB9B,QAAxB,KAAqC,CAAvG,EAA0G;QACtG,IAAIgC,aAAa,GAAG,KAApB;QACA,IAAIC,KAAK,GAAG,IAAIC,MAAJ,CAAWC,MAAM,CAACC,YAAP,CAAoB,IAApB,CAAX,EAAsC,GAAtC,CAAZ;QACA,IAAIC,cAAc,GAAG,KAAK,CAA1B;;QACA,IAAIT,YAAY,CAACE,UAAb,KAA4BtB,UAAhC,EAA4C;UACxCA,UAAU,CAACS,WAAX,GAA0BW,YAAY,CAAC3B,aAAb,KAA+BnB,OAAO,CAACwD,WAAR,CAAoBV,YAAY,CAAC3B,aAAjC,KACrD2B,YAAY,CAAC3B,aAAb,CAA2BgB,WAA3B,CAAuCpB,MAAvC,IAAiD,CADI,GACA+B,YAAY,CAAC3B,aAAb,CAA2BC,iBAA3B,GAA+C,CAD/C,GAErD0B,YAAY,CAAC1B,iBAAb,KAAmC,CAFb,MAGrB0B,YAAY,CAAC3B,aAAb,CAA2BgB,WAA3B,CAAuCpB,MAAvC,GAAgD,CAAhD,IACG+B,YAAY,CAAC3B,aAAb,CAA2B6B,UAA3B,IAAyCF,YAAY,CAAC3B,aAAb,CAA2B6B,UAA3B,CAAsC9B,QAAtC,KAAmD,CAJ1E,IAKtBQ,UAAU,CAACS,WALW,GAKGT,UAAU,CAACS,WAAX,CAAuBsB,OAAvB,CAA+BN,KAA/B,EAAsC,EAAtC,CAL7B;UAMAI,cAAc,GAAG7B,UAAjB;UACAwB,aAAa,GAAG,IAAhB;QACH,CATD,MAUK;UACDJ,YAAY,CAACE,UAAb,CAAwBb,WAAxB,GAAsCW,YAAY,CAACE,UAAb,CAAwBb,WAAxB,CAAoCsB,OAApC,CAA4CN,KAA5C,EAAmD,EAAnD,CAAtC;UACAI,cAAc,GAAGT,YAAY,CAACE,UAA9B;QACH;;QACD,IAAIU,OAAO,GAAG,KAAK,CAAnB;;QACA,IAAIH,cAAc,CAACpB,WAAf,CAA2BpB,MAA3B,KAAsC,CAA1C,EAA6C;UACzC,IAAI,CAAC/B,KAAK,CAACuE,cAAc,CAACI,eAAhB,CAAV,EAA4C;YACxCjC,UAAU,GAAG6B,cAAc,CAACI,eAA5B;YACAD,OAAO,GAAGH,cAAc,CAACpB,WAAf,CAA2BpB,MAA3B,GAAoC,CAA9C;YACAhB,YAAY,CAAC6D,cAAb,CAA4BrE,UAA5B,EAAwCgE,cAAxC,EAAwDG,OAAxD;UACH,CAJD,MAKK,IAAI,CAAC1E,KAAK,CAACuE,cAAc,CAACpC,aAAhB,CAAN,IAAwCoC,cAAc,CAACpC,aAAf,CAA6BgB,WAA7B,CAAyCpB,MAAzC,KAAoD,CAAhG,EAAmG;YACpG,IAAI8C,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,IAAvB,CAAb;YACAR,cAAc,CAACpC,aAAf,CAA6B6C,WAA7B,CAAyCH,MAAzC;YACA1E,MAAM,CAACoE,cAAD,CAAN;YACA7B,UAAU,GAAGmC,MAAb;YACA9D,YAAY,CAAC6D,cAAb,CAA4BrE,UAA5B,EAAwCmC,UAAU,CAACP,aAAnD,EAAkE,CAAlE;UACH;QACJ;MACJ;;MACD,IAAK,CAAC,WAAD,EAAc,UAAd,EAA0B,UAA1B,EAAsC,iBAAtC,EAAyDrB,OAAzD,CAAiEN,MAAjE,IAA2E,CAAC,CAAjF,EAAqF;QACjF,IAAIA,MAAM,KAAK,WAAf,EAA4B;UACxBsD,YAAY,CAACmB,KAAb,CAAmBC,KAAnB,GAA2BvE,KAA3B;QACH,CAFD,MAGK,IAAIH,MAAM,KAAK,UAAf,EAA2B;UAC5BsD,YAAY,CAACmB,KAAb,CAAmBE,UAAnB,GAAgCxE,KAAhC;QACH,CAFI,MAGA,IAAIH,MAAM,KAAK,UAAf,EAA2B;UAC5BsD,YAAY,CAACmB,KAAb,CAAmBG,QAAnB,GAA8BzE,KAA9B;QACH,CAFI,MAGA;UACDmD,YAAY,CAACmB,KAAb,CAAmBI,eAAnB,GAAqC1E,KAArC;QACH;;QACD+B,UAAU,GAAGoB,YAAb;MACH,CAdD,MAeK;QACDnE,aAAa,CAAC2F,MAAd,CAAqBxB,YAArB;MACH;IACJ,CAtDD,MAuDK;MACD,IAAIF,WAAW,CAAC7B,MAAZ,GAAqB,CAArB,IAA0BZ,KAAK,CAACkB,WAAN,GAAoB,CAA9C,IAAoDuB,WAAW,CAAC,CAAD,CAAX,CAAetB,iBAAf,IACpDsB,WAAW,CAAC,CAAD,CAAX,CAAetB,iBAAf,CAAiCC,OAAjC,CAAyCC,WAAzC,OAA2D,IAD/D,EACsE;QAClEoB,WAAW,CAAC,CAAD,CAAX,CAAe2B,SAAf,GAA2B,EAA3B;MACH;;MACD,IAAI3B,WAAW,CAAC7B,MAAZ,KAAuB,CAAvB,IAA4BZ,KAAK,CAACkB,WAAN,KAAsB,CAAlD,KAAwDuB,WAAW,CAAC,CAAD,CAAX,CAAeb,QAAf,KAA4B,IAA5B,IACxDa,WAAW,CAAC,CAAD,CAAX,CAAe4B,WAAf,CAA2BzC,QAA3B,KAAwC,IADxC,CAAJ,EACmD;QAC/C5C,MAAM,CAACyD,WAAW,CAAC,CAAD,CAAX,CAAeb,QAAf,KAA4B,OAA5B,GAAsCa,WAAW,CAAC,CAAD,CAAX,CAAe4B,WAArD,GAAmE5B,WAAW,CAAC,CAAD,CAA/E,CAAN;MACH;;MACDlB,UAAU,GAAG,KAAK+C,aAAL,CAAmBlF,UAAnB,EAA+BY,KAA/B,EAAsCX,MAAtC,EAA8CG,KAA9C,EAAqDqD,UAAlE;IACH;;IACD,OAAOtB,UAAP;EACH,CA3ED;;EA4EArC,iBAAiB,CAAC0D,eAAlB,GAAoC,UAAU7C,WAAV,EAAuB0C,WAAvB,EAAoCpD,MAApC,EAA4CC,OAA5C,EAAqD;IACrF,IAAIiF,WAAJ;;IACA,KAAK,IAAIrC,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGO,WAAW,CAAC7B,MAAxC,EAAgDsB,KAAK,EAArD,EAAyD;MACrDqC,WAAW,GAAG9B,WAAW,CAACP,KAAD,CAAX,CAAmBsC,gBAAnB,GACV/B,WAAW,CAACP,KAAD,CAAX,CAAmBsC,gBADT,GAC4B/B,WAAW,CAACP,KAAD,CADrD;IAEH;;IACD,OAAOnC,WAAW,CAACqC,gBAAZ,CAA6BmC,WAA7B,EAA0ClF,MAA1C,EAAkDC,OAAlD,CAAP;EACH,CAPD;;EAQAJ,iBAAiB,CAACmD,YAAlB,GAAiC,UAAUlC,KAAV,EAAiB+B,KAAjB,EAAwBC,UAAxB,EAAoC1B,QAApC,EAA8CD,QAA9C,EAAwDG,WAAxD,EAAqEX,KAArE,EAA4EF,UAA5E,EAAwFT,MAAxF,EAAgGG,KAAhG,EAAuGI,YAAvG,EAAqHN,OAArH,EAA8HO,OAA9H,EAAuI;IACpK,IAAI4E,SAAS,GAAG,IAAhB;IACA,IAAIC,SAAS,GAAG1E,KAAK,CAACc,cAAN,CAAqBc,QAArB,KAAkC,OAAlC,GACZ5B,KAAK,CAACc,cAAN,CAAqBkB,WAArB,CAAiC2C,SAAjC,CAA2C3E,KAAK,CAACkB,WAAjD,EAA8DlB,KAAK,CAACc,cAAN,CAAqBkB,WAArB,CAAiCpB,MAA/F,CADY,GAEZZ,KAAK,CAACc,cAAN,CAAqBkB,WAFzB;;IAGA,IAAI,EAAEhC,KAAK,CAACc,cAAN,KAAyBd,KAAK,CAACyB,YAA/B,IAA+CzB,KAAK,CAACkB,WAAN,KAAsB,CAArE,IACClB,KAAK,CAAC+B,SAAN,KAAoB/B,KAAK,CAACc,cAAN,CAAqBF,MAD5C,CAAJ,EACyD;MACrD,IAAIgE,SAAS,GAAG,EAAhB;MACA,IAAIC,SAAS,GAAG1E,KAAK,CAAC+B,KAAD,CAArB;;MACA,GAAG;QACC0C,SAAS,CAACtD,IAAV,CAAe1B,YAAY,CAACkF,QAAb,CAAsBD,SAAtB,CAAf;QACAA,SAAS,GAAGA,SAAS,CAAChD,UAAtB;MACH,CAHD,QAGSgD,SAAS,IAAKA,SAAS,KAAK1C,UAHrC;;MAIA,IAAIhC,KAAK,CAAC+B,KAAD,CAAL,CAAaN,QAAb,KAA0B,IAA9B,EAAoC;QAChCiD,SAAS,GAAGJ,SAAS,GAAIhE,QAAQ,IAAK0B,UAAU,CAACH,WAAX,CAAuBpB,MAAvB,GAAgC,CAAjC,KAAwCZ,KAAK,CAACkB,WAA3D,GACpBpB,UAAU,CAACiF,SAAX,CAAqB/E,KAArB,EAA4BmC,UAA5B,EAAwC,IAAxC,CADoB,GAElBrC,UAAU,CAACkF,aAAX,CAAyBhF,KAAzB,EAAgCmC,UAAhC,CAFN;MAGH;;MACD,IAAI,CAAC1B,QAAL,EAAe;QACX,OAAOoE,SAAS,IAAIA,SAAS,CAAClD,UAAV,CAAqBf,MAArB,GAA8B,CAA3C,IAAkDgE,SAAS,CAAChE,MAAV,GAAmB,CAApB,IAA0B,CAA3E,IACCiE,SAAS,CAAClD,UAAV,CAAqBf,MAArB,GAA8BgE,SAAS,CAACA,SAAS,CAAChE,MAAV,GAAmB,CAApB,CAD/C,EACwE;UACpEiE,SAAS,GAAGA,SAAS,CAAClD,UAAV,CAAqBiD,SAAS,CAACA,SAAS,CAAChE,MAAV,GAAmB,CAApB,CAA9B,CAAZ;UACAgE,SAAS,CAACK,GAAV;QACH;;QACD,IAAI9E,KAAK,CAAC+B,KAAD,CAAL,CAAaN,QAAb,KAA0B,IAA9B,EAAoC;UAChC,IAAIiD,SAAS,CAAC9D,QAAV,KAAuB,CAAvB,IAA4B,EAAEN,QAAQ,IAAIoE,SAAS,CAACK,SAAV,KAAwB,EAAtC,CAAhC,EAA2E;YACvE/E,KAAK,CAAC+B,KAAD,CAAL,GAAe2C,SAAf;UACH,CAFD,MAGK;YACD,IAAIM,OAAO,GAAGxB,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAd;YACAuB,OAAO,CAACf,SAAR,GAAoB,SAApB;;YACA,IAAIS,SAAS,CAAC9D,QAAV,KAAuB,CAA3B,EAA8B;cAC1B8D,SAAS,CAACO,YAAV,CAAuBD,OAAO,CAACtC,UAA/B,EAA2CgC,SAAS,CAAChC,UAArD;cACA1C,KAAK,CAAC+B,KAAD,CAAL,GAAe2C,SAAS,CAAChC,UAAzB;YACH,CAHD,MAIK;cACDgC,SAAS,CAAChD,UAAV,CAAqBuD,YAArB,CAAkCD,OAAO,CAACtC,UAA1C,EAAsDgC,SAAtD;cACA1E,KAAK,CAAC+B,KAAD,CAAL,GAAe2C,SAAS,CAACrB,eAAzB;cACAqB,SAAS,CAAChD,UAAV,CAAqBwD,WAArB,CAAiCR,SAAjC;YACH;UACJ;QACJ;MACJ,CAxBD,MAyBK;QACD,IAAIS,QAAQ,GAAGb,SAAf;;QACA,OAAOa,QAAQ,CAACzC,UAAT,KAAwB,IAAxB,IAAgCyC,QAAQ,CAACzC,UAAT,CAAoB9B,QAApB,KAAiC,CAAxE,EAA2E,IAA3E,EAAiF;UAC7EuE,QAAQ,GAAGA,QAAQ,CAACzC,UAApB;QACH;;QACDyC,QAAQ,CAAClB,SAAT,GAAqB,SAArB;QACAjE,KAAK,CAAC+B,KAAD,CAAL,GAAeoD,QAAQ,CAACzC,UAAxB;MACH;IACJ;;IACD,IAAI0C,SAAJ;;IACA,IAAIlG,MAAM,KAAK,iBAAf,EAAkC;MAC9BkG,SAAS,GAAGpD,UAAU,CAAC2B,KAAX,CAAiBG,QAA7B;IACH;;IACD,IAAIuB,OAAJ;;IACA,IAAInG,MAAM,KAAK,UAAf,EAA2B;MACvB,IAAIoG,EAAE,GAAG1G,OAAO,CAACoB,KAAK,CAAC+B,KAAD,CAAL,CAAalB,aAAd,EAA6B,iBAAiB,kBAAjB,GAAsC,GAAnE,CAAhB;;MACA,IAAI,CAACnC,KAAK,CAAC4G,EAAD,CAAV,EAAgB;QACZD,OAAO,GAAGC,EAAE,CAAC3B,KAAH,CAASI,eAAnB;MACH;IACJ;;IACD,IAAIwB,gBAAgB,GAAGvD,UAAU,CAACwD,YAAX,CAAwB,OAAxB,CAAvB;IACA,IAAIC,iBAAiB,GAAGzD,UAAU,CAACf,OAAnC;IACA,IAAIyE,KAAK,GAAGrH,aAAa,CAAC2F,MAAd,CAAqBhC,UAArB,CAAZ;;IACA,IAAI0D,KAAK,CAAC,CAAD,CAAL,IAAY,CAAClF,WAAjB,EAA8B;MAC1B,IAAImF,YAAY,GAAGD,KAAK,CAAC3D,KAAD,CAAL,GAAe2D,KAAK,CAAC3D,KAAD,CAApB,GAA8B2D,KAAK,CAAC,CAAD,CAAtD;MACA,IAAIE,QAAQ,GAAGD,YAAf;;MACA,OAAOA,YAAY,IAAIA,YAAY,CAAC9E,aAA7B,IAA8C8E,YAAY,CAAC9E,aAAb,KAA+B1B,OAApF,EACA;MACAwG,YAAY,GAAGA,YAFf,EAE6B;QACzB,IAAIA,YAAY,CAAC9E,aAAb,IAA8B8E,YAAY,CAAC9E,aAAb,CAA2BI,OAA3B,CAAmC4E,iBAAnC,OAC1B7D,UAAU,CAACf,OAAX,CAAmB4E,iBAAnB,EADJ,KAECF,YAAY,CAAC9E,aAAb,CAA2BC,iBAA3B,GAA+C,CAA/C,IAAoDjB,KAAK,CAACkB,WAAN,GAAoB,CAFzE,CAAJ,EAEiF;UAC7E,IAAI6E,QAAQ,CAAC/E,aAAT,IAA0B+E,QAAQ,CAAC/E,aAAT,CAAuBI,OAAvB,CAA+B4E,iBAA/B,OACtB7D,UAAU,CAACf,OAAX,CAAmB4E,iBAAnB,EADR,EACgD;YAC5C,IAAKhG,KAAK,CAACkB,WAAN,KAAsBlB,KAAK,CAAC+B,SAA7B,IAA2CgE,QAAQ,CAAChF,QAAT,KAAsB,CAAjE,IACA,CAAClC,KAAK,CAACkH,QAAQ,CAAC/D,WAAV,CADN,IACgC+D,QAAQ,CAAC/E,aAAT,CAAuBC,iBAAvB,GAA2C,CAD/E,EACkF;cAC9EjB,KAAK,CAACiG,QAAN,CAAeF,QAAf,EAAyB,CAAzB;cACA/F,KAAK,CAACkG,MAAN,CAAaH,QAAb,EAAuBA,QAAQ,CAAC/D,WAAT,CAAqBpB,MAA5C;cACAd,UAAU,CAACiF,SAAX,CAAqB/E,KAArB,EAA4B+F,QAAQ,CAAC/E,aAArC,EAAoD,KAApD;YACH;UACJ;;UACD,IAAI8E,YAAY,CAAC9E,aAAb,CAA2BI,OAA3B,CAAmC4E,iBAAnC,OAA2D,MAA/D,EAAuE;YACnE,IAAI7D,UAAU,CAAC2B,KAAX,CAAiBqC,cAAjB,KAAoC,WAApC,IACAL,YAAY,CAAC9E,aAAb,CAA2B8C,KAA3B,CAAiCqC,cAAjC,KAAoD,WADxD,EACqE;cACjEL,YAAY,GAAGA,YAAY,CAAC9E,aAA5B;cACA;YACH;UACJ;;UACDxC,aAAa,CAAC2F,MAAd,CAAqB2B,YAAY,CAAC9E,aAAlC;UACA8E,YAAY,GAAG,CAACjH,KAAK,CAACiH,YAAY,CAAC9E,aAAd,CAAN,IAAsC,CAACnB,OAAO,CAACwD,WAAR,CAAoByC,YAAY,CAAC9E,aAAjC,CAAvC,GAAyF+E,QAAzF,GACXD,YAAY,CAAC9E,aADjB;QAEH,CAtBD,MAuBK;UACD8E,YAAY,GAAGA,YAAY,CAAC9E,aAA5B;QACH;MACJ;IACJ;;IACD,IAAI6E,KAAK,CAACjF,MAAN,GAAe,CAAf,IAAoBD,WAAxB,EAAqC;MACjC,KAAK,IAAIyF,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGP,KAAK,CAACjF,MAA9B,EAAsCwF,GAAG,EAAzC,EAA6C;QACzC,IAAIP,KAAK,CAACO,GAAD,CAAL,CAAWrF,QAAX,KAAwB,CAAxB,IAA8B8E,KAAK,CAACO,GAAD,CAAL,CAAWpE,WAAX,IAA0B6D,KAAK,CAACO,GAAD,CAAL,CAAWpE,WAAX,CAAuBqE,IAAvB,GAA8BzF,MAA9B,GAAuC,CAAnG,EAAuG;UACnGiF,KAAK,CAACO,GAAD,CAAL,GAAa5H,aAAa,CAAC8H,IAAd,CAAmBT,KAAK,CAACO,GAAD,CAAxB,EAA+B,KAAKG,aAAL,CAAmBlH,MAAnB,EAA2BG,KAA3B,EAAkCoG,iBAAlC,EAAqDF,gBAArD,CAA/B,CAAb;;UACA,IAAIG,KAAK,CAACO,GAAD,CAAL,CAAWpE,WAAX,KAA2B0C,SAA/B,EAA0C;YACtC,IAAI0B,GAAG,KAAK,CAAZ,EAAe;cACXpG,KAAK,CAACwG,cAAN,CAAqBX,KAAK,CAACO,GAAD,CAA1B;YACH,CAFD,MAGK,IAAIA,GAAG,KAAKP,KAAK,CAACjF,MAAN,GAAe,CAA3B,EAA8B;cAC/BZ,KAAK,CAACyG,WAAN,CAAkBZ,KAAK,CAACO,GAAD,CAAvB;YACH;UACJ;QACJ;MACJ;;MACD,IAAIM,eAAe,GAAGvG,KAAK,CAAC+B,KAAD,CAAL,CAAalB,aAAnC;;MACA,IAAI,CAACnC,KAAK,CAAC0G,SAAD,CAAN,IAAqBA,SAAS,KAAK,EAAvC,EAA2C;QACvCmB,eAAe,CAAC5C,KAAhB,CAAsBG,QAAtB,GAAiCsB,SAAjC;MACH;;MACD,IAAI,CAAC1G,KAAK,CAAC2G,OAAD,CAAN,IAAmBA,OAAO,KAAK,EAAnC,EAAuC;QACnCkB,eAAe,CAAC5C,KAAhB,CAAsBI,eAAtB,GAAwCsB,OAAxC;MACH;;MACD,IAAKnG,MAAM,KAAK,iBAAX,IAAgC,CAACR,KAAK,CAAC0G,SAAD,CAAtC,IAAqDA,SAAS,KAAK,EAApE,IACAmB,eAAe,CAAC1F,aAAhB,CAA8BoD,SAA9B,KAA4CsC,eAAe,CAACC,SADhE,EAC2E;QACvE,IAAIC,aAAa,GAAGF,eAAe,CAAC1F,aAApC;QACA4F,aAAa,CAAC5F,aAAd,CAA4BoE,YAA5B,CAAyCsB,eAAzC,EAA0DE,aAA1D;QACA5H,MAAM,CAAC4H,aAAD,CAAN;MACH;;MACD,IAAIvH,MAAM,KAAK,UAAX,IAAyBA,MAAM,KAAK,WAAxC,EAAqD;QACjD,IAAIwH,SAAS,GAAG1G,KAAK,CAAC+B,KAAD,CAAL,CAAalB,aAA7B;QACA,IAAIA,aAAa,GAAGb,KAAK,CAAC+B,KAAD,CAAL,CAAalB,aAAjC;;QACA,OAAO,CAACnC,KAAK,CAACmC,aAAD,CAAN,IAAyBA,aAAa,CAACI,OAAd,CAAsBC,WAAtB,OAAwC,IAAxE,EAA8E;UAC1EL,aAAa,GAAGA,aAAa,CAACA,aAA9B;UACA6F,SAAS,GAAG7F,aAAZ;QACH;;QACD,IAAI,CAACnC,KAAK,CAACgI,SAAD,CAAN,IAAqBA,SAAS,CAACzF,OAAV,CAAkBC,WAAlB,OAAoC,IAAzD,IACAwF,SAAS,CAAC7E,WAAV,CAAsBqE,IAAtB,OAAiClG,KAAK,CAAC+B,KAAD,CAAL,CAAaF,WAAb,CAAyBqE,IAAzB,EADrC,EACsE;UAClE,IAAIhH,MAAM,KAAK,UAAf,EAA2B;YACvBwH,SAAS,CAAC/C,KAAV,CAAgBG,QAAhB,GAA2BzE,KAA3B;UACH,CAFD,MAGK;YACDqH,SAAS,CAAC/C,KAAV,CAAgBC,KAAhB,GAAwBvE,KAAxB;YACAqH,SAAS,CAAC/C,KAAV,CAAgBqC,cAAhB,GAAiC,SAAjC;UACH;QACJ;MACJ;IACJ;;IACD,OAAOhG,KAAK,CAAC+B,KAAD,CAAZ;EACH,CAnJD;;EAoJAhD,iBAAiB,CAACoD,YAAlB,GAAiC,UAAUlD,UAAV,EAAsBe,KAAtB,EAA6B+B,KAA7B,EAAoCC,UAApC,EAAgD1B,QAAhD,EAA0DD,QAA1D,EAAoEG,WAApE,EAAiFX,KAAjF,EAAwFF,UAAxF,EAAoGT,MAApG,EAA4GG,KAA5G,EAAmH;IAChJ,IAAI,CAACiB,QAAL,EAAe;MACX,IAAK0B,UAAU,KAAK,IAAf,IAAuB3B,QAAxB,IAAqCG,WAAzC,EAAsD;QAClD,IAAIR,KAAK,CAAC+B,KAAD,CAAL,CAAaN,QAAb,KAA0B,IAA9B,EAAoC;UAChCzB,KAAK,CAAC+B,KAAD,CAAL,GAAepC,UAAU,CAACkF,aAAX,CAAyBhF,KAAzB,EAAgCG,KAAK,CAAC+B,KAAD,CAArC,CAAf;UACA/B,KAAK,CAAC+B,KAAD,CAAL,CAAaF,WAAb,GAA2BlC,UAAU,CAACgH,aAAX,CAAyB3G,KAAK,CAAC+B,KAAD,CAAL,CAAaF,WAAtC,CAA3B;QACH;;QACD,IAAI3C,MAAM,KAAK,WAAX,IAA0BA,MAAM,KAAK,WAAzC,EAAsD;UAClDc,KAAK,CAAC+B,KAAD,CAAL,CAAaF,WAAb,GAA4B3C,MAAM,KAAK,WAAZ,GAA2Bc,KAAK,CAAC+B,KAAD,CAAL,CAAaF,WAAb,CAAyB+E,iBAAzB,EAA3B,GACrB5G,KAAK,CAAC+B,KAAD,CAAL,CAAaF,WAAb,CAAyBgE,iBAAzB,EADN;QAEH,CAHD,MAIK,IAAI,EAAErF,WAAW,KAAK,IAAhB,IAAwBnB,KAAK,KAAK,EAApC,CAAJ,EAA6C;UAC9C,IAAIwH,OAAO,GAAG,KAAKT,aAAL,CAAmBlH,MAAnB,EAA2BG,KAA3B,CAAd;;UACA,IAAIH,MAAM,KAAK,UAAX,IAAyBA,MAAM,KAAK,WAAxC,EAAqD;YACjD,IAAIwH,SAAS,GAAG1G,KAAK,CAAC+B,KAAD,CAAL,CAAalB,aAA7B;YACA,IAAIA,aAAa,GAAGb,KAAK,CAAC+B,KAAD,CAAL,CAAalB,aAAjC;;YACA,OAAO,CAACnC,KAAK,CAACmC,aAAD,CAAN,IAAyBA,aAAa,CAACI,OAAd,CAAsBC,WAAtB,OAAwC,IAAxE,EAA8E;cAC1EL,aAAa,GAAGA,aAAa,CAACA,aAA9B;cACA6F,SAAS,GAAG7F,aAAZ;YACH;;YACD,IAAI,CAACnC,KAAK,CAACgI,SAAD,CAAN,IAAqBA,SAAS,CAACzF,OAAV,CAAkBC,WAAlB,OAAoC,IAAzD,IACAwF,SAAS,CAAC7E,WAAV,CAAsBqE,IAAtB,OAAiClG,KAAK,CAAC+B,KAAD,CAAL,CAAaF,WAAb,CAAyBqE,IAAzB,EADrC,EACsE;cAClE,IAAIhH,MAAM,KAAK,UAAf,EAA2B;gBACvBwH,SAAS,CAAC/C,KAAV,CAAgBG,QAAhB,GAA2BzE,KAA3B;cACH,CAFD,MAGK;gBACDqH,SAAS,CAAC/C,KAAV,CAAgBC,KAAhB,GAAwBvE,KAAxB;gBACAqH,SAAS,CAAC/C,KAAV,CAAgBqC,cAAhB,GAAiC,SAAjC;cACH;YACJ;;YACDhG,KAAK,CAAC+B,KAAD,CAAL,GAAe,KAAK+E,WAAL,CAAiB9G,KAAjB,EAAwB+B,KAAxB,EAA+B8E,OAA/B,CAAf;;YACA,IAAI3H,MAAM,KAAK,UAAf,EAA2B;cACvB,IAAIoG,EAAE,GAAG1G,OAAO,CAACoB,KAAK,CAAC+B,KAAD,CAAL,CAAalB,aAAd,EAA6B,iBAAiB,kBAAjB,GAAsC,GAAnE,CAAhB;;cACA,IAAI,CAACnC,KAAK,CAAC4G,EAAD,CAAV,EAAgB;gBACZtF,KAAK,CAAC+B,KAAD,CAAL,CAAalB,aAAb,CAA2B8C,KAA3B,CAAiCI,eAAjC,GAAmDuB,EAAE,CAAC3B,KAAH,CAASI,eAA5D;cACH;YACJ;UACJ,CAxBD,MAyBK;YACD/D,KAAK,CAAC+B,KAAD,CAAL,GAAe,KAAK+E,WAAL,CAAiB9G,KAAjB,EAAwB+B,KAAxB,EAA+B8E,OAA/B,CAAf;UACH;QACJ;MACJ,CAxCD,MAyCK;QACD7G,KAAK,CAAC+B,KAAD,CAAL,GAAepC,UAAU,CAACkF,aAAX,CAAyBhF,KAAzB,EAAgCG,KAAK,CAAC+B,KAAD,CAArC,CAAf;MACH;IACJ,CA7CD,MA8CK;MACD,IAAI7C,MAAM,KAAK,WAAX,IAA0BA,MAAM,KAAK,WAAzC,EAAsD;QAClD,IAAI2H,OAAO,GAAG,KAAK1C,aAAL,CAAmBlF,UAAnB,EAA+BY,KAA/B,EAAsCX,MAAtC,EAA8CG,KAA9C,CAAd;QACAW,KAAK,CAAC+B,KAAD,CAAL,GAAe8E,OAAO,CAACnE,UAAvB;QACA/C,UAAU,CAACoH,QAAX,GAAsB,CAAtB;MACH,CAJD,MAKK;QACDpH,UAAU,CAACoH,QAAX,GAAsBlH,KAAK,CAACkB,WAA5B;MACH;IACJ;;IACD,OAAOf,KAAK,CAAC+B,KAAD,CAAZ;EACH,CA1DD;;EA2DAhD,iBAAiB,CAAC+H,WAAlB,GAAgC,UAAU9G,KAAV,EAAiB+B,KAAjB,EAAwB8E,OAAxB,EAAiC;IAC7D,IAAI,EAAE7G,KAAK,CAAC+B,KAAD,CAAL,CAAaN,QAAb,KAA0B,IAA1B,IAAkC,KAAKrC,WAAL,KAAqB,IAAzD,CAAJ,EAAoE;MAChEY,KAAK,CAAC+B,KAAD,CAAL,GAAgBA,KAAK,KAAM/B,KAAK,CAACS,MAAN,GAAe,CAA3B,IAAkCT,KAAK,CAAC+B,KAAD,CAAL,CAAaN,QAAb,KAA0B,IAA5D,GACXpD,aAAa,CAAC8H,IAAd,CAAmBnG,KAAK,CAAC+B,KAAD,CAAxB,EAAiC8E,OAAjC,CADW,GAETxI,aAAa,CAAC2I,UAAd,CAAyBhH,KAAK,CAAC+B,KAAD,CAA9B,EAAuC8E,OAAvC,EAAgD,IAAhD,CAFN;MAGA7G,KAAK,CAAC+B,KAAD,CAAL,GAAe,KAAKkF,YAAL,CAAkBjH,KAAK,CAAC+B,KAAD,CAAvB,EAAgC8E,OAAhC,CAAf;IACH;;IACD,OAAO7G,KAAK,CAAC+B,KAAD,CAAZ;EACH,CARD;;EASAhD,iBAAiB,CAACoF,aAAlB,GAAkC,UAAUlF,UAAV,EAAsBY,KAAtB,EAA6BX,MAA7B,EAAqCG,KAArC,EAA4C;IAC1E,IAAIwH,OAAO,GAAG,KAAKT,aAAL,CAAmBlH,MAAnB,EAA2BG,KAA3B,CAAd;IACAwH,OAAO,CAAC5C,SAAR,GAAoB,SAApB;;IACA,IAAItF,OAAO,CAACuI,IAAZ,EAAkB;MACd,IAAIC,IAAI,GAAGlI,UAAU,CAACmI,sBAAX,EAAX;MACAD,IAAI,CAACzD,WAAL,CAAiBmD,OAAjB;MACAhH,KAAK,CAACwH,UAAN,CAAiBF,IAAjB;IACH,CAJD,MAKK;MACDtH,KAAK,CAACwH,UAAN,CAAiBR,OAAjB;IACH;;IACD,OAAOA,OAAP;EACH,CAZD;;EAaA9H,iBAAiB,CAACkI,YAAlB,GAAiC,UAAUK,IAAV,EAAgBT,OAAhB,EAAyB;IACtD,IAAIS,IAAI,KAAKC,SAAT,IAAsBD,IAAI,KAAK,IAAnC,EAAyC;MACrCT,OAAO,CAAC5C,SAAR,GAAoB,SAApB;MACAqD,IAAI,GAAGT,OAAO,CAACnE,UAAf;IACH;;IACD,OAAO4E,IAAP;EACH,CAND;;EAOAvI,iBAAiB,CAACqD,cAAlB,GAAmC,UAAUpC,KAAV,EAAiBP,YAAjB,EAA+BE,UAA/B,EAA2CoC,KAA3C,EAAkD3B,WAAlD,EAA+D;IAC9F,IAAIJ,KAAK,CAACS,MAAN,KAAiB,CAAjB,IAAsB,CAACL,WAA3B,EAAwC;MACpCX,YAAY,CAACkB,cAAb,GAA8BlB,YAAY,CAAC8B,YAAb,CAA0BvB,KAAK,CAAC+B,KAAD,CAA/B,EAAwC,IAAxC,CAA9B;MACAtC,YAAY,CAAC6B,YAAb,GAA4B7B,YAAY,CAACkB,cAAzC;MACAlB,YAAY,CAACsB,WAAb,GAA2B,CAA3B;MACAtB,YAAY,CAACmC,SAAb,GAAyB5B,KAAK,CAAC+B,KAAD,CAAL,CAAaF,WAAb,CAAyBpB,MAAlD;IACH,CALD,MAMK,IAAIT,KAAK,CAACS,MAAN,KAAiB,CAAjB,IAAsBL,WAA1B,EAAuC;MACxCX,YAAY,CAACkB,cAAb,GAA8BlB,YAAY,CAAC8B,YAAb,CAA0BvB,KAAK,CAAC+B,KAAD,CAA/B,EAAwC,IAAxC,CAA9B;MACAtC,YAAY,CAAC6B,YAAb,GAA4B7B,YAAY,CAACkB,cAAzC;MACAlB,YAAY,CAACsB,WAAb,GAA2BpB,UAAU,CAACoH,QAAtC;MACAtH,YAAY,CAACmC,SAAb,GAAyBjC,UAAU,CAACoH,QAApC;IACH,CALI,MAMA,IAAIhF,KAAK,KAAK,CAAd,EAAiB;MAClBtC,YAAY,CAACkB,cAAb,GAA8BlB,YAAY,CAAC8B,YAAb,CAA0BvB,KAAK,CAAC+B,KAAD,CAA/B,EAAwC,IAAxC,CAA9B;MACAtC,YAAY,CAACsB,WAAb,GAA2B,CAA3B;IACH,CAHI,MAIA,IAAIgB,KAAK,KAAK/B,KAAK,CAACS,MAAN,GAAe,CAA7B,EAAgC;MACjChB,YAAY,CAAC6B,YAAb,GAA4B7B,YAAY,CAAC8B,YAAb,CAA0BvB,KAAK,CAAC+B,KAAD,CAA/B,EAAwC,KAAxC,CAA5B;MACAtC,YAAY,CAACmC,SAAb,GAAyB5B,KAAK,CAAC+B,KAAD,CAAL,CAAaF,WAAb,CAAyBpB,MAAlD;IACH;;IACD,OAAOhB,YAAP;EACH,CAtBD;;EAuBAV,iBAAiB,CAACqH,aAAlB,GAAkC,UAAUlH,MAAV,EAAkBG,KAAlB,EAAyB4B,OAAzB,EAAkCuG,MAAlC,EAA0C;IACxE,IAAIF,IAAJ;;IACA,QAAQpI,MAAR;MACI,KAAK,MAAL;QACI,OAAOsE,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAP;;MACJ,KAAK,QAAL;QACI,OAAOD,QAAQ,CAACC,aAAT,CAAuB,IAAvB,CAAP;;MACJ,KAAK,WAAL;QACI6D,IAAI,GAAG9D,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAP;QACA,KAAKgE,YAAL,CAAkBH,IAAlB,EAAwBrG,OAAxB,EAAiCuG,MAAjC;QACAF,IAAI,CAAC3D,KAAL,CAAWqC,cAAX,GAA4B,WAA5B;QACA,OAAOsB,IAAP;;MACJ,KAAK,eAAL;QACIA,IAAI,GAAG9D,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAP;QACA,KAAKgE,YAAL,CAAkBH,IAAlB,EAAwBrG,OAAxB,EAAiCuG,MAAjC;QACAF,IAAI,CAAC3D,KAAL,CAAWqC,cAAX,GAA4B,cAA5B;QACA,OAAOsB,IAAP;;MACJ,KAAK,aAAL;QACI,OAAO9D,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAP;;MACJ,KAAK,WAAL;QACI,OAAOD,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAP;;MACJ,KAAK,WAAL;QACI6D,IAAI,GAAG9D,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAP;QACA,KAAKgE,YAAL,CAAkBH,IAAlB,EAAwBrG,OAAxB,EAAiCuG,MAAjC;QACAF,IAAI,CAAC3D,KAAL,CAAWC,KAAX,GAAmBvE,KAAnB;QACAiI,IAAI,CAAC3D,KAAL,CAAWqC,cAAX,GAA4B,SAA5B;QACA,OAAOsB,IAAP;;MACJ,KAAK,UAAL;QACIA,IAAI,GAAG9D,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAP;QACA,KAAKgE,YAAL,CAAkBH,IAAlB,EAAwBrG,OAAxB,EAAiCuG,MAAjC;QACAF,IAAI,CAAC3D,KAAL,CAAWE,UAAX,GAAwBxE,KAAxB;QACA,OAAOiI,IAAP;;MACJ,KAAK,UAAL;QACIA,IAAI,GAAG9D,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAP;QACA,KAAKgE,YAAL,CAAkBH,IAAlB,EAAwBrG,OAAxB,EAAiCuG,MAAjC;QACAF,IAAI,CAAC3D,KAAL,CAAWG,QAAX,GAAsBzE,KAAtB;QACA,OAAOiI,IAAP;;MACJ;QACIA,IAAI,GAAG9D,QAAQ,CAACC,aAAT,CAAuB,MAAvB,CAAP;QACA,KAAKgE,YAAL,CAAkBH,IAAlB,EAAwBrG,OAAxB,EAAiCuG,MAAjC;QACAF,IAAI,CAAC3D,KAAL,CAAWI,eAAX,GAA6B1E,KAA7B;QACA,OAAOiI,IAAP;IAvCR;EAyCH,CA3CD;;EA4CAvI,iBAAiB,CAAC0I,YAAlB,GAAiC,UAAUC,GAAV,EAAeC,GAAf,EAAoBH,MAApB,EAA4B;IACzD,IAAIA,MAAM,KAAK,IAAX,IAAmBG,GAAG,KAAK,MAA/B,EAAuC;MACnCD,GAAG,CAACE,YAAJ,CAAiB,OAAjB,EAA0BJ,MAA1B;IACH;EACJ,CAJD;;EAKAzI,iBAAiB,CAACK,WAAlB,GAAgC,GAAhC;EACA,OAAOL,iBAAP;AACH,CA9esC,EAAvC;;AA+eA,SAASA,iBAAT"},"metadata":{},"sourceType":"module"}