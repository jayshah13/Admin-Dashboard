{"ast":null,"code":"import * as events from '../base/constant';\nimport { isNullOrUndefined, closest, attributes, removeClass, addClass, Browser, detach } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport { HTMLFormatter } from '../formatter/html-formatter';\nimport { RenderType } from '../base/enum';\nimport * as classes from '../base/classes';\nimport { HtmlToolbarStatus } from './html-toolbar-status';\nimport { IframeContentRender } from '../renderer/iframe-content-renderer';\nimport { ContentRender } from '../renderer/content-renderer';\nimport { ColorPickerInput } from './color-picker';\nimport { NodeSelection } from '../../selection/selection';\nimport { InsertHtml } from '../../editor-manager/plugin/inserthtml';\nimport { getTextNodesUnder, sanitizeHelper, getDefaultValue } from '../base/util';\nimport { isIDevice } from '../../common/util';\nimport { XhtmlValidation } from './xhtml-validation';\nimport { ON_BEGIN } from './../../common/constant';\n/**\n * `HtmlEditor` module is used to HTML editor\n */\n\nvar HtmlEditor =\n/** @class */\nfunction () {\n  function HtmlEditor(parent, serviceLocator) {\n    this.rangeCollection = [];\n    this.isImageDelete = false;\n    this.parent = parent;\n    this.locator = serviceLocator;\n    this.renderFactory = this.locator.getService('rendererFactory');\n    this.xhtmlValidation = new XhtmlValidation(parent);\n    this.addEventListener();\n  }\n  /**\n   * Destroys the Markdown.\n   *\n   * @function destroy\n   * @returns {void}\n   * @hidden\n    */\n\n\n  HtmlEditor.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n  /**\n   * @param {string} value - specifies the string value\n   * @returns {void}\n   * @hidden\n    */\n\n\n  HtmlEditor.prototype.sanitizeHelper = function (value) {\n    value = sanitizeHelper(value, this.parent);\n    return value;\n  };\n\n  HtmlEditor.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.nodeSelectionObj = new NodeSelection();\n    this.colorPickerModule = new ColorPickerInput(this.parent, this.locator);\n    this.parent.on(events.initialLoad, this.instantiateRenderer, this);\n    this.parent.on(events.htmlToolbarClick, this.onToolbarClick, this);\n    this.parent.on(events.keyDown, this.onKeyDown, this);\n    this.parent.on(events.keyUp, this.onKeyUp, this);\n    this.parent.on(events.renderColorPicker, this.renderColorPicker, this);\n    this.parent.on(events.initialEnd, this.render, this);\n    this.parent.on(events.modelChanged, this.onPropertyChanged, this);\n    this.parent.on(events.destroy, this.destroy, this);\n    this.parent.on(events.selectAll, this.selectAll, this);\n    this.parent.on(events.selectRange, this.selectRange, this);\n    this.parent.on(events.getSelectedHtml, this.getSelectedHtml, this);\n    this.parent.on(events.selectionSave, this.onSelectionSave, this);\n    this.parent.on(events.selectionRestore, this.onSelectionRestore, this);\n    this.parent.on(events.readOnlyMode, this.updateReadOnly, this);\n    this.parent.on(events.paste, this.onPaste, this);\n  };\n\n  HtmlEditor.prototype.updateReadOnly = function () {\n    if (this.parent.readonly) {\n      attributes(this.parent.contentModule.getEditPanel(), {\n        contenteditable: 'false'\n      });\n      addClass([this.parent.element], classes.CLS_RTE_READONLY);\n    } else {\n      attributes(this.parent.contentModule.getEditPanel(), {\n        contenteditable: 'true'\n      });\n      removeClass([this.parent.element], classes.CLS_RTE_READONLY);\n    }\n  };\n\n  HtmlEditor.prototype.onSelectionSave = function () {\n    var currentDocument = this.contentRenderer.getDocument();\n    var range = this.nodeSelectionObj.getRange(currentDocument);\n    this.saveSelection = this.nodeSelectionObj.save(range, currentDocument);\n  };\n\n  HtmlEditor.prototype.onSelectionRestore = function (e) {\n    this.parent.isBlur = false;\n    this.contentRenderer.getEditPanel().focus();\n\n    if (isNullOrUndefined(e.items) || e.items) {\n      this.saveSelection.restore();\n    }\n  };\n\n  HtmlEditor.prototype.onKeyUp = function (e) {\n    var args = e.args;\n    var restrictKeys = [8, 9, 13, 16, 17, 18, 20, 27, 37, 38, 39, 40, 44, 45, 46, 91, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123];\n    var range = this.parent.getRange();\n    var regEx = new RegExp(String.fromCharCode(8203), 'g');\n    var pointer;\n\n    if (restrictKeys.indexOf(args.keyCode) < 0 && !args.shiftKey && !args.ctrlKey && !args.altKey) {\n      if (range.startContainer.textContent.charCodeAt(0) === 8203) {\n        pointer = range.startOffset - 1;\n        range.startContainer.textContent = range.startContainer.textContent.replace(regEx, '');\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n      }\n\n      if (!isNOU(range.startContainer.previousSibling) && !isNOU(range.startContainer.previousSibling.parentElement) && range.startContainer.parentElement === range.startContainer.previousSibling.parentElement && range.startContainer.previousSibling.textContent.charCodeAt(0) === 8203 && range.startContainer.previousSibling.textContent.length <= 1) {\n        range.startContainer.previousSibling.textContent = range.startContainer.previousSibling.textContent.replace(regEx, '');\n      }\n\n      if (range.endContainer.textContent.charCodeAt(range.endOffset) === 8203) {\n        pointer = range.startOffset;\n        range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n      }\n    }\n  };\n\n  HtmlEditor.prototype.onKeyDown = function (e) {\n    var _this = this;\n\n    var currentRange;\n    var args = e.args;\n\n    if (Browser.info.name === 'chrome') {\n      currentRange = this.parent.getRange();\n      this.backSpaceCleanup(e, currentRange);\n      this.deleteCleanup(e, currentRange);\n    }\n\n    if (args.keyCode === 9 && this.parent.enableTabKey) {\n      if (!isNOU(args.target) && isNullOrUndefined(closest(args.target, '.e-rte-toolbar'))) {\n        var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n        var parentNode = this.nodeSelectionObj.getParentNodeCollection(range);\n\n        if (!((parentNode[0].nodeName === 'LI' || closest(parentNode[0], 'li') || closest(parentNode[0], 'table')) && range.startOffset === 0)) {\n          args.preventDefault();\n\n          if (!args.shiftKey) {\n            InsertHtml.Insert(this.contentRenderer.getDocument(), '&nbsp;&nbsp;&nbsp;&nbsp;');\n            this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()));\n          } else if (this.rangeCollection.length > 0 && this.rangeCollection[this.rangeCollection.length - 1].startContainer.textContent.length === 4) {\n            var textCont = this.rangeCollection[this.rangeCollection.length - 1].startContainer;\n            this.nodeSelectionObj.setSelectionText(this.contentRenderer.getDocument(), textCont, textCont, 0, textCont.textContent.length);\n            InsertHtml.Insert(this.contentRenderer.getDocument(), document.createTextNode(''));\n            this.rangeCollection.pop();\n          }\n        }\n      }\n    }\n\n    if (e.args.action === 'space' || e.args.action === 'enter' || e.args.keyCode === 13) {\n      this.spaceLink(e.args);\n\n      if (this.parent.editorMode === 'HTML' && !this.parent.readonly) {\n        this.parent.notify(events.enterHandler, {\n          args: e.args\n        });\n      }\n    }\n\n    if (e.args.action === 'space') {\n      var currentRange_1 = this.parent.getRange();\n      var editorValue = currentRange_1.startContainer.textContent.slice(0, currentRange_1.startOffset);\n      var orderedList_1 = this.isOrderedList(editorValue);\n      var unOrderedList = this.isUnOrderedList(editorValue);\n\n      if (orderedList_1 && !unOrderedList || unOrderedList && !orderedList_1) {\n        var eventArgs_1 = {\n          callBack: null,\n          event: e.args,\n          name: 'keydown-handler'\n        };\n        var actionBeginArgs = {\n          cancel: false,\n          item: {\n            command: 'Lists',\n            subCommand: orderedList_1 ? 'OL' : 'UL'\n          },\n          name: 'actionBegin',\n          originalEvent: e.args,\n          requestType: orderedList_1 ? 'OL' : 'UL'\n        };\n        this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n          if (!actionBeginArgs.cancel) {\n            _this.parent.formatter.editorManager.observer.notify(ON_BEGIN, eventArgs_1);\n\n            _this.parent.trigger(events.actionComplete, {\n              editorMode: _this.parent.editorMode,\n              elements: _this.parent.formatter.editorManager.domNode.blockNodes(),\n              event: e.args,\n              name: events.actionComplete,\n              range: _this.parent.getRange(),\n              requestType: orderedList_1 ? 'OL' : 'UL'\n            });\n          }\n        });\n      }\n    }\n\n    if (Browser.info.name === 'chrome' && (!isNullOrUndefined(this.rangeElement) && !isNullOrUndefined(this.oldRangeElement) || !isNullOrUndefined(this.deleteRangeElement) && !isNullOrUndefined(this.deleteOldRangeElement)) && currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n      this.rangeElement = null;\n      this.oldRangeElement = null;\n      this.deleteRangeElement = null;\n      this.deleteOldRangeElement = null;\n\n      if (!this.isImageDelete) {\n        args.preventDefault();\n      }\n    }\n  };\n\n  HtmlEditor.prototype.isOrderedList = function (editorValue) {\n    editorValue = editorValue.replace(/\\u200B/g, '');\n    var olListStartRegex = [/^[1]+[.]+$/, /^[i]+[.]+$/, /^[a]+[.]+$/];\n\n    if (!isNullOrUndefined(editorValue)) {\n      for (var i = 0; i < olListStartRegex.length; i++) {\n        if (olListStartRegex[i].test(editorValue)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  HtmlEditor.prototype.isUnOrderedList = function (editorValue) {\n    editorValue = editorValue.replace(/\\u200B/g, '');\n    var ulListStartRegex = [/^[*]$/, /^[-]$/];\n\n    if (!isNullOrUndefined(editorValue)) {\n      for (var i = 0; i < ulListStartRegex.length; i++) {\n        if (ulListStartRegex[i].test(editorValue)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  };\n\n  HtmlEditor.prototype.backSpaceCleanup = function (e, currentRange) {\n    var isLiElement = false;\n\n    if (e.args.code === 'Backspace' && e.args.keyCode === 8 && currentRange.startOffset === 0 && currentRange.endOffset === 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.textContent.length > 0 && currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n      this.rangeElement = this.getRootBlockNode(currentRange.startContainer);\n\n      if (this.rangeElement.tagName === 'OL' || this.rangeElement.tagName === 'UL') {\n        var liElement = this.getRangeLiNode(currentRange.startContainer);\n\n        if (liElement.previousElementSibling && liElement.previousElementSibling.childElementCount > 0) {\n          this.oldRangeElement = liElement.previousElementSibling.lastElementChild.nodeName === 'BR' ? liElement.previousElementSibling : liElement.previousElementSibling.lastElementChild;\n\n          if (!isNullOrUndefined(liElement.lastElementChild) && liElement.lastElementChild.nodeName !== 'BR') {\n            this.rangeElement = liElement.lastElementChild;\n            isLiElement = true;\n          } else {\n            this.rangeElement = liElement;\n          }\n        }\n      } else if (this.rangeElement.tagName === 'TABLE' || !isNullOrUndefined(this.rangeElement.previousElementSibling) && this.rangeElement.previousElementSibling.tagName === 'TABLE') {\n        return;\n      } else {\n        this.oldRangeElement = this.rangeElement.previousElementSibling;\n      }\n\n      if (isNullOrUndefined(this.oldRangeElement)) {\n        return;\n      } else {\n        if (this.oldRangeElement.tagName === 'OL' || this.oldRangeElement.tagName === 'UL') {\n          this.oldRangeElement = this.oldRangeElement.lastElementChild.lastElementChild ? this.oldRangeElement.lastElementChild.lastElementChild : this.oldRangeElement.lastElementChild;\n        }\n\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), // eslint-disable-next-line\n        this.oldRangeElement, this.oldRangeElement.childNodes.length);\n\n        if (this.oldRangeElement.querySelector('BR')) {\n          detach(this.oldRangeElement.querySelector('BR'));\n        }\n\n        if (!isNullOrUndefined(this.rangeElement) && this.oldRangeElement !== this.rangeElement) {\n          while (this.rangeElement.firstChild) {\n            this.oldRangeElement.appendChild(this.rangeElement.childNodes[0]);\n          } // eslint-disable-next-line\n\n\n          !isLiElement ? detach(this.rangeElement) : detach(this.rangeElement.parentElement);\n          this.oldRangeElement.normalize();\n        }\n      }\n    }\n  };\n\n  HtmlEditor.prototype.deleteCleanup = function (e, currentRange) {\n    var isLiElement = false;\n    var liElement;\n    var rootElement;\n\n    if (e.args.code === 'Delete' && e.args.keyCode === 46 && this.parent.contentModule.getText().trim().length !== 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n      this.deleteRangeElement = rootElement = this.getRootBlockNode(currentRange.startContainer);\n\n      if (this.deleteRangeElement.tagName === 'OL' || this.deleteRangeElement.tagName === 'UL') {\n        liElement = this.getRangeLiNode(currentRange.startContainer);\n\n        if (liElement.nextElementSibling && liElement.nextElementSibling.childElementCount > 0 && !liElement.nextElementSibling.querySelector('BR')) {\n          if (!isNullOrUndefined(liElement.lastElementChild)) {\n            this.deleteRangeElement = liElement.lastElementChild;\n            isLiElement = true;\n          } else {\n            this.deleteRangeElement = liElement;\n          }\n        } else {\n          this.deleteRangeElement = this.getRangeElement(liElement);\n        }\n      } else if (this.deleteRangeElement.nodeType === 3 || this.deleteRangeElement.tagName === 'TABLE' || !isNullOrUndefined(this.deleteRangeElement.nextElementSibling) && this.deleteRangeElement.nextElementSibling.tagName === 'TABLE') {\n        return;\n      }\n\n      if (this.getCaretIndex(currentRange, this.deleteRangeElement) === this.deleteRangeElement.textContent.length) {\n        if (!isNullOrUndefined(liElement)) {\n          if (isLiElement || !isNullOrUndefined(liElement.nextElementSibling)) {\n            this.deleteOldRangeElement = this.getRangeElement(liElement.nextElementSibling);\n          } else {\n            this.deleteOldRangeElement = rootElement.nextElementSibling;\n          }\n        } else {\n          this.deleteOldRangeElement = this.deleteRangeElement.nextElementSibling;\n        }\n\n        if (isNullOrUndefined(this.deleteOldRangeElement)) {\n          return;\n        } else {\n          if (currentRange.startOffset === 0 && currentRange.endOffset === 1 && this.deleteRangeElement.childNodes[0].nodeName === 'IMG') {\n            this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement, 0, 1);\n            this.isImageDelete = true;\n          } else {\n            this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement.childNodes.length);\n            this.isImageDelete = false;\n          }\n\n          if (this.deleteRangeElement.querySelector('BR')) {\n            detach(this.deleteRangeElement.querySelector('BR'));\n          }\n\n          if (!isNullOrUndefined(this.deleteRangeElement) && this.deleteOldRangeElement.tagName !== 'OL' && this.deleteOldRangeElement.tagName !== 'UL' && this.deleteOldRangeElement !== this.deleteRangeElement) {\n            while (this.deleteOldRangeElement.firstChild) {\n              this.deleteRangeElement.appendChild(this.deleteOldRangeElement.childNodes[0]);\n            }\n\n            if (!isLiElement) {\n              detach(this.deleteOldRangeElement);\n            } else {\n              detach(this.deleteOldRangeElement.parentElement);\n            }\n\n            this.deleteRangeElement.normalize();\n          } else {\n            this.deleteRangeElement = null;\n            this.deleteOldRangeElement = null;\n          }\n        }\n      } else {\n        this.deleteRangeElement = null;\n      }\n    }\n  };\n\n  HtmlEditor.prototype.getCaretIndex = function (currentRange, element) {\n    var position = 0;\n\n    if (this.parent.contentModule.getDocument().getSelection().rangeCount !== 0) {\n      var preCaretRange = currentRange.cloneRange();\n      preCaretRange.selectNodeContents(element);\n      preCaretRange.setEnd(currentRange.endContainer, currentRange.endOffset);\n      position = preCaretRange.toString().length;\n    }\n\n    return position;\n  };\n\n  HtmlEditor.prototype.getRangeElement = function (element) {\n    var rangeElement = element.lastElementChild ? element.lastElementChild.tagName === 'BR' ? element.lastElementChild.previousElementSibling ? element.lastElementChild.previousElementSibling : element : element.lastElementChild : element;\n    return rangeElement;\n  };\n\n  HtmlEditor.prototype.getRootBlockNode = function (rangeBlockNode) {\n    // eslint-disable-next-line\n    for (; rangeBlockNode && this.parent && this.parent.inputElement !== rangeBlockNode; rangeBlockNode = rangeBlockNode) {\n      if (rangeBlockNode.parentElement === this.parent.inputElement) {\n        break;\n      } else {\n        rangeBlockNode = rangeBlockNode.parentElement;\n      }\n    }\n\n    return rangeBlockNode;\n  };\n\n  HtmlEditor.prototype.getRangeLiNode = function (rangeLiNode) {\n    var node = rangeLiNode.parentElement;\n\n    while (node !== this.parent.inputElement) {\n      if (node.nodeType === 1 && node.tagName === 'LI') {\n        break;\n      }\n\n      node = node.parentElement;\n    }\n\n    return node;\n  };\n\n  HtmlEditor.prototype.onPaste = function (e) {\n    // eslint-disable-next-line\n    var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n\n    if (e.text.match(regex)) {\n      if (e.isWordPaste) {\n        return;\n      }\n\n      e.args.preventDefault();\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()); // eslint-disable-next-line\n\n      var saveSelection = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument()); // eslint-disable-next-line\n\n      var httpRegex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)))/gi);\n      var wwwRegex = new RegExp(/([^\\S]|^)(((www\\.))(\\S+))/gi);\n      var enterSplitText = e.text.split('\\n');\n      var contentInnerElem = '';\n\n      for (var i = 0; i < enterSplitText.length; i++) {\n        if (enterSplitText[i].trim() === '') {\n          contentInnerElem += getDefaultValue(this.parent);\n        } else {\n          var contentWithSpace = '';\n          var spaceBetweenContent = true;\n          var spaceSplit = enterSplitText[i].split(' ');\n\n          for (var j = 0; j < spaceSplit.length; j++) {\n            if (spaceSplit[j].trim() === '') {\n              contentWithSpace += spaceBetweenContent ? '&nbsp;' : ' ';\n            } else {\n              spaceBetweenContent = false;\n              contentWithSpace += spaceSplit[j] + ' ';\n            }\n          }\n\n          if (i === 0) {\n            contentInnerElem += '<span>' + contentWithSpace.trim() + '</span>';\n          } else {\n            contentInnerElem += '<p>' + contentWithSpace.trim() + '</p>';\n          }\n        }\n      }\n\n      var divElement = this.parent.createElement('div');\n      divElement.setAttribute('class', 'pasteContent');\n      divElement.style.display = 'inline';\n      divElement.innerHTML = contentInnerElem.replace('&para', '&amp;para');\n      var paraElem = divElement.querySelectorAll('span, p');\n\n      for (var i = 0; i < paraElem.length; i++) {\n        var splitTextContent = paraElem[i].innerHTML.split(' ');\n        var resultSplitContent = '';\n\n        for (var j = 0; j < splitTextContent.length; j++) {\n          if (splitTextContent[j].match(httpRegex) || splitTextContent[j].match(wwwRegex)) {\n            resultSplitContent += '<a className=\"e-rte-anchor\" href=\"' + splitTextContent[j] + '\" title=\"' + splitTextContent[j] + '\"target=\"_blank\">' + splitTextContent[j] + ' </a>';\n          } else {\n            resultSplitContent += splitTextContent[j] + ' ';\n          }\n        }\n\n        paraElem[i].innerHTML = resultSplitContent.trim();\n      }\n\n      if (!isNullOrUndefined(this.parent.pasteCleanupModule)) {\n        e.callBack(divElement.innerHTML);\n      } else {\n        this.parent.formatter.editorManager.execCommand('insertHTML', null, null, null, divElement);\n      }\n    }\n  };\n\n  HtmlEditor.prototype.spaceLink = function (e) {\n    var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n    var selectNodeEle = this.nodeSelectionObj.getParentNodeCollection(range);\n    var text = range.startContainer.textContent.substr(0, range.endOffset);\n    var splitText = text.split(' ');\n    var urlText = splitText[splitText.length - 1];\n    var urlTextRange = range.startOffset - (text.length - splitText[splitText.length - 1].length);\n    urlText = urlText.slice(0, urlTextRange); // eslint-disable-next-line\n\n    var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n\n    if (selectNodeEle[0].nodeName !== 'A' && urlText.match(regex)) {\n      var selection = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n      var url = urlText.indexOf('http') > -1 ? urlText : 'http://' + urlText;\n      var selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      var value = {\n        url: url,\n        selection: selection,\n        selectParent: selectParent,\n        text: urlText,\n        title: '',\n        target: '_blank'\n      };\n      this.parent.formatter.process(this.parent, {\n        item: {\n          'command': 'Links',\n          'subCommand': 'CreateLink'\n        }\n      }, e, value);\n    }\n  };\n\n  HtmlEditor.prototype.onToolbarClick = function (args) {\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n    var item = args.item;\n    var closestElement = closest(args.originalEvent.target, '.e-rte-quick-popup');\n\n    if (closestElement && !closestElement.classList.contains('e-rte-inline-popup')) {\n      if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' || item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n        if (isIDevice() && item.command === 'Images') {\n          this.nodeSelectionObj.restore();\n        }\n\n        var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n        save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n        selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n        selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n      }\n\n      if (item.command === 'Images') {\n        this.parent.notify(events.imageToolbarAction, {\n          member: 'image',\n          args: args,\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle\n        });\n      }\n\n      if (item.command === 'Links') {\n        this.parent.notify(events.linkToolbarAction, {\n          member: 'link',\n          args: args,\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle\n        });\n      }\n\n      if (item.command === 'Table') {\n        this.parent.notify(events.tableToolbarAction, {\n          member: 'table',\n          args: args,\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle\n        });\n      }\n    } else {\n      var linkDialog = document.getElementById(this.parent.getID() + '_rtelink');\n      var imageDialog = document.getElementById(this.parent.getID() + '_image');\n\n      if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' || item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n        var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n\n        if (isNullOrUndefined(linkDialog) && isNullOrUndefined(imageDialog)) {\n          save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n        }\n\n        selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n        selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n      }\n\n      switch (item.subCommand) {\n        case 'Maximize':\n          this.parent.notify(events.enableFullScreen, {\n            args: args\n          });\n          break;\n\n        case 'Minimize':\n          this.parent.notify(events.disableFullScreen, {\n            args: args\n          });\n          break;\n\n        case 'CreateLink':\n          this.parent.notify(events.insertLink, {\n            member: 'link',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n          break;\n\n        case 'RemoveLink':\n          this.parent.notify(events.unLink, {\n            member: 'link',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n          break;\n\n        case 'Print':\n          this.parent.print();\n          break;\n\n        case 'Image':\n          this.parent.notify(events.insertImage, {\n            member: 'image',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n          break;\n\n        case 'CreateTable':\n          this.parent.notify(events.createTable, {\n            member: 'table',\n            args: args,\n            selection: save\n          });\n          break;\n\n        case 'SourceCode':\n          this.parent.notify(events.sourceCode, {\n            member: 'viewSource',\n            args: args\n          });\n          break;\n\n        case 'Preview':\n          this.parent.notify(events.updateSource, {\n            member: 'updateSource',\n            args: args\n          });\n          break;\n\n        case 'FontColor':\n        case 'BackgroundColor':\n          break;\n\n        case 'File':\n          this.parent.notify(events.renderFileManager, {\n            member: 'fileManager',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n          break;\n\n        default:\n          this.parent.formatter.process(this.parent, args, args.originalEvent, null);\n          break;\n      }\n    }\n  };\n\n  HtmlEditor.prototype.renderColorPicker = function (args) {\n    this.colorPickerModule.renderColorPickerInput(args);\n  };\n\n  HtmlEditor.prototype.instantiateRenderer = function () {\n    if (this.parent.iframeSettings.enable) {\n      this.renderFactory.addRenderer(RenderType.Content, new IframeContentRender(this.parent, this.locator));\n    } else {\n      this.renderFactory.addRenderer(RenderType.Content, new ContentRender(this.parent, this.locator));\n    }\n  };\n\n  HtmlEditor.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.initialEnd, this.render);\n    this.parent.off(events.modelChanged, this.onPropertyChanged);\n    this.parent.off(events.htmlToolbarClick, this.onToolbarClick);\n    this.parent.off(events.renderColorPicker, this.renderColorPicker);\n    this.parent.off(events.destroy, this.destroy);\n    this.parent.off(events.keyDown, this.onKeyDown);\n    this.parent.off(events.initialLoad, this.instantiateRenderer);\n    this.parent.off(events.selectAll, this.selectAll);\n    this.parent.off(events.selectRange, this.selectRange);\n    this.parent.off(events.getSelectedHtml, this.getSelectedHtml);\n    this.parent.off(events.selectionSave, this.onSelectionSave);\n    this.parent.off(events.selectionRestore, this.onSelectionRestore);\n    this.parent.off(events.readOnlyMode, this.updateReadOnly);\n    this.parent.off(events.paste, this.onPaste);\n  };\n\n  HtmlEditor.prototype.render = function () {\n    this.contentRenderer = this.renderFactory.getRenderer(RenderType.Content);\n    var editElement = this.contentRenderer.getEditPanel();\n    var option = {\n      undoRedoSteps: this.parent.undoRedoSteps,\n      undoRedoTimer: this.parent.undoRedoTimer\n    };\n\n    if (isNullOrUndefined(this.parent.formatter)) {\n      var formatterClass = new HTMLFormatter({\n        currentDocument: this.contentRenderer.getDocument(),\n        element: editElement,\n        options: option\n      });\n      this.parent.setProperties({\n        formatter: formatterClass\n      }, true);\n    } else {\n      this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n    }\n\n    if (this.parent.enableXhtml) {\n      this.parent.notify(events.xhtmlValidation, {});\n    }\n\n    if (this.parent.toolbarSettings.enable) {\n      this.toolbarUpdate = new HtmlToolbarStatus(this.parent);\n    }\n\n    if (this.parent.inlineMode.enable) {\n      if (!isNullOrUndefined(this.parent.fontFamily.default)) {\n        editElement.style.fontFamily = this.parent.fontFamily.default;\n      }\n\n      if (!isNullOrUndefined(this.parent.fontSize.default)) {\n        editElement.style.fontSize = this.parent.fontSize.default;\n      }\n    }\n\n    this.parent.notify(events.bindOnEnd, {});\n  };\n  /**\n   * Called internally if any of the property value changed.\n   *\n   * @param {RichTextEditorModel} e - specifies the editor model\n   * @returns {void}\n   * @hidden\n    */\n\n\n  HtmlEditor.prototype.onPropertyChanged = function (e) {\n    // On property code change here\n    if (!isNullOrUndefined(e.newProp.formatter)) {\n      var editElement = this.contentRenderer.getEditPanel();\n      var option = {\n        undoRedoSteps: this.parent.undoRedoSteps,\n        undoRedoTimer: this.parent.undoRedoTimer\n      };\n      this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n    }\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {string} - returns the string value\n   * @hidden\n   */\n\n\n  HtmlEditor.prototype.getModuleName = function () {\n    return 'htmlEditor';\n  };\n  /**\n   * For selecting all content in RTE\n   *\n   * @returns {void}\n   * @private\n   * @hidden\n   */\n\n\n  HtmlEditor.prototype.selectAll = function () {\n    var nodes = getTextNodesUnder(this.parent.contentModule.getDocument(), this.parent.contentModule.getEditPanel());\n\n    if (nodes.length > 0) {\n      this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), nodes[0], nodes[nodes.length - 1], 0, nodes[nodes.length - 1].textContent.length);\n    }\n  };\n  /**\n   * For selecting all content in RTE\n   *\n   * @param {NotifyArgs} e - specifies the notified arguments\n   * @returns {void}\n   * @private\n   * @hidden\n   */\n\n\n  HtmlEditor.prototype.selectRange = function (e) {\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.contentModule.getDocument(), e.range);\n  };\n  /**\n   * For get a selected text in RTE\n   *\n   * @param {NotifyArgs} e - specifies the notified arguments\n   * @returns {void}\n   * @hidden\n   */\n\n\n  HtmlEditor.prototype.getSelectedHtml = function (e) {\n    e.callBack(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).toString());\n  };\n\n  return HtmlEditor;\n}();\n\nexport { HtmlEditor };","map":{"version":3,"names":["events","isNullOrUndefined","closest","attributes","removeClass","addClass","Browser","detach","isNOU","HTMLFormatter","RenderType","classes","HtmlToolbarStatus","IframeContentRender","ContentRender","ColorPickerInput","NodeSelection","InsertHtml","getTextNodesUnder","sanitizeHelper","getDefaultValue","isIDevice","XhtmlValidation","ON_BEGIN","HtmlEditor","parent","serviceLocator","rangeCollection","isImageDelete","locator","renderFactory","getService","xhtmlValidation","addEventListener","prototype","destroy","removeEventListener","value","isDestroyed","nodeSelectionObj","colorPickerModule","on","initialLoad","instantiateRenderer","htmlToolbarClick","onToolbarClick","keyDown","onKeyDown","keyUp","onKeyUp","renderColorPicker","initialEnd","render","modelChanged","onPropertyChanged","selectAll","selectRange","getSelectedHtml","selectionSave","onSelectionSave","selectionRestore","onSelectionRestore","readOnlyMode","updateReadOnly","paste","onPaste","readonly","contentModule","getEditPanel","contenteditable","element","CLS_RTE_READONLY","currentDocument","contentRenderer","getDocument","range","getRange","saveSelection","save","e","isBlur","focus","items","restore","args","restrictKeys","regEx","RegExp","String","fromCharCode","pointer","indexOf","keyCode","shiftKey","ctrlKey","altKey","startContainer","textContent","charCodeAt","startOffset","replace","formatter","editorManager","nodeSelection","setCursorPoint","previousSibling","parentElement","length","endContainer","endOffset","_this","currentRange","info","name","backSpaceCleanup","deleteCleanup","enableTabKey","target","parentNode","getParentNodeCollection","nodeName","preventDefault","Insert","push","textCont","setSelectionText","document","createTextNode","pop","action","spaceLink","editorMode","notify","enterHandler","currentRange_1","editorValue","slice","orderedList_1","isOrderedList","unOrderedList","isUnOrderedList","eventArgs_1","callBack","event","actionBeginArgs","cancel","item","command","subCommand","originalEvent","requestType","trigger","actionBegin","observer","actionComplete","elements","domNode","blockNodes","rangeElement","oldRangeElement","deleteRangeElement","deleteOldRangeElement","tagName","olListStartRegex","i","test","ulListStartRegex","isLiElement","code","getSelection","getRootBlockNode","liElement","getRangeLiNode","previousElementSibling","childElementCount","lastElementChild","childNodes","querySelector","firstChild","appendChild","normalize","rootElement","getText","trim","nextElementSibling","getRangeElement","nodeType","getCaretIndex","position","rangeCount","preCaretRange","cloneRange","selectNodeContents","setEnd","toString","rangeBlockNode","inputElement","rangeLiNode","node","regex","text","match","isWordPaste","httpRegex","wwwRegex","enterSplitText","split","contentInnerElem","contentWithSpace","spaceBetweenContent","spaceSplit","j","divElement","createElement","setAttribute","style","display","innerHTML","paraElem","querySelectorAll","splitTextContent","resultSplitContent","pasteCleanupModule","execCommand","selectNodeEle","substr","splitText","urlText","urlTextRange","selection","url","selectParent","title","process","selectParentEle","closestElement","classList","contains","getNodeCollection","imageToolbarAction","member","selectNode","linkToolbarAction","tableToolbarAction","linkDialog","getElementById","getID","imageDialog","enableFullScreen","disableFullScreen","insertLink","unLink","print","insertImage","createTable","sourceCode","updateSource","renderFileManager","renderColorPickerInput","iframeSettings","enable","addRenderer","Content","off","getRenderer","editElement","option","undoRedoSteps","undoRedoTimer","formatterClass","options","setProperties","updateFormatter","enableXhtml","toolbarSettings","toolbarUpdate","inlineMode","fontFamily","default","fontSize","bindOnEnd","newProp","getModuleName","nodes","setRange"],"sources":["C:/Users/shahj/OneDrive/Documents/GitHub/Multifunctional-React-Dashboard/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/actions/html-editor.js"],"sourcesContent":["import * as events from '../base/constant';\nimport { isNullOrUndefined, closest, attributes, removeClass, addClass, Browser, detach } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport { HTMLFormatter } from '../formatter/html-formatter';\nimport { RenderType } from '../base/enum';\nimport * as classes from '../base/classes';\nimport { HtmlToolbarStatus } from './html-toolbar-status';\nimport { IframeContentRender } from '../renderer/iframe-content-renderer';\nimport { ContentRender } from '../renderer/content-renderer';\nimport { ColorPickerInput } from './color-picker';\nimport { NodeSelection } from '../../selection/selection';\nimport { InsertHtml } from '../../editor-manager/plugin/inserthtml';\nimport { getTextNodesUnder, sanitizeHelper, getDefaultValue } from '../base/util';\nimport { isIDevice } from '../../common/util';\nimport { XhtmlValidation } from './xhtml-validation';\nimport { ON_BEGIN } from './../../common/constant';\n/**\n * `HtmlEditor` module is used to HTML editor\n */\nvar HtmlEditor = /** @class */ (function () {\n    function HtmlEditor(parent, serviceLocator) {\n        this.rangeCollection = [];\n        this.isImageDelete = false;\n        this.parent = parent;\n        this.locator = serviceLocator;\n        this.renderFactory = this.locator.getService('rendererFactory');\n        this.xhtmlValidation = new XhtmlValidation(parent);\n        this.addEventListener();\n    }\n    /**\n     * Destroys the Markdown.\n     *\n     * @function destroy\n     * @returns {void}\n     * @hidden\n\n     */\n    HtmlEditor.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    /**\n     * @param {string} value - specifies the string value\n     * @returns {void}\n     * @hidden\n\n     */\n    HtmlEditor.prototype.sanitizeHelper = function (value) {\n        value = sanitizeHelper(value, this.parent);\n        return value;\n    };\n    HtmlEditor.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.nodeSelectionObj = new NodeSelection();\n        this.colorPickerModule = new ColorPickerInput(this.parent, this.locator);\n        this.parent.on(events.initialLoad, this.instantiateRenderer, this);\n        this.parent.on(events.htmlToolbarClick, this.onToolbarClick, this);\n        this.parent.on(events.keyDown, this.onKeyDown, this);\n        this.parent.on(events.keyUp, this.onKeyUp, this);\n        this.parent.on(events.renderColorPicker, this.renderColorPicker, this);\n        this.parent.on(events.initialEnd, this.render, this);\n        this.parent.on(events.modelChanged, this.onPropertyChanged, this);\n        this.parent.on(events.destroy, this.destroy, this);\n        this.parent.on(events.selectAll, this.selectAll, this);\n        this.parent.on(events.selectRange, this.selectRange, this);\n        this.parent.on(events.getSelectedHtml, this.getSelectedHtml, this);\n        this.parent.on(events.selectionSave, this.onSelectionSave, this);\n        this.parent.on(events.selectionRestore, this.onSelectionRestore, this);\n        this.parent.on(events.readOnlyMode, this.updateReadOnly, this);\n        this.parent.on(events.paste, this.onPaste, this);\n    };\n    HtmlEditor.prototype.updateReadOnly = function () {\n        if (this.parent.readonly) {\n            attributes(this.parent.contentModule.getEditPanel(), { contenteditable: 'false' });\n            addClass([this.parent.element], classes.CLS_RTE_READONLY);\n        }\n        else {\n            attributes(this.parent.contentModule.getEditPanel(), { contenteditable: 'true' });\n            removeClass([this.parent.element], classes.CLS_RTE_READONLY);\n        }\n    };\n    HtmlEditor.prototype.onSelectionSave = function () {\n        var currentDocument = this.contentRenderer.getDocument();\n        var range = this.nodeSelectionObj.getRange(currentDocument);\n        this.saveSelection = this.nodeSelectionObj.save(range, currentDocument);\n    };\n    HtmlEditor.prototype.onSelectionRestore = function (e) {\n        this.parent.isBlur = false;\n        this.contentRenderer.getEditPanel().focus();\n        if (isNullOrUndefined(e.items) || e.items) {\n            this.saveSelection.restore();\n        }\n    };\n    HtmlEditor.prototype.onKeyUp = function (e) {\n        var args = e.args;\n        var restrictKeys = [8, 9, 13, 16, 17, 18, 20, 27, 37, 38, 39, 40, 44, 45, 46, 91,\n            112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123];\n        var range = this.parent.getRange();\n        var regEx = new RegExp(String.fromCharCode(8203), 'g');\n        var pointer;\n        if (restrictKeys.indexOf(args.keyCode) < 0 && !args.shiftKey && !args.ctrlKey && !args.altKey) {\n            if (range.startContainer.textContent.charCodeAt(0) === 8203) {\n                pointer = range.startOffset - 1;\n                range.startContainer.textContent = range.startContainer.textContent.replace(regEx, '');\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n            }\n            if (!isNOU(range.startContainer.previousSibling) && !isNOU(range.startContainer.previousSibling.parentElement) &&\n                range.startContainer.parentElement === range.startContainer.previousSibling.parentElement &&\n                range.startContainer.previousSibling.textContent.charCodeAt(0) === 8203 &&\n                range.startContainer.previousSibling.textContent.length <= 1) {\n                range.startContainer.previousSibling.textContent = range.startContainer.previousSibling.textContent.replace(regEx, '');\n            }\n            if (range.endContainer.textContent.charCodeAt(range.endOffset) === 8203) {\n                pointer = range.startOffset;\n                range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n            }\n        }\n    };\n    HtmlEditor.prototype.onKeyDown = function (e) {\n        var _this = this;\n        var currentRange;\n        var args = e.args;\n        if (Browser.info.name === 'chrome') {\n            currentRange = this.parent.getRange();\n            this.backSpaceCleanup(e, currentRange);\n            this.deleteCleanup(e, currentRange);\n        }\n        if (args.keyCode === 9 && this.parent.enableTabKey) {\n            if (!isNOU(args.target) && isNullOrUndefined(closest(args.target, '.e-rte-toolbar'))) {\n                var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n                var parentNode = this.nodeSelectionObj.getParentNodeCollection(range);\n                if (!((parentNode[0].nodeName === 'LI' || closest(parentNode[0], 'li') ||\n                    closest(parentNode[0], 'table')) && range.startOffset === 0)) {\n                    args.preventDefault();\n                    if (!args.shiftKey) {\n                        InsertHtml.Insert(this.contentRenderer.getDocument(), '&nbsp;&nbsp;&nbsp;&nbsp;');\n                        this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()));\n                    }\n                    else if (this.rangeCollection.length > 0 &&\n                        this.rangeCollection[this.rangeCollection.length - 1].startContainer.textContent.length === 4) {\n                        var textCont = this.rangeCollection[this.rangeCollection.length - 1].startContainer;\n                        this.nodeSelectionObj.setSelectionText(this.contentRenderer.getDocument(), textCont, textCont, 0, textCont.textContent.length);\n                        InsertHtml.Insert(this.contentRenderer.getDocument(), document.createTextNode(''));\n                        this.rangeCollection.pop();\n                    }\n                }\n            }\n        }\n        if (e.args.action === 'space' ||\n            e.args.action === 'enter' ||\n            e.args.keyCode === 13) {\n            this.spaceLink(e.args);\n            if (this.parent.editorMode === 'HTML' && !this.parent.readonly) {\n                this.parent.notify(events.enterHandler, { args: e.args });\n            }\n        }\n        if (e.args.action === 'space') {\n            var currentRange_1 = this.parent.getRange();\n            var editorValue = currentRange_1.startContainer.textContent.slice(0, currentRange_1.startOffset);\n            var orderedList_1 = this.isOrderedList(editorValue);\n            var unOrderedList = this.isUnOrderedList(editorValue);\n            if (orderedList_1 && !unOrderedList || unOrderedList && !orderedList_1) {\n                var eventArgs_1 = {\n                    callBack: null,\n                    event: e.args,\n                    name: 'keydown-handler'\n                };\n                var actionBeginArgs = {\n                    cancel: false,\n                    item: { command: 'Lists', subCommand: orderedList_1 ? 'OL' : 'UL' },\n                    name: 'actionBegin',\n                    originalEvent: e.args,\n                    requestType: orderedList_1 ? 'OL' : 'UL'\n                };\n                this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n                    if (!actionBeginArgs.cancel) {\n                        _this.parent.formatter.editorManager.observer.notify(ON_BEGIN, eventArgs_1);\n                        _this.parent.trigger(events.actionComplete, {\n                            editorMode: _this.parent.editorMode,\n                            elements: _this.parent.formatter.editorManager.domNode.blockNodes(),\n                            event: e.args,\n                            name: events.actionComplete,\n                            range: _this.parent.getRange(),\n                            requestType: orderedList_1 ? 'OL' : 'UL'\n                        });\n                    }\n                });\n            }\n        }\n        if (Browser.info.name === 'chrome' && (!isNullOrUndefined(this.rangeElement) && !isNullOrUndefined(this.oldRangeElement) ||\n            !isNullOrUndefined(this.deleteRangeElement) && !isNullOrUndefined(this.deleteOldRangeElement)) &&\n            currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n            this.rangeElement = null;\n            this.oldRangeElement = null;\n            this.deleteRangeElement = null;\n            this.deleteOldRangeElement = null;\n            if (!this.isImageDelete) {\n                args.preventDefault();\n            }\n        }\n    };\n    HtmlEditor.prototype.isOrderedList = function (editorValue) {\n        editorValue = editorValue.replace(/\\u200B/g, '');\n        var olListStartRegex = [/^[1]+[.]+$/, /^[i]+[.]+$/, /^[a]+[.]+$/];\n        if (!isNullOrUndefined(editorValue)) {\n            for (var i = 0; i < olListStartRegex.length; i++) {\n                if (olListStartRegex[i].test(editorValue)) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    };\n    HtmlEditor.prototype.isUnOrderedList = function (editorValue) {\n        editorValue = editorValue.replace(/\\u200B/g, '');\n        var ulListStartRegex = [/^[*]$/, /^[-]$/];\n        if (!isNullOrUndefined(editorValue)) {\n            for (var i = 0; i < ulListStartRegex.length; i++) {\n                if (ulListStartRegex[i].test(editorValue)) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    };\n    HtmlEditor.prototype.backSpaceCleanup = function (e, currentRange) {\n        var isLiElement = false;\n        if (e.args.code === 'Backspace' && e.args.keyCode === 8 && currentRange.startOffset === 0 &&\n            currentRange.endOffset === 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.textContent.length > 0 &&\n            currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n            this.rangeElement = this.getRootBlockNode(currentRange.startContainer);\n            if (this.rangeElement.tagName === 'OL' || this.rangeElement.tagName === 'UL') {\n                var liElement = this.getRangeLiNode(currentRange.startContainer);\n                if (liElement.previousElementSibling && liElement.previousElementSibling.childElementCount > 0) {\n                    this.oldRangeElement = liElement.previousElementSibling.lastElementChild.nodeName === 'BR' ?\n                        liElement.previousElementSibling : liElement.previousElementSibling.lastElementChild;\n                    if (!isNullOrUndefined(liElement.lastElementChild) && liElement.lastElementChild.nodeName !== 'BR') {\n                        this.rangeElement = liElement.lastElementChild;\n                        isLiElement = true;\n                    }\n                    else {\n                        this.rangeElement = liElement;\n                    }\n                }\n            }\n            else if (this.rangeElement.tagName === 'TABLE' || (!isNullOrUndefined(this.rangeElement.previousElementSibling) &&\n                this.rangeElement.previousElementSibling.tagName === 'TABLE')) {\n                return;\n            }\n            else {\n                this.oldRangeElement = this.rangeElement.previousElementSibling;\n            }\n            if (isNullOrUndefined(this.oldRangeElement)) {\n                return;\n            }\n            else {\n                if (this.oldRangeElement.tagName === 'OL' || this.oldRangeElement.tagName === 'UL') {\n                    this.oldRangeElement = this.oldRangeElement.lastElementChild.lastElementChild\n                        ? this.oldRangeElement.lastElementChild.lastElementChild :\n                        this.oldRangeElement.lastElementChild;\n                }\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), \n                // eslint-disable-next-line\n                this.oldRangeElement, this.oldRangeElement.childNodes.length);\n                if (this.oldRangeElement.querySelector('BR')) {\n                    detach(this.oldRangeElement.querySelector('BR'));\n                }\n                if (!isNullOrUndefined(this.rangeElement) && this.oldRangeElement !== this.rangeElement) {\n                    while (this.rangeElement.firstChild) {\n                        this.oldRangeElement.appendChild(this.rangeElement.childNodes[0]);\n                    }\n                    // eslint-disable-next-line\n                    !isLiElement ? detach(this.rangeElement) : detach(this.rangeElement.parentElement);\n                    this.oldRangeElement.normalize();\n                }\n            }\n        }\n    };\n    HtmlEditor.prototype.deleteCleanup = function (e, currentRange) {\n        var isLiElement = false;\n        var liElement;\n        var rootElement;\n        if (e.args.code === 'Delete' && e.args.keyCode === 46 &&\n            this.parent.contentModule.getText().trim().length !== 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.parentElement.tagName !== 'TD' &&\n            currentRange.startContainer.parentElement.tagName !== 'TH') {\n            this.deleteRangeElement = rootElement = this.getRootBlockNode(currentRange.startContainer);\n            if (this.deleteRangeElement.tagName === 'OL' || this.deleteRangeElement.tagName === 'UL') {\n                liElement = this.getRangeLiNode(currentRange.startContainer);\n                if (liElement.nextElementSibling && liElement.nextElementSibling.childElementCount > 0\n                    && !liElement.nextElementSibling.querySelector('BR')) {\n                    if (!isNullOrUndefined(liElement.lastElementChild)) {\n                        this.deleteRangeElement = liElement.lastElementChild;\n                        isLiElement = true;\n                    }\n                    else {\n                        this.deleteRangeElement = liElement;\n                    }\n                }\n                else {\n                    this.deleteRangeElement = this.getRangeElement(liElement);\n                }\n            }\n            else if (this.deleteRangeElement.nodeType === 3 || (this.deleteRangeElement.tagName === 'TABLE' ||\n                (!isNullOrUndefined(this.deleteRangeElement.nextElementSibling) && this.deleteRangeElement.nextElementSibling.tagName === 'TABLE'))) {\n                return;\n            }\n            if (this.getCaretIndex(currentRange, this.deleteRangeElement) === this.deleteRangeElement.textContent.length) {\n                if (!isNullOrUndefined(liElement)) {\n                    if (isLiElement || !isNullOrUndefined(liElement.nextElementSibling)) {\n                        this.deleteOldRangeElement = this.getRangeElement(liElement.nextElementSibling);\n                    }\n                    else {\n                        this.deleteOldRangeElement = rootElement.nextElementSibling;\n                    }\n                }\n                else {\n                    this.deleteOldRangeElement = this.deleteRangeElement.nextElementSibling;\n                }\n                if (isNullOrUndefined(this.deleteOldRangeElement)) {\n                    return;\n                }\n                else {\n                    if (currentRange.startOffset === 0 && currentRange.endOffset === 1 &&\n                        this.deleteRangeElement.childNodes[0].nodeName === 'IMG') {\n                        this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement, 0, 1);\n                        this.isImageDelete = true;\n                    }\n                    else {\n                        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement.childNodes.length);\n                        this.isImageDelete = false;\n                    }\n                    if (this.deleteRangeElement.querySelector('BR')) {\n                        detach(this.deleteRangeElement.querySelector('BR'));\n                    }\n                    if (!isNullOrUndefined(this.deleteRangeElement) && (this.deleteOldRangeElement.tagName !== 'OL' && this.deleteOldRangeElement.tagName !== 'UL')\n                        && this.deleteOldRangeElement !== this.deleteRangeElement) {\n                        while (this.deleteOldRangeElement.firstChild) {\n                            this.deleteRangeElement.appendChild(this.deleteOldRangeElement.childNodes[0]);\n                        }\n                        if (!isLiElement) {\n                            detach(this.deleteOldRangeElement);\n                        }\n                        else {\n                            detach(this.deleteOldRangeElement.parentElement);\n                        }\n                        this.deleteRangeElement.normalize();\n                    }\n                    else {\n                        this.deleteRangeElement = null;\n                        this.deleteOldRangeElement = null;\n                    }\n                }\n            }\n            else {\n                this.deleteRangeElement = null;\n            }\n        }\n    };\n    HtmlEditor.prototype.getCaretIndex = function (currentRange, element) {\n        var position = 0;\n        if (this.parent.contentModule.getDocument().getSelection().rangeCount !== 0) {\n            var preCaretRange = currentRange.cloneRange();\n            preCaretRange.selectNodeContents(element);\n            preCaretRange.setEnd(currentRange.endContainer, currentRange.endOffset);\n            position = preCaretRange.toString().length;\n        }\n        return position;\n    };\n    HtmlEditor.prototype.getRangeElement = function (element) {\n        var rangeElement = element.lastElementChild ? element.lastElementChild.tagName === 'BR' ?\n            element.lastElementChild.previousElementSibling ? element.lastElementChild.previousElementSibling\n                : element : element.lastElementChild : element;\n        return rangeElement;\n    };\n    HtmlEditor.prototype.getRootBlockNode = function (rangeBlockNode) {\n        // eslint-disable-next-line\n        for (; rangeBlockNode && this.parent && this.parent.inputElement !== rangeBlockNode; rangeBlockNode = rangeBlockNode) {\n            if (rangeBlockNode.parentElement === this.parent.inputElement) {\n                break;\n            }\n            else {\n                rangeBlockNode = rangeBlockNode.parentElement;\n            }\n        }\n        return rangeBlockNode;\n    };\n    HtmlEditor.prototype.getRangeLiNode = function (rangeLiNode) {\n        var node = rangeLiNode.parentElement;\n        while (node !== this.parent.inputElement) {\n            if (node.nodeType === 1 && node.tagName === 'LI') {\n                break;\n            }\n            node = node.parentElement;\n        }\n        return node;\n    };\n    HtmlEditor.prototype.onPaste = function (e) {\n        // eslint-disable-next-line\n        var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n        if (e.text.match(regex)) {\n            if (e.isWordPaste) {\n                return;\n            }\n            e.args.preventDefault();\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            // eslint-disable-next-line\n            var saveSelection = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            // eslint-disable-next-line\n            var httpRegex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)))/gi);\n            var wwwRegex = new RegExp(/([^\\S]|^)(((www\\.))(\\S+))/gi);\n            var enterSplitText = e.text.split('\\n');\n            var contentInnerElem = '';\n            for (var i = 0; i < enterSplitText.length; i++) {\n                if (enterSplitText[i].trim() === '') {\n                    contentInnerElem += getDefaultValue(this.parent);\n                }\n                else {\n                    var contentWithSpace = '';\n                    var spaceBetweenContent = true;\n                    var spaceSplit = enterSplitText[i].split(' ');\n                    for (var j = 0; j < spaceSplit.length; j++) {\n                        if (spaceSplit[j].trim() === '') {\n                            contentWithSpace += spaceBetweenContent ? '&nbsp;' : ' ';\n                        }\n                        else {\n                            spaceBetweenContent = false;\n                            contentWithSpace += spaceSplit[j] + ' ';\n                        }\n                    }\n                    if (i === 0) {\n                        contentInnerElem += '<span>' + contentWithSpace.trim() + '</span>';\n                    }\n                    else {\n                        contentInnerElem += '<p>' + contentWithSpace.trim() + '</p>';\n                    }\n                }\n            }\n            var divElement = this.parent.createElement('div');\n            divElement.setAttribute('class', 'pasteContent');\n            divElement.style.display = 'inline';\n            divElement.innerHTML = contentInnerElem.replace('&para', '&amp;para');\n            var paraElem = divElement.querySelectorAll('span, p');\n            for (var i = 0; i < paraElem.length; i++) {\n                var splitTextContent = paraElem[i].innerHTML.split(' ');\n                var resultSplitContent = '';\n                for (var j = 0; j < splitTextContent.length; j++) {\n                    if (splitTextContent[j].match(httpRegex) || splitTextContent[j].match(wwwRegex)) {\n                        resultSplitContent += '<a className=\"e-rte-anchor\" href=\"' + splitTextContent[j] +\n                            '\" title=\"' + splitTextContent[j] + '\"target=\"_blank\">' + splitTextContent[j] + ' </a>';\n                    }\n                    else {\n                        resultSplitContent += splitTextContent[j] + ' ';\n                    }\n                }\n                paraElem[i].innerHTML = resultSplitContent.trim();\n            }\n            if (!isNullOrUndefined(this.parent.pasteCleanupModule)) {\n                e.callBack(divElement.innerHTML);\n            }\n            else {\n                this.parent.formatter.editorManager.execCommand('insertHTML', null, null, null, divElement);\n            }\n        }\n    };\n    HtmlEditor.prototype.spaceLink = function (e) {\n        var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n        var selectNodeEle = this.nodeSelectionObj.getParentNodeCollection(range);\n        var text = range.startContainer.textContent.substr(0, range.endOffset);\n        var splitText = text.split(' ');\n        var urlText = splitText[splitText.length - 1];\n        var urlTextRange = range.startOffset - (text.length - splitText[splitText.length - 1].length);\n        urlText = urlText.slice(0, urlTextRange);\n        // eslint-disable-next-line\n        var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n        if (selectNodeEle[0].nodeName !== 'A' && urlText.match(regex)) {\n            var selection = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n            var url = urlText.indexOf('http') > -1 ? urlText : 'http://' + urlText;\n            var selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            var value = {\n                url: url,\n                selection: selection, selectParent: selectParent,\n                text: urlText,\n                title: '',\n                target: '_blank'\n            };\n            this.parent.formatter.process(this.parent, {\n                item: {\n                    'command': 'Links',\n                    'subCommand': 'CreateLink'\n                }\n            }, e, value);\n        }\n    };\n    HtmlEditor.prototype.onToolbarClick = function (args) {\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        var item = args.item;\n        var closestElement = closest(args.originalEvent.target, '.e-rte-quick-popup');\n        if (closestElement && !closestElement.classList.contains('e-rte-inline-popup')) {\n            if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' ||\n                item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n                if (isIDevice() && item.command === 'Images') {\n                    this.nodeSelectionObj.restore();\n                }\n                var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n                save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n                selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n                selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n            }\n            if (item.command === 'Images') {\n                this.parent.notify(events.imageToolbarAction, {\n                    member: 'image', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                });\n            }\n            if (item.command === 'Links') {\n                this.parent.notify(events.linkToolbarAction, {\n                    member: 'link', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                });\n            }\n            if (item.command === 'Table') {\n                this.parent.notify(events.tableToolbarAction, {\n                    member: 'table', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                });\n            }\n        }\n        else {\n            var linkDialog = document.getElementById(this.parent.getID() + '_rtelink');\n            var imageDialog = document.getElementById(this.parent.getID() + '_image');\n            if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' ||\n                item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n                var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n                if (isNullOrUndefined(linkDialog) && isNullOrUndefined(imageDialog)) {\n                    save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n                }\n                selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n                selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n            }\n            switch (item.subCommand) {\n                case 'Maximize':\n                    this.parent.notify(events.enableFullScreen, { args: args });\n                    break;\n                case 'Minimize':\n                    this.parent.notify(events.disableFullScreen, { args: args });\n                    break;\n                case 'CreateLink':\n                    this.parent.notify(events.insertLink, {\n                        member: 'link', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                    break;\n                case 'RemoveLink':\n                    this.parent.notify(events.unLink, {\n                        member: 'link', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                    break;\n                case 'Print':\n                    this.parent.print();\n                    break;\n                case 'Image':\n                    this.parent.notify(events.insertImage, {\n                        member: 'image', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                    break;\n                case 'CreateTable':\n                    this.parent.notify(events.createTable, {\n                        member: 'table', args: args, selection: save\n                    });\n                    break;\n                case 'SourceCode':\n                    this.parent.notify(events.sourceCode, { member: 'viewSource', args: args });\n                    break;\n                case 'Preview':\n                    this.parent.notify(events.updateSource, { member: 'updateSource', args: args });\n                    break;\n                case 'FontColor':\n                case 'BackgroundColor':\n                    break;\n                case 'File':\n                    this.parent.notify(events.renderFileManager, {\n                        member: 'fileManager', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                    break;\n                default:\n                    this.parent.formatter.process(this.parent, args, args.originalEvent, null);\n                    break;\n            }\n        }\n    };\n    HtmlEditor.prototype.renderColorPicker = function (args) {\n        this.colorPickerModule.renderColorPickerInput(args);\n    };\n    HtmlEditor.prototype.instantiateRenderer = function () {\n        if (this.parent.iframeSettings.enable) {\n            this.renderFactory.addRenderer(RenderType.Content, new IframeContentRender(this.parent, this.locator));\n        }\n        else {\n            this.renderFactory.addRenderer(RenderType.Content, new ContentRender(this.parent, this.locator));\n        }\n    };\n    HtmlEditor.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.initialEnd, this.render);\n        this.parent.off(events.modelChanged, this.onPropertyChanged);\n        this.parent.off(events.htmlToolbarClick, this.onToolbarClick);\n        this.parent.off(events.renderColorPicker, this.renderColorPicker);\n        this.parent.off(events.destroy, this.destroy);\n        this.parent.off(events.keyDown, this.onKeyDown);\n        this.parent.off(events.initialLoad, this.instantiateRenderer);\n        this.parent.off(events.selectAll, this.selectAll);\n        this.parent.off(events.selectRange, this.selectRange);\n        this.parent.off(events.getSelectedHtml, this.getSelectedHtml);\n        this.parent.off(events.selectionSave, this.onSelectionSave);\n        this.parent.off(events.selectionRestore, this.onSelectionRestore);\n        this.parent.off(events.readOnlyMode, this.updateReadOnly);\n        this.parent.off(events.paste, this.onPaste);\n    };\n    HtmlEditor.prototype.render = function () {\n        this.contentRenderer = this.renderFactory.getRenderer(RenderType.Content);\n        var editElement = this.contentRenderer.getEditPanel();\n        var option = { undoRedoSteps: this.parent.undoRedoSteps, undoRedoTimer: this.parent.undoRedoTimer };\n        if (isNullOrUndefined(this.parent.formatter)) {\n            var formatterClass = new HTMLFormatter({\n                currentDocument: this.contentRenderer.getDocument(),\n                element: editElement,\n                options: option\n            });\n            this.parent.setProperties({ formatter: formatterClass }, true);\n        }\n        else {\n            this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n        }\n        if (this.parent.enableXhtml) {\n            this.parent.notify(events.xhtmlValidation, {});\n        }\n        if (this.parent.toolbarSettings.enable) {\n            this.toolbarUpdate = new HtmlToolbarStatus(this.parent);\n        }\n        if (this.parent.inlineMode.enable) {\n            if (!isNullOrUndefined(this.parent.fontFamily.default)) {\n                editElement.style.fontFamily = this.parent.fontFamily.default;\n            }\n            if (!isNullOrUndefined(this.parent.fontSize.default)) {\n                editElement.style.fontSize = this.parent.fontSize.default;\n            }\n        }\n        this.parent.notify(events.bindOnEnd, {});\n    };\n    /**\n     * Called internally if any of the property value changed.\n     *\n     * @param {RichTextEditorModel} e - specifies the editor model\n     * @returns {void}\n     * @hidden\n\n     */\n    HtmlEditor.prototype.onPropertyChanged = function (e) {\n        // On property code change here\n        if (!isNullOrUndefined(e.newProp.formatter)) {\n            var editElement = this.contentRenderer.getEditPanel();\n            var option = { undoRedoSteps: this.parent.undoRedoSteps,\n                undoRedoTimer: this.parent.undoRedoTimer };\n            this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n        }\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {string} - returns the string value\n     * @hidden\n     */\n    HtmlEditor.prototype.getModuleName = function () {\n        return 'htmlEditor';\n    };\n    /**\n     * For selecting all content in RTE\n     *\n     * @returns {void}\n     * @private\n     * @hidden\n     */\n    HtmlEditor.prototype.selectAll = function () {\n        var nodes = getTextNodesUnder(this.parent.contentModule.getDocument(), this.parent.contentModule.getEditPanel());\n        if (nodes.length > 0) {\n            this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), nodes[0], nodes[nodes.length - 1], 0, nodes[nodes.length - 1].textContent.length);\n        }\n    };\n    /**\n     * For selecting all content in RTE\n     *\n     * @param {NotifyArgs} e - specifies the notified arguments\n     * @returns {void}\n     * @private\n     * @hidden\n     */\n    HtmlEditor.prototype.selectRange = function (e) {\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.contentModule.getDocument(), e.range);\n    };\n    /**\n     * For get a selected text in RTE\n     *\n     * @param {NotifyArgs} e - specifies the notified arguments\n     * @returns {void}\n     * @hidden\n     */\n    HtmlEditor.prototype.getSelectedHtml = function (e) {\n        e.callBack(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).toString());\n    };\n    return HtmlEditor;\n}());\nexport { HtmlEditor };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}