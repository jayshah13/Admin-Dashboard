{"ast":null,"code":"import { remove, resetBlazorTemplate, blazorTemplates, getValue } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Deferred, Predicate, DataUtil } from '@syncfusion/ej2-data';\nimport { ValueFormatter } from '../services/value-formatter';\nimport { RenderType, CellType } from '../base/enum';\nimport { Data } from '../actions/data';\nimport { Column } from '../models/column';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport * as events from '../base/constant';\nimport { prepareColumns, setFormatter, isGroupAdaptive, getDatePredicate, getObject, clearReactVueTemplates } from '../base/util';\nimport { ContentRender } from '../renderer/content-renderer';\nimport { HeaderRender } from '../renderer/header-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { HeaderCellRenderer } from '../renderer/header-cell-renderer';\nimport { StackedHeaderCellRenderer } from '../renderer/stacked-cell-renderer';\nimport { IndentCellRenderer } from '../renderer/indent-cell-renderer';\nimport { GroupCaptionCellRenderer, GroupCaptionEmptyCellRenderer } from '../renderer/caption-cell-renderer';\nimport { ExpandCellRenderer } from '../renderer/expand-cell-renderer';\nimport { HeaderIndentCellRenderer } from '../renderer/header-indent-renderer';\nimport { DetailHeaderIndentCellRenderer } from '../renderer/detail-header-indent-renderer';\nimport { DetailExpandCellRenderer } from '../renderer/detail-expand-cell-renderer';\nimport { RowDragDropRenderer } from './row-drag-drop-renderer';\nimport { RowDragDropHeaderRenderer } from '../renderer/row-drag-header-indent-render';\nimport * as literals from '../base/string-literals';\n/**\n * Content module is used to render grid content\n *\n * @hidden\n */\n\nvar Render =\n/** @class */\nfunction () {\n  /**\n   * Constructor for render module\n   *\n   * @param {IGrid} parent - specifies the IGrid\n   * @param {ServiceLocator} locator - specifies the serviceLocator\n   */\n  function Render(parent, locator) {\n    this.emptyGrid = false;\n    this.counter = 0;\n    this.parent = parent;\n    this.locator = locator;\n    this.data = new Data(parent, locator);\n    this.l10n = locator.getService('localization');\n    this.ariaService = this.locator.getService('ariaService');\n    this.renderer = this.locator.getService('rendererFactory');\n    this.addEventListener();\n  }\n  /**\n   * To initialize grid header, content and footer rendering\n   *\n   * @returns {void}\n   */\n\n\n  Render.prototype.render = function () {\n    var gObj = this.parent;\n    this.headerRenderer = this.renderer.getRenderer(RenderType.Header);\n    this.contentRenderer = this.renderer.getRenderer(RenderType.Content);\n    this.headerRenderer.renderPanel();\n    this.contentRenderer.renderPanel();\n\n    if (gObj.getColumns().length) {\n      this.isLayoutRendered = true;\n      this.headerRenderer.renderTable();\n      this.contentRenderer.renderTable();\n      this.emptyRow(false);\n    }\n\n    this.parent.scrollModule.setWidth();\n    this.parent.scrollModule.setHeight();\n\n    if (this.parent.height !== 'auto') {\n      this.parent.scrollModule.setPadding();\n    }\n\n    this.refreshDataManager();\n  };\n  /**\n   * Refresh the entire Grid.\n   *\n   * @param {NotifyArgs} e - specifies the NotifyArgs\n   * @returns {void}\n   */\n\n\n  Render.prototype.refresh = function (e) {\n    var _this = this;\n\n    if (e === void 0) {\n      e = {\n        requestType: 'refresh'\n      };\n    }\n\n    var gObj = this.parent;\n    gObj.notify(e.requestType + \"-begin\", e);\n    gObj.trigger(events.actionBegin, e, function (args) {\n      if (args === void 0) {\n        args = {\n          requestType: 'refresh'\n        };\n      }\n\n      if (args.cancel) {\n        gObj.notify(events.cancelBegin, args);\n        return;\n      }\n\n      if (args.requestType === 'delete' && gObj.allowPaging) {\n        var dataLength = args.data.length;\n        var count = gObj.pageSettings.totalRecordsCount - dataLength;\n        var currentViewData = gObj.getCurrentViewRecords().length; // eslint-disable-next-line max-len\n\n        if (!(currentViewData - dataLength) && count && (gObj.pageSettings.currentPage - 1) * gObj.pageSettings.pageSize === count) {\n          gObj.prevPageMoving = true;\n          gObj.setProperties({\n            pageSettings: {\n              totalRecordsCount: count,\n              currentPage: Math.ceil(count / gObj.pageSettings.pageSize)\n            }\n          }, true);\n          gObj.pagerModule.pagerObj.totalRecordsCount = count;\n        }\n      }\n\n      if (args.requestType === 'reorder' && _this.parent.dataSource && 'result' in _this.parent.dataSource) {\n        _this.contentRenderer.refreshContentRows(args);\n      } else if ((args.requestType === 'paging' || args.requestType === 'columnstate' || args.requestType === 'reorder') && _this.parent.groupSettings.enableLazyLoading && _this.parent.groupSettings.columns.length && _this.parent.contentModule.getGroupCache()[_this.parent.pageSettings.currentPage]) {\n        _this.contentRenderer.refreshContentRows(args);\n      } else {\n        _this.refreshDataManager(args);\n      }\n    });\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Render.prototype.resetTemplates = function () {\n    var gObj = this.parent;\n    var gridColumns = gObj.getColumns();\n\n    if (gObj.detailTemplate) {\n      var detailTemplateID = gObj.element.id + 'detailTemplate';\n      blazorTemplates[detailTemplateID] = [];\n      resetBlazorTemplate(detailTemplateID, 'DetailTemplate');\n    }\n\n    if (gObj.groupSettings.captionTemplate) {\n      resetBlazorTemplate(gObj.element.id + 'captionTemplate', 'CaptionTemplate');\n    }\n\n    if (gObj.rowTemplate) {\n      resetBlazorTemplate(gObj.element.id + 'rowTemplate', 'RowTemplate');\n    }\n\n    if (gObj.toolbarTemplate) {\n      resetBlazorTemplate(gObj.element.id + 'toolbarTemplate', 'ToolbarTemplate');\n    }\n\n    if (gObj.pageSettings.template) {\n      resetBlazorTemplate(gObj.element.id + '_template', 'pageSettings');\n    }\n\n    for (var i = 0; i < gridColumns.length; i++) {\n      if (gridColumns[i].template) {\n        blazorTemplates[gObj.element.id + gridColumns[i].uid] = [];\n        resetBlazorTemplate(gObj.element.id + gridColumns[i].uid, 'Template');\n      }\n\n      if (gridColumns[i].headerTemplate) {\n        resetBlazorTemplate(gObj.element.id + gridColumns[i].uid + 'headerTemplate', 'HeaderTemplate');\n      }\n\n      if (gridColumns[i].filterTemplate) {\n        resetBlazorTemplate(gObj.element.id + gridColumns[i].uid + 'filterTemplate', 'FilterTemplate');\n      }\n    }\n\n    var guid = 'guid';\n\n    for (var k = 0; k < gObj.aggregates.length; k++) {\n      for (var j = 0; j < gObj.aggregates[k].columns.length; j++) {\n        if (gObj.aggregates[k].columns[j].footerTemplate) {\n          var tempID = gObj.element.id + gObj.aggregates[k].columns[j][guid] + 'footerTemplate';\n          resetBlazorTemplate(tempID, 'FooterTemplate');\n        }\n\n        if (gObj.aggregates[k].columns[j].groupFooterTemplate) {\n          var tempID = gObj.element.id + gObj.aggregates[k].columns[j][guid] + 'groupFooterTemplate';\n          resetBlazorTemplate(tempID, 'GroupFooterTemplate');\n        }\n\n        if (gObj.aggregates[k].columns[j].groupCaptionTemplate) {\n          var tempID = gObj.element.id + gObj.aggregates[k].columns[j][guid] + 'groupCaptionTemplate';\n          resetBlazorTemplate(tempID, 'GroupCaptionTemplate');\n        }\n      }\n    }\n  };\n\n  Render.prototype.refreshComplete = function (e) {\n    this.parent.trigger(events.actionComplete, e);\n  };\n  /**\n   * The function is used to refresh the dataManager\n   *\n   * @param {NotifyArgs} args - specifies the args\n   * @returns {void}\n   */\n\n\n  Render.prototype.refreshDataManager = function (args) {\n    var _this = this;\n\n    if (args === void 0) {\n      args = {};\n    }\n\n    if (args.requestType !== 'virtualscroll' && !args.isCaptionCollapse) {\n      this.parent.showSpinner();\n    }\n\n    this.parent.notify(events.resetInfiniteBlocks, args);\n    this.emptyGrid = false;\n    var dataManager;\n    var isFActon = this.isNeedForeignAction();\n    this.ariaService.setBusy(this.parent.getContent().querySelector('.' + literals.content), true);\n\n    if (isFActon) {\n      var deffered = new Deferred();\n      dataManager = this.getFData(deffered, args);\n    }\n\n    if (!dataManager) {\n      dataManager = this.data.getData(args, this.data.generateQuery().requiresCount());\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      dataManager = dataManager.then(function (e) {\n        var query = _this.data.generateQuery().requiresCount();\n\n        if (_this.emptyGrid) {\n          var def = new Deferred();\n          def.resolve({\n            result: [],\n            count: 0\n          });\n          return def.promise;\n        }\n\n        return _this.data.getData(args, query);\n      });\n    }\n\n    if (this.parent.getForeignKeyColumns().length && (!isFActon || this.parent.searchSettings.key.length)) {\n      var deffered_1 = new Deferred();\n      dataManager = dataManager.then(function (e) {\n        _this.parent.notify(events.getForeignKeyData, {\n          dataManager: dataManager,\n          result: e,\n          promise: deffered_1,\n          action: args\n        });\n\n        return deffered_1.promise;\n      });\n    }\n\n    if (this.parent.groupSettings.disablePageWiseAggregates && this.parent.groupSettings.columns.length) {\n      dataManager = dataManager.then(function (e) {\n        return _this.validateGroupRecords(e);\n      });\n    }\n\n    dataManager.then(function (e) {\n      return _this.dataManagerSuccess(e, args);\n    }).catch(function (e) {\n      return _this.dataManagerFailure(e, args);\n    });\n  };\n\n  Render.prototype.getFData = function (deferred, args) {\n    this.parent.notify(events.getForeignKeyData, {\n      isComplex: true,\n      promise: deferred,\n      action: args\n    });\n    return deferred.promise;\n  };\n\n  Render.prototype.isNeedForeignAction = function () {\n    var gObj = this.parent;\n    return !!(gObj.allowFiltering && gObj.filterSettings.columns.length || gObj.searchSettings.key.length) && this.foreignKey(this.parent.getForeignKeyColumns());\n  };\n\n  Render.prototype.foreignKey = function (columns) {\n    var _this = this;\n\n    return columns.some(function (col) {\n      var fbool = false;\n      fbool = _this.parent.filterSettings.columns.some(function (value) {\n        return col.uid === value.uid;\n      });\n      return !!(fbool || _this.parent.searchSettings.key.length);\n    });\n  };\n\n  Render.prototype.sendBulkRequest = function (args) {\n    var _this = this;\n\n    args.requestType = 'batchsave';\n    var promise = this.data.saveChanges(args.changes, this.parent.getPrimaryKeyFieldNames()[0], args.original);\n    var query = this.data.generateQuery().requiresCount();\n\n    if (this.data.dataManager.dataSource.offline) {\n      this.refreshDataManager({\n        requestType: 'batchsave'\n      });\n      return;\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      promise.then(function (e) {\n        _this.data.getData(args, query).then(function (e) {\n          return _this.dmSuccess(e, args);\n        }).catch(function (e) {\n          return _this.dmFailure(e, args);\n        });\n      }).catch(function (e) {\n        return _this.dmFailure(e, args);\n      });\n    }\n  };\n\n  Render.prototype.dmSuccess = function (e, args) {\n    this.dataManagerSuccess(e, args);\n  };\n\n  Render.prototype.dmFailure = function (e, args) {\n    this.dataManagerFailure(e, args);\n  };\n  /**\n   * Render empty row to Grid which is used at the time to represent to no records.\n   *\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Render.prototype.renderEmptyRow = function () {\n    this.emptyRow(true);\n  };\n\n  Render.prototype.emptyRow = function (isTrigger) {\n    var gObj = this.parent;\n    var tbody = this.contentRenderer.getTable().querySelector(literals.tbody);\n\n    if (!isNullOrUndefined(tbody)) {\n      remove(tbody);\n    }\n\n    tbody = this.parent.createElement(literals.tbody);\n    var spanCount = 0;\n\n    if (gObj.detailTemplate || gObj.childGrid) {\n      ++spanCount;\n    }\n\n    var tr = this.parent.createElement('tr', {\n      className: 'e-emptyrow'\n    });\n    tr.appendChild(this.parent.createElement('td', {\n      innerHTML: this.l10n.getConstant('EmptyRecord'),\n      attrs: {\n        colspan: (gObj.getVisibleColumns().length + spanCount + gObj.groupSettings.columns.length).toString()\n      }\n    }));\n    tbody.appendChild(tr);\n    this.contentRenderer.renderEmpty(tbody);\n\n    if (isTrigger) {\n      this.parent.trigger(events.dataBound, {});\n      this.parent.notify(events.onEmpty, {\n        rows: [new Row({\n          isDataRow: true,\n          cells: [new Cell({\n            isDataCell: true,\n            visible: true\n          })]\n        })]\n      });\n    }\n  };\n\n  Render.prototype.dynamicColumnChange = function () {\n    if (this.parent.getCurrentViewRecords().length) {\n      this.updateColumnType(this.parent.getCurrentViewRecords()[0]);\n    }\n  };\n\n  Render.prototype.updateColumnType = function (record) {\n    var columns = this.parent.getColumns();\n    var value;\n    var cFormat = 'customFormat';\n    var equalTo = 'equalTo';\n    var data = record && record.items ? record.items[0] : record;\n    var fmtr = this.locator.getService('valueFormatter');\n\n    for (var i = 0, len = columns.length; i < len; i++) {\n      value = getObject(columns[i].field || '', data);\n\n      if (!isNullOrUndefined(columns[i][cFormat])) {\n        columns[i].format = columns[i][cFormat];\n      }\n\n      if (!isNullOrUndefined(columns[i].validationRules) && !isNullOrUndefined(columns[i].validationRules[equalTo])) {\n        columns[i].validationRules[equalTo][0] = this.parent.element.id + columns[i].validationRules[equalTo][0];\n      }\n\n      if (columns[i].isForeignColumn() && columns[i].columnData) {\n        value = getObject(columns[i].foreignKeyValue || '', columns[i].columnData[0]);\n      }\n\n      if (!isNullOrUndefined(value)) {\n        this.isColTypeDef = true;\n\n        if (!columns[i].type) {\n          columns[i].type = value.getDay ? value.getHours() > 0 || value.getMinutes() > 0 || value.getSeconds() > 0 || value.getMilliseconds() > 0 ? 'datetime' : 'date' : typeof value;\n        }\n      } else {\n        columns[i].type = columns[i].type || null;\n      }\n\n      var valueFormatter = new ValueFormatter();\n\n      if (columns[i].format && (columns[i].format.skeleton || columns[i].format.format && typeof columns[i].format.format === 'string')) {\n        columns[i].setFormatter(valueFormatter.getFormatFunction(extend({}, columns[i].format)));\n        columns[i].setParser(valueFormatter.getParserFunction(columns[i].format));\n      }\n\n      if (typeof columns[i].format === 'string') {\n        setFormatter(this.locator, columns[i]);\n      } else if (!columns[i].format && columns[i].type === 'number') {\n        columns[i].setParser(fmtr.getParserFunction({\n          format: 'n2'\n        }));\n      }\n    }\n  };\n  /**\n   * @param {ReturnType} e - specifies the return type\n   * @param {NotifyArgs} args - specifies the Notifyargs\n   * @returns {void}\n   * @hidden\n   */\n  // tslint:disable-next-line:max-func-body-length\n\n\n  Render.prototype.dataManagerSuccess = function (e, args) {\n    var _this = this;\n\n    var gObj = this.parent;\n    this.contentRenderer = this.renderer.getRenderer(RenderType.Content);\n    this.headerRenderer = this.renderer.getRenderer(RenderType.Header);\n    e.actionArgs = args;\n    var isInfiniteDelete = this.parent.enableInfiniteScrolling && !this.parent.infiniteScrollSettings.enableCache && (args.requestType === 'delete' || args.requestType === 'save' && this.parent.infiniteScrollModule.requestType === 'add'); // tslint:disable-next-line:max-func-body-length\n\n    gObj.trigger(events.beforeDataBound, e, function (dataArgs) {\n      if (dataArgs.cancel) {\n        return;\n      }\n\n      dataArgs.result = isNullOrUndefined(dataArgs.result) ? [] : dataArgs.result;\n      var len = Object.keys(dataArgs.result).length;\n\n      if (_this.parent.isDestroyed) {\n        return;\n      }\n\n      if (!gObj.getColumns().length && !len && !(gObj.columns.length && gObj.columns[0] instanceof Column)) {\n        gObj.hideSpinner();\n        return;\n      }\n\n      if (_this.isInfiniteEnd(args) && !len) {\n        _this.parent.notify(events.infiniteEditHandler, {\n          e: args,\n          result: e.result,\n          count: e.count,\n          agg: e.aggregates\n        });\n\n        return;\n      }\n\n      _this.parent.isEdit = false;\n\n      _this.parent.notify(events.editReset, {});\n\n      _this.parent.notify(events.tooltipDestroy, {});\n\n      _this.contentRenderer.prevCurrentView = _this.parent.currentViewData.slice();\n      gObj.currentViewData = dataArgs.result;\n      gObj.notify(events.refreshInfiniteCurrentViewData, {\n        args: args,\n        data: dataArgs.result\n      });\n\n      if (!len && dataArgs.count && gObj.allowPaging && args && args.requestType !== 'delete') {\n        if (_this.parent.groupSettings.enableLazyLoading && (args.requestType === 'grouping' || args.requestType === 'ungrouping')) {\n          _this.parent.notify(events.groupComplete, args);\n        }\n\n        gObj.prevPageMoving = true;\n        gObj.pageSettings.totalRecordsCount = dataArgs.count;\n\n        if (args.requestType !== 'paging') {\n          gObj.pageSettings.currentPage = Math.ceil(dataArgs.count / gObj.pageSettings.pageSize);\n        }\n\n        gObj.dataBind();\n        return;\n      }\n\n      if ((!gObj.getColumns().length && len || !_this.isLayoutRendered) && !isGroupAdaptive(gObj)) {\n        _this.updatesOnInitialRender(dataArgs);\n      }\n\n      if (!_this.isColTypeDef && gObj.getCurrentViewRecords()) {\n        if (_this.data.dataManager.dataSource.offline && gObj.dataSource && gObj.dataSource.length) {\n          _this.updateColumnType(gObj.dataSource[0]);\n        } else {\n          _this.updateColumnType(gObj.getCurrentViewRecords()[0]);\n        }\n      }\n\n      if (!_this.parent.isInitialLoad && _this.parent.groupSettings.disablePageWiseAggregates && !_this.parent.groupSettings.columns.length) {\n        dataArgs.result = _this.parent.dataSource instanceof Array ? _this.parent.dataSource : _this.parent.currentViewData;\n      }\n\n      if ((_this.parent.isReact || _this.parent.isVue) && !isNullOrUndefined(args) && args.requestType !== 'infiniteScroll' && !args.isFrozen) {\n        clearReactVueTemplates(_this.parent, ['footerTemplate']);\n      }\n\n      _this.parent.notify(events.dataReady, extend({\n        count: dataArgs.count,\n        result: dataArgs.result,\n        aggregates: dataArgs.aggregates\n      }, args));\n\n      if ((gObj.groupSettings.columns.length || args && args.requestType === 'ungrouping') && args && args.requestType !== 'filtering') {\n        _this.headerRenderer.refreshUI();\n      }\n\n      if (len) {\n        if (isGroupAdaptive(gObj)) {\n          var content = 'content';\n          args.scrollTop = {\n            top: _this.contentRenderer[content].scrollTop\n          };\n        }\n\n        if (!isInfiniteDelete) {\n          if (_this.parent.enableImmutableMode) {\n            _this.contentRenderer.immutableModeRendering(args);\n          } else {\n            _this.contentRenderer.refreshContentRows(args);\n          }\n        } else {\n          _this.parent.notify(events.infiniteEditHandler, {\n            e: args,\n            result: e.result,\n            count: e.count,\n            agg: e.aggregates\n          });\n        }\n      } else {\n        if (args && args.isCaptionCollapse) {\n          return;\n        }\n\n        if (!gObj.getColumns().length) {\n          gObj.element.innerHTML = '';\n          alert(_this.l10n.getConstant('EmptyDataSourceError')); //ToDO: change this alert as dialog\n\n          return;\n        }\n\n        _this.contentRenderer.setRowElements([]);\n\n        _this.contentRenderer.setRowObjects([]);\n\n        _this.ariaService.setBusy(_this.parent.getContent().querySelector('.' + literals.content), false);\n\n        _this.renderEmptyRow();\n\n        if (args) {\n          var action = (args.requestType || '').toLowerCase() + '-complete';\n\n          _this.parent.notify(action, args);\n\n          if (args.requestType === 'batchsave') {\n            args.cancel = false;\n            args.rows = [];\n            args.isFrozen = _this.parent.getFrozenColumns() !== 0 && !args.isFrozen;\n\n            _this.parent.trigger(events.actionComplete, args);\n          }\n        }\n\n        _this.parent.hideSpinner();\n      }\n\n      _this.parent.notify(events.toolbarRefresh, {});\n\n      _this.setRowCount(_this.parent.getCurrentViewRecords().length);\n\n      _this.parent.getDataModule().isQueryInvokedFromData = false;\n    });\n  };\n  /**\n   * @param {object} e - specifies the object\n   * @param {Object[]} e.result - specifies the result\n   * @param {NotifyArgs} args - specifies the args\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Render.prototype.dataManagerFailure = function (e, args) {\n    this.ariaService.setOptions(this.parent.getContent().querySelector('.' + literals.content), {\n      busy: false,\n      invalid: true\n    });\n    this.setRowCount(1);\n    this.parent.trigger(events.actionFailure, {\n      error: e\n    });\n    this.parent.hideSpinner();\n\n    if (args.requestType === 'save' || args.requestType === 'delete' || args.name === 'bulk-save') {\n      return;\n    }\n\n    this.parent.currentViewData = [];\n    this.renderEmptyRow();\n    this.parent.log('actionfailure', {\n      error: e\n    });\n  };\n\n  Render.prototype.setRowCount = function (dataRowCount) {\n    this.ariaService.setOptions(this.parent.getHeaderTable(), {\n      rowcount: dataRowCount ? dataRowCount.toString() : '1'\n    });\n  };\n\n  Render.prototype.isInfiniteEnd = function (args) {\n    return this.parent.enableInfiniteScrolling && !this.parent.infiniteScrollSettings.enableCache && args.requestType === 'delete';\n  };\n\n  Render.prototype.updatesOnInitialRender = function (e) {\n    this.isLayoutRendered = true;\n\n    if (this.parent.columns.length < 1) {\n      this.buildColumns(e.result[0]);\n    }\n\n    prepareColumns(this.parent.columns, null, this.parent);\n    this.headerRenderer.renderTable();\n    this.contentRenderer.renderTable();\n    this.parent.isAutoGen = true;\n    this.parent.notify(events.autoCol, {});\n  };\n\n  Render.prototype.iterateComplexColumns = function (obj, field, split) {\n    var keys = Object.keys(obj);\n\n    for (var i = 0; i < keys.length; i++) {\n      var childKeys = typeof obj[keys[i]] === 'object' && obj[keys[i]] && !(obj[keys[i]] instanceof Date) ? Object.keys(obj[keys[i]]) : [];\n\n      if (childKeys.length) {\n        this.iterateComplexColumns(obj[keys[i]], field + (keys[i] + '.'), split);\n      } else {\n        split[this.counter] = field + keys[i];\n        this.counter++;\n      }\n    }\n  };\n\n  Render.prototype.buildColumns = function (record) {\n    var cols = [];\n    var complexCols = {};\n    this.iterateComplexColumns(record, '', complexCols);\n    var columns = Object.keys(complexCols).filter(function (e) {\n      return complexCols[e] !== 'BlazId';\n    }).map(function (field) {\n      return complexCols[field];\n    });\n\n    for (var i = 0, len = columns.length; i < len; i++) {\n      cols[i] = {\n        'field': columns[i]\n      };\n\n      if (this.parent.enableColumnVirtualization) {\n        cols[i].width = !isNullOrUndefined(cols[i].width) ? cols[i].width : 200;\n      }\n    }\n\n    this.parent.setProperties({\n      'columns': cols\n    }, true);\n  };\n\n  Render.prototype.instantiateRenderer = function () {\n    this.renderer.addRenderer(RenderType.Header, new HeaderRender(this.parent, this.locator));\n    this.renderer.addRenderer(RenderType.Content, new ContentRender(this.parent, this.locator));\n    var cellrender = this.locator.getService('cellRendererFactory');\n    cellrender.addCellRenderer(CellType.Header, new HeaderCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.Data, new CellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.StackedHeader, new StackedHeaderCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.Indent, new IndentCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.GroupCaption, new GroupCaptionCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.GroupCaptionEmpty, new GroupCaptionEmptyCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.Expand, new ExpandCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.HeaderIndent, new HeaderIndentCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.StackedHeader, new StackedHeaderCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.DetailHeader, new DetailHeaderIndentCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.RowDragHIcon, new RowDragDropHeaderRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.DetailExpand, new DetailExpandCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.DetailFooterIntent, new IndentCellRenderer(this.parent, this.locator));\n    cellrender.addCellRenderer(CellType.RowDragIcon, new RowDragDropRenderer(this.parent, this.locator));\n  };\n\n  Render.prototype.addEventListener = function () {\n    var _this = this;\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.initialLoad, this.instantiateRenderer, this);\n    this.parent.on('refreshdataSource', this.dataManagerSuccess, this);\n    this.parent.on(events.modelChanged, this.refresh, this);\n    this.parent.on(events.refreshComplete, this.refreshComplete, this);\n    this.parent.on(events.bulkSave, this.sendBulkRequest, this);\n    this.parent.on(events.showEmptyGrid, function () {\n      _this.emptyGrid = true;\n    }, this);\n    this.parent.on(events.autoCol, this.dynamicColumnChange, this);\n  };\n  /**\n   * @param {ReturnType} e - specifies the Return type\n   * @returns {Promise<Object>} returns the object\n   * @hidden\n   */\n\n\n  Render.prototype.validateGroupRecords = function (e) {\n    var _this = this;\n\n    var index = e.result.length - 1;\n\n    if (index < 0) {\n      return Promise.resolve(e);\n    }\n\n    var group0 = e.result[0];\n    var groupN = e.result[index];\n    var predicate = [];\n\n    var addWhere = function (input) {\n      var groups = [group0, groupN];\n\n      for (var i = 0; i < groups.length; i++) {\n        predicate.push(new Predicate('field', '==', groups[i].field).and(_this.getPredicate('key', 'equal', groups[i].key)));\n      }\n\n      input.where(Predicate.or(predicate));\n    };\n\n    var query = new Query();\n    addWhere(query);\n    var curDm = new DataManager(e.result);\n    var curFilter = curDm.executeLocal(query);\n    var newQuery = this.data.generateQuery(true);\n    var rPredicate = [];\n\n    if (this.data.isRemote()) {\n      var groups = [group0, groupN];\n\n      for (var i = 0; i < groups.length; i++) {\n        rPredicate.push(this.getPredicate(groups[i].field, 'equal', groups[i].key));\n      }\n\n      newQuery.where(Predicate.or(rPredicate));\n    } else {\n      addWhere(newQuery);\n    }\n\n    var deferred = new Deferred();\n    this.data.getData({}, newQuery).then(function (r) {\n      _this.updateGroupInfo(curFilter, r.result);\n\n      deferred.resolve(e);\n    }).catch(function (e) {\n      return deferred.reject(e);\n    });\n    return deferred.promise;\n  };\n\n  Render.prototype.getPredicate = function (key, operator, value) {\n    if (value instanceof Date) {\n      return getDatePredicate({\n        field: key,\n        operator: operator,\n        value: value\n      });\n    }\n\n    return new Predicate(key, operator, value);\n  };\n\n  Render.prototype.updateGroupInfo = function (current, untouched) {\n    var dm = new DataManager(untouched);\n    var elements = current;\n\n    for (var i = 0; i < elements.length; i++) {\n      var uGroup = dm.executeLocal(new Query().where(new Predicate('field', '==', elements[i].field).and(this.getPredicate('key', 'equal', elements[i].key))))[0];\n      elements[i].count = uGroup.count;\n      var itemGroup = elements[i].items;\n      var uGroupItem = uGroup.items;\n\n      if (itemGroup.GroupGuid) {\n        elements[i].items = this.updateGroupInfo(elements[i].items, uGroup.items);\n      }\n\n      var rows = this.parent.aggregates;\n\n      for (var j = 0; j < rows.length; j++) {\n        var row = rows[j];\n\n        for (var k = 0; k < row.columns.length; k++) {\n          var types = row.columns[k].type instanceof Array ? row.columns[k].type : [row.columns[k].type];\n\n          for (var l = 0; l < types.length; l++) {\n            var key = row.columns[k].field + ' - ' + types[l].toLowerCase();\n            var data = itemGroup.level ? uGroupItem.records : uGroup.items;\n            var context = this.parent;\n\n            if (types[l] === 'Custom') {\n              var data_1 = itemGroup.level ? uGroupItem : uGroup;\n              var temp = row.columns[k].customAggregate;\n\n              if (typeof temp === 'string') {\n                temp = getValue(temp, window);\n              }\n\n              elements[i].aggregates[key] = temp ? temp.call(context, data_1, row.columns[k]) : '';\n            } else {\n              // eslint-disable-next-line max-len\n              elements[i].aggregates[key] = DataUtil.aggregates[types[l].toLowerCase()](data, row.columns[k].field);\n            }\n          }\n        }\n      }\n    }\n\n    return current;\n  };\n\n  return Render;\n}();\n\nexport { Render };","map":{"version":3,"names":["remove","resetBlazorTemplate","blazorTemplates","getValue","isNullOrUndefined","extend","DataManager","Query","Deferred","Predicate","DataUtil","ValueFormatter","RenderType","CellType","Data","Column","Row","Cell","events","prepareColumns","setFormatter","isGroupAdaptive","getDatePredicate","getObject","clearReactVueTemplates","ContentRender","HeaderRender","CellRenderer","HeaderCellRenderer","StackedHeaderCellRenderer","IndentCellRenderer","GroupCaptionCellRenderer","GroupCaptionEmptyCellRenderer","ExpandCellRenderer","HeaderIndentCellRenderer","DetailHeaderIndentCellRenderer","DetailExpandCellRenderer","RowDragDropRenderer","RowDragDropHeaderRenderer","literals","Render","parent","locator","emptyGrid","counter","data","l10n","getService","ariaService","renderer","addEventListener","prototype","render","gObj","headerRenderer","getRenderer","Header","contentRenderer","Content","renderPanel","getColumns","length","isLayoutRendered","renderTable","emptyRow","scrollModule","setWidth","setHeight","height","setPadding","refreshDataManager","refresh","e","_this","requestType","notify","trigger","actionBegin","args","cancel","cancelBegin","allowPaging","dataLength","count","pageSettings","totalRecordsCount","currentViewData","getCurrentViewRecords","currentPage","pageSize","prevPageMoving","setProperties","Math","ceil","pagerModule","pagerObj","dataSource","refreshContentRows","groupSettings","enableLazyLoading","columns","contentModule","getGroupCache","resetTemplates","gridColumns","detailTemplate","detailTemplateID","element","id","captionTemplate","rowTemplate","toolbarTemplate","template","i","uid","headerTemplate","filterTemplate","guid","k","aggregates","j","footerTemplate","tempID","groupFooterTemplate","groupCaptionTemplate","refreshComplete","actionComplete","isCaptionCollapse","showSpinner","resetInfiniteBlocks","dataManager","isFActon","isNeedForeignAction","setBusy","getContent","querySelector","content","deffered","getFData","getData","generateQuery","requiresCount","then","query","def","resolve","result","promise","getForeignKeyColumns","searchSettings","key","deffered_1","getForeignKeyData","action","disablePageWiseAggregates","validateGroupRecords","dataManagerSuccess","catch","dataManagerFailure","deferred","isComplex","allowFiltering","filterSettings","foreignKey","some","col","fbool","value","sendBulkRequest","saveChanges","changes","getPrimaryKeyFieldNames","original","offline","dmSuccess","dmFailure","renderEmptyRow","isTrigger","tbody","getTable","createElement","spanCount","childGrid","tr","className","appendChild","innerHTML","getConstant","attrs","colspan","getVisibleColumns","toString","renderEmpty","dataBound","onEmpty","rows","isDataRow","cells","isDataCell","visible","dynamicColumnChange","updateColumnType","record","cFormat","equalTo","items","fmtr","len","field","format","validationRules","isForeignColumn","columnData","foreignKeyValue","isColTypeDef","type","getDay","getHours","getMinutes","getSeconds","getMilliseconds","valueFormatter","skeleton","getFormatFunction","setParser","getParserFunction","actionArgs","isInfiniteDelete","enableInfiniteScrolling","infiniteScrollSettings","enableCache","infiniteScrollModule","beforeDataBound","dataArgs","Object","keys","isDestroyed","hideSpinner","isInfiniteEnd","infiniteEditHandler","agg","isEdit","editReset","tooltipDestroy","prevCurrentView","slice","refreshInfiniteCurrentViewData","groupComplete","dataBind","updatesOnInitialRender","isInitialLoad","Array","isReact","isVue","isFrozen","dataReady","refreshUI","scrollTop","top","enableImmutableMode","immutableModeRendering","alert","setRowElements","setRowObjects","toLowerCase","getFrozenColumns","toolbarRefresh","setRowCount","getDataModule","isQueryInvokedFromData","setOptions","busy","invalid","actionFailure","error","name","log","dataRowCount","getHeaderTable","rowcount","buildColumns","isAutoGen","autoCol","iterateComplexColumns","obj","split","childKeys","Date","cols","complexCols","filter","map","enableColumnVirtualization","width","instantiateRenderer","addRenderer","cellrender","addCellRenderer","StackedHeader","Indent","GroupCaption","GroupCaptionEmpty","Expand","HeaderIndent","DetailHeader","RowDragHIcon","DetailExpand","DetailFooterIntent","RowDragIcon","on","initialLoad","modelChanged","bulkSave","showEmptyGrid","index","Promise","group0","groupN","predicate","addWhere","input","groups","push","and","getPredicate","where","or","curDm","curFilter","executeLocal","newQuery","rPredicate","isRemote","r","updateGroupInfo","reject","operator","current","untouched","dm","elements","uGroup","itemGroup","uGroupItem","GroupGuid","row","types","l","level","records","context","data_1","temp","customAggregate","window","call"],"sources":["C:/Users/shahj/OneDrive/Documents/GitHub/Multifunctional-React-Dashboard/node_modules/@syncfusion/ej2-grids/src/grid/renderer/render.js"],"sourcesContent":["import { remove, resetBlazorTemplate, blazorTemplates, getValue } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Deferred, Predicate, DataUtil } from '@syncfusion/ej2-data';\nimport { ValueFormatter } from '../services/value-formatter';\nimport { RenderType, CellType } from '../base/enum';\nimport { Data } from '../actions/data';\nimport { Column } from '../models/column';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport * as events from '../base/constant';\nimport { prepareColumns, setFormatter, isGroupAdaptive, getDatePredicate, getObject, clearReactVueTemplates } from '../base/util';\nimport { ContentRender } from '../renderer/content-renderer';\nimport { HeaderRender } from '../renderer/header-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { HeaderCellRenderer } from '../renderer/header-cell-renderer';\nimport { StackedHeaderCellRenderer } from '../renderer/stacked-cell-renderer';\nimport { IndentCellRenderer } from '../renderer/indent-cell-renderer';\nimport { GroupCaptionCellRenderer, GroupCaptionEmptyCellRenderer } from '../renderer/caption-cell-renderer';\nimport { ExpandCellRenderer } from '../renderer/expand-cell-renderer';\nimport { HeaderIndentCellRenderer } from '../renderer/header-indent-renderer';\nimport { DetailHeaderIndentCellRenderer } from '../renderer/detail-header-indent-renderer';\nimport { DetailExpandCellRenderer } from '../renderer/detail-expand-cell-renderer';\nimport { RowDragDropRenderer } from './row-drag-drop-renderer';\nimport { RowDragDropHeaderRenderer } from '../renderer/row-drag-header-indent-render';\nimport * as literals from '../base/string-literals';\n/**\n * Content module is used to render grid content\n *\n * @hidden\n */\nvar Render = /** @class */ (function () {\n    /**\n     * Constructor for render module\n     *\n     * @param {IGrid} parent - specifies the IGrid\n     * @param {ServiceLocator} locator - specifies the serviceLocator\n     */\n    function Render(parent, locator) {\n        this.emptyGrid = false;\n        this.counter = 0;\n        this.parent = parent;\n        this.locator = locator;\n        this.data = new Data(parent, locator);\n        this.l10n = locator.getService('localization');\n        this.ariaService = this.locator.getService('ariaService');\n        this.renderer = this.locator.getService('rendererFactory');\n        this.addEventListener();\n    }\n    /**\n     * To initialize grid header, content and footer rendering\n     *\n     * @returns {void}\n     */\n    Render.prototype.render = function () {\n        var gObj = this.parent;\n        this.headerRenderer = this.renderer.getRenderer(RenderType.Header);\n        this.contentRenderer = this.renderer.getRenderer(RenderType.Content);\n        this.headerRenderer.renderPanel();\n        this.contentRenderer.renderPanel();\n        if (gObj.getColumns().length) {\n            this.isLayoutRendered = true;\n            this.headerRenderer.renderTable();\n            this.contentRenderer.renderTable();\n            this.emptyRow(false);\n        }\n        this.parent.scrollModule.setWidth();\n        this.parent.scrollModule.setHeight();\n        if (this.parent.height !== 'auto') {\n            this.parent.scrollModule.setPadding();\n        }\n        this.refreshDataManager();\n    };\n    /**\n     * Refresh the entire Grid.\n     *\n     * @param {NotifyArgs} e - specifies the NotifyArgs\n     * @returns {void}\n     */\n    Render.prototype.refresh = function (e) {\n        var _this = this;\n        if (e === void 0) { e = { requestType: 'refresh' }; }\n        var gObj = this.parent;\n        gObj.notify(e.requestType + \"-begin\", e);\n        gObj.trigger(events.actionBegin, e, function (args) {\n            if (args === void 0) { args = { requestType: 'refresh' }; }\n            if (args.cancel) {\n                gObj.notify(events.cancelBegin, args);\n                return;\n            }\n            if (args.requestType === 'delete' && gObj.allowPaging) {\n                var dataLength = args.data.length;\n                var count = gObj.pageSettings.totalRecordsCount - dataLength;\n                var currentViewData = gObj.getCurrentViewRecords().length;\n                // eslint-disable-next-line max-len\n                if (!(currentViewData - dataLength) && count && ((gObj.pageSettings.currentPage - 1) * gObj.pageSettings.pageSize) === count) {\n                    gObj.prevPageMoving = true;\n                    gObj.setProperties({\n                        pageSettings: {\n                            totalRecordsCount: count, currentPage: Math.ceil(count / gObj.pageSettings.pageSize)\n                        }\n                    }, true);\n                    gObj.pagerModule.pagerObj.totalRecordsCount = count;\n                }\n            }\n            if (args.requestType === 'reorder' && _this.parent.dataSource && 'result' in _this.parent.dataSource) {\n                _this.contentRenderer.refreshContentRows(args);\n            }\n            else if ((args.requestType === 'paging' || args.requestType === 'columnstate' || args.requestType === 'reorder')\n                && _this.parent.groupSettings.enableLazyLoading && _this.parent.groupSettings.columns.length\n                && _this.parent.contentModule.getGroupCache()[_this.parent.pageSettings.currentPage]) {\n                _this.contentRenderer.refreshContentRows(args);\n            }\n            else {\n                _this.refreshDataManager(args);\n            }\n        });\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    Render.prototype.resetTemplates = function () {\n        var gObj = this.parent;\n        var gridColumns = gObj.getColumns();\n        if (gObj.detailTemplate) {\n            var detailTemplateID = gObj.element.id + 'detailTemplate';\n            blazorTemplates[detailTemplateID] = [];\n            resetBlazorTemplate(detailTemplateID, 'DetailTemplate');\n        }\n        if (gObj.groupSettings.captionTemplate) {\n            resetBlazorTemplate(gObj.element.id + 'captionTemplate', 'CaptionTemplate');\n        }\n        if (gObj.rowTemplate) {\n            resetBlazorTemplate(gObj.element.id + 'rowTemplate', 'RowTemplate');\n        }\n        if (gObj.toolbarTemplate) {\n            resetBlazorTemplate(gObj.element.id + 'toolbarTemplate', 'ToolbarTemplate');\n        }\n        if (gObj.pageSettings.template) {\n            resetBlazorTemplate(gObj.element.id + '_template', 'pageSettings');\n        }\n        for (var i = 0; i < gridColumns.length; i++) {\n            if (gridColumns[i].template) {\n                blazorTemplates[gObj.element.id + gridColumns[i].uid] = [];\n                resetBlazorTemplate(gObj.element.id + gridColumns[i].uid, 'Template');\n            }\n            if (gridColumns[i].headerTemplate) {\n                resetBlazorTemplate(gObj.element.id + gridColumns[i].uid + 'headerTemplate', 'HeaderTemplate');\n            }\n            if (gridColumns[i].filterTemplate) {\n                resetBlazorTemplate(gObj.element.id + gridColumns[i].uid + 'filterTemplate', 'FilterTemplate');\n            }\n        }\n        var guid = 'guid';\n        for (var k = 0; k < gObj.aggregates.length; k++) {\n            for (var j = 0; j < gObj.aggregates[k].columns.length; j++) {\n                if (gObj.aggregates[k].columns[j].footerTemplate) {\n                    var tempID = gObj.element.id + gObj.aggregates[k].columns[j][guid] + 'footerTemplate';\n                    resetBlazorTemplate(tempID, 'FooterTemplate');\n                }\n                if (gObj.aggregates[k].columns[j].groupFooterTemplate) {\n                    var tempID = gObj.element.id + gObj.aggregates[k].columns[j][guid] + 'groupFooterTemplate';\n                    resetBlazorTemplate(tempID, 'GroupFooterTemplate');\n                }\n                if (gObj.aggregates[k].columns[j].groupCaptionTemplate) {\n                    var tempID = gObj.element.id + gObj.aggregates[k].columns[j][guid] + 'groupCaptionTemplate';\n                    resetBlazorTemplate(tempID, 'GroupCaptionTemplate');\n                }\n            }\n        }\n    };\n    Render.prototype.refreshComplete = function (e) {\n        this.parent.trigger(events.actionComplete, e);\n    };\n    /**\n     * The function is used to refresh the dataManager\n     *\n     * @param {NotifyArgs} args - specifies the args\n     * @returns {void}\n     */\n    Render.prototype.refreshDataManager = function (args) {\n        var _this = this;\n        if (args === void 0) { args = {}; }\n        if (args.requestType !== 'virtualscroll' && !args.isCaptionCollapse) {\n            this.parent.showSpinner();\n        }\n        this.parent.notify(events.resetInfiniteBlocks, args);\n        this.emptyGrid = false;\n        var dataManager;\n        var isFActon = this.isNeedForeignAction();\n        this.ariaService.setBusy(this.parent.getContent().querySelector('.' + literals.content), true);\n        if (isFActon) {\n            var deffered = new Deferred();\n            dataManager = this.getFData(deffered, args);\n        }\n        if (!dataManager) {\n            dataManager = this.data.getData(args, this.data.generateQuery().requiresCount());\n        }\n        else {\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n            dataManager = dataManager.then(function (e) {\n                var query = _this.data.generateQuery().requiresCount();\n                if (_this.emptyGrid) {\n                    var def = new Deferred();\n                    def.resolve({ result: [], count: 0 });\n                    return def.promise;\n                }\n                return _this.data.getData(args, query);\n            });\n        }\n        if (this.parent.getForeignKeyColumns().length && (!isFActon || this.parent.searchSettings.key.length)) {\n            var deffered_1 = new Deferred();\n            dataManager = dataManager.then(function (e) {\n                _this.parent.notify(events.getForeignKeyData, { dataManager: dataManager, result: e, promise: deffered_1, action: args });\n                return deffered_1.promise;\n            });\n        }\n        if (this.parent.groupSettings.disablePageWiseAggregates && this.parent.groupSettings.columns.length) {\n            dataManager = dataManager.then(function (e) { return _this.validateGroupRecords(e); });\n        }\n        dataManager.then(function (e) { return _this.dataManagerSuccess(e, args); })\n            .catch(function (e) { return _this.dataManagerFailure(e, args); });\n    };\n    Render.prototype.getFData = function (deferred, args) {\n        this.parent.notify(events.getForeignKeyData, { isComplex: true, promise: deferred, action: args });\n        return deferred.promise;\n    };\n    Render.prototype.isNeedForeignAction = function () {\n        var gObj = this.parent;\n        return !!((gObj.allowFiltering && gObj.filterSettings.columns.length) ||\n            (gObj.searchSettings.key.length)) && this.foreignKey(this.parent.getForeignKeyColumns());\n    };\n    Render.prototype.foreignKey = function (columns) {\n        var _this = this;\n        return columns.some(function (col) {\n            var fbool = false;\n            fbool = _this.parent.filterSettings.columns.some(function (value) {\n                return col.uid === value.uid;\n            });\n            return !!(fbool || _this.parent.searchSettings.key.length);\n        });\n    };\n    Render.prototype.sendBulkRequest = function (args) {\n        var _this = this;\n        args.requestType = 'batchsave';\n        var promise = this.data.saveChanges(args.changes, this.parent.getPrimaryKeyFieldNames()[0], args.original);\n        var query = this.data.generateQuery().requiresCount();\n        if (this.data.dataManager.dataSource.offline) {\n            this.refreshDataManager({ requestType: 'batchsave' });\n            return;\n        }\n        else {\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n            promise.then(function (e) {\n                _this.data.getData(args, query)\n                    .then(function (e) { return _this.dmSuccess(e, args); })\n                    .catch(function (e) { return _this.dmFailure(e, args); });\n            })\n                .catch(function (e) { return _this.dmFailure(e, args); });\n        }\n    };\n    Render.prototype.dmSuccess = function (e, args) {\n        this.dataManagerSuccess(e, args);\n    };\n    Render.prototype.dmFailure = function (e, args) {\n        this.dataManagerFailure(e, args);\n    };\n    /**\n     * Render empty row to Grid which is used at the time to represent to no records.\n     *\n     * @returns {void}\n     * @hidden\n     */\n    Render.prototype.renderEmptyRow = function () {\n        this.emptyRow(true);\n    };\n    Render.prototype.emptyRow = function (isTrigger) {\n        var gObj = this.parent;\n        var tbody = this.contentRenderer.getTable().querySelector(literals.tbody);\n        if (!isNullOrUndefined(tbody)) {\n            remove(tbody);\n        }\n        tbody = this.parent.createElement(literals.tbody);\n        var spanCount = 0;\n        if (gObj.detailTemplate || gObj.childGrid) {\n            ++spanCount;\n        }\n        var tr = this.parent.createElement('tr', { className: 'e-emptyrow' });\n        tr.appendChild(this.parent.createElement('td', {\n            innerHTML: this.l10n.getConstant('EmptyRecord'),\n            attrs: { colspan: (gObj.getVisibleColumns().length + spanCount + gObj.groupSettings.columns.length).toString() }\n        }));\n        tbody.appendChild(tr);\n        this.contentRenderer.renderEmpty(tbody);\n        if (isTrigger) {\n            this.parent.trigger(events.dataBound, {});\n            this.parent.notify(events.onEmpty, { rows: [new Row({ isDataRow: true, cells: [new Cell({ isDataCell: true, visible: true })] })] });\n        }\n    };\n    Render.prototype.dynamicColumnChange = function () {\n        if (this.parent.getCurrentViewRecords().length) {\n            this.updateColumnType(this.parent.getCurrentViewRecords()[0]);\n        }\n    };\n    Render.prototype.updateColumnType = function (record) {\n        var columns = this.parent.getColumns();\n        var value;\n        var cFormat = 'customFormat';\n        var equalTo = 'equalTo';\n        var data = record && record.items ? record.items[0] : record;\n        var fmtr = this.locator.getService('valueFormatter');\n        for (var i = 0, len = columns.length; i < len; i++) {\n            value = getObject(columns[i].field || '', data);\n            if (!isNullOrUndefined(columns[i][cFormat])) {\n                columns[i].format = columns[i][cFormat];\n            }\n            if (!isNullOrUndefined(columns[i].validationRules) && !isNullOrUndefined(columns[i].validationRules[equalTo])) {\n                columns[i].validationRules[equalTo][0] = this.parent.element.id + columns[i].validationRules[equalTo][0];\n            }\n            if (columns[i].isForeignColumn() && columns[i].columnData) {\n                value = getObject(columns[i].foreignKeyValue || '', columns[i].columnData[0]);\n            }\n            if (!isNullOrUndefined(value)) {\n                this.isColTypeDef = true;\n                if (!columns[i].type) {\n                    columns[i].type = value.getDay ? (value.getHours() > 0 || value.getMinutes() > 0 ||\n                        value.getSeconds() > 0 || value.getMilliseconds() > 0 ? 'datetime' : 'date') : typeof (value);\n                }\n            }\n            else {\n                columns[i].type = columns[i].type || null;\n            }\n            var valueFormatter = new ValueFormatter();\n            if (columns[i].format && (columns[i].format.skeleton || (columns[i].format.format &&\n                typeof columns[i].format.format === 'string'))) {\n                columns[i].setFormatter(valueFormatter.getFormatFunction(extend({}, columns[i].format)));\n                columns[i].setParser(valueFormatter.getParserFunction(columns[i].format));\n            }\n            if (typeof (columns[i].format) === 'string') {\n                setFormatter(this.locator, columns[i]);\n            }\n            else if (!columns[i].format && columns[i].type === 'number') {\n                columns[i].setParser(fmtr.getParserFunction({ format: 'n2' }));\n            }\n        }\n    };\n    /**\n     * @param {ReturnType} e - specifies the return type\n     * @param {NotifyArgs} args - specifies the Notifyargs\n     * @returns {void}\n     * @hidden\n     */\n    // tslint:disable-next-line:max-func-body-length\n    Render.prototype.dataManagerSuccess = function (e, args) {\n        var _this = this;\n        var gObj = this.parent;\n        this.contentRenderer = this.renderer.getRenderer(RenderType.Content);\n        this.headerRenderer = this.renderer.getRenderer(RenderType.Header);\n        e.actionArgs = args;\n        var isInfiniteDelete = this.parent.enableInfiniteScrolling && !this.parent.infiniteScrollSettings.enableCache\n            && (args.requestType === 'delete' || (args.requestType === 'save' && this.parent.infiniteScrollModule.requestType === 'add'));\n        // tslint:disable-next-line:max-func-body-length\n        gObj.trigger(events.beforeDataBound, e, function (dataArgs) {\n            if (dataArgs.cancel) {\n                return;\n            }\n            dataArgs.result = isNullOrUndefined(dataArgs.result) ? [] : dataArgs.result;\n            var len = Object.keys(dataArgs.result).length;\n            if (_this.parent.isDestroyed) {\n                return;\n            }\n            if ((!gObj.getColumns().length && !len) && !(gObj.columns.length && gObj.columns[0] instanceof Column)) {\n                gObj.hideSpinner();\n                return;\n            }\n            if (_this.isInfiniteEnd(args) && !len) {\n                _this.parent.notify(events.infiniteEditHandler, { e: args, result: e.result, count: e.count, agg: e.aggregates });\n                return;\n            }\n            _this.parent.isEdit = false;\n            _this.parent.notify(events.editReset, {});\n            _this.parent.notify(events.tooltipDestroy, {});\n            _this.contentRenderer.prevCurrentView = _this.parent.currentViewData.slice();\n            gObj.currentViewData = dataArgs.result;\n            gObj.notify(events.refreshInfiniteCurrentViewData, { args: args, data: dataArgs.result });\n            if (!len && dataArgs.count && gObj.allowPaging && args && args.requestType !== 'delete') {\n                if (_this.parent.groupSettings.enableLazyLoading\n                    && (args.requestType === 'grouping' || args.requestType === 'ungrouping')) {\n                    _this.parent.notify(events.groupComplete, args);\n                }\n                gObj.prevPageMoving = true;\n                gObj.pageSettings.totalRecordsCount = dataArgs.count;\n                if (args.requestType !== 'paging') {\n                    gObj.pageSettings.currentPage = Math.ceil(dataArgs.count / gObj.pageSettings.pageSize);\n                }\n                gObj.dataBind();\n                return;\n            }\n            if ((!gObj.getColumns().length && len || !_this.isLayoutRendered) && !isGroupAdaptive(gObj)) {\n                _this.updatesOnInitialRender(dataArgs);\n            }\n            if (!_this.isColTypeDef && gObj.getCurrentViewRecords()) {\n                if (_this.data.dataManager.dataSource.offline && gObj.dataSource && gObj.dataSource.length) {\n                    _this.updateColumnType(gObj.dataSource[0]);\n                }\n                else {\n                    _this.updateColumnType(gObj.getCurrentViewRecords()[0]);\n                }\n            }\n            if (!_this.parent.isInitialLoad && _this.parent.groupSettings.disablePageWiseAggregates &&\n                !_this.parent.groupSettings.columns.length) {\n                dataArgs.result = _this.parent.dataSource instanceof Array ? _this.parent.dataSource : _this.parent.currentViewData;\n            }\n            if ((_this.parent.isReact || _this.parent.isVue) && !isNullOrUndefined(args) && args.requestType !== 'infiniteScroll' && !args.isFrozen) {\n                clearReactVueTemplates(_this.parent, ['footerTemplate']);\n            }\n            _this.parent.notify(events.dataReady, extend({ count: dataArgs.count, result: dataArgs.result, aggregates: dataArgs.aggregates }, args));\n            if ((gObj.groupSettings.columns.length || (args && args.requestType === 'ungrouping'))\n                && (args && args.requestType !== 'filtering')) {\n                _this.headerRenderer.refreshUI();\n            }\n            if (len) {\n                if (isGroupAdaptive(gObj)) {\n                    var content = 'content';\n                    args.scrollTop = { top: _this.contentRenderer[content].scrollTop };\n                }\n                if (!isInfiniteDelete) {\n                    if (_this.parent.enableImmutableMode) {\n                        _this.contentRenderer.immutableModeRendering(args);\n                    }\n                    else {\n                        _this.contentRenderer.refreshContentRows(args);\n                    }\n                }\n                else {\n                    _this.parent.notify(events.infiniteEditHandler, { e: args, result: e.result, count: e.count, agg: e.aggregates });\n                }\n            }\n            else {\n                if (args && args.isCaptionCollapse) {\n                    return;\n                }\n                if (!gObj.getColumns().length) {\n                    gObj.element.innerHTML = '';\n                    alert(_this.l10n.getConstant('EmptyDataSourceError')); //ToDO: change this alert as dialog\n                    return;\n                }\n                _this.contentRenderer.setRowElements([]);\n                _this.contentRenderer.setRowObjects([]);\n                _this.ariaService.setBusy(_this.parent.getContent().querySelector('.' + literals.content), false);\n                _this.renderEmptyRow();\n                if (args) {\n                    var action = (args.requestType || '').toLowerCase() + '-complete';\n                    _this.parent.notify(action, args);\n                    if (args.requestType === 'batchsave') {\n                        args.cancel = false;\n                        args.rows = [];\n                        args.isFrozen = _this.parent.getFrozenColumns() !== 0 && !args.isFrozen;\n                        _this.parent.trigger(events.actionComplete, args);\n                    }\n                }\n                _this.parent.hideSpinner();\n            }\n            _this.parent.notify(events.toolbarRefresh, {});\n            _this.setRowCount(_this.parent.getCurrentViewRecords().length);\n            _this.parent.getDataModule().isQueryInvokedFromData = false;\n        });\n    };\n    /**\n     * @param {object} e - specifies the object\n     * @param {Object[]} e.result - specifies the result\n     * @param {NotifyArgs} args - specifies the args\n     * @returns {void}\n     * @hidden\n     */\n    Render.prototype.dataManagerFailure = function (e, args) {\n        this.ariaService.setOptions(this.parent.getContent().querySelector('.' + literals.content), { busy: false, invalid: true });\n        this.setRowCount(1);\n        this.parent.trigger(events.actionFailure, { error: e });\n        this.parent.hideSpinner();\n        if (args.requestType === 'save' || args.requestType === 'delete'\n            || args.name === 'bulk-save') {\n            return;\n        }\n        this.parent.currentViewData = [];\n        this.renderEmptyRow();\n        this.parent.log('actionfailure', { error: e });\n    };\n    Render.prototype.setRowCount = function (dataRowCount) {\n        this.ariaService.setOptions(this.parent.getHeaderTable(), {\n            rowcount: dataRowCount ? dataRowCount.toString() : '1'\n        });\n    };\n    Render.prototype.isInfiniteEnd = function (args) {\n        return this.parent.enableInfiniteScrolling && !this.parent.infiniteScrollSettings.enableCache && args.requestType === 'delete';\n    };\n    Render.prototype.updatesOnInitialRender = function (e) {\n        this.isLayoutRendered = true;\n        if (this.parent.columns.length < 1) {\n            this.buildColumns(e.result[0]);\n        }\n        prepareColumns(this.parent.columns, null, this.parent);\n        this.headerRenderer.renderTable();\n        this.contentRenderer.renderTable();\n        this.parent.isAutoGen = true;\n        this.parent.notify(events.autoCol, {});\n    };\n    Render.prototype.iterateComplexColumns = function (obj, field, split) {\n        var keys = Object.keys(obj);\n        for (var i = 0; i < keys.length; i++) {\n            var childKeys = typeof obj[keys[i]] === 'object' && obj[keys[i]] && !(obj[keys[i]] instanceof Date) ?\n                Object.keys(obj[keys[i]]) : [];\n            if (childKeys.length) {\n                this.iterateComplexColumns(obj[keys[i]], field + (keys[i] + '.'), split);\n            }\n            else {\n                split[this.counter] = field + keys[i];\n                this.counter++;\n            }\n        }\n    };\n    Render.prototype.buildColumns = function (record) {\n        var cols = [];\n        var complexCols = {};\n        this.iterateComplexColumns(record, '', complexCols);\n        var columns = Object.keys(complexCols).filter(function (e) { return complexCols[e] !== 'BlazId'; }).\n            map(function (field) { return complexCols[field]; });\n        for (var i = 0, len = columns.length; i < len; i++) {\n            cols[i] = { 'field': columns[i] };\n            if (this.parent.enableColumnVirtualization) {\n                cols[i].width = !isNullOrUndefined(cols[i].width) ? cols[i].width : 200;\n            }\n        }\n        this.parent.setProperties({ 'columns': cols }, true);\n    };\n    Render.prototype.instantiateRenderer = function () {\n        this.renderer.addRenderer(RenderType.Header, new HeaderRender(this.parent, this.locator));\n        this.renderer.addRenderer(RenderType.Content, new ContentRender(this.parent, this.locator));\n        var cellrender = this.locator.getService('cellRendererFactory');\n        cellrender.addCellRenderer(CellType.Header, new HeaderCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.Data, new CellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.StackedHeader, new StackedHeaderCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.Indent, new IndentCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.GroupCaption, new GroupCaptionCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.GroupCaptionEmpty, new GroupCaptionEmptyCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.Expand, new ExpandCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.HeaderIndent, new HeaderIndentCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.StackedHeader, new StackedHeaderCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.DetailHeader, new DetailHeaderIndentCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.RowDragHIcon, new RowDragDropHeaderRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.DetailExpand, new DetailExpandCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.DetailFooterIntent, new IndentCellRenderer(this.parent, this.locator));\n        cellrender.addCellRenderer(CellType.RowDragIcon, new RowDragDropRenderer(this.parent, this.locator));\n    };\n    Render.prototype.addEventListener = function () {\n        var _this = this;\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.initialLoad, this.instantiateRenderer, this);\n        this.parent.on('refreshdataSource', this.dataManagerSuccess, this);\n        this.parent.on(events.modelChanged, this.refresh, this);\n        this.parent.on(events.refreshComplete, this.refreshComplete, this);\n        this.parent.on(events.bulkSave, this.sendBulkRequest, this);\n        this.parent.on(events.showEmptyGrid, function () { _this.emptyGrid = true; }, this);\n        this.parent.on(events.autoCol, this.dynamicColumnChange, this);\n    };\n    /**\n     * @param {ReturnType} e - specifies the Return type\n     * @returns {Promise<Object>} returns the object\n     * @hidden\n     */\n    Render.prototype.validateGroupRecords = function (e) {\n        var _this = this;\n        var index = e.result.length - 1;\n        if (index < 0) {\n            return Promise.resolve(e);\n        }\n        var group0 = e.result[0];\n        var groupN = e.result[index];\n        var predicate = [];\n        var addWhere = function (input) {\n            var groups = [group0, groupN];\n            for (var i = 0; i < groups.length; i++) {\n                predicate.push(new Predicate('field', '==', groups[i].field).and(_this.getPredicate('key', 'equal', groups[i].key)));\n            }\n            input.where(Predicate.or(predicate));\n        };\n        var query = new Query();\n        addWhere(query);\n        var curDm = new DataManager(e.result);\n        var curFilter = curDm.executeLocal(query);\n        var newQuery = this.data.generateQuery(true);\n        var rPredicate = [];\n        if (this.data.isRemote()) {\n            var groups = [group0, groupN];\n            for (var i = 0; i < groups.length; i++) {\n                rPredicate.push(this.getPredicate(groups[i].field, 'equal', groups[i].key));\n            }\n            newQuery.where(Predicate.or(rPredicate));\n        }\n        else {\n            addWhere(newQuery);\n        }\n        var deferred = new Deferred();\n        this.data.getData({}, newQuery).then(function (r) {\n            _this.updateGroupInfo(curFilter, r.result);\n            deferred.resolve(e);\n        }).catch(function (e) { return deferred.reject(e); });\n        return deferred.promise;\n    };\n    Render.prototype.getPredicate = function (key, operator, value) {\n        if (value instanceof Date) {\n            return getDatePredicate({ field: key, operator: operator, value: value });\n        }\n        return new Predicate(key, operator, value);\n    };\n    Render.prototype.updateGroupInfo = function (current, untouched) {\n        var dm = new DataManager(untouched);\n        var elements = current;\n        for (var i = 0; i < elements.length; i++) {\n            var uGroup = dm.executeLocal(new Query()\n                .where(new Predicate('field', '==', elements[i].field).and(this.getPredicate('key', 'equal', elements[i].key))))[0];\n            elements[i].count = uGroup.count;\n            var itemGroup = elements[i].items;\n            var uGroupItem = uGroup.items;\n            if (itemGroup.GroupGuid) {\n                elements[i].items = this.updateGroupInfo(elements[i].items, uGroup.items);\n            }\n            var rows = this.parent.aggregates;\n            for (var j = 0; j < rows.length; j++) {\n                var row = rows[j];\n                for (var k = 0; k < row.columns.length; k++) {\n                    var types = row.columns[k].type instanceof Array ? (row.columns[k].type) :\n                        [(row.columns[k].type)];\n                    for (var l = 0; l < types.length; l++) {\n                        var key = row.columns[k].field + ' - ' + types[l].toLowerCase();\n                        var data = itemGroup.level ? uGroupItem.records : uGroup.items;\n                        var context = this.parent;\n                        if (types[l] === 'Custom') {\n                            var data_1 = itemGroup.level ? uGroupItem : uGroup;\n                            var temp = row.columns[k].customAggregate;\n                            if (typeof temp === 'string') {\n                                temp = getValue(temp, window);\n                            }\n                            elements[i].aggregates[key] = temp ? temp.call(context, data_1, row.columns[k]) : '';\n                        }\n                        else {\n                            // eslint-disable-next-line max-len\n                            elements[i].aggregates[key] = DataUtil.aggregates[types[l].toLowerCase()](data, row.columns[k].field);\n                        }\n                    }\n                }\n            }\n        }\n        return current;\n    };\n    return Render;\n}());\nexport { Render };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}