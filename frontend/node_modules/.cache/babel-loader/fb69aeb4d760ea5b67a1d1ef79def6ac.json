{"ast":null,"code":"import * as EVENTS from './../../common/constant';\nimport { isNullOrUndefined as isNOU, detach, createElement, closest } from '@syncfusion/ej2-base';\nimport { isIDevice, setEditFrameFocus } from '../../common/util';\nimport { markerClassName } from './dom-node';\nimport { NodeCutter } from './nodecutter';\n/**\n * Formats internal component\n *\n * @hidden\n\n */\n\nvar Formats =\n/** @class */\nfunction () {\n  /**\n   * Constructor for creating the Formats plugin\n   *\n   * @param {EditorManager} parent - specifies the parent element.\n   * @hidden\n    */\n  function Formats(parent) {\n    this.parent = parent;\n    this.addEventListener();\n  }\n\n  Formats.prototype.addEventListener = function () {\n    this.parent.observer.on(EVENTS.FORMAT_TYPE, this.applyFormats, this);\n    this.parent.observer.on(EVENTS.KEY_UP_HANDLER, this.onKeyUp, this);\n    this.parent.observer.on(EVENTS.KEY_DOWN_HANDLER, this.onKeyDown, this);\n  };\n\n  Formats.prototype.getParentNode = function (node) {\n    for (; node.parentNode && node.parentNode !== this.parent.editableElement; null) {\n      node = node.parentNode;\n    }\n\n    return node;\n  };\n\n  Formats.prototype.onKeyUp = function (e) {\n    var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n    var endCon = range.endContainer;\n    var lastChild = endCon.lastChild;\n\n    if (e.event.which === 13 && range.startContainer === endCon && endCon.nodeType !== 3) {\n      var pTag = createElement('p');\n      pTag.innerHTML = '<br>';\n\n      if (!isNOU(lastChild) && lastChild && lastChild.nodeName === 'BR' && lastChild.previousSibling && lastChild.previousSibling.nodeName === 'TABLE') {\n        endCon.replaceChild(pTag, lastChild);\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 0);\n      } else {\n        var brNode = this.parent.nodeSelection.getSelectionNodeCollectionBr(range)[0];\n\n        if (!isNOU(brNode) && brNode.nodeName === 'BR' && brNode.previousSibling && brNode.previousSibling.nodeName === 'TABLE') {\n          endCon.replaceChild(pTag, brNode);\n          this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 0);\n        }\n      }\n    }\n  };\n\n  Formats.prototype.onKeyDown = function (e) {\n    if (e.event.which === 13) {\n      var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n      var startCon = range.startContainer.textContent.length === 0 || range.startContainer.nodeName === 'PRE' ? range.startContainer : range.startContainer.parentElement;\n      var endCon = range.endContainer.textContent.length === 0 || range.endContainer.nodeName === 'PRE' ? range.endContainer : range.endContainer.parentElement;\n      var preElem = closest(startCon, 'pre');\n      var endPreElem = closest(endCon, 'pre');\n      var liParent = !isNOU(preElem) && !isNOU(preElem.parentElement) && preElem.parentElement.tagName === 'LI';\n\n      if (liParent) {\n        return;\n      }\n\n      if (isNOU(preElem) && !isNOU(endPreElem) || !isNOU(preElem) && isNOU(endPreElem)) {\n        e.event.preventDefault();\n        this.deleteContent(range);\n        this.removeCodeContent(range);\n        range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, endCon, 0);\n      }\n\n      if (e.event.which === 13 && !isNOU(preElem) && !isNOU(endPreElem)) {\n        e.event.preventDefault();\n        this.deleteContent(range);\n        this.removeCodeContent(range);\n        range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        var lastEmpty = range.startContainer.childNodes[range.endOffset];\n        var lastBeforeBr = range.startContainer.childNodes[range.endOffset - 1];\n        var startParent = range.startContainer;\n\n        if (!isNOU(lastEmpty) && !isNOU(lastBeforeBr) && isNOU(lastEmpty.nextSibling) && lastEmpty.nodeName === 'BR' && lastBeforeBr.nodeName === 'BR') {\n          this.paraFocus(range.startContainer, e.enterAction);\n        } else if (startParent.textContent.charCodeAt(0) === 8203 && startParent.textContent.length === 1 || startParent.textContent.length === 0) {\n          //Double enter with any parent tag for the node\n          while (startParent.parentElement.nodeName !== 'PRE' && (startParent.textContent.length === 1 || startParent.textContent.length === 0)) {\n            startParent = startParent.parentElement;\n          }\n\n          if (!isNOU(startParent.previousSibling) && startParent.previousSibling.nodeName === 'BR' && isNOU(startParent.nextSibling)) {\n            this.paraFocus(startParent.parentElement);\n          } else {\n            this.isNotEndCursor(preElem, range);\n          }\n        } else {\n          //Cursor at start and middle\n          this.isNotEndCursor(preElem, range);\n        }\n      }\n    }\n  };\n\n  Formats.prototype.removeCodeContent = function (range) {\n    var regEx = new RegExp(String.fromCharCode(65279), 'g');\n\n    if (!isNOU(range.endContainer.textContent.match(regEx))) {\n      var pointer = range.endContainer.textContent.charCodeAt(range.endOffset - 1) === 65279 ? range.endOffset - 2 : range.endOffset;\n      range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n\n      if (range.endContainer.textContent === '') {\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, range.endContainer.parentElement, 0);\n      } else {\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, range.endContainer, pointer);\n      }\n    }\n  };\n\n  Formats.prototype.deleteContent = function (range) {\n    if (range.startContainer !== range.endContainer || range.startOffset !== range.endOffset) {\n      range.deleteContents();\n    }\n  };\n\n  Formats.prototype.paraFocus = function (referNode, enterAction) {\n    var insertTag;\n\n    if (enterAction === 'DIV') {\n      insertTag = createElement('div');\n      insertTag.innerHTML = '<br>';\n    } else if (enterAction === 'BR') {\n      insertTag = createElement('br');\n    } else {\n      insertTag = createElement('p');\n      insertTag.innerHTML = '<br>';\n    }\n\n    this.parent.domNode.insertAfter(insertTag, referNode);\n    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, insertTag, 0);\n    detach(referNode.lastChild);\n  };\n\n  Formats.prototype.isNotEndCursor = function (preElem, range) {\n    var nodeCutter = new NodeCutter();\n    var isEnd = range.startOffset === preElem.lastChild.textContent.length && preElem.lastChild.textContent === range.startContainer.textContent; //Cursor at start point\n\n    if (preElem.textContent.indexOf(range.startContainer.textContent) === 0 && (range.startOffset === 0 && range.endOffset === 0 || range.startContainer.nodeName === 'PRE')) {\n      this.insertMarker(preElem, range);\n      var brTag = createElement('br');\n      preElem.childNodes[range.endOffset].parentElement.insertBefore(brTag, preElem.childNodes[range.endOffset]);\n    } else {\n      //Cursor at middle\n      var cloneNode = nodeCutter.SplitNode(range, preElem, true);\n      this.insertMarker(preElem, range);\n      var previousSib = preElem.previousElementSibling;\n\n      if (previousSib.tagName === 'PRE') {\n        previousSib.insertAdjacentHTML('beforeend', '<br>' + cloneNode.innerHTML);\n        detach(preElem);\n      }\n    } //To place the cursor position\n\n\n    this.setCursorPosition(isEnd, preElem);\n  };\n\n  Formats.prototype.setCursorPosition = function (isEnd, preElem) {\n    var isEmpty = false;\n    var markerElem = this.parent.editableElement.querySelector('.tempSpan');\n    var mrkParentElem = markerElem.parentElement; // eslint-disable-next-line\n\n    markerElem.parentNode.textContent === '' ? isEmpty = true : this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n\n    if (isEnd) {\n      if (isEmpty) {\n        //Enter press when pre element is empty\n        if (mrkParentElem === preElem) {\n          this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n          detach(markerElem);\n        } else {\n          this.focusSelectionParent(markerElem, mrkParentElem);\n        }\n      } else {\n        var brElm = createElement('br');\n        this.parent.domNode.insertAfter(brElm, markerElem);\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n        detach(markerElem);\n      }\n    } else {\n      // eslint-disable-next-line\n      isEmpty ? this.focusSelectionParent(markerElem, mrkParentElem) : detach(markerElem);\n    }\n  };\n\n  Formats.prototype.focusSelectionParent = function (markerElem, tempSpanPElem) {\n    detach(markerElem);\n    tempSpanPElem.innerHTML = '\\u200B';\n    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, tempSpanPElem, 0);\n  };\n\n  Formats.prototype.insertMarker = function (preElem, range) {\n    var tempSpan = createElement('span', {\n      className: 'tempSpan'\n    });\n\n    if (range.startContainer.nodeName === 'PRE') {\n      preElem.childNodes[range.endOffset].parentElement.insertBefore(tempSpan, preElem.childNodes[range.endOffset]);\n    } else {\n      range.startContainer.parentElement.insertBefore(tempSpan, range.startContainer);\n    }\n  };\n\n  Formats.prototype.applyFormats = function (e) {\n    var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n    var isSelectAll = false;\n\n    if (this.parent.editableElement === range.endContainer && !isNOU(this.parent.editableElement.children[range.endOffset - 1]) && this.parent.editableElement.children[range.endOffset - 1].tagName === 'TABLE' && !range.collapsed) {\n      isSelectAll = true;\n    }\n\n    var save = this.parent.nodeSelection.save(range, this.parent.currentDocument);\n    this.parent.domNode.setMarker(save);\n    var formatsNodes = this.parent.domNode.blockNodes();\n\n    if (e.enterAction === 'BR') {\n      this.setSelectionBRConfig();\n      var allSelectedNode = this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument);\n      var selectedNodes = this.parent.nodeSelection.getSelectionNodes(allSelectedNode);\n      var currentFormatNodes = [];\n\n      if (selectedNodes.length === 0) {\n        selectedNodes.push(formatsNodes[0]);\n      }\n\n      for (var i = 0; i < selectedNodes.length; i++) {\n        var currentNode = selectedNodes[i];\n        var previousCurrentNode = void 0;\n\n        while (!this.parent.domNode.isBlockNode(currentNode) && currentNode !== this.parent.editableElement) {\n          previousCurrentNode = currentNode;\n          currentNode = currentNode.parentElement;\n        }\n\n        if (this.parent.domNode.isBlockNode(currentNode) && currentNode === this.parent.editableElement) {\n          currentFormatNodes.push(previousCurrentNode);\n        }\n      }\n\n      for (var i = 0; i < currentFormatNodes.length; i++) {\n        if (!this.parent.domNode.isBlockNode(currentFormatNodes[i])) {\n          var currentNode = currentFormatNodes[i];\n          var previousNode = currentNode;\n\n          while (currentNode === this.parent.editableElement) {\n            previousNode = currentNode;\n            currentNode = currentNode.parentElement;\n          }\n\n          var tempElem = void 0;\n\n          if (this.parent.domNode.isBlockNode(previousNode.parentElement) && previousNode.parentElement === this.parent.editableElement) {\n            tempElem = createElement('div');\n            previousNode.parentElement.insertBefore(tempElem, previousNode);\n            tempElem.appendChild(previousNode);\n          } else {\n            tempElem = previousNode;\n          }\n\n          var preNode = tempElem.previousSibling;\n\n          while (!isNOU(preNode) && preNode.nodeName !== 'BR' && !this.parent.domNode.isBlockNode(preNode)) {\n            tempElem.firstChild.parentElement.insertBefore(preNode, tempElem.firstChild);\n            preNode = tempElem.previousSibling;\n          }\n\n          if (!isNOU(preNode) && preNode.nodeName === 'BR') {\n            detach(preNode);\n          }\n\n          var postNode = tempElem.nextSibling;\n\n          while (!isNOU(postNode) && postNode.nodeName !== 'BR' && !this.parent.domNode.isBlockNode(postNode)) {\n            tempElem.appendChild(postNode);\n            postNode = tempElem.nextSibling;\n          }\n\n          if (!isNOU(postNode) && postNode.nodeName === 'BR') {\n            detach(postNode);\n          }\n        }\n      }\n\n      this.setSelectionBRConfig();\n      formatsNodes = this.parent.domNode.blockNodes();\n    }\n\n    for (var i = 0; i < formatsNodes.length; i++) {\n      var parentNode = void 0;\n      var replaceHTML = void 0;\n\n      if (e.subCommand.toLowerCase() === 'blockquote') {\n        parentNode = this.getParentNode(formatsNodes[i]);\n        replaceHTML = this.parent.domNode.isList(parentNode) || parentNode.tagName === 'TABLE' ? parentNode.outerHTML : parentNode.innerHTML;\n      } else {\n        parentNode = formatsNodes[i];\n        replaceHTML = parentNode.innerHTML;\n      }\n\n      if (e.subCommand.toLowerCase() === parentNode.tagName.toLowerCase() && (e.subCommand.toLowerCase() !== 'pre' || !isNOU(e.exeValue) && e.exeValue.name === 'dropDownSelect') || isNOU(parentNode.parentNode) || parentNode.tagName === 'TABLE' && e.subCommand.toLowerCase() === 'pre') {\n        continue;\n      }\n\n      this.cleanFormats(parentNode, e.subCommand);\n      var replaceNode = e.subCommand.toLowerCase() === 'pre' && parentNode.tagName.toLowerCase() === 'pre' ? 'p' : e.subCommand;\n      var replaceTag = this.parent.domNode.createTagString(replaceNode, parentNode, replaceHTML.replace(/>\\s+</g, '><'));\n\n      if (parentNode.tagName === 'LI') {\n        parentNode.innerHTML = '';\n        parentNode.insertAdjacentHTML('beforeend', replaceTag);\n      } else {\n        this.parent.domNode.replaceWith(parentNode, replaceTag);\n      }\n    }\n\n    this.preFormatMerge();\n    var startNode = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n    var endNode = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n\n    if (!isNOU(startNode) && !isNOU(endNode)) {\n      startNode = startNode.lastChild;\n      endNode = endNode.lastChild;\n    }\n\n    save = this.parent.domNode.saveMarker(save, null);\n\n    if (isIDevice()) {\n      setEditFrameFocus(this.parent.editableElement, e.selector);\n    }\n\n    if (isSelectAll) {\n      this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startNode, endNode, 0, endNode.textContent.length);\n    } else {\n      save.restore();\n    }\n\n    if (e.callBack) {\n      e.callBack({\n        requestType: e.subCommand,\n        editorMode: 'HTML',\n        event: e.event,\n        range: this.parent.nodeSelection.getRange(this.parent.currentDocument),\n        elements: this.parent.domNode.blockNodes()\n      });\n    }\n  };\n\n  Formats.prototype.setSelectionBRConfig = function () {\n    var startElem = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n    var endElem = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n\n    if (isNOU(endElem)) {\n      this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, startElem, 0);\n    } else {\n      this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startElem, endElem, 0, 0);\n    }\n  };\n\n  Formats.prototype.preFormatMerge = function () {\n    var preNodes = this.parent.editableElement.querySelectorAll('PRE');\n\n    if (!isNOU(preNodes)) {\n      for (var i = 0; i < preNodes.length; i++) {\n        var previousSib = preNodes[i].previousElementSibling;\n\n        if (!isNOU(previousSib) && previousSib.tagName === 'PRE') {\n          previousSib.insertAdjacentHTML('beforeend', '<br>' + preNodes[i].innerHTML);\n          detach(preNodes[i]);\n        }\n      }\n    }\n  };\n\n  Formats.prototype.cleanFormats = function (element, tagName) {\n    var ignoreAttr = ['display', 'font-size', 'margin-top', 'margin-bottom', 'margin-left', 'margin-right', 'font-weight'];\n    tagName = tagName.toLowerCase();\n\n    for (var i = 0; i < ignoreAttr.length && tagName !== 'p' && tagName !== 'blockquote' && tagName !== 'pre'; i++) {\n      element.style.removeProperty(ignoreAttr[i]);\n    }\n  };\n\n  return Formats;\n}();\n\nexport { Formats };","map":{"version":3,"names":["EVENTS","isNullOrUndefined","isNOU","detach","createElement","closest","isIDevice","setEditFrameFocus","markerClassName","NodeCutter","Formats","parent","addEventListener","prototype","observer","on","FORMAT_TYPE","applyFormats","KEY_UP_HANDLER","onKeyUp","KEY_DOWN_HANDLER","onKeyDown","getParentNode","node","parentNode","editableElement","e","range","nodeSelection","getRange","currentDocument","endCon","endContainer","lastChild","event","which","startContainer","nodeType","pTag","innerHTML","nodeName","previousSibling","replaceChild","setCursorPoint","brNode","getSelectionNodeCollectionBr","startCon","textContent","length","parentElement","preElem","endPreElem","liParent","tagName","preventDefault","deleteContent","removeCodeContent","lastEmpty","childNodes","endOffset","lastBeforeBr","startParent","nextSibling","paraFocus","enterAction","charCodeAt","isNotEndCursor","regEx","RegExp","String","fromCharCode","match","pointer","replace","startOffset","deleteContents","referNode","insertTag","domNode","insertAfter","nodeCutter","isEnd","indexOf","insertMarker","brTag","insertBefore","cloneNode","SplitNode","previousSib","previousElementSibling","insertAdjacentHTML","setCursorPosition","isEmpty","markerElem","querySelector","mrkParentElem","focusSelectionParent","brElm","tempSpanPElem","tempSpan","className","isSelectAll","children","collapsed","save","setMarker","formatsNodes","blockNodes","setSelectionBRConfig","allSelectedNode","getSelectedNodes","selectedNodes","getSelectionNodes","currentFormatNodes","push","i","currentNode","previousCurrentNode","isBlockNode","previousNode","tempElem","appendChild","preNode","firstChild","postNode","replaceHTML","subCommand","toLowerCase","isList","outerHTML","exeValue","name","cleanFormats","replaceNode","replaceTag","createTagString","replaceWith","preFormatMerge","startNode","startSelection","endNode","endSelection","saveMarker","selector","setSelectionText","restore","callBack","requestType","editorMode","elements","startElem","endElem","preNodes","querySelectorAll","element","ignoreAttr","style","removeProperty"],"sources":["C:/Users/shahj/OneDrive/Documents/GitHub/Multifunctional-React-Dashboard/node_modules/@syncfusion/ej2-richtexteditor/src/editor-manager/plugin/formats.js"],"sourcesContent":["import * as EVENTS from './../../common/constant';\nimport { isNullOrUndefined as isNOU, detach, createElement, closest } from '@syncfusion/ej2-base';\nimport { isIDevice, setEditFrameFocus } from '../../common/util';\nimport { markerClassName } from './dom-node';\nimport { NodeCutter } from './nodecutter';\n/**\n * Formats internal component\n *\n * @hidden\n\n */\nvar Formats = /** @class */ (function () {\n    /**\n     * Constructor for creating the Formats plugin\n     *\n     * @param {EditorManager} parent - specifies the parent element.\n     * @hidden\n\n     */\n    function Formats(parent) {\n        this.parent = parent;\n        this.addEventListener();\n    }\n    Formats.prototype.addEventListener = function () {\n        this.parent.observer.on(EVENTS.FORMAT_TYPE, this.applyFormats, this);\n        this.parent.observer.on(EVENTS.KEY_UP_HANDLER, this.onKeyUp, this);\n        this.parent.observer.on(EVENTS.KEY_DOWN_HANDLER, this.onKeyDown, this);\n    };\n    Formats.prototype.getParentNode = function (node) {\n        for (; node.parentNode && node.parentNode !== this.parent.editableElement; null) {\n            node = node.parentNode;\n        }\n        return node;\n    };\n    Formats.prototype.onKeyUp = function (e) {\n        var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        var endCon = range.endContainer;\n        var lastChild = endCon.lastChild;\n        if (e.event.which === 13 && range.startContainer === endCon && endCon.nodeType !== 3) {\n            var pTag = createElement('p');\n            pTag.innerHTML = '<br>';\n            if (!isNOU(lastChild) && lastChild && lastChild.nodeName === 'BR' && (lastChild.previousSibling && lastChild.previousSibling.nodeName === 'TABLE')) {\n                endCon.replaceChild(pTag, lastChild);\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 0);\n            }\n            else {\n                var brNode = this.parent.nodeSelection.getSelectionNodeCollectionBr(range)[0];\n                if (!isNOU(brNode) && brNode.nodeName === 'BR' && (brNode.previousSibling && brNode.previousSibling.nodeName === 'TABLE')) {\n                    endCon.replaceChild(pTag, brNode);\n                    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, pTag, 0);\n                }\n            }\n        }\n    };\n    Formats.prototype.onKeyDown = function (e) {\n        if (e.event.which === 13) {\n            var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n            var startCon = (range.startContainer.textContent.length === 0 || range.startContainer.nodeName === 'PRE')\n                ? range.startContainer : range.startContainer.parentElement;\n            var endCon = (range.endContainer.textContent.length === 0 || range.endContainer.nodeName === 'PRE')\n                ? range.endContainer : range.endContainer.parentElement;\n            var preElem = closest(startCon, 'pre');\n            var endPreElem = closest(endCon, 'pre');\n            var liParent = !isNOU(preElem) && !isNOU(preElem.parentElement) && preElem.parentElement.tagName === 'LI';\n            if (liParent) {\n                return;\n            }\n            if (((isNOU(preElem) && !isNOU(endPreElem)) || (!isNOU(preElem) && isNOU(endPreElem)))) {\n                e.event.preventDefault();\n                this.deleteContent(range);\n                this.removeCodeContent(range);\n                range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, endCon, 0);\n            }\n            if (e.event.which === 13 && !isNOU(preElem) && !isNOU(endPreElem)) {\n                e.event.preventDefault();\n                this.deleteContent(range);\n                this.removeCodeContent(range);\n                range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n                var lastEmpty = range.startContainer.childNodes[range.endOffset];\n                var lastBeforeBr = range.startContainer.childNodes[range.endOffset - 1];\n                var startParent = range.startContainer;\n                if (!isNOU(lastEmpty) && !isNOU(lastBeforeBr) && isNOU(lastEmpty.nextSibling) &&\n                    lastEmpty.nodeName === 'BR' && lastBeforeBr.nodeName === 'BR') {\n                    this.paraFocus(range.startContainer, e.enterAction);\n                }\n                else if ((startParent.textContent.charCodeAt(0) === 8203 &&\n                    startParent.textContent.length === 1) || startParent.textContent.length === 0) {\n                    //Double enter with any parent tag for the node\n                    while (startParent.parentElement.nodeName !== 'PRE' &&\n                        (startParent.textContent.length === 1 || startParent.textContent.length === 0)) {\n                        startParent = startParent.parentElement;\n                    }\n                    if (!isNOU(startParent.previousSibling) && startParent.previousSibling.nodeName === 'BR' &&\n                        isNOU(startParent.nextSibling)) {\n                        this.paraFocus(startParent.parentElement);\n                    }\n                    else {\n                        this.isNotEndCursor(preElem, range);\n                    }\n                }\n                else {\n                    //Cursor at start and middle\n                    this.isNotEndCursor(preElem, range);\n                }\n            }\n        }\n    };\n    Formats.prototype.removeCodeContent = function (range) {\n        var regEx = new RegExp(String.fromCharCode(65279), 'g');\n        if (!isNOU(range.endContainer.textContent.match(regEx))) {\n            var pointer = range.endContainer.textContent.charCodeAt(range.endOffset - 1) === 65279 ?\n                range.endOffset - 2 : range.endOffset;\n            range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n            if (range.endContainer.textContent === '') {\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, range.endContainer.parentElement, 0);\n            }\n            else {\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, range.endContainer, pointer);\n            }\n        }\n    };\n    Formats.prototype.deleteContent = function (range) {\n        if (range.startContainer !== range.endContainer || range.startOffset !== range.endOffset) {\n            range.deleteContents();\n        }\n    };\n    Formats.prototype.paraFocus = function (referNode, enterAction) {\n        var insertTag;\n        if (enterAction === 'DIV') {\n            insertTag = createElement('div');\n            insertTag.innerHTML = '<br>';\n        }\n        else if (enterAction === 'BR') {\n            insertTag = createElement('br');\n        }\n        else {\n            insertTag = createElement('p');\n            insertTag.innerHTML = '<br>';\n        }\n        this.parent.domNode.insertAfter(insertTag, referNode);\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, insertTag, 0);\n        detach(referNode.lastChild);\n    };\n    Formats.prototype.isNotEndCursor = function (preElem, range) {\n        var nodeCutter = new NodeCutter();\n        var isEnd = range.startOffset === preElem.lastChild.textContent.length &&\n            preElem.lastChild.textContent === range.startContainer.textContent;\n        //Cursor at start point\n        if (preElem.textContent.indexOf(range.startContainer.textContent) === 0 &&\n            ((range.startOffset === 0 && range.endOffset === 0) || range.startContainer.nodeName === 'PRE')) {\n            this.insertMarker(preElem, range);\n            var brTag = createElement('br');\n            preElem.childNodes[range.endOffset].parentElement.insertBefore(brTag, preElem.childNodes[range.endOffset]);\n        }\n        else {\n            //Cursor at middle\n            var cloneNode = nodeCutter.SplitNode(range, preElem, true);\n            this.insertMarker(preElem, range);\n            var previousSib = preElem.previousElementSibling;\n            if (previousSib.tagName === 'PRE') {\n                previousSib.insertAdjacentHTML('beforeend', '<br>' + cloneNode.innerHTML);\n                detach(preElem);\n            }\n        }\n        //To place the cursor position\n        this.setCursorPosition(isEnd, preElem);\n    };\n    Formats.prototype.setCursorPosition = function (isEnd, preElem) {\n        var isEmpty = false;\n        var markerElem = this.parent.editableElement.querySelector('.tempSpan');\n        var mrkParentElem = markerElem.parentElement;\n        // eslint-disable-next-line\n        markerElem.parentNode.textContent === '' ? isEmpty = true :\n            this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n        if (isEnd) {\n            if (isEmpty) {\n                //Enter press when pre element is empty\n                if (mrkParentElem === preElem) {\n                    this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n                    detach(markerElem);\n                }\n                else {\n                    this.focusSelectionParent(markerElem, mrkParentElem);\n                }\n            }\n            else {\n                var brElm = createElement('br');\n                this.parent.domNode.insertAfter(brElm, markerElem);\n                this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, markerElem, 0);\n                detach(markerElem);\n            }\n        }\n        else {\n            // eslint-disable-next-line\n            isEmpty ? this.focusSelectionParent(markerElem, mrkParentElem) : detach(markerElem);\n        }\n    };\n    Formats.prototype.focusSelectionParent = function (markerElem, tempSpanPElem) {\n        detach(markerElem);\n        tempSpanPElem.innerHTML = '\\u200B';\n        this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, tempSpanPElem, 0);\n    };\n    Formats.prototype.insertMarker = function (preElem, range) {\n        var tempSpan = createElement('span', { className: 'tempSpan' });\n        if (range.startContainer.nodeName === 'PRE') {\n            preElem.childNodes[range.endOffset].parentElement.insertBefore(tempSpan, preElem.childNodes[range.endOffset]);\n        }\n        else {\n            range.startContainer.parentElement.insertBefore(tempSpan, range.startContainer);\n        }\n    };\n    Formats.prototype.applyFormats = function (e) {\n        var range = this.parent.nodeSelection.getRange(this.parent.currentDocument);\n        var isSelectAll = false;\n        if (this.parent.editableElement === range.endContainer &&\n            !isNOU(this.parent.editableElement.children[range.endOffset - 1]) &&\n            this.parent.editableElement.children[range.endOffset - 1].tagName === 'TABLE' && !range.collapsed) {\n            isSelectAll = true;\n        }\n        var save = this.parent.nodeSelection.save(range, this.parent.currentDocument);\n        this.parent.domNode.setMarker(save);\n        var formatsNodes = this.parent.domNode.blockNodes();\n        if (e.enterAction === 'BR') {\n            this.setSelectionBRConfig();\n            var allSelectedNode = this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument);\n            var selectedNodes = this.parent.nodeSelection.getSelectionNodes(allSelectedNode);\n            var currentFormatNodes = [];\n            if (selectedNodes.length === 0) {\n                selectedNodes.push(formatsNodes[0]);\n            }\n            for (var i = 0; i < selectedNodes.length; i++) {\n                var currentNode = selectedNodes[i];\n                var previousCurrentNode = void 0;\n                while (!this.parent.domNode.isBlockNode(currentNode) && currentNode !== this.parent.editableElement) {\n                    previousCurrentNode = currentNode;\n                    currentNode = currentNode.parentElement;\n                }\n                if (this.parent.domNode.isBlockNode(currentNode) && currentNode === this.parent.editableElement) {\n                    currentFormatNodes.push(previousCurrentNode);\n                }\n            }\n            for (var i = 0; i < currentFormatNodes.length; i++) {\n                if (!this.parent.domNode.isBlockNode(currentFormatNodes[i])) {\n                    var currentNode = currentFormatNodes[i];\n                    var previousNode = currentNode;\n                    while (currentNode === this.parent.editableElement) {\n                        previousNode = currentNode;\n                        currentNode = currentNode.parentElement;\n                    }\n                    var tempElem = void 0;\n                    if (this.parent.domNode.isBlockNode(previousNode.parentElement) &&\n                        previousNode.parentElement === this.parent.editableElement) {\n                        tempElem = createElement('div');\n                        previousNode.parentElement.insertBefore(tempElem, previousNode);\n                        tempElem.appendChild(previousNode);\n                    }\n                    else {\n                        tempElem = previousNode;\n                    }\n                    var preNode = tempElem.previousSibling;\n                    while (!isNOU(preNode) && preNode.nodeName !== 'BR' &&\n                        !this.parent.domNode.isBlockNode(preNode)) {\n                        tempElem.firstChild.parentElement.insertBefore(preNode, tempElem.firstChild);\n                        preNode = tempElem.previousSibling;\n                    }\n                    if (!isNOU(preNode) && preNode.nodeName === 'BR') {\n                        detach(preNode);\n                    }\n                    var postNode = tempElem.nextSibling;\n                    while (!isNOU(postNode) && postNode.nodeName !== 'BR' &&\n                        !this.parent.domNode.isBlockNode(postNode)) {\n                        tempElem.appendChild(postNode);\n                        postNode = tempElem.nextSibling;\n                    }\n                    if (!isNOU(postNode) && postNode.nodeName === 'BR') {\n                        detach(postNode);\n                    }\n                }\n            }\n            this.setSelectionBRConfig();\n            formatsNodes = this.parent.domNode.blockNodes();\n        }\n        for (var i = 0; i < formatsNodes.length; i++) {\n            var parentNode = void 0;\n            var replaceHTML = void 0;\n            if (e.subCommand.toLowerCase() === 'blockquote') {\n                parentNode = this.getParentNode(formatsNodes[i]);\n                replaceHTML = this.parent.domNode.isList(parentNode) ||\n                    parentNode.tagName === 'TABLE' ? parentNode.outerHTML : parentNode.innerHTML;\n            }\n            else {\n                parentNode = formatsNodes[i];\n                replaceHTML = parentNode.innerHTML;\n            }\n            if ((e.subCommand.toLowerCase() === parentNode.tagName.toLowerCase() &&\n                (e.subCommand.toLowerCase() !== 'pre' ||\n                    (!isNOU(e.exeValue) && e.exeValue.name === 'dropDownSelect'))) ||\n                isNOU(parentNode.parentNode) ||\n                (parentNode.tagName === 'TABLE' && e.subCommand.toLowerCase() === 'pre')) {\n                continue;\n            }\n            this.cleanFormats(parentNode, e.subCommand);\n            var replaceNode = (e.subCommand.toLowerCase() === 'pre' && parentNode.tagName.toLowerCase() === 'pre') ?\n                'p' : e.subCommand;\n            var replaceTag = this.parent.domNode.createTagString(replaceNode, parentNode, replaceHTML.replace(/>\\s+</g, '><'));\n            if (parentNode.tagName === 'LI') {\n                parentNode.innerHTML = '';\n                parentNode.insertAdjacentHTML('beforeend', replaceTag);\n            }\n            else {\n                this.parent.domNode.replaceWith(parentNode, replaceTag);\n            }\n        }\n        this.preFormatMerge();\n        var startNode = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n        var endNode = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n        if (!isNOU(startNode) && !isNOU(endNode)) {\n            startNode = startNode.lastChild;\n            endNode = endNode.lastChild;\n        }\n        save = this.parent.domNode.saveMarker(save, null);\n        if (isIDevice()) {\n            setEditFrameFocus(this.parent.editableElement, e.selector);\n        }\n        if (isSelectAll) {\n            this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startNode, endNode, 0, endNode.textContent.length);\n        }\n        else {\n            save.restore();\n        }\n        if (e.callBack) {\n            e.callBack({\n                requestType: e.subCommand,\n                editorMode: 'HTML',\n                event: e.event,\n                range: this.parent.nodeSelection.getRange(this.parent.currentDocument),\n                elements: this.parent.domNode.blockNodes()\n            });\n        }\n    };\n    Formats.prototype.setSelectionBRConfig = function () {\n        var startElem = this.parent.editableElement.querySelector('.' + markerClassName.startSelection);\n        var endElem = this.parent.editableElement.querySelector('.' + markerClassName.endSelection);\n        if (isNOU(endElem)) {\n            this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument, startElem, 0);\n        }\n        else {\n            this.parent.nodeSelection.setSelectionText(this.parent.currentDocument, startElem, endElem, 0, 0);\n        }\n    };\n    Formats.prototype.preFormatMerge = function () {\n        var preNodes = this.parent.editableElement.querySelectorAll('PRE');\n        if (!isNOU(preNodes)) {\n            for (var i = 0; i < preNodes.length; i++) {\n                var previousSib = preNodes[i].previousElementSibling;\n                if (!isNOU(previousSib) && previousSib.tagName === 'PRE') {\n                    previousSib.insertAdjacentHTML('beforeend', '<br>' + preNodes[i].innerHTML);\n                    detach(preNodes[i]);\n                }\n            }\n        }\n    };\n    Formats.prototype.cleanFormats = function (element, tagName) {\n        var ignoreAttr = ['display', 'font-size', 'margin-top', 'margin-bottom', 'margin-left', 'margin-right', 'font-weight'];\n        tagName = tagName.toLowerCase();\n        for (var i = 0; i < ignoreAttr.length && (tagName !== 'p' && tagName !== 'blockquote' && tagName !== 'pre'); i++) {\n            element.style.removeProperty(ignoreAttr[i]);\n        }\n    };\n    return Formats;\n}());\nexport { Formats };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}