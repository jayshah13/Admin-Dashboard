{"ast":null,"code":"import { addClass, detach, EventHandler, isNullOrUndefined, select, Ajax, formatUnit } from '@syncfusion/ej2-base';\nimport { Browser, closest, removeClass, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as classes from '../base/classes';\nimport { Uploader, TextBox } from '@syncfusion/ej2-inputs';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { Button, CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType } from '../base/enum';\nimport { dispatchEvent, parseHtml, hasClass, convertToBlob } from '../base/util';\nimport { isIDevice } from '../../common/util';\n/**\n * `Image` module is used to handle image actions.\n */\n\nvar Image =\n/** @class */\nfunction () {\n  function Image(parent, serviceLocator) {\n    this.isImgUploaded = false;\n    this.isAllowedTypes = true;\n    this.pageX = null;\n    this.pageY = null;\n    this.deletedImg = [];\n    this.parent = parent;\n    this.rteID = parent.element.id;\n    this.i10n = serviceLocator.getService('rteLocale');\n    this.rendererFactory = serviceLocator.getService('rendererFactory');\n    this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n    this.addEventListener();\n  }\n\n  Image.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.keyDown, this.onKeyDown, this);\n    this.parent.on(events.keyUp, this.onKeyUp, this);\n    this.parent.on(events.insertImage, this.insertImage, this);\n    this.parent.on(events.showImageDialog, this.showDialog, this);\n    this.parent.on(events.closeImageDialog, this.closeDialog, this);\n    this.parent.on(events.windowResize, this.onWindowResize, this);\n    this.parent.on(events.insertCompleted, this.showImageQuickToolbar, this);\n    this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n    this.parent.on(events.imageToolbarAction, this.onToolbarAction, this);\n    this.parent.on(events.imageCaption, this.caption, this);\n    this.parent.on(events.imageDelete, this.deleteImg, this);\n    this.parent.on(events.imageLink, this.insertImgLink, this);\n    this.parent.on(events.imageAlt, this.insertAltText, this);\n    this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n    this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n    this.parent.on(events.imageSize, this.imageSize, this);\n    this.parent.on(events.dropDownSelect, this.alignmentSelect, this);\n    this.parent.on(events.initialEnd, this.afterRender, this);\n    this.parent.on(events.dynamicModule, this.afterRender, this);\n    this.parent.on(events.paste, this.imagePaste, this);\n    this.parent.on(events.destroy, this.removeEventListener, this);\n  };\n\n  Image.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.keyDown, this.onKeyDown);\n    this.parent.off(events.keyUp, this.onKeyUp);\n    this.parent.off(events.windowResize, this.onWindowResize);\n    this.parent.off(events.insertImage, this.insertImage);\n    this.parent.off(events.showImageDialog, this.showDialog);\n    this.parent.off(events.closeImageDialog, this.closeDialog);\n    this.parent.off(events.insertCompleted, this.showImageQuickToolbar);\n    this.parent.off(events.clearDialogObj, this.clearDialogObj);\n    this.parent.off(events.imageCaption, this.caption);\n    this.parent.off(events.imageToolbarAction, this.onToolbarAction);\n    this.parent.off(events.imageDelete, this.deleteImg);\n    this.parent.off(events.imageLink, this.insertImgLink);\n    this.parent.off(events.imageAlt, this.insertAltText);\n    this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n    this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n    this.parent.off(events.imageSize, this.imageSize);\n    this.parent.off(events.dropDownSelect, this.alignmentSelect);\n    this.parent.off(events.initialEnd, this.afterRender);\n    this.parent.off(events.dynamicModule, this.afterRender);\n    this.parent.off(events.paste, this.imagePaste);\n    this.parent.off(events.destroy, this.removeEventListener);\n    var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;\n    dropElement.removeEventListener('drop', this.dragDrop.bind(this), true);\n    dropElement.removeEventListener('dragstart', this.dragStart.bind(this), true);\n    dropElement.removeEventListener('dragenter', this.dragEnter.bind(this), true);\n    dropElement.removeEventListener('dragover', this.dragOver.bind(this), true);\n\n    if (!isNullOrUndefined(this.contentModule)) {\n      EventHandler.remove(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick);\n      this.parent.formatter.editorManager.observer.off(events.checkUndo, this.undoStack);\n\n      if (this.parent.insertImageSettings.resize) {\n        EventHandler.remove(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart);\n        EventHandler.remove(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick);\n        EventHandler.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler);\n      }\n    }\n  };\n\n  Image.prototype.onIframeMouseDown = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  };\n\n  Image.prototype.afterRender = function () {\n    this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n    EventHandler.add(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick, this);\n\n    if (this.parent.insertImageSettings.resize) {\n      EventHandler.add(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart, this);\n      EventHandler.add(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick, this);\n      EventHandler.add(this.contentModule.getEditPanel(), 'cut', this.onCutHandler, this);\n    }\n\n    var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;\n    dropElement.addEventListener('drop', this.dragDrop.bind(this), true);\n    dropElement.addEventListener('dragstart', this.dragStart.bind(this), true);\n    dropElement.addEventListener('dragenter', this.dragOver.bind(this), true);\n    dropElement.addEventListener('dragover', this.dragOver.bind(this), true);\n  };\n\n  Image.prototype.undoStack = function (args) {\n    if (args.subCommand.toLowerCase() === 'undo' || args.subCommand.toLowerCase() === 'redo') {\n      for (var i = 0; i < this.parent.formatter.getUndoRedoStack().length; i++) {\n        var temp = this.parent.createElement('div');\n        var contentElem = parseHtml(this.parent.formatter.getUndoRedoStack()[i].text);\n        temp.appendChild(contentElem);\n        var img = temp.querySelectorAll('img');\n\n        if (temp.querySelector('.e-img-resize') && img.length > 0) {\n          for (var j = 0; j < img.length; j++) {\n            img[j].style.outline = '';\n          }\n\n          detach(temp.querySelector('.e-img-resize'));\n          this.parent.formatter.getUndoRedoStack()[i].text = temp.innerHTML;\n        }\n      }\n    }\n  };\n\n  Image.prototype.resizeEnd = function (e) {\n    this.resizeBtnInit();\n    this.imgEle.parentElement.style.cursor = 'auto';\n\n    if (Browser.isDevice) {\n      removeClass([e.target.parentElement], 'e-mob-span');\n    }\n\n    var args = {\n      event: e,\n      requestType: 'images'\n    };\n    this.parent.trigger(events.resizeStop, args);\n    /* eslint-disable */\n\n    var pageX = this.getPointX(e);\n    var pageY = this.parent.iframeSettings.enable ? window.pageYOffset + this.parent.element.getBoundingClientRect().top + e.clientY : e.pageY;\n    /* eslint-enable */\n\n    this.parent.formatter.editorManager.observer.on(events.checkUndo, this.undoStack, this);\n    this.parent.formatter.saveData();\n  };\n\n  Image.prototype.resizeStart = function (e, ele) {\n    var _this = this;\n\n    if (this.parent.readonly) {\n      return;\n    }\n\n    var target = ele ? ele : e.target;\n    this.prevSelectedImgEle = this.imgEle;\n\n    if (target.tagName === 'IMG') {\n      this.parent.preventDefaultResize(e);\n      var img = target;\n\n      if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n        detach(this.imgResizeDiv);\n      }\n\n      this.imageResize(img);\n    }\n\n    if (target.classList.contains('e-rte-imageboxmark')) {\n      if (this.parent.formatter.getUndoRedoStack().length === 0) {\n        this.parent.formatter.saveData();\n      }\n\n      this.pageX = this.getPointX(e);\n      this.pageY = this.getPointY(e);\n      e.preventDefault();\n      e.stopImmediatePropagation();\n      this.resizeBtnInit();\n\n      if (this.quickToolObj) {\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n\n      if (target.classList.contains('e-rte-topLeft')) {\n        this.resizeBtnStat.topLeft = true;\n      }\n\n      if (target.classList.contains('e-rte-topRight')) {\n        this.resizeBtnStat.topRight = true;\n      }\n\n      if (target.classList.contains('e-rte-botLeft')) {\n        this.resizeBtnStat.botLeft = true;\n      }\n\n      if (target.classList.contains('e-rte-botRight')) {\n        this.resizeBtnStat.botRight = true;\n      }\n\n      if (Browser.isDevice && this.contentModule.getEditPanel().contains(this.imgResizeDiv) && !this.imgResizeDiv.classList.contains('e-mob-span')) {\n        addClass([this.imgResizeDiv], 'e-mob-span');\n      } else {\n        var args = {\n          event: e,\n          requestType: 'images'\n        };\n        this.parent.trigger(events.resizeStart, args, function (resizeStartArgs) {\n          if (resizeStartArgs.cancel) {\n            _this.cancelResizeAction();\n          }\n        });\n      }\n\n      EventHandler.add(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd, this);\n    }\n  };\n\n  Image.prototype.imageClick = function (e) {\n    if (Browser.isDevice) {\n      if (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A' || e.target.tagName === 'IMG') {\n        this.contentModule.getEditPanel().setAttribute('contenteditable', 'false');\n        e.target.focus();\n      } else {\n        if (!this.parent.readonly) {\n          this.contentModule.getEditPanel().setAttribute('contenteditable', 'true');\n        }\n      }\n    }\n\n    if (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A') {\n      e.preventDefault();\n    }\n  };\n\n  Image.prototype.onCutHandler = function () {\n    if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      this.cancelResizeAction();\n    }\n  };\n\n  Image.prototype.imageResize = function (e) {\n    this.resizeBtnInit();\n    this.imgEle = e;\n    addClass([this.imgEle], 'e-resize');\n    this.imgResizeDiv = this.parent.createElement('span', {\n      className: 'e-img-resize',\n      id: this.rteID + '_imgResize'\n    });\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-topLeft',\n      styles: 'cursor: nwse-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-topRight',\n      styles: 'cursor: nesw-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-botLeft',\n      styles: 'cursor: nesw-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-botRight',\n      styles: 'cursor: nwse-resize'\n    }));\n\n    if (Browser.isDevice) {\n      addClass([this.imgResizeDiv], 'e-mob-rte');\n    }\n\n    e.style.outline = '2px solid #4a90e2';\n    this.imgResizePos(e, this.imgResizeDiv);\n    this.resizeImgDupPos(e);\n    this.contentModule.getEditPanel().appendChild(this.imgResizeDiv);\n    EventHandler.add(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing, this);\n  };\n\n  Image.prototype.getPointX = function (e) {\n    if (e.touches && e.touches.length) {\n      return e.touches[0].pageX;\n    } else {\n      return e.pageX;\n    }\n  };\n\n  Image.prototype.getPointY = function (e) {\n    if (e.touches && e.touches.length) {\n      return e.touches[0].pageY;\n    } else {\n      return e.pageY;\n    }\n  };\n\n  Image.prototype.imgResizePos = function (e, imgResizeDiv) {\n    var pos = this.calcPos(e);\n    var top = pos.top;\n    var left = pos.left;\n    var imgWid = e.width;\n    var imgHgt = e.height;\n    var borWid = Browser.isDevice ? 4 * parseInt(e.style.outline.slice(-3), 10) + 2 : 2 * parseInt(e.style.outline.slice(-3), 10) + 2; //span border width + image outline width\n\n    var devWid = Browser.isDevice ? 0 : 2; // span border width\n\n    imgResizeDiv.querySelector('.e-rte-botLeft').style.left = left - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-botLeft').style.top = imgHgt - borWid + top + 'px';\n    imgResizeDiv.querySelector('.e-rte-botRight').style.left = imgWid - (borWid - devWid) + left + 'px';\n    imgResizeDiv.querySelector('.e-rte-botRight').style.top = imgHgt - borWid + top + 'px';\n    imgResizeDiv.querySelector('.e-rte-topRight').style.left = imgWid - (borWid - devWid) + left + 'px';\n    imgResizeDiv.querySelector('.e-rte-topRight').style.top = top - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-topLeft').style.left = left - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-topLeft').style.top = top - borWid + 'px';\n  };\n\n  Image.prototype.calcPos = function (elem) {\n    var ignoreOffset = ['TD', 'TH', 'TABLE', 'A'];\n    var parentOffset = {\n      top: 0,\n      left: 0\n    };\n    var doc = elem.ownerDocument;\n    var offsetParent = (elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption') || ignoreOffset.indexOf(elem.offsetParent.tagName) > -1) ? closest(elem, '#' + this.parent.getID() + '_rte-edit-view') : elem.offsetParent) || doc.documentElement;\n\n    while (offsetParent && (offsetParent === doc.body || offsetParent === doc.documentElement) && offsetParent.style.position === 'static') {\n      offsetParent = offsetParent.parentNode;\n    }\n\n    if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n      // eslint-disable-next-line\n      parentOffset = offsetParent.getBoundingClientRect();\n    }\n\n    return {\n      top: elem.offsetTop,\n      left: elem.offsetLeft\n    };\n  };\n\n  Image.prototype.setAspectRatio = function (img, expectedX, expectedY, e) {\n    if (isNullOrUndefined(img.width)) {\n      return;\n    }\n\n    var width = img.style.width !== '' ? img.style.width.match(/^\\d+(\\.\\d*)?%$/g) ? parseFloat(img.style.width) : parseInt(img.style.width, 10) : img.width;\n    var height = img.style.height !== '' ? parseInt(img.style.height, 10) : img.height;\n\n    if (width > height) {\n      img.style.minWidth = '20px';\n\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n          var percentageValue = this.pixToPerc(width / height * expectedY, img.previousElementSibling || img.parentElement);\n          img.style.width = Math.min(Math.round(percentageValue / img.getBoundingClientRect().width * expectedX * 100) / 100, 100) + '%';\n        } else {\n          img.style.width = this.pixToPerc(width / height * expectedY, img.previousElementSibling || img.parentElement) + '%';\n        }\n\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else if (img.style.width === '' && img.style.height !== '') {\n        img.style.height = expectedY + 'px';\n      } else if (img.style.width !== '' && img.style.height === '') {\n        var currentWidth = width / height * expectedY + width / height < this.parent.inputElement.getBoundingClientRect().right - 32 ? width / height * expectedY + width / height : this.parent.inputElement.getBoundingClientRect().right - 32;\n        img.style.width = currentWidth.toString() + 'px';\n      } else if (img.style.width !== '') {\n        var currentWidth = width / height * expectedY < this.parent.inputElement.getBoundingClientRect().right - 32 ? width / height * expectedY : this.parent.inputElement.getBoundingClientRect().right - 32;\n        img.style.width = currentWidth + 'px';\n        img.style.height = expectedY + 'px';\n      } else {\n        img.setAttribute('width', (width / height * expectedY + width / height).toString());\n      }\n    } else if (height > width) {\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n          img.style.width = Math.min(Math.round(width / img.getBoundingClientRect().width * expectedX * 100) / 100, 100) + '%';\n        } else {\n          img.style.width = this.pixToPerc(expectedX / height * expectedY, img.previousElementSibling || img.parentElement) + '%';\n        }\n\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else if (img.style.width !== '') {\n        img.style.width = expectedX + 'px';\n        img.style.height = height / width * expectedX + 'px';\n      } else {\n        img.setAttribute('width', this.resizeBtnStat.botRight ? (this.getPointX(e.event) - img.getBoundingClientRect().left).toString() : expectedX.toString());\n      }\n    } else {\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        img.style.width = this.pixToPerc(expectedX, img.previousElementSibling || img.parentElement) + '%';\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else if (img.style.width !== '') {\n        img.style.width = expectedX + 'px';\n        img.style.height = expectedX + 'px';\n      } else {\n        img.setAttribute('width', expectedX.toString());\n        img.setAttribute('height', expectedX.toString());\n      }\n    }\n  };\n\n  Image.prototype.pixToPerc = function (expected, parentEle) {\n    return expected / parseFloat(getComputedStyle(parentEle).width) * 100;\n  };\n\n  Image.prototype.imgDupMouseMove = function (width, height, e) {\n    var _this = this;\n\n    var args = {\n      event: e,\n      requestType: 'images'\n    };\n    this.parent.trigger(events.onResize, args, function (resizingArgs) {\n      if (resizingArgs.cancel) {\n        _this.cancelResizeAction();\n      } else {\n        if (parseInt(_this.parent.insertImageSettings.minWidth, 10) >= parseInt(width, 10) || parseInt(_this.parent.getInsertImgMaxWidth(), 10) <= parseInt(width, 10) && isNOU(_this.imgEle.style.width)) {\n          return;\n        }\n\n        if (!_this.parent.insertImageSettings.resizeByPercent && (parseInt(_this.parent.insertImageSettings.minHeight, 10) >= parseInt(height, 10) || parseInt(_this.parent.insertImageSettings.maxHeight, 10) <= parseInt(height, 10))) {\n          return;\n        }\n\n        _this.imgEle.parentElement.style.cursor = 'pointer';\n\n        _this.setAspectRatio(_this.imgEle, parseInt(width, 10), parseInt(height, 10), args);\n\n        _this.resizeImgDupPos(_this.imgEle);\n\n        _this.imgResizePos(_this.imgEle, _this.imgResizeDiv);\n\n        _this.parent.setContentHeight('', false);\n      }\n    });\n  };\n\n  Image.prototype.resizing = function (e) {\n    if (this.imgEle.offsetWidth >= this.parent.getInsertImgMaxWidth()) {\n      this.imgEle.style.maxHeight = this.imgEle.offsetHeight + 'px';\n    }\n\n    var pageX = this.getPointX(e);\n    var pageY = this.getPointY(e);\n    var mouseX = this.resizeBtnStat.botLeft || this.resizeBtnStat.topLeft ? -(pageX - this.pageX) : pageX - this.pageX;\n    var mouseY = this.resizeBtnStat.topLeft || this.resizeBtnStat.topRight ? -(pageY - this.pageY) : pageY - this.pageY;\n    var width = parseInt(this.imgDupPos.width, 10) + mouseX;\n    var height = parseInt(this.imgDupPos.height, 10) + mouseY;\n    this.pageX = pageX;\n    this.pageY = pageY;\n\n    if (this.resizeBtnStat.botRight) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.botLeft) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.topRight) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.topLeft) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    }\n  };\n\n  Image.prototype.cancelResizeAction = function () {\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n\n    if (this.imgEle && this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      detach(this.imgResizeDiv);\n      this.imgEle.style.outline = '';\n      this.imgResizeDiv = null;\n      this.pageX = null;\n      this.pageY = null;\n    }\n  };\n\n  Image.prototype.resizeImgDupPos = function (e) {\n    this.imgDupPos = {\n      width: e.style.width !== '' && this.parent.insertImageSettings && !this.parent.insertImageSettings.resizeByPercent ? this.imgEle.style.width : e.width + 'px',\n      height: e.style.height !== '' ? this.imgEle.style.height : e.height + 'px'\n    };\n  };\n\n  Image.prototype.resizeBtnInit = function () {\n    return this.resizeBtnStat = {\n      botLeft: false,\n      botRight: false,\n      topRight: false,\n      topLeft: false\n    };\n  };\n\n  Image.prototype.onToolbarAction = function (args) {\n    if (isIDevice()) {\n      this.parent.notify(events.selectionRestore, {});\n    }\n\n    var item = args.args.item;\n\n    switch (item.subCommand) {\n      case 'Replace':\n        if (this.parent.fileManagerSettings.enable) {\n          this.parent.notify(events.renderFileManager, args);\n        } else {\n          this.parent.notify(events.insertImage, args);\n        }\n\n        break;\n\n      case 'Caption':\n        this.parent.notify(events.imageCaption, args);\n        break;\n\n      case 'InsertLink':\n        this.parent.notify(events.imageLink, args);\n        break;\n\n      case 'AltText':\n        this.parent.notify(events.imageAlt, args);\n        break;\n\n      case 'Remove':\n        this.parent.notify(events.imageDelete, args);\n        break;\n\n      case 'Dimension':\n        this.parent.notify(events.imageSize, args);\n        break;\n\n      case 'OpenImageLink':\n        this.openImgLink(args);\n        break;\n\n      case 'EditImageLink':\n        this.editImgLink(args);\n        break;\n\n      case 'RemoveImageLink':\n        this.removeImgLink(args);\n        break;\n    }\n  };\n\n  Image.prototype.openImgLink = function (e) {\n    var target = e.selectParent[0].parentNode.target === '' ? '_self' : '_blank';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      url: e.selectParent[0].parentNode.href,\n      target: target,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand\n    });\n  };\n\n  Image.prototype.editImgLink = function (e) {\n    var selectParentEle = e.selectParent[0].parentNode;\n    var linkUpdate = this.i10n.getConstant('dialogUpdate');\n    var inputDetails = {\n      url: selectParentEle.href,\n      target: selectParentEle.target,\n      header: 'Edit Link',\n      btnText: linkUpdate\n    };\n    this.insertImgLink(e, inputDetails);\n  };\n\n  Image.prototype.removeImgLink = function (e) {\n    if (Browser.isIE) {\n      this.contentModule.getEditPanel().focus();\n    }\n\n    e.selection.restore();\n    var isCapLink = this.contentModule.getEditPanel().contains(this.captionEle) && select('a', this.captionEle) ? true : false;\n    var selectParent = isCapLink ? [this.captionEle] : [e.selectNode[0].parentElement];\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      insertElement: e.selectNode[0],\n      selectParent: selectParent,\n      selection: e.selection,\n      subCommand: e.args.item.subCommand\n    });\n\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n\n      if (!isNullOrUndefined(e.selectParent)) {\n        removeClass([e.selectParent[0]], 'e-img-focus');\n      }\n    }\n\n    if (isCapLink) {\n      select('.e-img-inner', this.captionEle).focus();\n    }\n  };\n\n  Image.prototype.onKeyDown = function (event) {\n    var originalEvent = event.args;\n    var range;\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n    this.deletedImg = [];\n    var isCursor;\n    var keyCodeValues = [27, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 44, 45, 9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 91, 92, 93, 144, 145, 182, 183];\n\n    if (this.parent.editorMode === 'HTML') {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      isCursor = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n    }\n\n    if (!isCursor && this.parent.editorMode === 'HTML' && keyCodeValues.indexOf(originalEvent.which) < 0) {\n      var nodes = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n\n      for (var i = 0; i < nodes.length; i++) {\n        if (nodes[i].nodeName === 'IMG') {\n          this.deletedImg.push(nodes[i]);\n        }\n      }\n    }\n\n    if (this.parent.editorMode === 'HTML' && (originalEvent.which === 8 && originalEvent.code === 'Backspace' || originalEvent.which === 46 && originalEvent.code === 'Delete')) {\n      var isCursor_1 = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n\n      if (originalEvent.which === 8 && originalEvent.code === 'Backspace' && isCursor_1) {\n        this.checkImageBack(range);\n      } else if (originalEvent.which === 46 && originalEvent.code === 'Delete' && isCursor_1) {\n        this.checkImageDel(range);\n      }\n    }\n\n    if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection) && originalEvent.code !== 'KeyK') {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n\n      if (!originalEvent.ctrlKey && originalEvent.key && (originalEvent.key.length === 1 || originalEvent.action === 'enter') && selectParentEle[0].tagName === 'IMG' && selectParentEle[0].parentElement) {\n        var prev = selectParentEle[0].parentElement.childNodes[0];\n\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n          this.removeResizeEle();\n        }\n\n        this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), prev, prev, prev.textContent.length, prev.textContent.length);\n        removeClass([selectParentEle[0]], 'e-img-focus');\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n    }\n\n    if (originalEvent.ctrlKey && (originalEvent.keyCode === 89 || originalEvent.keyCode === 90)) {\n      this.undoStack({\n        subCommand: originalEvent.keyCode === 90 ? 'undo' : 'redo'\n      });\n    }\n\n    if (originalEvent.keyCode === 8 || originalEvent.keyCode === 46) {\n      if (selectNodeEle && selectNodeEle[0].nodeName === 'IMG' && selectNodeEle.length < 1) {\n        originalEvent.preventDefault();\n        var event_1 = {\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle,\n          args: {\n            item: {\n              command: 'Images',\n              subCommand: 'Remove'\n            },\n            originalEvent: originalEvent\n          }\n        };\n        this.deleteImg(event_1, originalEvent.keyCode);\n      }\n\n      if (this.parent.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n        this.removeResizeEle();\n      }\n    }\n\n    if (originalEvent.code === 'Backspace') {\n      originalEvent.action = 'backspace';\n    }\n\n    switch (originalEvent.action) {\n      case 'escape':\n        if (!isNullOrUndefined(this.dialogObj)) {\n          this.dialogObj.close();\n        }\n\n        break;\n\n      case 'backspace':\n      case 'delete':\n        for (var i = 0; i < this.deletedImg.length; i++) {\n          var src = this.deletedImg[i].src;\n          this.imageRemovePost(src);\n        }\n\n        if (this.parent.editorMode !== 'Markdown') {\n          if (range.startContainer.nodeType === 3) {\n            if (originalEvent.code === 'Backspace') {\n              if (range.startContainer.previousElementSibling && range.startOffset === 0 && range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPTION) && range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                detach(range.startContainer.previousElementSibling);\n              }\n            } else {\n              if (range.startContainer.nextElementSibling && range.endContainer.textContent.length === range.endOffset && range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPTION) && range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                detach(range.startContainer.nextElementSibling);\n              }\n            }\n          } else if (range.startContainer.nodeType === 1 && range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE)) {\n            detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE));\n          }\n        }\n\n        break;\n\n      case 'insert-image':\n        this.openDialog(true, originalEvent, save, selectNodeEle, selectParentEle);\n        originalEvent.preventDefault();\n        break;\n    }\n  };\n\n  Image.prototype.openDialog = function (isInternal, event, selection, ele, parentEle) {\n    var range;\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n\n    if (!isInternal && !isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n    } else {\n      save = selection;\n      selectNodeEle = ele;\n      selectParentEle = parentEle;\n    }\n\n    if (this.parent.editorMode === 'HTML') {\n      this.insertImage({\n        args: {\n          item: {\n            command: 'Images',\n            subCommand: 'Image'\n          },\n          originalEvent: event\n        },\n        selectNode: selectNodeEle,\n        selection: save,\n        selectParent: selectParentEle\n      });\n    } else {\n      this.insertImage({\n        args: {\n          item: {\n            command: 'Images',\n            subCommand: 'Image'\n          },\n          originalEvent: event\n        },\n        member: 'image',\n        text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n        module: 'Markdown',\n        name: 'insertImage'\n      });\n    }\n  };\n\n  Image.prototype.showDialog = function () {\n    this.openDialog(false);\n  };\n\n  Image.prototype.closeDialog = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  }; // eslint-disable-next-line\n\n\n  Image.prototype.onKeyUp = function (event) {\n    if (!isNOU(this.deletedImg) && this.deletedImg.length > 0) {\n      for (var i = 0; i < this.deletedImg.length; i++) {\n        var args = {\n          element: this.deletedImg[i],\n          src: this.deletedImg[i].getAttribute('src')\n        };\n        this.parent.trigger(events.afterImageDelete, args);\n      }\n    }\n  };\n\n  Image.prototype.checkImageBack = function (range) {\n    if (range.startContainer.nodeName === '#text' && range.startOffset === 0 && !isNOU(range.startContainer.previousSibling) && range.startContainer.previousSibling.nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.previousSibling);\n    } else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset - 1]) && range.startContainer.childNodes[range.startOffset - 1].nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.childNodes[range.startOffset - 1]);\n    }\n  };\n\n  Image.prototype.checkImageDel = function (range) {\n    if (range.startContainer.nodeName === '#text' && range.startOffset === range.startContainer.textContent.length && !isNOU(range.startContainer.nextSibling) && range.startContainer.nextSibling.nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.nextSibling);\n    } else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset]) && range.startContainer.childNodes[range.startOffset].nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.childNodes[range.startOffset]);\n    }\n  };\n\n  Image.prototype.alignmentSelect = function (e) {\n    var item = e.item;\n\n    if (!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || item.command !== 'Images') {\n      return;\n    }\n\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n    selectNodeEle = selectNodeEle[0].nodeName === 'IMG' ? selectNodeEle : [this.imgEle];\n    var args = {\n      args: e,\n      selectNode: selectNodeEle\n    };\n\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n\n    switch (item.subCommand) {\n      case 'JustifyLeft':\n        this.alignImage(args, 'JustifyLeft');\n        break;\n\n      case 'JustifyCenter':\n        this.alignImage(args, 'JustifyCenter');\n        break;\n\n      case 'JustifyRight':\n        this.alignImage(args, 'JustifyRight');\n        break;\n\n      case 'Inline':\n        this.inline(args);\n        break;\n\n      case 'Break':\n        this.break(args);\n        break;\n    }\n\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      removeClass([selectNodeEle[0]], 'e-img-focus');\n    }\n\n    this.cancelResizeAction();\n  };\n\n  Image.prototype.imageWithLinkQTBarItemUpdate = function () {\n    var separator;\n    var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n\n    for (var i = 0; i < items.length; i++) {\n      if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') || items[i].getAttribute('title') === this.i10n.getConstant('editLink') || items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n        addClass([items[i]], 'e-link-groups');\n        items[i].style.display = 'none';\n      } else if (items[i].getAttribute('title') === 'Insert Link') {\n        items[i].style.display = '';\n      } else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n        // eslint-disable-next-line\n        separator = items[i];\n        detach(items[i]);\n      }\n    }\n\n    var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n    this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n  };\n\n  Image.prototype.showImageQuickToolbar = function (e) {\n    var _this = this;\n\n    if (e.type !== 'Images' || isNullOrUndefined(this.parent.quickToolbarModule) || isNullOrUndefined(this.parent.quickToolbarModule.imageQTBar) || isNullOrUndefined(e.args)) {\n      return;\n    }\n\n    this.quickToolObj = this.parent.quickToolbarModule;\n    var args = e.args;\n    var target = e.elements;\n    [].forEach.call(e.elements, function (element, index) {\n      if (index === 0) {\n        target = element;\n      }\n    });\n\n    if (target && !closest(target, 'a')) {\n      this.imageWithLinkQTBarItemUpdate();\n    }\n\n    if (target.nodeName === 'IMG') {\n      addClass([target], ['e-img-focus']);\n    }\n\n    var pageY = this.parent.iframeSettings.enable ? window.pageYOffset + this.parent.element.getBoundingClientRect().top + args.clientY : args.pageY;\n\n    if (this.parent.quickToolbarModule.imageQTBar) {\n      if (e.isNotify) {\n        setTimeout(function () {\n          _this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n        }, 400);\n      } else {\n        this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n      }\n    }\n  };\n\n  Image.prototype.hideImageQuickToolbar = function () {\n    if (!isNullOrUndefined(this.contentModule.getEditPanel().querySelector('.e-img-focus'))) {\n      removeClass([this.contentModule.getEditPanel().querySelector('.e-img-focus')], 'e-img-focus');\n\n      if (this.quickToolObj && this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n    }\n  };\n\n  Image.prototype.editAreaClickHandler = function (e) {\n    if (this.parent.readonly) {\n      this.hideImageQuickToolbar();\n      return;\n    }\n\n    var args = e.args;\n    var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n\n    if (args.which === 2 || showOnRightClick && args.which === 1 || !showOnRightClick && args.which === 3) {\n      if (showOnRightClick && args.which === 1 && !isNullOrUndefined(args.target) && args.target.tagName === 'IMG') {\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), args.target);\n      }\n\n      return;\n    }\n\n    if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.imageQTBar) {\n      this.quickToolObj = this.parent.quickToolbarModule;\n      var target = args.target;\n      this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n      var isPopupOpen = this.quickToolObj.imageQTBar.element.classList.contains('e-rte-pop');\n\n      if (target.nodeName === 'IMG' && this.parent.quickToolbarModule) {\n        if (isPopupOpen) {\n          return;\n        }\n\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), target);\n\n        if (isIDevice()) {\n          this.parent.notify(events.selectionSave, e);\n        }\n\n        addClass([target], 'e-img-focus');\n        var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n        var separator = void 0;\n\n        if (closest(target, 'a')) {\n          for (var i = 0; i < items.length; i++) {\n            if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') || items[i].getAttribute('title') === this.i10n.getConstant('editLink') || items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n              items[i].style.display = '';\n              removeClass([items[i]], 'e-link-groups');\n            } else if (items[i].getAttribute('title') === 'Insert Link') {\n              items[i].style.display = 'none';\n            } else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n              // eslint-disable-next-line\n              separator = items[i];\n              detach(items[i]);\n            }\n          }\n\n          var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n          this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n        } else if (!closest(target, 'a')) {\n          this.imageWithLinkQTBarItemUpdate();\n        }\n\n        this.showImageQuickToolbar({\n          args: args,\n          type: 'Images',\n          elements: [args.target]\n        });\n      } else {\n        this.hideImageQuickToolbar();\n      }\n    }\n  };\n\n  Image.prototype.insertImgLink = function (e, inputDetails) {\n    var _this = this;\n\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    this.imagDialog(e);\n\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var linkWrap = this.parent.createElement('div', {\n        className: 'e-img-linkwrap'\n      });\n      var linkUrl = this.i10n.getConstant('linkurl');\n      var content = '<div class=\"e-rte-field\">' + '<input type=\"text\" data-role =\"none\" class=\"e-input e-img-link\" spellcheck=\"false\" placeholder=\"' + linkUrl + '\"/></div>' + '<div class=\"e-rte-label\"></div>' + '<div class=\"e-rte-field\">' + '<input type=\"checkbox\" class=\"e-rte-linkTarget\"  data-role =\"none\"></div>';\n      var contentElem = parseHtml(content);\n      linkWrap.appendChild(contentElem);\n      var linkTarget = linkWrap.querySelector('.e-rte-linkTarget');\n      var inputLink = linkWrap.querySelector('.e-img-link');\n      var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n      this.checkBoxObj = new CheckBox({\n        label: linkOpenLabel,\n        checked: true,\n        enableRtl: this.parent.enableRtl,\n        change: function (e) {\n          if (e.checked) {\n            target_1 = '_blank';\n          } else {\n            target_1 = null;\n          }\n        }\n      });\n      this.checkBoxObj.isStringTemplate = true;\n      this.checkBoxObj.createElement = this.parent.createElement;\n      this.checkBoxObj.appendTo(linkTarget);\n      var target_1 = this.checkBoxObj.checked ? '_blank' : null;\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var linkargs_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode,\n        selectParent: e.selectParent,\n        link: inputLink,\n        target: target_1\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: this.parent.localeObj.getConstant('imageInsertLinkHeader'),\n        content: linkWrap,\n        position: {\n          X: 'center',\n          Y: 'center'\n        },\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertlink(linkargs_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-link',\n            isPrimary: true\n          }\n        }]\n      });\n\n      if (!isNullOrUndefined(inputDetails)) {\n        inputLink.value = inputDetails.url; // eslint-disable-next-line\n\n        inputDetails.target ? this.checkBoxObj.checked = true : this.checkBoxObj.checked = false;\n        this.dialogObj.header = inputDetails.header;\n      }\n\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n\n  Image.prototype.insertAltText = function (e) {\n    var _this = this;\n\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    this.imagDialog(e);\n    var altText = this.i10n.getConstant('altText');\n\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var altWrap = this.parent.createElement('div', {\n        className: 'e-img-altwrap'\n      });\n      var altHeader = this.i10n.getConstant('alternateHeader');\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var getAlt = e.selectNode[0].getAttribute('alt') === null ? '' : e.selectNode[0].getAttribute('alt');\n      var content = '<div class=\"e-rte-field\">' + '<input type=\"text\" spellcheck=\"false\" value=\"' + getAlt + '\" class=\"e-input e-img-alt\" placeholder=\"' + altText + '\"/>' + '</div>';\n      var contentElem = parseHtml(content);\n      altWrap.appendChild(contentElem);\n      var inputAlt = altWrap.querySelector('.e-img-alt');\n      var altArgs_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode,\n        alt: inputAlt\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: altHeader,\n        content: altWrap,\n        position: {\n          X: 'center',\n          Y: 'center'\n        },\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertAlt(altArgs_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-alt',\n            isPrimary: true\n          }\n        }]\n      });\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n\n  Image.prototype.insertAlt = function (e) {\n    if (!isNullOrUndefined(e.alt)) {\n      e.selection.restore();\n\n      if (this.parent.formatter.getUndoRedoStack().length === 0) {\n        this.parent.formatter.saveData();\n      }\n\n      var altText = e.alt.value;\n      this.parent.formatter.process(this.parent, e.args, e.args, {\n        altText: altText,\n        selectNode: e.selectNode,\n        subCommand: e.args.item.subCommand\n      });\n      this.dialogObj.hide({\n        returnValue: false\n      });\n    }\n  };\n\n  Image.prototype.insertlink = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    var url = e.link.value;\n\n    if (url === '') {\n      addClass([e.link], 'e-error');\n      e.link.setSelectionRange(0, url.length);\n      e.link.focus();\n      return;\n    }\n\n    if (!this.isUrl(url)) {\n      url = 'http://' + url;\n    } else {\n      removeClass([e.link], 'e-error');\n    }\n\n    var proxy = e.selfImage;\n\n    if (proxy.parent.editorMode === 'HTML') {\n      e.selection.restore();\n    }\n\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n\n    if (e.selectNode[0].parentElement.nodeName === 'A') {\n      proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n        url: url,\n        target: proxy.checkBoxObj.checked ? '_blank' : null,\n        selectNode: e.selectNode,\n        subCommand: e.args.item.subCommand\n      });\n      proxy.dialogObj.hide({\n        returnValue: true\n      });\n      return;\n    }\n\n    proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n      url: url,\n      target: proxy.checkBoxObj.checked ? '_blank' : null,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand,\n      selection: e.selection\n    });\n    var captionEle = closest(e.selectNode[0], '.e-img-caption');\n\n    if (captionEle) {\n      select('.e-img-inner', captionEle).focus();\n    }\n\n    if (captionEle) {\n      select('.e-img-inner', captionEle).focus();\n    }\n\n    proxy.dialogObj.hide({\n      returnValue: false\n    });\n  };\n\n  Image.prototype.isUrl = function (url) {\n    // eslint-disable-next-line\n    var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/gi;\n    return regexp.test(url);\n  };\n\n  Image.prototype.deleteImg = function (e, keyCode) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    var args = {\n      element: e.selectNode[0],\n      src: e.selectNode[0].getAttribute('src')\n    };\n\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n\n    e.selection.restore();\n\n    if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n      this.removeResizeEle();\n    }\n\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      captionClass: classes.CLS_CAPTION,\n      subCommand: e.args.item.subCommand\n    });\n    this.imageRemovePost(args.src);\n\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n    }\n\n    this.cancelResizeAction();\n\n    if (isNullOrUndefined(keyCode)) {\n      this.parent.trigger(events.afterImageDelete, args);\n    }\n  };\n\n  Image.prototype.imageRemovePost = function (src) {\n    var proxy = this;\n    var absoluteUrl = '';\n\n    if (isNOU(this.parent.insertImageSettings.removeUrl) || this.parent.insertImageSettings.removeUrl === '') {\n      return;\n    }\n\n    if (src.indexOf('http://') > -1 || src.indexOf('https://') > -1) {\n      absoluteUrl = src;\n    } else {\n      absoluteUrl = new URL(src, document.baseURI).href;\n    }\n\n    this.removingImgName = absoluteUrl.replace(/^.*[\\\\\\/]/, '');\n    var xhr = new XMLHttpRequest();\n    xhr.addEventListener(\"readystatechange\", function () {\n      if (this.readyState == 4 && this.status == 200) {\n        proxy.triggerPost(this.response);\n      }\n    });\n    xhr.open('GET', absoluteUrl);\n    xhr.responseType = 'blob';\n    xhr.send();\n  };\n\n  Image.prototype.triggerPost = function (response) {\n    var removeUrl = this.parent.insertImageSettings.removeUrl;\n\n    if (isNOU(removeUrl) || removeUrl === '') {\n      return;\n    }\n\n    var file = new File([response], this.removingImgName);\n    var ajax = new Ajax(removeUrl, 'POST', true, null);\n    var formData = new FormData();\n    formData.append('UploadFiles', file);\n    ajax.send(formData);\n  };\n\n  Image.prototype.caption = function (e) {\n    var selectNode = e.selectNode[0];\n\n    if (selectNode.nodeName !== 'IMG') {\n      return;\n    }\n\n    e.selection.restore();\n\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n\n    this.cancelResizeAction();\n    addClass([selectNode], 'e-rte-image');\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Caption';\n\n    if (!isNullOrUndefined(closest(selectNode, '.' + classes.CLS_CAPTION))) {\n      detach(closest(selectNode, '.' + classes.CLS_CAPTION));\n\n      if (Browser.isIE) {\n        this.contentModule.getEditPanel().focus();\n        e.selection.restore();\n      }\n\n      if (selectNode.parentElement.tagName === 'A') {\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n          insertElement: selectNode.parentElement,\n          selectNode: e.selectNode,\n          subCommand: subCommand\n        });\n      } else {\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n          insertElement: selectNode,\n          selectNode: e.selectNode,\n          subCommand: subCommand\n        });\n      }\n    } else {\n      this.captionEle = this.parent.createElement('span', {\n        className: classes.CLS_CAPTION + ' ' + classes.CLS_RTE_CAPTION,\n        attrs: {\n          contenteditable: 'false',\n          draggable: 'false',\n          style: 'width:' + this.parent.insertImageSettings.width\n        }\n      });\n      var imgWrap = this.parent.createElement('span', {\n        className: 'e-img-wrap'\n      });\n      var imgInner = this.parent.createElement('span', {\n        className: 'e-img-inner',\n        attrs: {\n          contenteditable: 'true'\n        }\n      });\n      var parent_1 = e.selectNode[0].parentElement;\n\n      if (parent_1.tagName === 'A') {\n        parent_1.setAttribute('contenteditable', 'true');\n      }\n\n      imgWrap.appendChild(parent_1.tagName === 'A' ? parent_1 : e.selectNode[0]);\n      imgWrap.appendChild(imgInner);\n      var imgCaption = this.i10n.getConstant('imageCaption');\n      imgInner.innerHTML = imgCaption;\n      this.captionEle.appendChild(imgWrap);\n\n      if (selectNode.classList.contains(classes.CLS_IMGINLINE)) {\n        addClass([this.captionEle], classes.CLS_CAPINLINE);\n      }\n\n      if (selectNode.classList.contains(classes.CLS_IMGBREAK)) {\n        addClass([this.captionEle], classes.CLS_IMGBREAK);\n      }\n\n      if (selectNode.classList.contains(classes.CLS_IMGLEFT)) {\n        addClass([this.captionEle], classes.CLS_IMGLEFT);\n      }\n\n      if (selectNode.classList.contains(classes.CLS_IMGRIGHT)) {\n        addClass([this.captionEle], classes.CLS_IMGRIGHT);\n      }\n\n      if (selectNode.classList.contains(classes.CLS_IMGCENTER)) {\n        addClass([this.captionEle], classes.CLS_IMGCENTER);\n      }\n\n      this.parent.formatter.process(this.parent, e.args, e.args, {\n        insertElement: this.captionEle,\n        selectNode: e.selectNode,\n        subCommand: subCommand\n      });\n      this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), imgInner.childNodes[0], imgInner.childNodes[0], 0, imgInner.childNodes[0].textContent.length);\n    }\n\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      removeClass([selectNode], 'e-img-focus');\n    }\n  };\n\n  Image.prototype.imageSize = function (e) {\n    var _this = this;\n\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    this.imagDialog(e);\n\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var imgSizeHeader = this.i10n.getConstant('imageSizeHeader');\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var dialogContent = this.imgsizeInput(e);\n      var selectObj_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: imgSizeHeader,\n        content: dialogContent,\n        position: {\n          X: 'center',\n          Y: 'center'\n        },\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertSize(selectObj_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-size',\n            isPrimary: true\n          }\n        }]\n      });\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n\n  Image.prototype.break = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Break';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n\n  Image.prototype.inline = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Inline';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n\n  Image.prototype.alignImage = function (e, type) {\n    var subCommand = e.args.item ? e.args.item.subCommand : type;\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n\n  Image.prototype.clearDialogObj = function () {\n    if (this.dialogObj) {\n      this.dialogObj.destroy();\n      detach(this.dialogObj.element);\n      this.dialogObj = null;\n    }\n  };\n\n  Image.prototype.imagDialog = function (e) {\n    var _this = this;\n\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n      return;\n    }\n\n    var imgDialog = this.parent.createElement('div', {\n      className: 'e-rte-img-dialog',\n      id: this.rteID + '_image'\n    });\n    this.parent.element.appendChild(imgDialog);\n    var imgInsert = this.i10n.getConstant('dialogInsert');\n    var imglinkCancel = this.i10n.getConstant('dialogCancel');\n    var imgHeader = this.i10n.getConstant('imageHeader');\n    var selection = e.selection;\n    var selectObj = {\n      selfImage: this,\n      selection: e.selection,\n      args: e.args,\n      selectParent: e.selectParent\n    };\n    var dialogModel = {\n      header: imgHeader,\n      cssClass: classes.CLS_RTE_ELEMENTS,\n      enableRtl: this.parent.enableRtl,\n      locale: this.parent.locale,\n      showCloseIcon: true,\n      closeOnEscape: true,\n      width: Browser.isDevice ? '290px' : '340px',\n      height: 'inherit',\n      position: {\n        X: 'center',\n        Y: Browser.isDevice ? 'center' : 'top'\n      },\n      isModal: Browser.isDevice,\n      buttons: [{\n        click: this.insertImageUrl.bind(selectObj),\n        buttonModel: {\n          content: imgInsert,\n          cssClass: 'e-flat e-insertImage',\n          isPrimary: true,\n          disabled: true\n        }\n      }, {\n        click: function (e) {\n          _this.cancelDialog(e);\n        },\n        buttonModel: {\n          cssClass: 'e-flat e-cancel',\n          content: imglinkCancel\n        }\n      }],\n      target: Browser.isDevice ? document.body : this.parent.element,\n      animationSettings: {\n        effect: 'None'\n      },\n      close: function (event) {\n        if (_this.isImgUploaded) {\n          _this.uploadObj.removing();\n        }\n\n        _this.parent.isBlur = false;\n\n        if (event && event.event.returnValue) {\n          if (_this.parent.editorMode === 'HTML') {\n            selection.restore();\n          } else {\n            _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n          }\n        }\n\n        _this.dialogObj.destroy();\n\n        detach(_this.dialogObj.element);\n\n        _this.dialogRenderObj.close(event);\n\n        _this.dialogObj = null;\n      }\n    };\n    var dialogContent = this.parent.createElement('div', {\n      className: 'e-img-content'\n    });\n\n    if (!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown' || this.parent.editorMode === 'HTML') {\n      dialogContent.appendChild(this.imgUpload(e));\n    }\n\n    var linkHeader = this.parent.createElement('div', {\n      className: 'e-linkheader'\n    });\n    var linkHeaderText = this.i10n.getConstant('imageLinkHeader');\n\n    if (this.parent.editorMode === 'HTML') {\n      linkHeader.innerHTML = linkHeaderText;\n    } else {\n      linkHeader.innerHTML = this.i10n.getConstant('mdimageLink');\n    }\n\n    dialogContent.appendChild(linkHeader);\n    dialogContent.appendChild(this.imageUrlPopup(e));\n\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n      dialogModel.header = this.parent.localeObj.getConstant('editImageHeader');\n      dialogModel.content = dialogContent;\n    } else {\n      dialogModel.content = dialogContent;\n    }\n\n    this.dialogObj = this.dialogRenderObj.render(dialogModel);\n    this.dialogObj.createElement = this.parent.createElement;\n    this.dialogObj.appendTo(imgDialog);\n\n    if (isNullOrUndefined(this.dialogObj)) {\n      return;\n    }\n\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG' && e.name === 'insertImage') {\n      this.dialogObj.element.querySelector('.e-insertImage').textContent = this.parent.localeObj.getConstant('dialogUpdate');\n    }\n\n    imgDialog.style.maxHeight = 'inherit';\n\n    if (this.quickToolObj) {\n      if (this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n        this.quickToolObj.imageQTBar.hidePopup();\n\n        if (!isNullOrUndefined(e.selectParent)) {\n          removeClass([e.selectParent[0]], 'e-img-focus');\n        }\n      }\n\n      if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n        this.quickToolObj.inlineQTBar.hidePopup();\n      }\n    }\n  }; // eslint-disable-next-line\n\n\n  Image.prototype.cancelDialog = function (e) {\n    this.parent.isBlur = false;\n    this.dialogObj.hide({\n      returnValue: true\n    });\n\n    if (this.isImgUploaded) {\n      this.uploadObj.removing();\n    }\n  };\n\n  Image.prototype.onDocumentClick = function (e) {\n    var target = e.target;\n\n    if (target.nodeName === 'IMG') {\n      this.imgEle = target;\n    }\n\n    if (!isNullOrUndefined(this.dialogObj) && ( // eslint-disable-next-line\n    !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable && this.parent.getToolbarElement() && !this.parent.getToolbarElement().contains(e.target) || this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target) && !closest(target, '#' + this.parent.getID() + '_toolbar_Image') && !target.querySelector('#' + this.parent.getID() + '_toolbar_Image'))) {\n      /* eslint-disable */\n      if (e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight) {} else {\n        this.dialogObj.hide({\n          returnValue: true\n        });\n        this.parent.isBlur = true;\n        dispatchEvent(this.parent.element, 'focusout');\n      }\n      /* eslint-enable */\n\n    }\n\n    if (e.target.tagName !== 'IMG' && this.imgResizeDiv && !(this.quickToolObj && this.quickToolObj.imageQTBar && this.quickToolObj.imageQTBar.element.contains(e.target)) && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      this.cancelResizeAction();\n    }\n\n    if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n      if (target.tagName !== 'IMG') {\n        this.removeResizeEle();\n      }\n\n      if (target.tagName !== 'IMG' && !isNOU(this.imgEle)) {\n        this.imgEle.style.outline = '';\n      } else if (!isNOU(this.prevSelectedImgEle) && this.prevSelectedImgEle !== target) {\n        this.prevSelectedImgEle.style.outline = '';\n      }\n    }\n  };\n\n  Image.prototype.removeResizeEle = function () {\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n    detach(this.contentModule.getEditPanel().querySelector('.e-img-resize'));\n  };\n\n  Image.prototype.onWindowResize = function () {\n    if (!isNOU(this.contentModule) && !isNOU(this.contentModule.getEditPanel().querySelector('.e-img-resize'))) {\n      this.cancelResizeAction();\n    }\n  }; // eslint-disable-next-line\n\n\n  Image.prototype.imageUrlPopup = function (e) {\n    var _this = this;\n\n    var imgUrl = this.parent.createElement('div', {\n      className: 'imgUrl'\n    });\n    var placeUrl = this.i10n.getConstant('imageUrl');\n    this.inputUrl = this.parent.createElement('input', {\n      className: 'e-input e-img-url',\n      attrs: {\n        placeholder: placeUrl,\n        spellcheck: 'false'\n      }\n    });\n    this.inputUrl.addEventListener('input', function () {\n      if (!isNOU(_this.inputUrl)) {\n        if (_this.inputUrl.value.length === 0) {\n          _this.dialogObj.getButtons(0).element.disabled = true;\n        } else {\n          _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n        }\n      }\n    });\n    imgUrl.appendChild(this.inputUrl);\n    return imgUrl;\n  }; // eslint-disable-next-line\n\n\n  Image.prototype.insertImageUrl = function (e) {\n    var proxy = this.selfImage;\n    proxy.isImgUploaded = false;\n    var url = proxy.inputUrl.value;\n\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n\n    if (!isNullOrUndefined(proxy.uploadUrl) && proxy.uploadUrl.url !== '') {\n      proxy.uploadUrl.cssClass = proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK;\n      proxy.dialogObj.hide({\n        returnValue: false\n      });\n      proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, proxy.uploadUrl);\n      proxy.uploadUrl.url = '';\n\n      if (proxy.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n        proxy.imgEle.style.outline = '';\n        proxy.removeResizeEle();\n      }\n    } else if (url !== '') {\n      if (proxy.parent.editorMode === 'HTML' && isNullOrUndefined(closest( // eslint-disable-next-line\n      this.selection.range.startContainer.parentNode, '[id=' + \"'\" + proxy.contentModule.getPanel().id + \"'\" + ']'))) {\n        proxy.contentModule.getEditPanel().focus();\n        var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.contentModule.getDocument());\n        this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.contentModule.getDocument());\n        this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      }\n\n      var regex = /[\\w-]+.(jpg|png|jpeg|gif)/g;\n      var matchUrl = !isNullOrUndefined(url.match(regex)) && proxy.parent.editorMode === 'HTML' ? url.match(regex)[0] : '';\n      var value = {\n        cssClass: proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK,\n        url: url,\n        selection: this.selection,\n        altText: matchUrl,\n        selectParent: this.selectParent,\n        width: {\n          width: proxy.parent.insertImageSettings.width,\n          minWidth: proxy.parent.insertImageSettings.minWidth,\n          maxWidth: proxy.parent.getInsertImgMaxWidth()\n        },\n        height: {\n          height: proxy.parent.insertImageSettings.height,\n          minHeight: proxy.parent.insertImageSettings.minHeight,\n          maxHeight: proxy.parent.insertImageSettings.maxHeight\n        }\n      };\n      proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, value);\n      proxy.dialogObj.hide({\n        returnValue: false\n      });\n    }\n  };\n\n  Image.prototype.imgsizeInput = function (e) {\n    var _this = this;\n\n    var selectNode = e.selectNode[0];\n    var imgHeight = this.i10n.getConstant('imageHeight');\n    var imgWidth = this.i10n.getConstant('imageWidth');\n    var imgSizeWrap = this.parent.createElement('div', {\n      className: 'e-img-sizewrap'\n    });\n    var widthVal = isNullOrUndefined(this.changedWidthValue) && (selectNode.style.width.toString() === 'auto' || selectNode.style.width !== '') ? selectNode.style.width : !isNullOrUndefined(this.changedWidthValue) ? this.changedWidthValue : parseInt(selectNode.getClientRects()[0].width.toString(), 10).toString();\n    var heightVal = isNullOrUndefined(this.changedHeightValue) && (selectNode.style.height.toString() === 'auto' || selectNode.style.height !== '') ? selectNode.style.height : !isNullOrUndefined(this.changedHeightValue) ? this.changedHeightValue : parseInt(selectNode.getClientRects()[0].height.toString(), 10).toString();\n    this.changedWidthValue = null;\n    this.changedHeightValue = null;\n    var content = '<div class=\"e-rte-label\"><label>' + imgWidth + '</label></div><div class=\"e-rte-field\"><input type=\"text\" id=\"imgwidth\" class=\"e-img-width\" value=' + widthVal + ' /></div>' + '<div class=\"e-rte-label\">' + '<label>' + imgHeight + '</label></div><div class=\"e-rte-field\"> ' + '<input type=\"text\" id=\"imgheight\" class=\"e-img-height\" value=' + heightVal + ' /></div>';\n    var contentElem = parseHtml(content);\n    imgSizeWrap.appendChild(contentElem);\n    var widthNum = new TextBox({\n      value: formatUnit(widthVal),\n      enableRtl: this.parent.enableRtl,\n      input: function (e) {\n        _this.inputWidthValue = formatUnit(_this.inputValue(e.value));\n      }\n    });\n    widthNum.createElement = this.parent.createElement;\n    widthNum.appendTo(imgSizeWrap.querySelector('#imgwidth'));\n    var heightNum = new TextBox({\n      value: formatUnit(heightVal),\n      enableRtl: this.parent.enableRtl,\n      input: function (e) {\n        _this.inputHeightValue = formatUnit(_this.inputValue(e.value));\n      }\n    });\n    heightNum.createElement = this.parent.createElement;\n    heightNum.appendTo(imgSizeWrap.querySelector('#imgheight'));\n    return imgSizeWrap;\n  };\n\n  Image.prototype.inputValue = function (value) {\n    if (value === 'auto' || value.indexOf('%') !== -1 || value.indexOf('px') !== -1 || value.match(/(\\d+)/)) {\n      return value;\n    } else {\n      return 'auto';\n    }\n  };\n\n  Image.prototype.insertSize = function (e) {\n    e.selection.restore();\n    var proxy = e.selfImage;\n\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n\n    var dialogEle = proxy.dialogObj.element;\n    this.changedWidthValue = this.inputWidthValue;\n    this.changedHeightValue = this.inputHeightValue;\n    var width = dialogEle.querySelector('.e-img-width').value;\n    var height = dialogEle.parentElement.querySelector('.e-img-height').value;\n    proxy.parent.formatter.process(this.parent, e.args, e.args, {\n      width: width,\n      height: height,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand\n    });\n\n    if (this.imgResizeDiv) {\n      proxy.imgResizePos(e.selectNode[0], this.imgResizeDiv);\n    }\n\n    proxy.dialogObj.hide({\n      returnValue: true\n    });\n  };\n\n  Image.prototype.insertImage = function (e) {\n    this.imagDialog(e);\n\n    if (!isNullOrUndefined(this.dialogObj)) {\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      var dialogContent = this.dialogObj.element.querySelector('.e-img-content');\n\n      if (!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown' || this.parent.editorMode === 'HTML') {\n        document.getElementById(this.rteID + '_insertImage').focus();\n      } else {\n        dialogContent.querySelector('.e-img-url').focus();\n      }\n    }\n  };\n\n  Image.prototype.imgUpload = function (e) {\n    var _this = this;\n\n    var save;\n    var selectParent; // eslint-disable-next-line\n\n    var proxy = this;\n    var iframe = proxy.parent.iframeSettings.enable;\n\n    if (proxy.parent.editorMode === 'HTML' && (!iframe && isNullOrUndefined(closest(e.selection.range.startContainer.parentNode, '[id=' // eslint-disable-next-line\n    + \"'\" + this.parent.contentModule.getPanel().id + \"'\" + ']')) || iframe && !hasClass(e.selection.range.startContainer.parentNode.ownerDocument.querySelector('body'), 'e-lib'))) {\n      this.contentModule.getEditPanel().focus();\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n    } else {\n      save = e.selection;\n      selectParent = e.selectParent;\n    }\n\n    var uploadParentEle = this.parent.createElement('div', {\n      className: 'e-img-uploadwrap e-droparea'\n    });\n    var deviceImgUpMsg = this.i10n.getConstant('imageDeviceUploadMessage');\n    var imgUpMsg = this.i10n.getConstant('imageUploadMessage');\n    var span = this.parent.createElement('span', {\n      className: 'e-droptext'\n    });\n    var spanMsg = this.parent.createElement('span', {\n      className: 'e-rte-upload-text',\n      innerHTML: Browser.isDevice ? deviceImgUpMsg : imgUpMsg\n    });\n    span.appendChild(spanMsg);\n    var btnEle = this.parent.createElement('button', {\n      className: 'e-browsebtn',\n      id: this.rteID + '_insertImage',\n      attrs: {\n        autofocus: 'true',\n        type: 'button'\n      }\n    });\n    span.appendChild(btnEle);\n    uploadParentEle.appendChild(span);\n    var browserMsg = this.i10n.getConstant('browse');\n    var button = new Button({\n      content: browserMsg,\n      enableRtl: this.parent.enableRtl\n    });\n    button.isStringTemplate = true;\n    button.createElement = this.parent.createElement;\n    button.appendTo(btnEle);\n    var btnClick = Browser.isDevice ? span : btnEle;\n    EventHandler.add(btnClick, 'click', this.fileSelect, this);\n    var uploadEle = this.parent.createElement('input', {\n      id: this.rteID + '_upload',\n      attrs: {\n        type: 'File',\n        name: 'UploadFiles'\n      }\n    });\n    uploadParentEle.appendChild(uploadEle);\n    var altText;\n    var rawFile;\n    var selectArgs;\n    var filesData;\n    var beforeUploadArgs;\n    this.uploadObj = new Uploader({\n      asyncSettings: {\n        saveUrl: this.parent.insertImageSettings.saveUrl,\n        removeUrl: this.parent.insertImageSettings.removeUrl\n      },\n      dropArea: span,\n      multiple: false,\n      enableRtl: this.parent.enableRtl,\n      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n      selected: function (e) {\n        proxy.isImgUploaded = true;\n        selectArgs = e;\n        filesData = e.filesData;\n\n        if (_this.parent.isServerRendered) {\n          selectArgs = JSON.parse(JSON.stringify(e));\n          e.cancel = true;\n          rawFile = e.filesData;\n          selectArgs.filesData = rawFile;\n        }\n\n        _this.parent.trigger(events.imageSelected, selectArgs, function (selectArgs) {\n          if (!selectArgs.cancel) {\n            _this.checkExtension(selectArgs.filesData[0]);\n\n            altText = selectArgs.filesData[0].name;\n\n            if (_this.parent.editorMode === 'HTML' && isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n              var reader_1 = new FileReader(); // eslint-disable-next-line\n\n              reader_1.addEventListener('load', function (e) {\n                var url = _this.parent.insertImageSettings.saveFormat === 'Base64' ? reader_1.result : URL.createObjectURL(convertToBlob(reader_1.result));\n                proxy.uploadUrl = {\n                  url: url,\n                  selection: save,\n                  altText: altText,\n                  selectParent: selectParent,\n                  width: {\n                    width: proxy.parent.insertImageSettings.width,\n                    minWidth: proxy.parent.insertImageSettings.minWidth,\n                    maxWidth: proxy.parent.getInsertImgMaxWidth()\n                  },\n                  height: {\n                    height: proxy.parent.insertImageSettings.height,\n                    minHeight: proxy.parent.insertImageSettings.minHeight,\n                    maxHeight: proxy.parent.insertImageSettings.maxHeight\n                  }\n                };\n                proxy.inputUrl.setAttribute('disabled', 'true');\n\n                if (isNullOrUndefined(proxy.parent.insertImageSettings.saveUrl) && _this.isAllowedTypes && !isNullOrUndefined(_this.dialogObj)) {\n                  _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                }\n              });\n              reader_1.readAsDataURL(selectArgs.filesData[0].rawFile);\n            }\n\n            if (_this.parent.isServerRendered) {\n              /* eslint-disable */\n              _this.uploadObj._internalRenderSelect(selectArgs, rawFile);\n              /* eslint-enable */\n\n            }\n          }\n        });\n      },\n      beforeUpload: function (args) {\n        if (_this.parent.isServerRendered) {\n          beforeUploadArgs = JSON.parse(JSON.stringify(args));\n          beforeUploadArgs.filesData = filesData;\n          args.cancel = true;\n\n          _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n            if (beforeUploadArgs.cancel) {\n              return;\n            }\n            /* eslint-disable */\n\n\n            _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ? beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n            _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ? beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n\n            _this.uploadObj.uploadFiles(rawFile, null);\n            /* eslint-enable */\n\n          });\n        } else {\n          _this.parent.trigger(events.beforeImageUpload, args);\n        }\n      },\n      uploading: function (e) {\n        if (!_this.parent.isServerRendered) {\n          _this.parent.trigger(events.imageUploading, e);\n        }\n      },\n      success: function (e) {\n        _this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n          if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n            var url = _this.parent.insertImageSettings.path + e.file.name; // eslint-disable-next-line\n\n            var value = {\n              url: url,\n              selection: save\n            };\n            proxy.uploadUrl = {\n              url: url,\n              selection: save,\n              altText: altText,\n              selectParent: selectParent,\n              width: {\n                width: proxy.parent.insertImageSettings.width,\n                minWidth: proxy.parent.insertImageSettings.minWidth,\n                maxWidth: proxy.parent.getInsertImgMaxWidth()\n              },\n              height: {\n                height: proxy.parent.insertImageSettings.height,\n                minHeight: proxy.parent.insertImageSettings.minHeight,\n                maxHeight: proxy.parent.insertImageSettings.maxHeight\n              }\n            };\n            proxy.inputUrl.setAttribute('disabled', 'true');\n          }\n\n          if (e.operation === 'upload' && !isNullOrUndefined(_this.dialogObj)) {\n            _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n          }\n        });\n      },\n      failure: function (e) {\n        _this.parent.trigger(events.imageUploadFailed, e);\n      },\n      removing: function () {\n        // eslint-disable-next-line\n        _this.parent.trigger(events.imageRemoving, e, function (e) {\n          proxy.isImgUploaded = false;\n          _this.dialogObj.getButtons(0).element.disabled = true;\n          proxy.inputUrl.removeAttribute('disabled');\n\n          if (proxy.uploadUrl) {\n            proxy.uploadUrl.url = '';\n          }\n        });\n      }\n    });\n    this.uploadObj.isStringTemplate = true;\n    this.uploadObj.createElement = this.parent.createElement;\n    this.uploadObj.appendTo(uploadEle);\n    return uploadParentEle;\n  };\n\n  Image.prototype.checkExtension = function (e) {\n    if (this.uploadObj.allowedExtensions) {\n      if (this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(('.' + e.type).toLocaleLowerCase()) === -1) {\n        this.dialogObj.getButtons(0).element.setAttribute('disabled', 'disabled');\n        this.isAllowedTypes = false;\n      } else {\n        this.isAllowedTypes = true;\n      }\n    }\n  };\n\n  Image.prototype.fileSelect = function () {\n    this.dialogObj.element.getElementsByClassName('e-file-select-wrap')[0].querySelector('button').click();\n    return false;\n  };\n\n  Image.prototype.dragStart = function (e) {\n    if (e.target.nodeName === 'IMG') {\n      this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n        if (actionBeginArgs.cancel) {\n          e.preventDefault();\n        } else {\n          e.dataTransfer.effectAllowed = 'copyMove';\n          e.target.classList.add(classes.CLS_RTE_DRAG_IMAGE);\n        }\n      });\n    } else {\n      return true;\n    }\n  };\n\n  Image.prototype.dragEnter = function (e) {\n    e.dataTransfer.dropEffect = 'copy';\n    e.preventDefault();\n  };\n\n  Image.prototype.dragOver = function (e) {\n    if (Browser.info.name === 'edge' && e.dataTransfer.items[0].type.split('/')[0].indexOf('image') > -1 || Browser.isIE && e.dataTransfer.types[0] === 'Files') {\n      e.preventDefault();\n    } else {\n      return true;\n    }\n  };\n  /**\n   * Used to set range When drop an image\n   *\n   * @param {ImageDropEventArgs} args - specifies the image arguments.\n   * @returns {void}\n   */\n\n\n  Image.prototype.dragDrop = function (args) {\n    var _this = this;\n\n    this.parent.trigger(events.beforeImageDrop, args, function (e) {\n      var imgElement = _this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n\n      var isImgOrFileDrop = imgElement && imgElement.tagName === 'IMG' || e.dataTransfer.files.length > 0;\n\n      if (!e.cancel && isImgOrFileDrop) {\n        _this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n          if (actionBeginArgs.cancel) {\n            e.preventDefault();\n          } else {\n            if (closest(e.target, '#' + _this.parent.getID() + '_toolbar') || _this.parent.inputElement.contentEditable === 'false') {\n              e.preventDefault();\n              return;\n            }\n\n            if (_this.parent.element.querySelector('.' + classes.CLS_IMG_RESIZE)) {\n              detach(_this.imgResizeDiv);\n            }\n\n            e.preventDefault();\n            var range = void 0;\n\n            if (_this.contentModule.getDocument().caretRangeFromPoint) {\n              //For chrome\n              range = _this.contentModule.getDocument().caretRangeFromPoint(e.clientX, e.clientY);\n            } else if (e.rangeParent) {\n              //For mozilla firefox\n              range = _this.contentModule.getDocument().createRange();\n              range.setStart(e.rangeParent, e.rangeOffset);\n            } else {\n              range = _this.getDropRange(e.clientX, e.clientY); //For internet explorer\n            }\n\n            _this.parent.notify(events.selectRange, {\n              range: range\n            });\n\n            var uploadArea = _this.parent.element.querySelector('.' + classes.CLS_DROPAREA);\n\n            if (uploadArea) {\n              return;\n            }\n\n            _this.insertDragImage(e);\n          }\n        });\n      } else {\n        if (isImgOrFileDrop) {\n          e.preventDefault();\n        }\n      }\n    });\n  };\n  /**\n   * Used to calculate range on internet explorer\n   *\n   * @param {number} x - specifies the x range.\n   * @param {number} y - specifies the y range.\n   * @returns {void}\n   */\n\n\n  Image.prototype.getDropRange = function (x, y) {\n    var startRange = this.contentModule.getDocument().createRange();\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), startRange);\n    var elem = this.contentModule.getDocument().elementFromPoint(x, y);\n    var startNode = elem.childNodes.length > 0 ? elem.childNodes[0] : elem;\n    var startCharIndexCharacter = 0;\n\n    if (this.parent.inputElement.firstChild.innerHTML === '<br>') {\n      startRange.setStart(startNode, startCharIndexCharacter);\n      startRange.setEnd(startNode, startCharIndexCharacter);\n    } else {\n      var rangeRect = void 0;\n\n      do {\n        startCharIndexCharacter++;\n        startRange.setStart(startNode, startCharIndexCharacter);\n        startRange.setEnd(startNode, startCharIndexCharacter + 1);\n        rangeRect = startRange.getBoundingClientRect();\n      } while (rangeRect.left < x && startCharIndexCharacter < startNode.length - 1);\n    }\n\n    return startRange;\n  };\n\n  Image.prototype.insertDragImage = function (e) {\n    var _this = this;\n\n    e.preventDefault();\n    var activePopupElement = this.parent.element.querySelector('' + classes.CLS_POPUP_OPEN);\n    this.parent.notify(events.drop, {\n      args: e\n    });\n\n    if (activePopupElement) {\n      activePopupElement.classList.add(classes.CLS_HIDE);\n    }\n\n    var imgElement = this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n\n    if (e.dataTransfer.files.length > 0 && imgElement === null) {\n      //For external image drag and drop\n      if (e.dataTransfer.files.length > 1) {\n        return;\n      }\n\n      var imgFiles = e.dataTransfer.files;\n      var fileName = imgFiles[0].name;\n      var imgType = fileName.substring(fileName.lastIndexOf('.'));\n      var allowedTypes = this.parent.insertImageSettings.allowedTypes;\n\n      for (var i = 0; i < allowedTypes.length; i++) {\n        if (imgType.toLocaleLowerCase() === allowedTypes[i].toLowerCase()) {\n          if (this.parent.insertImageSettings.saveUrl) {\n            this.onSelect(e);\n          } else {\n            var args = {\n              args: e,\n              text: '',\n              file: imgFiles[0]\n            };\n            e.preventDefault();\n            this.imagePaste(args);\n          }\n        }\n      }\n    } else {\n      //For internal image drag and drop\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n\n      if (imgElement && imgElement.tagName === 'IMG') {\n        if (imgElement.nextElementSibling) {\n          if (imgElement.nextElementSibling.classList.contains(classes.CLS_IMG_INNER)) {\n            range.insertNode(imgElement.parentElement.parentElement);\n          } else {\n            range.insertNode(imgElement);\n          }\n        } else {\n          range.insertNode(imgElement);\n        }\n\n        imgElement.classList.remove(classes.CLS_RTE_DRAG_IMAGE);\n        var imgArgs_1 = {\n          elements: [imgElement]\n        };\n        imgElement.addEventListener('load', function () {\n          _this.parent.trigger(events.actionComplete, imgArgs_1);\n        });\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        var args = e;\n        this.resizeStart(args, imgElement);\n        this.hideImageQuickToolbar();\n      }\n    }\n  };\n\n  Image.prototype.onSelect = function (args) {\n    var _this = this; // eslint-disable-next-line\n\n\n    var proxy = this;\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var parentElement = this.parent.createElement('ul', {\n      className: classes.CLS_UPLOAD_FILES\n    });\n    this.parent.element.appendChild(parentElement);\n    var validFiles = {\n      name: '',\n      size: 0,\n      status: '',\n      statusCode: '',\n      type: '',\n      rawFile: args.dataTransfer.files[0],\n      validationMessages: {}\n    };\n    var imageTag = this.parent.createElement('IMG');\n    imageTag.style.opacity = '0.5';\n    imageTag.classList.add(classes.CLS_RTE_IMAGE);\n    imageTag.classList.add(classes.CLS_IMGINLINE);\n    imageTag.classList.add(classes.CLS_RESIZE);\n    var file = validFiles.rawFile;\n    var reader = new FileReader();\n    reader.addEventListener('load', function () {\n      var url = URL.createObjectURL(convertToBlob(reader.result));\n      imageTag.src = proxy.parent.insertImageSettings.saveFormat === 'Blob' ? url : reader.result;\n    });\n\n    if (file) {\n      reader.readAsDataURL(file);\n    }\n\n    range.insertNode(imageTag);\n    this.uploadMethod(args, imageTag);\n    var e = {\n      elements: [imageTag]\n    };\n    imageTag.addEventListener('load', function () {\n      _this.parent.trigger(events.actionComplete, e);\n    });\n    detach(parentElement);\n  };\n  /**\n   * Rendering uploader and popup for drag and drop\n   *\n   * @param {DragEvent} dragEvent - specifies the event.\n   * @param {HTMLImageElement} imageElement - specifies the element.\n   * @returns {void}\n   */\n\n\n  Image.prototype.uploadMethod = function (dragEvent, imageElement) {\n    var _this = this;\n\n    var isUploading = false; // eslint-disable-next-line\n\n    var proxy = this;\n    var popupEle = this.parent.createElement('div');\n    this.parent.element.appendChild(popupEle);\n    var uploadEle = this.parent.createElement('input', {\n      id: this.rteID + '_upload',\n      attrs: {\n        type: 'File',\n        name: 'UploadFiles'\n      }\n    });\n    var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n    this.popupObj = new Popup(popupEle, {\n      relateTo: imageElement,\n      height: '85px',\n      width: '300px',\n      offsetY: offsetY,\n      content: uploadEle,\n      viewPortElement: this.parent.element,\n      position: {\n        X: 'center',\n        Y: 'top'\n      },\n      enableRtl: this.parent.enableRtl,\n      zIndex: 10001,\n      // eslint-disable-next-line\n      close: function (event) {\n        _this.parent.isBlur = false;\n\n        _this.popupObj.destroy();\n\n        detach(_this.popupObj.element);\n        _this.popupObj = null;\n\n        if (!_this.parent.inlineMode.enable) {\n          _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(false);\n        }\n      }\n    });\n    this.popupObj.element.style.display = 'none';\n    addClass([this.popupObj.element], classes.CLS_POPUP_OPEN);\n    addClass([this.popupObj.element], classes.CLS_RTE_UPLOAD_POPUP);\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var timeOut = dragEvent.dataTransfer.files[0].size > 1000000 ? 300 : 100;\n    setTimeout(function () {\n      proxy.refreshPopup(imageElement);\n    }, timeOut);\n    var rawFile;\n    var beforeUploadArgs;\n    this.uploadObj = new Uploader({\n      asyncSettings: {\n        saveUrl: this.parent.insertImageSettings.saveUrl,\n        removeUrl: this.parent.insertImageSettings.removeUrl\n      },\n      cssClass: classes.CLS_RTE_DIALOG_UPLOAD,\n      dropArea: this.parent.element,\n      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n      removing: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n        isUploading = false;\n        detach(imageElement);\n\n        _this.popupObj.close();\n      },\n      canceling: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n        isUploading = false;\n        detach(imageElement);\n\n        _this.popupObj.close();\n\n        _this.quickToolObj.imageQTBar.hidePopup();\n\n        setTimeout(function () {\n          _this.uploadObj.destroy();\n        }, 900);\n      },\n      beforeUpload: function (args) {\n        if (_this.parent.isServerRendered) {\n          beforeUploadArgs = JSON.parse(JSON.stringify(args));\n          beforeUploadArgs.filesData = rawFile;\n          isUploading = true;\n          args.cancel = true;\n\n          _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n            if (beforeUploadArgs.cancel) {\n              return;\n            }\n\n            if (!_this.parent.inlineMode.enable) {\n              _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n            }\n            /* eslint-disable */\n\n\n            _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ? beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n            _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ? beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n\n            _this.uploadObj.uploadFiles(rawFile, null);\n\n            _this.parent.inputElement.contentEditable = 'false';\n            /* eslint-enable */\n          });\n        } else {\n          _this.parent.trigger(events.beforeImageUpload, args);\n\n          if (!_this.parent.inlineMode.enable) {\n            _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n          }\n        }\n      },\n      uploading: function (e) {\n        if (!_this.parent.isServerRendered) {\n          isUploading = true;\n\n          _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n            if (imageUploadingArgs.cancel) {\n              if (!isNullOrUndefined(imageElement)) {\n                detach(imageElement);\n              }\n\n              if (!isNullOrUndefined(_this.popupObj.element)) {\n                detach(_this.popupObj.element);\n              }\n            } else {\n              _this.parent.inputElement.contentEditable = 'false';\n            }\n          });\n        }\n      },\n      selected: function (e) {\n        if (isUploading) {\n          e.cancel = true;\n        }\n\n        if (_this.parent.isServerRendered) {\n          rawFile = e.filesData;\n        }\n      },\n      failure: function (e) {\n        isUploading = false;\n        _this.parent.inputElement.contentEditable = 'true';\n        var args = {\n          args: dragEvent,\n          type: 'Images',\n          isNotify: undefined,\n          elements: imageElement\n        };\n        setTimeout(function () {\n          _this.uploadFailure(imageElement, args, e);\n        }, 900);\n      },\n      success: function (e) {\n        if (e.operation === \"cancel\") {\n          return;\n        }\n\n        isUploading = false;\n        _this.parent.inputElement.contentEditable = 'true';\n        var args = {\n          args: dragEvent,\n          type: 'Images',\n          isNotify: undefined,\n          elements: imageElement\n        };\n        setTimeout(function () {\n          _this.uploadSuccess(imageElement, dragEvent, args, e);\n        }, 900);\n      }\n    });\n    this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n    this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap').style.display = 'none';\n    range.selectNodeContents(imageElement);\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), range);\n  };\n\n  Image.prototype.refreshPopup = function (imageElement) {\n    var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop + imageElement.offsetTop : imageElement.offsetTop;\n    var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n\n    if (imgPosition > rtePosition) {\n      this.popupObj.relateTo = this.parent.inputElement;\n      this.popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n      this.popupObj.element.style.display = 'block';\n    } else {\n      if (this.popupObj) {\n        this.popupObj.refreshPosition(imageElement);\n        this.popupObj.element.style.display = 'block';\n      }\n    }\n  };\n  /**\n   * Called when drop image upload was failed\n   *\n   * @param {HTMLElement} imgEle - specifies the image element.\n   * @param {IShowPopupArgs} args - specifies the arguments.\n   * @param {Object} e - specfies the object.\n   * @returns {void}\n   */\n\n\n  Image.prototype.uploadFailure = function (imgEle, args, e) {\n    detach(imgEle);\n\n    if (this.popupObj) {\n      this.popupObj.close();\n    }\n\n    this.parent.trigger(events.imageUploadFailed, e);\n    this.uploadObj.destroy();\n  };\n  /**\n   * Called when drop image upload was successful\n   *\n   * @param {HTMLElement} imageElement - specifies the image element.\n   * @param {DragEvent} dragEvent - specifies the drag event.\n   * @param {IShowPopupArgs} args - specifies the arguments.\n   * @param {ImageSuccessEventArgs} e - specifies the success event.\n   * @returns {void}\n   */\n\n\n  Image.prototype.uploadSuccess = function (imageElement, dragEvent, args, e) {\n    var _this = this;\n\n    imageElement.style.opacity = '1';\n    imageElement.classList.add(classes.CLS_IMG_FOCUS);\n    e.element = imageElement;\n    this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n      if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n        var url = _this.parent.insertImageSettings.path + e.file.name;\n        imageElement.src = url;\n        imageElement.setAttribute('alt', e.file.name);\n      }\n    });\n\n    if (this.popupObj) {\n      this.popupObj.close();\n      this.uploadObj.destroy();\n    }\n\n    this.showImageQuickToolbar(args);\n    this.resizeStart(dragEvent, imageElement);\n  };\n\n  Image.prototype.imagePaste = function (args) {\n    var _this = this;\n\n    if (args.text.length === 0 && !isNullOrUndefined(args.file)) {\n      // eslint-disable-next-line\n      var proxy_1 = this;\n      var reader_2 = new FileReader();\n      args.args.preventDefault(); // eslint-disable-next-line\n\n      reader_2.addEventListener('load', function (e) {\n        var url = {\n          cssClass: proxy_1.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK,\n          url: _this.parent.insertImageSettings.saveFormat === 'Base64' || !isNullOrUndefined(args.callBack) ? reader_2.result : URL.createObjectURL(convertToBlob(reader_2.result)),\n          width: {\n            width: proxy_1.parent.insertImageSettings.width,\n            minWidth: proxy_1.parent.insertImageSettings.minWidth,\n            maxWidth: proxy_1.parent.getInsertImgMaxWidth()\n          },\n          height: {\n            height: proxy_1.parent.insertImageSettings.height,\n            minHeight: proxy_1.parent.insertImageSettings.minHeight,\n            maxHeight: proxy_1.parent.insertImageSettings.maxHeight\n          }\n        };\n\n        if (!isNullOrUndefined(args.callBack)) {\n          args.callBack(url);\n          return;\n        } else {\n          proxy_1.parent.formatter.process(proxy_1.parent, {\n            item: {\n              command: 'Images',\n              subCommand: 'Image'\n            }\n          }, args.args, url);\n\n          _this.showPopupToolBar(args, url);\n        }\n      });\n      reader_2.readAsDataURL(args.file);\n    }\n  };\n\n  Image.prototype.showPopupToolBar = function (e, url) {\n    var _this = this;\n\n    var imageSrc = 'img[src=\"' + url.url + '\"]';\n    var imageElement = this.parent.inputElement.querySelector(imageSrc);\n    this.parent.quickToolbarModule.createQTBar('Image', 'MultiRow', this.parent.quickToolbarSettings.image, RenderType.ImageToolbar);\n    var args = {\n      args: e.args,\n      type: 'Images',\n      isNotify: undefined,\n      elements: imageElement\n    };\n\n    if (imageElement) {\n      setTimeout(function () {\n        _this.showImageQuickToolbar(args);\n\n        _this.resizeStart(e.args, imageElement);\n      }, 0);\n    }\n  };\n  /* eslint-disable */\n\n  /**\n   * Destroys the ToolBar.\n   *\n   * @method destroy\n   * @returns {void}\n   * @hidden\n    */\n\n  /* eslint-enable */\n\n\n  Image.prototype.destroy = function () {\n    this.prevSelectedImgEle = undefined;\n    this.removeEventListener();\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {void}\n   */\n\n\n  Image.prototype.getModuleName = function () {\n    return 'image';\n  };\n\n  return Image;\n}();\n\nexport { Image };","map":{"version":3,"names":["addClass","detach","EventHandler","isNullOrUndefined","select","Ajax","formatUnit","Browser","closest","removeClass","isNOU","events","classes","Uploader","TextBox","Popup","Button","CheckBox","RenderType","dispatchEvent","parseHtml","hasClass","convertToBlob","isIDevice","Image","parent","serviceLocator","isImgUploaded","isAllowedTypes","pageX","pageY","deletedImg","rteID","element","id","i10n","getService","rendererFactory","dialogRenderObj","addEventListener","prototype","isDestroyed","on","keyDown","onKeyDown","keyUp","onKeyUp","insertImage","showImageDialog","showDialog","closeImageDialog","closeDialog","windowResize","onWindowResize","insertCompleted","showImageQuickToolbar","clearDialogObj","imageToolbarAction","onToolbarAction","imageCaption","caption","imageDelete","deleteImg","imageLink","insertImgLink","imageAlt","insertAltText","editAreaClick","editAreaClickHandler","iframeMouseDown","onIframeMouseDown","imageSize","dropDownSelect","alignmentSelect","initialEnd","afterRender","dynamicModule","paste","imagePaste","destroy","removeEventListener","off","dropElement","iframeSettings","enable","inputElement","ownerDocument","dragDrop","bind","dragStart","dragEnter","dragOver","contentModule","remove","getEditPanel","touchEndEvent","imageClick","formatter","editorManager","observer","checkUndo","undoStack","insertImageSettings","resize","touchStartEvent","resizeStart","onDocumentClick","onCutHandler","dialogObj","hide","returnValue","getRenderer","Content","add","args","subCommand","toLowerCase","i","getUndoRedoStack","length","temp","createElement","contentElem","text","appendChild","img","querySelectorAll","querySelector","j","style","outline","innerHTML","resizeEnd","e","resizeBtnInit","imgEle","parentElement","cursor","isDevice","target","event","requestType","trigger","resizeStop","getPointX","window","pageYOffset","getBoundingClientRect","top","clientY","saveData","ele","_this","readonly","prevSelectedImgEle","tagName","preventDefaultResize","imgResizeDiv","contains","imageResize","classList","getPointY","preventDefault","stopImmediatePropagation","quickToolObj","imageQTBar","hidePopup","resizeBtnStat","topLeft","topRight","botLeft","botRight","resizeStartArgs","cancel","cancelResizeAction","getDocument","setAttribute","focus","className","styles","imgResizePos","resizeImgDupPos","touchMoveEvent","resizing","touches","pos","calcPos","left","imgWid","width","imgHgt","height","borWid","parseInt","slice","devWid","elem","ignoreOffset","parentOffset","doc","offsetParent","indexOf","getID","documentElement","body","position","parentNode","nodeType","offsetTop","offsetLeft","setAspectRatio","expectedX","expectedY","match","parseFloat","minWidth","resizeByPercent","percentageValue","pixToPerc","previousElementSibling","Math","min","round","removeAttribute","currentWidth","right","toString","expected","parentEle","getComputedStyle","imgDupMouseMove","onResize","resizingArgs","getInsertImgMaxWidth","minHeight","maxHeight","setContentHeight","offsetWidth","offsetHeight","mouseX","mouseY","imgDupPos","notify","selectionRestore","item","fileManagerSettings","renderFileManager","openImgLink","editImgLink","removeImgLink","selectParent","process","url","href","selectNode","selectParentEle","linkUpdate","getConstant","inputDetails","header","btnText","isIE","selection","restore","isCapLink","captionEle","insertElement","document","originalEvent","range","save","selectNodeEle","isCursor","keyCodeValues","editorMode","nodeSelection","getRange","startContainer","endContainer","startOffset","endOffset","which","nodes","getNodeCollection","nodeName","push","code","isCursor_1","checkImageBack","checkImageDel","getParentNodeCollection","ctrlKey","key","action","prev","childNodes","removeResizeEle","setSelectionText","textContent","keyCode","event_1","command","close","src","imageRemovePost","CLS_CAPTION","CLS_CAPINLINE","nextElementSibling","openDialog","isInternal","member","markdownSelection","getSelectedText","module","name","getAttribute","afterImageDelete","previousSibling","nextSibling","alignImage","inline","break","imageWithLinkQTBarItemUpdate","separator","items","toolbarElement","display","newItems","addQTBarItem","type","quickToolbarModule","elements","forEach","call","index","isNotify","setTimeout","showPopup","hideImageQuickToolbar","showOnRightClick","quickToolbarSettings","Clear","setSelectionContents","isPopupOpen","selectionSave","imagDialog","linkWrap","linkUrl","content","linkTarget","inputLink","linkOpenLabel","checkBoxObj","label","checked","enableRtl","change","target_1","isStringTemplate","appendTo","linkargs_1","selfImage","link","setProperties","localeObj","X","Y","buttons","click","insertlink","buttonModel","cssClass","isPrimary","value","altText","altWrap","altHeader","getAlt","inputAlt","altArgs_1","alt","insertAlt","setSelectionRange","isUrl","proxy","regexp","test","captionClass","absoluteUrl","removeUrl","URL","baseURI","removingImgName","replace","xhr","XMLHttpRequest","readyState","status","triggerPost","response","open","responseType","send","file","File","ajax","formData","FormData","append","CLS_RTE_CAPTION","attrs","contenteditable","draggable","imgWrap","imgInner","parent_1","imgCaption","CLS_IMGINLINE","CLS_IMGBREAK","CLS_IMGLEFT","CLS_IMGRIGHT","CLS_IMGCENTER","imgSizeHeader","dialogContent","imgsizeInput","selectObj_1","insertSize","imgDialog","imgInsert","imglinkCancel","imgHeader","selectObj","dialogModel","CLS_RTE_ELEMENTS","locale","showCloseIcon","closeOnEscape","isModal","insertImageUrl","disabled","cancelDialog","animationSettings","effect","uploadObj","removing","isBlur","path","imgUpload","linkHeader","linkHeaderText","imageUrlPopup","render","inlineQTBar","toolbarSettings","getToolbarElement","offsetX","clientWidth","offsetY","clientHeight","imgUrl","placeUrl","inputUrl","placeholder","spellcheck","getButtons","uploadUrl","getPanel","regex","matchUrl","maxWidth","imgHeight","imgWidth","imgSizeWrap","widthVal","changedWidthValue","getClientRects","heightVal","changedHeightValue","widthNum","input","inputWidthValue","inputValue","heightNum","inputHeightValue","dialogEle","getElementById","iframe","uploadParentEle","deviceImgUpMsg","imgUpMsg","span","spanMsg","btnEle","autofocus","browserMsg","button","btnClick","fileSelect","uploadEle","rawFile","selectArgs","filesData","beforeUploadArgs","asyncSettings","saveUrl","dropArea","multiple","allowedExtensions","allowedTypes","selected","isServerRendered","JSON","parse","stringify","imageSelected","checkExtension","reader_1","FileReader","saveFormat","result","createObjectURL","readAsDataURL","_internalRenderSelect","beforeUpload","imageUploading","currentRequestHeader","currentRequest","customFormDatas","customFormData","uploadFiles","beforeImageUpload","uploading","success","imageUploadSuccess","operation","failure","imageUploadFailed","imageRemoving","toLocaleLowerCase","getElementsByClassName","actionBegin","actionBeginArgs","dataTransfer","effectAllowed","CLS_RTE_DRAG_IMAGE","dropEffect","info","split","types","beforeImageDrop","imgElement","isImgOrFileDrop","files","contentEditable","CLS_IMG_RESIZE","caretRangeFromPoint","clientX","rangeParent","createRange","setStart","rangeOffset","getDropRange","selectRange","uploadArea","CLS_DROPAREA","insertDragImage","x","y","startRange","setRange","elementFromPoint","startNode","startCharIndexCharacter","firstChild","setEnd","rangeRect","activePopupElement","CLS_POPUP_OPEN","drop","CLS_HIDE","imgFiles","fileName","imgType","substring","lastIndexOf","onSelect","CLS_IMG_INNER","insertNode","imgArgs_1","actionComplete","CLS_UPLOAD_FILES","validFiles","size","statusCode","validationMessages","imageTag","opacity","CLS_RTE_IMAGE","CLS_RESIZE","reader","uploadMethod","dragEvent","imageElement","isUploading","popupEle","popupObj","relateTo","viewPortElement","zIndex","inlineMode","toolbarModule","baseToolbar","toolbarObj","disable","CLS_RTE_UPLOAD_POPUP","timeOut","refreshPopup","CLS_RTE_DIALOG_UPLOAD","canceling","imageUploadingArgs","undefined","uploadFailure","uploadSuccess","selectNodeContents","imgPosition","rtePosition","refreshPosition","CLS_IMG_FOCUS","proxy_1","reader_2","callBack","showPopupToolBar","imageSrc","createQTBar","image","ImageToolbar","getModuleName"],"sources":["C:/Users/shahj/OneDrive/Documents/GitHub/Multifunctional-React-Dashboard/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/renderer/image-module.js"],"sourcesContent":["import { addClass, detach, EventHandler, isNullOrUndefined, select, Ajax, formatUnit } from '@syncfusion/ej2-base';\nimport { Browser, closest, removeClass, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as classes from '../base/classes';\nimport { Uploader, TextBox } from '@syncfusion/ej2-inputs';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { Button, CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType } from '../base/enum';\nimport { dispatchEvent, parseHtml, hasClass, convertToBlob } from '../base/util';\nimport { isIDevice } from '../../common/util';\n/**\n * `Image` module is used to handle image actions.\n */\nvar Image = /** @class */ (function () {\n    function Image(parent, serviceLocator) {\n        this.isImgUploaded = false;\n        this.isAllowedTypes = true;\n        this.pageX = null;\n        this.pageY = null;\n        this.deletedImg = [];\n        this.parent = parent;\n        this.rteID = parent.element.id;\n        this.i10n = serviceLocator.getService('rteLocale');\n        this.rendererFactory = serviceLocator.getService('rendererFactory');\n        this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n        this.addEventListener();\n    }\n    Image.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.keyDown, this.onKeyDown, this);\n        this.parent.on(events.keyUp, this.onKeyUp, this);\n        this.parent.on(events.insertImage, this.insertImage, this);\n        this.parent.on(events.showImageDialog, this.showDialog, this);\n        this.parent.on(events.closeImageDialog, this.closeDialog, this);\n        this.parent.on(events.windowResize, this.onWindowResize, this);\n        this.parent.on(events.insertCompleted, this.showImageQuickToolbar, this);\n        this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n        this.parent.on(events.imageToolbarAction, this.onToolbarAction, this);\n        this.parent.on(events.imageCaption, this.caption, this);\n        this.parent.on(events.imageDelete, this.deleteImg, this);\n        this.parent.on(events.imageLink, this.insertImgLink, this);\n        this.parent.on(events.imageAlt, this.insertAltText, this);\n        this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n        this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n        this.parent.on(events.imageSize, this.imageSize, this);\n        this.parent.on(events.dropDownSelect, this.alignmentSelect, this);\n        this.parent.on(events.initialEnd, this.afterRender, this);\n        this.parent.on(events.dynamicModule, this.afterRender, this);\n        this.parent.on(events.paste, this.imagePaste, this);\n        this.parent.on(events.destroy, this.removeEventListener, this);\n    };\n    Image.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.keyDown, this.onKeyDown);\n        this.parent.off(events.keyUp, this.onKeyUp);\n        this.parent.off(events.windowResize, this.onWindowResize);\n        this.parent.off(events.insertImage, this.insertImage);\n        this.parent.off(events.showImageDialog, this.showDialog);\n        this.parent.off(events.closeImageDialog, this.closeDialog);\n        this.parent.off(events.insertCompleted, this.showImageQuickToolbar);\n        this.parent.off(events.clearDialogObj, this.clearDialogObj);\n        this.parent.off(events.imageCaption, this.caption);\n        this.parent.off(events.imageToolbarAction, this.onToolbarAction);\n        this.parent.off(events.imageDelete, this.deleteImg);\n        this.parent.off(events.imageLink, this.insertImgLink);\n        this.parent.off(events.imageAlt, this.insertAltText);\n        this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n        this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n        this.parent.off(events.imageSize, this.imageSize);\n        this.parent.off(events.dropDownSelect, this.alignmentSelect);\n        this.parent.off(events.initialEnd, this.afterRender);\n        this.parent.off(events.dynamicModule, this.afterRender);\n        this.parent.off(events.paste, this.imagePaste);\n        this.parent.off(events.destroy, this.removeEventListener);\n        var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument\n            : this.parent.inputElement;\n        dropElement.removeEventListener('drop', this.dragDrop.bind(this), true);\n        dropElement.removeEventListener('dragstart', this.dragStart.bind(this), true);\n        dropElement.removeEventListener('dragenter', this.dragEnter.bind(this), true);\n        dropElement.removeEventListener('dragover', this.dragOver.bind(this), true);\n        if (!isNullOrUndefined(this.contentModule)) {\n            EventHandler.remove(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick);\n            this.parent.formatter.editorManager.observer.off(events.checkUndo, this.undoStack);\n            if (this.parent.insertImageSettings.resize) {\n                EventHandler.remove(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart);\n                EventHandler.remove(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick);\n                EventHandler.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler);\n            }\n        }\n    };\n    Image.prototype.onIframeMouseDown = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    Image.prototype.afterRender = function () {\n        this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n        EventHandler.add(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick, this);\n        if (this.parent.insertImageSettings.resize) {\n            EventHandler.add(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart, this);\n            EventHandler.add(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick, this);\n            EventHandler.add(this.contentModule.getEditPanel(), 'cut', this.onCutHandler, this);\n        }\n        var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument :\n            this.parent.inputElement;\n        dropElement.addEventListener('drop', this.dragDrop.bind(this), true);\n        dropElement.addEventListener('dragstart', this.dragStart.bind(this), true);\n        dropElement.addEventListener('dragenter', this.dragOver.bind(this), true);\n        dropElement.addEventListener('dragover', this.dragOver.bind(this), true);\n    };\n    Image.prototype.undoStack = function (args) {\n        if (args.subCommand.toLowerCase() === 'undo' || args.subCommand.toLowerCase() === 'redo') {\n            for (var i = 0; i < this.parent.formatter.getUndoRedoStack().length; i++) {\n                var temp = this.parent.createElement('div');\n                var contentElem = parseHtml(this.parent.formatter.getUndoRedoStack()[i].text);\n                temp.appendChild(contentElem);\n                var img = temp.querySelectorAll('img');\n                if (temp.querySelector('.e-img-resize') && img.length > 0) {\n                    for (var j = 0; j < img.length; j++) {\n                        img[j].style.outline = '';\n                    }\n                    detach(temp.querySelector('.e-img-resize'));\n                    this.parent.formatter.getUndoRedoStack()[i].text = temp.innerHTML;\n                }\n            }\n        }\n    };\n    Image.prototype.resizeEnd = function (e) {\n        this.resizeBtnInit();\n        this.imgEle.parentElement.style.cursor = 'auto';\n        if (Browser.isDevice) {\n            removeClass([e.target.parentElement], 'e-mob-span');\n        }\n        var args = { event: e, requestType: 'images' };\n        this.parent.trigger(events.resizeStop, args);\n        /* eslint-disable */\n        var pageX = this.getPointX(e);\n        var pageY = (this.parent.iframeSettings.enable) ? window.pageYOffset +\n            this.parent.element.getBoundingClientRect().top + e.clientY : e.pageY;\n        /* eslint-enable */\n        this.parent.formatter.editorManager.observer.on(events.checkUndo, this.undoStack, this);\n        this.parent.formatter.saveData();\n    };\n    Image.prototype.resizeStart = function (e, ele) {\n        var _this = this;\n        if (this.parent.readonly) {\n            return;\n        }\n        var target = ele ? ele : e.target;\n        this.prevSelectedImgEle = this.imgEle;\n        if (target.tagName === 'IMG') {\n            this.parent.preventDefaultResize(e);\n            var img = target;\n            if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n                detach(this.imgResizeDiv);\n            }\n            this.imageResize(img);\n        }\n        if (target.classList.contains('e-rte-imageboxmark')) {\n            if (this.parent.formatter.getUndoRedoStack().length === 0) {\n                this.parent.formatter.saveData();\n            }\n            this.pageX = this.getPointX(e);\n            this.pageY = this.getPointY(e);\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            this.resizeBtnInit();\n            if (this.quickToolObj) {\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n            if (target.classList.contains('e-rte-topLeft')) {\n                this.resizeBtnStat.topLeft = true;\n            }\n            if (target.classList.contains('e-rte-topRight')) {\n                this.resizeBtnStat.topRight = true;\n            }\n            if (target.classList.contains('e-rte-botLeft')) {\n                this.resizeBtnStat.botLeft = true;\n            }\n            if (target.classList.contains('e-rte-botRight')) {\n                this.resizeBtnStat.botRight = true;\n            }\n            if (Browser.isDevice && this.contentModule.getEditPanel().contains(this.imgResizeDiv) &&\n                !this.imgResizeDiv.classList.contains('e-mob-span')) {\n                addClass([this.imgResizeDiv], 'e-mob-span');\n            }\n            else {\n                var args = { event: e, requestType: 'images' };\n                this.parent.trigger(events.resizeStart, args, function (resizeStartArgs) {\n                    if (resizeStartArgs.cancel) {\n                        _this.cancelResizeAction();\n                    }\n                });\n            }\n            EventHandler.add(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd, this);\n        }\n    };\n    Image.prototype.imageClick = function (e) {\n        if (Browser.isDevice) {\n            if ((e.target.tagName === 'IMG' &&\n                e.target.parentElement.tagName === 'A') ||\n                (e.target.tagName === 'IMG')) {\n                this.contentModule.getEditPanel().setAttribute('contenteditable', 'false');\n                e.target.focus();\n            }\n            else {\n                if (!this.parent.readonly) {\n                    this.contentModule.getEditPanel().setAttribute('contenteditable', 'true');\n                }\n            }\n        }\n        if (e.target.tagName === 'IMG' &&\n            e.target.parentElement.tagName === 'A') {\n            e.preventDefault();\n        }\n    };\n    Image.prototype.onCutHandler = function () {\n        if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            this.cancelResizeAction();\n        }\n    };\n    Image.prototype.imageResize = function (e) {\n        this.resizeBtnInit();\n        this.imgEle = e;\n        addClass([this.imgEle], 'e-resize');\n        this.imgResizeDiv = this.parent.createElement('span', { className: 'e-img-resize', id: this.rteID + '_imgResize' });\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-topLeft', styles: 'cursor: nwse-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-topRight', styles: 'cursor: nesw-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-botLeft', styles: 'cursor: nesw-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-botRight', styles: 'cursor: nwse-resize'\n        }));\n        if (Browser.isDevice) {\n            addClass([this.imgResizeDiv], 'e-mob-rte');\n        }\n        e.style.outline = '2px solid #4a90e2';\n        this.imgResizePos(e, this.imgResizeDiv);\n        this.resizeImgDupPos(e);\n        this.contentModule.getEditPanel().appendChild(this.imgResizeDiv);\n        EventHandler.add(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing, this);\n    };\n    Image.prototype.getPointX = function (e) {\n        if (e.touches && e.touches.length) {\n            return e.touches[0].pageX;\n        }\n        else {\n            return e.pageX;\n        }\n    };\n    Image.prototype.getPointY = function (e) {\n        if (e.touches && e.touches.length) {\n            return e.touches[0].pageY;\n        }\n        else {\n            return e.pageY;\n        }\n    };\n    Image.prototype.imgResizePos = function (e, imgResizeDiv) {\n        var pos = this.calcPos(e);\n        var top = pos.top;\n        var left = pos.left;\n        var imgWid = e.width;\n        var imgHgt = e.height;\n        var borWid = (Browser.isDevice) ? (4 * parseInt((e.style.outline.slice(-3)), 10)) + 2 :\n            (2 * parseInt((e.style.outline.slice(-3)), 10)) + 2; //span border width + image outline width\n        var devWid = ((Browser.isDevice) ? 0 : 2); // span border width\n        imgResizeDiv.querySelector('.e-rte-botLeft').style.left = (left - borWid) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botLeft').style.top = ((imgHgt - borWid) + top) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botRight').style.left = ((imgWid - (borWid - devWid)) + left) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botRight').style.top = ((imgHgt - borWid) + top) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topRight').style.left = ((imgWid - (borWid - devWid)) + left) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topRight').style.top = (top - (borWid)) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topLeft').style.left = (left - borWid) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topLeft').style.top = (top - borWid) + 'px';\n    };\n    Image.prototype.calcPos = function (elem) {\n        var ignoreOffset = ['TD', 'TH', 'TABLE', 'A'];\n        var parentOffset = { top: 0, left: 0 };\n        var doc = elem.ownerDocument;\n        var offsetParent = ((elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption') ||\n            ignoreOffset.indexOf(elem.offsetParent.tagName) > -1)) ?\n            closest(elem, '#' + this.parent.getID() + '_rte-edit-view') : elem.offsetParent) || doc.documentElement;\n        while (offsetParent &&\n            (offsetParent === doc.body || offsetParent === doc.documentElement) &&\n            offsetParent.style.position === 'static') {\n            offsetParent = offsetParent.parentNode;\n        }\n        if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n            // eslint-disable-next-line\n            parentOffset = offsetParent.getBoundingClientRect();\n        }\n        return {\n            top: elem.offsetTop,\n            left: elem.offsetLeft\n        };\n    };\n    Image.prototype.setAspectRatio = function (img, expectedX, expectedY, e) {\n        if (isNullOrUndefined(img.width)) {\n            return;\n        }\n        var width = img.style.width !== '' ? img.style.width.match(/^\\d+(\\.\\d*)?%$/g) ? parseFloat(img.style.width) :\n            parseInt(img.style.width, 10) : img.width;\n        var height = img.style.height !== '' ? parseInt(img.style.height, 10) : img.height;\n        if (width > height) {\n            img.style.minWidth = '20px';\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n                    var percentageValue = this.pixToPerc((width / height * expectedY), (img.previousElementSibling || img.parentElement));\n                    img.style.width = Math.min(Math.round((percentageValue / img.getBoundingClientRect().width) * expectedX * 100) / 100, 100) + '%';\n                }\n                else {\n                    img.style.width = this.pixToPerc((width / height * expectedY), (img.previousElementSibling || img.parentElement)) + '%';\n                }\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else if (img.style.width === '' && img.style.height !== '') {\n                img.style.height = expectedY + 'px';\n            }\n            else if (img.style.width !== '' && img.style.height === '') {\n                var currentWidth = ((width / height * expectedY) + width / height) < (this.parent.inputElement.getBoundingClientRect().right - 32) ?\n                    ((width / height * expectedY) + width / height) : (this.parent.inputElement.getBoundingClientRect().right - 32);\n                img.style.width = currentWidth.toString() + 'px';\n            }\n            else if (img.style.width !== '') {\n                var currentWidth = (width / height * expectedY) < (this.parent.inputElement.getBoundingClientRect().right - 32) ?\n                    (width / height * expectedY) : (this.parent.inputElement.getBoundingClientRect().right - 32);\n                img.style.width = currentWidth + 'px';\n                img.style.height = expectedY + 'px';\n            }\n            else {\n                img.setAttribute('width', ((width / height * expectedY) + width / height).toString());\n            }\n        }\n        else if (height > width) {\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n                    img.style.width = Math.min(Math.round((width / img.getBoundingClientRect().width) * expectedX * 100) / 100, 100) + '%';\n                }\n                else {\n                    img.style.width = this.pixToPerc((expectedX / height * expectedY), (img.previousElementSibling || img.parentElement)) + '%';\n                }\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else if (img.style.width !== '') {\n                img.style.width = expectedX + 'px';\n                img.style.height = (height / width * expectedX) + 'px';\n            }\n            else {\n                img.setAttribute('width', this.resizeBtnStat.botRight ? (this.getPointX(e.event) - img.getBoundingClientRect().left).toString() : expectedX.toString());\n            }\n        }\n        else {\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                img.style.width = this.pixToPerc(expectedX, (img.previousElementSibling || img.parentElement)) + '%';\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else if (img.style.width !== '') {\n                img.style.width = expectedX + 'px';\n                img.style.height = expectedX + 'px';\n            }\n            else {\n                img.setAttribute('width', expectedX.toString());\n                img.setAttribute('height', expectedX.toString());\n            }\n        }\n    };\n    Image.prototype.pixToPerc = function (expected, parentEle) {\n        return expected / parseFloat(getComputedStyle(parentEle).width) * 100;\n    };\n    Image.prototype.imgDupMouseMove = function (width, height, e) {\n        var _this = this;\n        var args = { event: e, requestType: 'images' };\n        this.parent.trigger(events.onResize, args, function (resizingArgs) {\n            if (resizingArgs.cancel) {\n                _this.cancelResizeAction();\n            }\n            else {\n                if ((parseInt(_this.parent.insertImageSettings.minWidth, 10) >= parseInt(width, 10) ||\n                    (parseInt(_this.parent.getInsertImgMaxWidth(), 10) <= parseInt(width, 10) &&\n                        isNOU(_this.imgEle.style.width)))) {\n                    return;\n                }\n                if (!_this.parent.insertImageSettings.resizeByPercent &&\n                    (parseInt(_this.parent.insertImageSettings.minHeight, 10) >= parseInt(height, 10) ||\n                        parseInt(_this.parent.insertImageSettings.maxHeight, 10) <= parseInt(height, 10))) {\n                    return;\n                }\n                _this.imgEle.parentElement.style.cursor = 'pointer';\n                _this.setAspectRatio(_this.imgEle, parseInt(width, 10), parseInt(height, 10), args);\n                _this.resizeImgDupPos(_this.imgEle);\n                _this.imgResizePos(_this.imgEle, _this.imgResizeDiv);\n                _this.parent.setContentHeight('', false);\n            }\n        });\n    };\n    Image.prototype.resizing = function (e) {\n        if (this.imgEle.offsetWidth >= this.parent.getInsertImgMaxWidth()) {\n            this.imgEle.style.maxHeight = this.imgEle.offsetHeight + 'px';\n        }\n        var pageX = this.getPointX(e);\n        var pageY = this.getPointY(e);\n        var mouseX = (this.resizeBtnStat.botLeft || this.resizeBtnStat.topLeft) ? -(pageX - this.pageX) : (pageX - this.pageX);\n        var mouseY = (this.resizeBtnStat.topLeft || this.resizeBtnStat.topRight) ? -(pageY - this.pageY) : (pageY - this.pageY);\n        var width = parseInt(this.imgDupPos.width, 10) + mouseX;\n        var height = parseInt(this.imgDupPos.height, 10) + mouseY;\n        this.pageX = pageX;\n        this.pageY = pageY;\n        if (this.resizeBtnStat.botRight) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.botLeft) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.topRight) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.topLeft) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n    };\n    Image.prototype.cancelResizeAction = function () {\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n        if (this.imgEle && this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            detach(this.imgResizeDiv);\n            this.imgEle.style.outline = '';\n            this.imgResizeDiv = null;\n            this.pageX = null;\n            this.pageY = null;\n        }\n    };\n    Image.prototype.resizeImgDupPos = function (e) {\n        this.imgDupPos = {\n            width: (e.style.width !== '' && (this.parent.insertImageSettings &&\n                !this.parent.insertImageSettings.resizeByPercent)) ? this.imgEle.style.width : e.width + 'px',\n            height: (e.style.height !== '') ? this.imgEle.style.height : e.height + 'px'\n        };\n    };\n    Image.prototype.resizeBtnInit = function () {\n        return this.resizeBtnStat = { botLeft: false, botRight: false, topRight: false, topLeft: false };\n    };\n    Image.prototype.onToolbarAction = function (args) {\n        if (isIDevice()) {\n            this.parent.notify(events.selectionRestore, {});\n        }\n        var item = args.args.item;\n        switch (item.subCommand) {\n            case 'Replace':\n                if (this.parent.fileManagerSettings.enable) {\n                    this.parent.notify(events.renderFileManager, args);\n                }\n                else {\n                    this.parent.notify(events.insertImage, args);\n                }\n                break;\n            case 'Caption':\n                this.parent.notify(events.imageCaption, args);\n                break;\n            case 'InsertLink':\n                this.parent.notify(events.imageLink, args);\n                break;\n            case 'AltText':\n                this.parent.notify(events.imageAlt, args);\n                break;\n            case 'Remove':\n                this.parent.notify(events.imageDelete, args);\n                break;\n            case 'Dimension':\n                this.parent.notify(events.imageSize, args);\n                break;\n            case 'OpenImageLink':\n                this.openImgLink(args);\n                break;\n            case 'EditImageLink':\n                this.editImgLink(args);\n                break;\n            case 'RemoveImageLink':\n                this.removeImgLink(args);\n                break;\n        }\n    };\n    Image.prototype.openImgLink = function (e) {\n        var target = e.selectParent[0].parentNode.target === '' ? '_self' : '_blank';\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            url: e.selectParent[0].parentNode.href, target: target, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand\n        });\n    };\n    Image.prototype.editImgLink = function (e) {\n        var selectParentEle = e.selectParent[0].parentNode;\n        var linkUpdate = this.i10n.getConstant('dialogUpdate');\n        var inputDetails = {\n            url: selectParentEle.href, target: selectParentEle.target,\n            header: 'Edit Link', btnText: linkUpdate\n        };\n        this.insertImgLink(e, inputDetails);\n    };\n    Image.prototype.removeImgLink = function (e) {\n        if (Browser.isIE) {\n            this.contentModule.getEditPanel().focus();\n        }\n        e.selection.restore();\n        var isCapLink = (this.contentModule.getEditPanel().contains(this.captionEle) && select('a', this.captionEle)) ?\n            true : false;\n        var selectParent = isCapLink ? [this.captionEle] : [e.selectNode[0].parentElement];\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            insertElement: e.selectNode[0], selectParent: selectParent, selection: e.selection,\n            subCommand: e.args.item.subCommand\n        });\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            if (!isNullOrUndefined(e.selectParent)) {\n                removeClass([e.selectParent[0]], 'e-img-focus');\n            }\n        }\n        if (isCapLink) {\n            select('.e-img-inner', this.captionEle).focus();\n        }\n    };\n    Image.prototype.onKeyDown = function (event) {\n        var originalEvent = event.args;\n        var range;\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        this.deletedImg = [];\n        var isCursor;\n        var keyCodeValues = [27, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123,\n            44, 45, 9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 91, 92, 93, 144, 145, 182, 183];\n        if (this.parent.editorMode === 'HTML') {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            isCursor = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n        }\n        if (!isCursor && this.parent.editorMode === 'HTML' && keyCodeValues.indexOf(originalEvent.which) < 0) {\n            var nodes = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            for (var i = 0; i < nodes.length; i++) {\n                if (nodes[i].nodeName === 'IMG') {\n                    this.deletedImg.push(nodes[i]);\n                }\n            }\n        }\n        if (this.parent.editorMode === 'HTML' && ((originalEvent.which === 8 && originalEvent.code === 'Backspace') ||\n            (originalEvent.which === 46 && originalEvent.code === 'Delete'))) {\n            var isCursor_1 = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n            if ((originalEvent.which === 8 && originalEvent.code === 'Backspace' && isCursor_1)) {\n                this.checkImageBack(range);\n            }\n            else if ((originalEvent.which === 46 && originalEvent.code === 'Delete' && isCursor_1)) {\n                this.checkImageDel(range);\n            }\n        }\n        if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection) &&\n            originalEvent.code !== 'KeyK') {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            if (!originalEvent.ctrlKey && originalEvent.key && (originalEvent.key.length === 1 || originalEvent.action === 'enter') &&\n                (selectParentEle[0].tagName === 'IMG') && selectParentEle[0].parentElement) {\n                var prev = selectParentEle[0].parentElement.childNodes[0];\n                if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                    this.removeResizeEle();\n                }\n                this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), prev, prev, prev.textContent.length, prev.textContent.length);\n                removeClass([selectParentEle[0]], 'e-img-focus');\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n        }\n        if (originalEvent.ctrlKey && (originalEvent.keyCode === 89 || originalEvent.keyCode === 90)) {\n            this.undoStack({ subCommand: (originalEvent.keyCode === 90 ? 'undo' : 'redo') });\n        }\n        if (originalEvent.keyCode === 8 || originalEvent.keyCode === 46) {\n            if (selectNodeEle && selectNodeEle[0].nodeName === 'IMG' && selectNodeEle.length < 1) {\n                originalEvent.preventDefault();\n                var event_1 = {\n                    selectNode: selectNodeEle, selection: save, selectParent: selectParentEle,\n                    args: {\n                        item: { command: 'Images', subCommand: 'Remove' },\n                        originalEvent: originalEvent\n                    }\n                };\n                this.deleteImg(event_1, originalEvent.keyCode);\n            }\n            if (this.parent.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                this.removeResizeEle();\n            }\n        }\n        if (originalEvent.code === 'Backspace') {\n            originalEvent.action = 'backspace';\n        }\n        switch (originalEvent.action) {\n            case 'escape':\n                if (!isNullOrUndefined(this.dialogObj)) {\n                    this.dialogObj.close();\n                }\n                break;\n            case 'backspace':\n            case 'delete':\n                for (var i = 0; i < this.deletedImg.length; i++) {\n                    var src = this.deletedImg[i].src;\n                    this.imageRemovePost(src);\n                }\n                if (this.parent.editorMode !== 'Markdown') {\n                    if (range.startContainer.nodeType === 3) {\n                        if (originalEvent.code === 'Backspace') {\n                            if (range.startContainer.previousElementSibling && range.startOffset === 0 &&\n                                range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPTION) &&\n                                range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                                detach(range.startContainer.previousElementSibling);\n                            }\n                        }\n                        else {\n                            if (range.startContainer.nextElementSibling &&\n                                range.endContainer.textContent.length === range.endOffset &&\n                                range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPTION) &&\n                                range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                                detach(range.startContainer.nextElementSibling);\n                            }\n                        }\n                    }\n                    else if ((range.startContainer.nodeType === 1 &&\n                        range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE))) {\n                        detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE));\n                    }\n                }\n                break;\n            case 'insert-image':\n                this.openDialog(true, originalEvent, save, selectNodeEle, selectParentEle);\n                originalEvent.preventDefault();\n                break;\n        }\n    };\n    Image.prototype.openDialog = function (isInternal, event, selection, ele, parentEle) {\n        var range;\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        if (!isInternal && !isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n        }\n        else {\n            save = selection;\n            selectNodeEle = ele;\n            selectParentEle = parentEle;\n        }\n        if (this.parent.editorMode === 'HTML') {\n            this.insertImage({\n                args: {\n                    item: { command: 'Images', subCommand: 'Image' },\n                    originalEvent: event\n                },\n                selectNode: selectNodeEle,\n                selection: save,\n                selectParent: selectParentEle\n            });\n        }\n        else {\n            this.insertImage({\n                args: {\n                    item: { command: 'Images', subCommand: 'Image' },\n                    originalEvent: event\n                },\n                member: 'image',\n                text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n                module: 'Markdown',\n                name: 'insertImage'\n            });\n        }\n    };\n    Image.prototype.showDialog = function () {\n        this.openDialog(false);\n    };\n    Image.prototype.closeDialog = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.onKeyUp = function (event) {\n        if (!isNOU(this.deletedImg) && this.deletedImg.length > 0) {\n            for (var i = 0; i < this.deletedImg.length; i++) {\n                var args = {\n                    element: this.deletedImg[i],\n                    src: this.deletedImg[i].getAttribute('src')\n                };\n                this.parent.trigger(events.afterImageDelete, args);\n            }\n        }\n    };\n    Image.prototype.checkImageBack = function (range) {\n        if (range.startContainer.nodeName === '#text' && range.startOffset === 0 &&\n            !isNOU(range.startContainer.previousSibling) && range.startContainer.previousSibling.nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.previousSibling);\n        }\n        else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset - 1]) &&\n            range.startContainer.childNodes[range.startOffset - 1].nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.childNodes[range.startOffset - 1]);\n        }\n    };\n    Image.prototype.checkImageDel = function (range) {\n        if (range.startContainer.nodeName === '#text' && range.startOffset === range.startContainer.textContent.length &&\n            !isNOU(range.startContainer.nextSibling) && range.startContainer.nextSibling.nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.nextSibling);\n        }\n        else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset]) &&\n            range.startContainer.childNodes[range.startOffset].nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.childNodes[range.startOffset]);\n        }\n    };\n    Image.prototype.alignmentSelect = function (e) {\n        var item = e.item;\n        if (!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || item.command !== 'Images') {\n            return;\n        }\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n        selectNodeEle = (selectNodeEle[0].nodeName === 'IMG') ? selectNodeEle : [this.imgEle];\n        var args = { args: e, selectNode: selectNodeEle };\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        switch (item.subCommand) {\n            case 'JustifyLeft':\n                this.alignImage(args, 'JustifyLeft');\n                break;\n            case 'JustifyCenter':\n                this.alignImage(args, 'JustifyCenter');\n                break;\n            case 'JustifyRight':\n                this.alignImage(args, 'JustifyRight');\n                break;\n            case 'Inline':\n                this.inline(args);\n                break;\n            case 'Break':\n                this.break(args);\n                break;\n        }\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            removeClass([selectNodeEle[0]], 'e-img-focus');\n        }\n        this.cancelResizeAction();\n    };\n    Image.prototype.imageWithLinkQTBarItemUpdate = function () {\n        var separator;\n        var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n        for (var i = 0; i < items.length; i++) {\n            if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') ||\n                items[i].getAttribute('title') === this.i10n.getConstant('editLink') ||\n                items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n                addClass([items[i]], 'e-link-groups');\n                items[i].style.display = 'none';\n            }\n            else if (items[i].getAttribute('title') === 'Insert Link') {\n                items[i].style.display = '';\n            }\n            else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n                // eslint-disable-next-line\n                separator = items[i];\n                detach(items[i]);\n            }\n        }\n        var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n        this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n    };\n    Image.prototype.showImageQuickToolbar = function (e) {\n        var _this = this;\n        if (e.type !== 'Images' || isNullOrUndefined(this.parent.quickToolbarModule)\n            || isNullOrUndefined(this.parent.quickToolbarModule.imageQTBar) || isNullOrUndefined(e.args)) {\n            return;\n        }\n        this.quickToolObj = this.parent.quickToolbarModule;\n        var args = e.args;\n        var target = e.elements;\n        [].forEach.call(e.elements, function (element, index) {\n            if (index === 0) {\n                target = element;\n            }\n        });\n        if (target && !closest(target, 'a')) {\n            this.imageWithLinkQTBarItemUpdate();\n        }\n        if (target.nodeName === 'IMG') {\n            addClass([target], ['e-img-focus']);\n        }\n        var pageY = (this.parent.iframeSettings.enable) ? window.pageYOffset +\n            this.parent.element.getBoundingClientRect().top + args.clientY : args.pageY;\n        if (this.parent.quickToolbarModule.imageQTBar) {\n            if (e.isNotify) {\n                setTimeout(function () {\n                    _this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n                }, 400);\n            }\n            else {\n                this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n            }\n        }\n    };\n    Image.prototype.hideImageQuickToolbar = function () {\n        if (!isNullOrUndefined(this.contentModule.getEditPanel().querySelector('.e-img-focus'))) {\n            removeClass([this.contentModule.getEditPanel().querySelector('.e-img-focus')], 'e-img-focus');\n            if (this.quickToolObj && this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n        }\n    };\n    Image.prototype.editAreaClickHandler = function (e) {\n        if (this.parent.readonly) {\n            this.hideImageQuickToolbar();\n            return;\n        }\n        var args = e.args;\n        var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n        if (args.which === 2 || (showOnRightClick && args.which === 1) || (!showOnRightClick && args.which === 3)) {\n            if ((showOnRightClick && args.which === 1) && !isNullOrUndefined(args.target) &&\n                args.target.tagName === 'IMG') {\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), args.target);\n            }\n            return;\n        }\n        if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.imageQTBar) {\n            this.quickToolObj = this.parent.quickToolbarModule;\n            var target = args.target;\n            this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n            var isPopupOpen = this.quickToolObj.imageQTBar.element.classList.contains('e-rte-pop');\n            if (target.nodeName === 'IMG' && this.parent.quickToolbarModule) {\n                if (isPopupOpen) {\n                    return;\n                }\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), target);\n                if (isIDevice()) {\n                    this.parent.notify(events.selectionSave, e);\n                }\n                addClass([target], 'e-img-focus');\n                var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n                var separator = void 0;\n                if (closest(target, 'a')) {\n                    for (var i = 0; i < items.length; i++) {\n                        if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') ||\n                            items[i].getAttribute('title') === this.i10n.getConstant('editLink') ||\n                            items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n                            items[i].style.display = '';\n                            removeClass([items[i]], 'e-link-groups');\n                        }\n                        else if (items[i].getAttribute('title') === 'Insert Link') {\n                            items[i].style.display = 'none';\n                        }\n                        else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n                            // eslint-disable-next-line\n                            separator = items[i];\n                            detach(items[i]);\n                        }\n                    }\n                    var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n                    this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n                }\n                else if (!closest(target, 'a')) {\n                    this.imageWithLinkQTBarItemUpdate();\n                }\n                this.showImageQuickToolbar({ args: args, type: 'Images', elements: [args.target] });\n            }\n            else {\n                this.hideImageQuickToolbar();\n            }\n        }\n    };\n    Image.prototype.insertImgLink = function (e, inputDetails) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var linkWrap = this.parent.createElement('div', { className: 'e-img-linkwrap' });\n            var linkUrl = this.i10n.getConstant('linkurl');\n            var content = '<div class=\"e-rte-field\">' +\n                '<input type=\"text\" data-role =\"none\" class=\"e-input e-img-link\" spellcheck=\"false\" placeholder=\"' + linkUrl + '\"/></div>' +\n                '<div class=\"e-rte-label\"></div>' + '<div class=\"e-rte-field\">' +\n                '<input type=\"checkbox\" class=\"e-rte-linkTarget\"  data-role =\"none\"></div>';\n            var contentElem = parseHtml(content);\n            linkWrap.appendChild(contentElem);\n            var linkTarget = linkWrap.querySelector('.e-rte-linkTarget');\n            var inputLink = linkWrap.querySelector('.e-img-link');\n            var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n            this.checkBoxObj = new CheckBox({\n                label: linkOpenLabel, checked: true, enableRtl: this.parent.enableRtl, change: function (e) {\n                    if (e.checked) {\n                        target_1 = '_blank';\n                    }\n                    else {\n                        target_1 = null;\n                    }\n                }\n            });\n            this.checkBoxObj.isStringTemplate = true;\n            this.checkBoxObj.createElement = this.parent.createElement;\n            this.checkBoxObj.appendTo(linkTarget);\n            var target_1 = this.checkBoxObj.checked ? '_blank' : null;\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var linkargs_1 = {\n                args: e.args,\n                selfImage: this, selection: e.selection,\n                selectNode: e.selectNode, selectParent: e.selectParent, link: inputLink, target: target_1\n            };\n            this.dialogObj.setProperties({\n                height: 'inherit',\n                width: '290px',\n                header: this.parent.localeObj.getConstant('imageInsertLinkHeader'),\n                content: linkWrap,\n                position: { X: 'center', Y: 'center' },\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertlink(linkargs_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-link', isPrimary: true\n                        }\n                    }]\n            });\n            if (!isNullOrUndefined(inputDetails)) {\n                inputLink.value = inputDetails.url;\n                // eslint-disable-next-line\n                (inputDetails.target) ? this.checkBoxObj.checked = true : this.checkBoxObj.checked = false;\n                this.dialogObj.header = inputDetails.header;\n            }\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.insertAltText = function (e) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        var altText = this.i10n.getConstant('altText');\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var altWrap = this.parent.createElement('div', { className: 'e-img-altwrap' });\n            var altHeader = this.i10n.getConstant('alternateHeader');\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var getAlt = (e.selectNode[0].getAttribute('alt') === null) ? '' :\n                e.selectNode[0].getAttribute('alt');\n            var content = '<div class=\"e-rte-field\">' +\n                '<input type=\"text\" spellcheck=\"false\" value=\"' + getAlt + '\" class=\"e-input e-img-alt\" placeholder=\"' + altText + '\"/>' +\n                '</div>';\n            var contentElem = parseHtml(content);\n            altWrap.appendChild(contentElem);\n            var inputAlt = altWrap.querySelector('.e-img-alt');\n            var altArgs_1 = {\n                args: e.args, selfImage: this, selection: e.selection, selectNode: e.selectNode,\n                alt: inputAlt\n            };\n            this.dialogObj.setProperties({\n                height: 'inherit', width: '290px', header: altHeader, content: altWrap, position: { X: 'center', Y: 'center' },\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertAlt(altArgs_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-alt', isPrimary: true\n                        }\n                    }]\n            });\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.insertAlt = function (e) {\n        if (!isNullOrUndefined(e.alt)) {\n            e.selection.restore();\n            if (this.parent.formatter.getUndoRedoStack().length === 0) {\n                this.parent.formatter.saveData();\n            }\n            var altText = e.alt.value;\n            this.parent.formatter.process(this.parent, e.args, e.args, {\n                altText: altText, selectNode: e.selectNode,\n                subCommand: e.args.item.subCommand\n            });\n            this.dialogObj.hide({ returnValue: false });\n        }\n    };\n    Image.prototype.insertlink = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var url = e.link.value;\n        if (url === '') {\n            addClass([e.link], 'e-error');\n            e.link.setSelectionRange(0, url.length);\n            e.link.focus();\n            return;\n        }\n        if (!this.isUrl(url)) {\n            url = 'http://' + url;\n        }\n        else {\n            removeClass([e.link], 'e-error');\n        }\n        var proxy = e.selfImage;\n        if (proxy.parent.editorMode === 'HTML') {\n            e.selection.restore();\n        }\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        if (e.selectNode[0].parentElement.nodeName === 'A') {\n            proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n                url: url, target: proxy.checkBoxObj.checked ? '_blank' : null, selectNode: e.selectNode,\n                subCommand: e.args.item.subCommand\n            });\n            proxy.dialogObj.hide({ returnValue: true });\n            return;\n        }\n        proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n            url: url, target: proxy.checkBoxObj.checked ? '_blank' : null, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand, selection: e.selection\n        });\n        var captionEle = closest(e.selectNode[0], '.e-img-caption');\n        if (captionEle) {\n            select('.e-img-inner', captionEle).focus();\n        }\n        if (captionEle) {\n            select('.e-img-inner', captionEle).focus();\n        }\n        proxy.dialogObj.hide({ returnValue: false });\n    };\n    Image.prototype.isUrl = function (url) {\n        // eslint-disable-next-line\n        var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/gi;\n        return regexp.test(url);\n    };\n    Image.prototype.deleteImg = function (e, keyCode) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var args = {\n            element: e.selectNode[0],\n            src: e.selectNode[0].getAttribute('src')\n        };\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        e.selection.restore();\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n            this.removeResizeEle();\n        }\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            selectNode: e.selectNode,\n            captionClass: classes.CLS_CAPTION,\n            subCommand: e.args.item.subCommand\n        });\n        this.imageRemovePost(args.src);\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n        }\n        this.cancelResizeAction();\n        if (isNullOrUndefined(keyCode)) {\n            this.parent.trigger(events.afterImageDelete, args);\n        }\n    };\n    Image.prototype.imageRemovePost = function (src) {\n        var proxy = this;\n        var absoluteUrl = '';\n        if (isNOU(this.parent.insertImageSettings.removeUrl) || this.parent.insertImageSettings.removeUrl === '') {\n            return;\n        }\n        if (src.indexOf('http://') > -1 || src.indexOf('https://') > -1) {\n            absoluteUrl = src;\n        }\n        else {\n            absoluteUrl = new URL(src, document.baseURI).href;\n        }\n        this.removingImgName = absoluteUrl.replace(/^.*[\\\\\\/]/, '');\n        var xhr = new XMLHttpRequest();\n        xhr.addEventListener(\"readystatechange\", function () {\n            if (this.readyState == 4 && this.status == 200) {\n                proxy.triggerPost(this.response);\n            }\n        });\n        xhr.open('GET', absoluteUrl);\n        xhr.responseType = 'blob';\n        xhr.send();\n    };\n    Image.prototype.triggerPost = function (response) {\n        var removeUrl = this.parent.insertImageSettings.removeUrl;\n        if (isNOU(removeUrl) || removeUrl === '') {\n            return;\n        }\n        var file = new File([response], this.removingImgName);\n        var ajax = new Ajax(removeUrl, 'POST', true, null);\n        var formData = new FormData();\n        formData.append('UploadFiles', file);\n        ajax.send(formData);\n    };\n    Image.prototype.caption = function (e) {\n        var selectNode = e.selectNode[0];\n        if (selectNode.nodeName !== 'IMG') {\n            return;\n        }\n        e.selection.restore();\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        this.cancelResizeAction();\n        addClass([selectNode], 'e-rte-image');\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Caption';\n        if (!isNullOrUndefined(closest(selectNode, '.' + classes.CLS_CAPTION))) {\n            detach(closest(selectNode, '.' + classes.CLS_CAPTION));\n            if (Browser.isIE) {\n                this.contentModule.getEditPanel().focus();\n                e.selection.restore();\n            }\n            if (selectNode.parentElement.tagName === 'A') {\n                this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: selectNode.parentElement, selectNode: e.selectNode, subCommand: subCommand });\n            }\n            else {\n                this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: selectNode, selectNode: e.selectNode, subCommand: subCommand });\n            }\n        }\n        else {\n            this.captionEle = this.parent.createElement('span', {\n                className: classes.CLS_CAPTION + ' ' + classes.CLS_RTE_CAPTION,\n                attrs: { contenteditable: 'false', draggable: 'false', style: 'width:' + this.parent.insertImageSettings.width }\n            });\n            var imgWrap = this.parent.createElement('span', { className: 'e-img-wrap' });\n            var imgInner = this.parent.createElement('span', { className: 'e-img-inner',\n                attrs: { contenteditable: 'true' } });\n            var parent_1 = e.selectNode[0].parentElement;\n            if (parent_1.tagName === 'A') {\n                parent_1.setAttribute('contenteditable', 'true');\n            }\n            imgWrap.appendChild(parent_1.tagName === 'A' ? parent_1 : e.selectNode[0]);\n            imgWrap.appendChild(imgInner);\n            var imgCaption = this.i10n.getConstant('imageCaption');\n            imgInner.innerHTML = imgCaption;\n            this.captionEle.appendChild(imgWrap);\n            if (selectNode.classList.contains(classes.CLS_IMGINLINE)) {\n                addClass([this.captionEle], classes.CLS_CAPINLINE);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGBREAK)) {\n                addClass([this.captionEle], classes.CLS_IMGBREAK);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGLEFT)) {\n                addClass([this.captionEle], classes.CLS_IMGLEFT);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGRIGHT)) {\n                addClass([this.captionEle], classes.CLS_IMGRIGHT);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGCENTER)) {\n                addClass([this.captionEle], classes.CLS_IMGCENTER);\n            }\n            this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: this.captionEle, selectNode: e.selectNode, subCommand: subCommand });\n            this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), imgInner.childNodes[0], imgInner.childNodes[0], 0, imgInner.childNodes[0].textContent.length);\n        }\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            removeClass([selectNode], 'e-img-focus');\n        }\n    };\n    Image.prototype.imageSize = function (e) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var imgSizeHeader = this.i10n.getConstant('imageSizeHeader');\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var dialogContent = this.imgsizeInput(e);\n            var selectObj_1 = { args: e.args, selfImage: this, selection: e.selection, selectNode: e.selectNode };\n            this.dialogObj.setProperties({\n                height: 'inherit', width: '290px', header: imgSizeHeader, content: dialogContent, position: { X: 'center', Y: 'center' },\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertSize(selectObj_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-size', isPrimary: true\n                        }\n                    }]\n            });\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.break = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Break';\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.inline = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Inline';\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.alignImage = function (e, type) {\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : type;\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.clearDialogObj = function () {\n        if (this.dialogObj) {\n            this.dialogObj.destroy();\n            detach(this.dialogObj.element);\n            this.dialogObj = null;\n        }\n    };\n    Image.prototype.imagDialog = function (e) {\n        var _this = this;\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n            return;\n        }\n        var imgDialog = this.parent.createElement('div', { className: 'e-rte-img-dialog', id: this.rteID + '_image' });\n        this.parent.element.appendChild(imgDialog);\n        var imgInsert = this.i10n.getConstant('dialogInsert');\n        var imglinkCancel = this.i10n.getConstant('dialogCancel');\n        var imgHeader = this.i10n.getConstant('imageHeader');\n        var selection = e.selection;\n        var selectObj = { selfImage: this, selection: e.selection, args: e.args, selectParent: e.selectParent };\n        var dialogModel = {\n            header: imgHeader,\n            cssClass: classes.CLS_RTE_ELEMENTS,\n            enableRtl: this.parent.enableRtl,\n            locale: this.parent.locale,\n            showCloseIcon: true, closeOnEscape: true, width: (Browser.isDevice) ? '290px' : '340px', height: 'inherit',\n            position: { X: 'center', Y: (Browser.isDevice) ? 'center' : 'top' },\n            isModal: Browser.isDevice,\n            buttons: [{\n                    click: this.insertImageUrl.bind(selectObj),\n                    buttonModel: { content: imgInsert, cssClass: 'e-flat e-insertImage', isPrimary: true, disabled: true }\n                },\n                {\n                    click: function (e) {\n                        _this.cancelDialog(e);\n                    },\n                    buttonModel: { cssClass: 'e-flat e-cancel', content: imglinkCancel }\n                }],\n            target: (Browser.isDevice) ? document.body : this.parent.element,\n            animationSettings: { effect: 'None' },\n            close: function (event) {\n                if (_this.isImgUploaded) {\n                    _this.uploadObj.removing();\n                }\n                _this.parent.isBlur = false;\n                if (event && event.event.returnValue) {\n                    if (_this.parent.editorMode === 'HTML') {\n                        selection.restore();\n                    }\n                    else {\n                        _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n                    }\n                }\n                _this.dialogObj.destroy();\n                detach(_this.dialogObj.element);\n                _this.dialogRenderObj.close(event);\n                _this.dialogObj = null;\n            }\n        };\n        var dialogContent = this.parent.createElement('div', { className: 'e-img-content' });\n        if ((!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown')\n            || this.parent.editorMode === 'HTML') {\n            dialogContent.appendChild(this.imgUpload(e));\n        }\n        var linkHeader = this.parent.createElement('div', { className: 'e-linkheader' });\n        var linkHeaderText = this.i10n.getConstant('imageLinkHeader');\n        if (this.parent.editorMode === 'HTML') {\n            linkHeader.innerHTML = linkHeaderText;\n        }\n        else {\n            linkHeader.innerHTML = this.i10n.getConstant('mdimageLink');\n        }\n        dialogContent.appendChild(linkHeader);\n        dialogContent.appendChild(this.imageUrlPopup(e));\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n            dialogModel.header = this.parent.localeObj.getConstant('editImageHeader');\n            dialogModel.content = dialogContent;\n        }\n        else {\n            dialogModel.content = dialogContent;\n        }\n        this.dialogObj = this.dialogRenderObj.render(dialogModel);\n        this.dialogObj.createElement = this.parent.createElement;\n        this.dialogObj.appendTo(imgDialog);\n        if (isNullOrUndefined(this.dialogObj)) {\n            return;\n        }\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG' && (e.name === 'insertImage')) {\n            this.dialogObj.element.querySelector('.e-insertImage').textContent = this.parent.localeObj.getConstant('dialogUpdate');\n        }\n        imgDialog.style.maxHeight = 'inherit';\n        if (this.quickToolObj) {\n            if (this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n                this.quickToolObj.imageQTBar.hidePopup();\n                if (!isNullOrUndefined(e.selectParent)) {\n                    removeClass([e.selectParent[0]], 'e-img-focus');\n                }\n            }\n            if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n                this.quickToolObj.inlineQTBar.hidePopup();\n            }\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.cancelDialog = function (e) {\n        this.parent.isBlur = false;\n        this.dialogObj.hide({ returnValue: true });\n        if (this.isImgUploaded) {\n            this.uploadObj.removing();\n        }\n    };\n    Image.prototype.onDocumentClick = function (e) {\n        var target = e.target;\n        if (target.nodeName === 'IMG') {\n            this.imgEle = target;\n        }\n        if (!isNullOrUndefined(this.dialogObj) && ((\n        // eslint-disable-next-line\n        !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable && this.parent.getToolbarElement() &&\n            !this.parent.getToolbarElement().contains(e.target)) ||\n            (this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target) &&\n                !closest(target, '#' + this.parent.getID() + '_toolbar_Image') &&\n                !target.querySelector('#' + this.parent.getID() + '_toolbar_Image')))) {\n            /* eslint-disable */\n            if (e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight) {\n            }\n            else {\n                this.dialogObj.hide({ returnValue: true });\n                this.parent.isBlur = true;\n                dispatchEvent(this.parent.element, 'focusout');\n            }\n            /* eslint-enable */\n        }\n        if (e.target.tagName !== 'IMG' && this.imgResizeDiv && !(this.quickToolObj &&\n            this.quickToolObj.imageQTBar && this.quickToolObj.imageQTBar.element.contains(e.target)) &&\n            this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            this.cancelResizeAction();\n        }\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n            if (target.tagName !== 'IMG') {\n                this.removeResizeEle();\n            }\n            if (target.tagName !== 'IMG' && !isNOU(this.imgEle)) {\n                this.imgEle.style.outline = '';\n            }\n            else if (!isNOU(this.prevSelectedImgEle) && this.prevSelectedImgEle !== target) {\n                this.prevSelectedImgEle.style.outline = '';\n            }\n        }\n    };\n    Image.prototype.removeResizeEle = function () {\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n        detach(this.contentModule.getEditPanel().querySelector('.e-img-resize'));\n    };\n    Image.prototype.onWindowResize = function () {\n        if (!isNOU(this.contentModule) && !isNOU(this.contentModule.getEditPanel().querySelector('.e-img-resize'))) {\n            this.cancelResizeAction();\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.imageUrlPopup = function (e) {\n        var _this = this;\n        var imgUrl = this.parent.createElement('div', { className: 'imgUrl' });\n        var placeUrl = this.i10n.getConstant('imageUrl');\n        this.inputUrl = this.parent.createElement('input', {\n            className: 'e-input e-img-url',\n            attrs: { placeholder: placeUrl, spellcheck: 'false' }\n        });\n        this.inputUrl.addEventListener('input', function () {\n            if (!isNOU(_this.inputUrl)) {\n                if (_this.inputUrl.value.length === 0) {\n                    _this.dialogObj.getButtons(0).element.disabled = true;\n                }\n                else {\n                    _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                }\n            }\n        });\n        imgUrl.appendChild(this.inputUrl);\n        return imgUrl;\n    };\n    // eslint-disable-next-line\n    Image.prototype.insertImageUrl = function (e) {\n        var proxy = this.selfImage;\n        proxy.isImgUploaded = false;\n        var url = proxy.inputUrl.value;\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        if (!isNullOrUndefined(proxy.uploadUrl) && proxy.uploadUrl.url !== '') {\n            proxy.uploadUrl.cssClass = (proxy.parent.insertImageSettings.display === 'inline' ?\n                classes.CLS_IMGINLINE : classes.CLS_IMGBREAK);\n            proxy.dialogObj.hide({ returnValue: false });\n            proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, proxy.uploadUrl);\n            proxy.uploadUrl.url = '';\n            if (proxy.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                proxy.imgEle.style.outline = '';\n                proxy.removeResizeEle();\n            }\n        }\n        else if (url !== '') {\n            if (proxy.parent.editorMode === 'HTML' && isNullOrUndefined(closest(\n            // eslint-disable-next-line\n            this.selection.range.startContainer.parentNode, '[id=' + \"'\" + proxy.contentModule.getPanel().id + \"'\" + ']'))) {\n                proxy.contentModule.getEditPanel().focus();\n                var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.contentModule.getDocument());\n                this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.contentModule.getDocument());\n                this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            }\n            var regex = /[\\w-]+.(jpg|png|jpeg|gif)/g;\n            var matchUrl = (!isNullOrUndefined(url.match(regex)) && proxy.parent.editorMode === 'HTML') ? url.match(regex)[0] : '';\n            var value = {\n                cssClass: (proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK),\n                url: url, selection: this.selection, altText: matchUrl,\n                selectParent: this.selectParent, width: {\n                    width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                    maxWidth: proxy.parent.getInsertImgMaxWidth()\n                },\n                height: {\n                    height: proxy.parent.insertImageSettings.height, minHeight: proxy.parent.insertImageSettings.minHeight,\n                    maxHeight: proxy.parent.insertImageSettings.maxHeight\n                }\n            };\n            proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, value);\n            proxy.dialogObj.hide({ returnValue: false });\n        }\n    };\n    Image.prototype.imgsizeInput = function (e) {\n        var _this = this;\n        var selectNode = e.selectNode[0];\n        var imgHeight = this.i10n.getConstant('imageHeight');\n        var imgWidth = this.i10n.getConstant('imageWidth');\n        var imgSizeWrap = this.parent.createElement('div', { className: 'e-img-sizewrap' });\n        var widthVal = isNullOrUndefined(this.changedWidthValue) && (selectNode.style.width.toString() === 'auto' ||\n            selectNode.style.width !== '') ? selectNode.style.width : !isNullOrUndefined(this.changedWidthValue) ?\n            this.changedWidthValue : (parseInt(selectNode.getClientRects()[0].width.toString(), 10)).toString();\n        var heightVal = isNullOrUndefined(this.changedHeightValue) && (selectNode.style.height.toString() === 'auto' ||\n            selectNode.style.height !== '') ? selectNode.style.height : !isNullOrUndefined(this.changedHeightValue) ?\n            this.changedHeightValue : (parseInt(selectNode.getClientRects()[0].height.toString(), 10)).toString();\n        this.changedWidthValue = null;\n        this.changedHeightValue = null;\n        var content = '<div class=\"e-rte-label\"><label>' + imgWidth +\n            '</label></div><div class=\"e-rte-field\"><input type=\"text\" id=\"imgwidth\" class=\"e-img-width\" value=' +\n            widthVal\n            + ' /></div>' +\n            '<div class=\"e-rte-label\">' + '<label>' + imgHeight + '</label></div><div class=\"e-rte-field\"> ' +\n            '<input type=\"text\" id=\"imgheight\" class=\"e-img-height\" value=' +\n            heightVal\n            + ' /></div>';\n        var contentElem = parseHtml(content);\n        imgSizeWrap.appendChild(contentElem);\n        var widthNum = new TextBox({\n            value: formatUnit(widthVal),\n            enableRtl: this.parent.enableRtl,\n            input: function (e) {\n                _this.inputWidthValue = formatUnit(_this.inputValue(e.value));\n            }\n        });\n        widthNum.createElement = this.parent.createElement;\n        widthNum.appendTo(imgSizeWrap.querySelector('#imgwidth'));\n        var heightNum = new TextBox({\n            value: formatUnit(heightVal),\n            enableRtl: this.parent.enableRtl,\n            input: function (e) {\n                _this.inputHeightValue = formatUnit(_this.inputValue(e.value));\n            }\n        });\n        heightNum.createElement = this.parent.createElement;\n        heightNum.appendTo(imgSizeWrap.querySelector('#imgheight'));\n        return imgSizeWrap;\n    };\n    Image.prototype.inputValue = function (value) {\n        if (value === 'auto' || value.indexOf('%') !== -1 || value.indexOf('px') !== -1\n            || value.match(/(\\d+)/)) {\n            return value;\n        }\n        else {\n            return 'auto';\n        }\n    };\n    Image.prototype.insertSize = function (e) {\n        e.selection.restore();\n        var proxy = e.selfImage;\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        var dialogEle = proxy.dialogObj.element;\n        this.changedWidthValue = this.inputWidthValue;\n        this.changedHeightValue = this.inputHeightValue;\n        var width = dialogEle.querySelector('.e-img-width').value;\n        var height = dialogEle.parentElement.querySelector('.e-img-height').value;\n        proxy.parent.formatter.process(this.parent, e.args, e.args, {\n            width: width, height: height, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand\n        });\n        if (this.imgResizeDiv) {\n            proxy.imgResizePos(e.selectNode[0], this.imgResizeDiv);\n        }\n        proxy.dialogObj.hide({ returnValue: true });\n    };\n    Image.prototype.insertImage = function (e) {\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            var dialogContent = this.dialogObj.element.querySelector('.e-img-content');\n            if (((!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown')\n                || this.parent.editorMode === 'HTML')) {\n                document.getElementById(this.rteID + '_insertImage').focus();\n            }\n            else {\n                dialogContent.querySelector('.e-img-url').focus();\n            }\n        }\n    };\n    Image.prototype.imgUpload = function (e) {\n        var _this = this;\n        var save;\n        var selectParent;\n        // eslint-disable-next-line\n        var proxy = this;\n        var iframe = proxy.parent.iframeSettings.enable;\n        if (proxy.parent.editorMode === 'HTML' && (!iframe && isNullOrUndefined(closest(e.selection.range.startContainer.parentNode, '[id='\n            // eslint-disable-next-line\n            + \"'\" + this.parent.contentModule.getPanel().id + \"'\" + ']'))\n            || (iframe && !hasClass(e.selection.range.startContainer.parentNode.ownerDocument.querySelector('body'), 'e-lib')))) {\n            this.contentModule.getEditPanel().focus();\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n        }\n        else {\n            save = e.selection;\n            selectParent = e.selectParent;\n        }\n        var uploadParentEle = this.parent.createElement('div', { className: 'e-img-uploadwrap e-droparea' });\n        var deviceImgUpMsg = this.i10n.getConstant('imageDeviceUploadMessage');\n        var imgUpMsg = this.i10n.getConstant('imageUploadMessage');\n        var span = this.parent.createElement('span', { className: 'e-droptext' });\n        var spanMsg = this.parent.createElement('span', {\n            className: 'e-rte-upload-text', innerHTML: ((Browser.isDevice) ? deviceImgUpMsg : imgUpMsg)\n        });\n        span.appendChild(spanMsg);\n        var btnEle = this.parent.createElement('button', {\n            className: 'e-browsebtn', id: this.rteID + '_insertImage', attrs: { autofocus: 'true', type: 'button' }\n        });\n        span.appendChild(btnEle);\n        uploadParentEle.appendChild(span);\n        var browserMsg = this.i10n.getConstant('browse');\n        var button = new Button({ content: browserMsg, enableRtl: this.parent.enableRtl });\n        button.isStringTemplate = true;\n        button.createElement = this.parent.createElement;\n        button.appendTo(btnEle);\n        var btnClick = (Browser.isDevice) ? span : btnEle;\n        EventHandler.add(btnClick, 'click', this.fileSelect, this);\n        var uploadEle = this.parent.createElement('input', {\n            id: this.rteID + '_upload', attrs: { type: 'File', name: 'UploadFiles' }\n        });\n        uploadParentEle.appendChild(uploadEle);\n        var altText;\n        var rawFile;\n        var selectArgs;\n        var filesData;\n        var beforeUploadArgs;\n        this.uploadObj = new Uploader({\n            asyncSettings: { saveUrl: this.parent.insertImageSettings.saveUrl, removeUrl: this.parent.insertImageSettings.removeUrl },\n            dropArea: span, multiple: false, enableRtl: this.parent.enableRtl,\n            allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n            selected: function (e) {\n                proxy.isImgUploaded = true;\n                selectArgs = e;\n                filesData = e.filesData;\n                if (_this.parent.isServerRendered) {\n                    selectArgs = JSON.parse(JSON.stringify(e));\n                    e.cancel = true;\n                    rawFile = e.filesData;\n                    selectArgs.filesData = rawFile;\n                }\n                _this.parent.trigger(events.imageSelected, selectArgs, function (selectArgs) {\n                    if (!selectArgs.cancel) {\n                        _this.checkExtension(selectArgs.filesData[0]);\n                        altText = selectArgs.filesData[0].name;\n                        if (_this.parent.editorMode === 'HTML' && isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                            var reader_1 = new FileReader();\n                            // eslint-disable-next-line\n                            reader_1.addEventListener('load', function (e) {\n                                var url = _this.parent.insertImageSettings.saveFormat === 'Base64' ? reader_1.result :\n                                    URL.createObjectURL(convertToBlob(reader_1.result));\n                                proxy.uploadUrl = {\n                                    url: url, selection: save, altText: altText,\n                                    selectParent: selectParent,\n                                    width: {\n                                        width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                                        maxWidth: proxy.parent.getInsertImgMaxWidth()\n                                    }, height: {\n                                        height: proxy.parent.insertImageSettings.height,\n                                        minHeight: proxy.parent.insertImageSettings.minHeight,\n                                        maxHeight: proxy.parent.insertImageSettings.maxHeight\n                                    }\n                                };\n                                proxy.inputUrl.setAttribute('disabled', 'true');\n                                if (isNullOrUndefined(proxy.parent.insertImageSettings.saveUrl) && _this.isAllowedTypes\n                                    && !isNullOrUndefined(_this.dialogObj)) {\n                                    _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                                }\n                            });\n                            reader_1.readAsDataURL(selectArgs.filesData[0].rawFile);\n                        }\n                        if (_this.parent.isServerRendered) {\n                            /* eslint-disable */\n                            _this.uploadObj._internalRenderSelect(selectArgs, rawFile);\n                            /* eslint-enable */\n                        }\n                    }\n                });\n            },\n            beforeUpload: function (args) {\n                if (_this.parent.isServerRendered) {\n                    beforeUploadArgs = JSON.parse(JSON.stringify(args));\n                    beforeUploadArgs.filesData = filesData;\n                    args.cancel = true;\n                    _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n                        if (beforeUploadArgs.cancel) {\n                            return;\n                        }\n                        /* eslint-disable */\n                        _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ?\n                            beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n                        _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ?\n                            beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n                        _this.uploadObj.uploadFiles(rawFile, null);\n                        /* eslint-enable */\n                    });\n                }\n                else {\n                    _this.parent.trigger(events.beforeImageUpload, args);\n                }\n            },\n            uploading: function (e) {\n                if (!_this.parent.isServerRendered) {\n                    _this.parent.trigger(events.imageUploading, e);\n                }\n            },\n            success: function (e) {\n                _this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n                    if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                        var url = _this.parent.insertImageSettings.path + e.file.name;\n                        // eslint-disable-next-line\n                        var value = { url: url, selection: save };\n                        proxy.uploadUrl = {\n                            url: url, selection: save, altText: altText, selectParent: selectParent,\n                            width: {\n                                width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                                maxWidth: proxy.parent.getInsertImgMaxWidth()\n                            }, height: {\n                                height: proxy.parent.insertImageSettings.height, minHeight: proxy.parent.insertImageSettings.minHeight,\n                                maxHeight: proxy.parent.insertImageSettings.maxHeight\n                            }\n                        };\n                        proxy.inputUrl.setAttribute('disabled', 'true');\n                    }\n                    if (e.operation === 'upload' && !isNullOrUndefined(_this.dialogObj)) {\n                        _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                    }\n                });\n            },\n            failure: function (e) {\n                _this.parent.trigger(events.imageUploadFailed, e);\n            },\n            removing: function () {\n                // eslint-disable-next-line\n                _this.parent.trigger(events.imageRemoving, e, function (e) {\n                    proxy.isImgUploaded = false;\n                    _this.dialogObj.getButtons(0).element.disabled = true;\n                    proxy.inputUrl.removeAttribute('disabled');\n                    if (proxy.uploadUrl) {\n                        proxy.uploadUrl.url = '';\n                    }\n                });\n            }\n        });\n        this.uploadObj.isStringTemplate = true;\n        this.uploadObj.createElement = this.parent.createElement;\n        this.uploadObj.appendTo(uploadEle);\n        return uploadParentEle;\n    };\n    Image.prototype.checkExtension = function (e) {\n        if (this.uploadObj.allowedExtensions) {\n            if (this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(('.' + e.type).toLocaleLowerCase()) === -1) {\n                this.dialogObj.getButtons(0).element.setAttribute('disabled', 'disabled');\n                this.isAllowedTypes = false;\n            }\n            else {\n                this.isAllowedTypes = true;\n            }\n        }\n    };\n    Image.prototype.fileSelect = function () {\n        this.dialogObj.element.getElementsByClassName('e-file-select-wrap')[0].querySelector('button').click();\n        return false;\n    };\n    Image.prototype.dragStart = function (e) {\n        if (e.target.nodeName === 'IMG') {\n            this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n                if (actionBeginArgs.cancel) {\n                    e.preventDefault();\n                }\n                else {\n                    e.dataTransfer.effectAllowed = 'copyMove';\n                    e.target.classList.add(classes.CLS_RTE_DRAG_IMAGE);\n                }\n            });\n        }\n        else {\n            return true;\n        }\n    };\n    Image.prototype.dragEnter = function (e) {\n        e.dataTransfer.dropEffect = 'copy';\n        e.preventDefault();\n    };\n    Image.prototype.dragOver = function (e) {\n        if ((Browser.info.name === 'edge' && e.dataTransfer.items[0].type.split('/')[0].indexOf('image') > -1) ||\n            (Browser.isIE && e.dataTransfer.types[0] === 'Files')) {\n            e.preventDefault();\n        }\n        else {\n            return true;\n        }\n    };\n    /**\n     * Used to set range When drop an image\n     *\n     * @param {ImageDropEventArgs} args - specifies the image arguments.\n     * @returns {void}\n     */\n    Image.prototype.dragDrop = function (args) {\n        var _this = this;\n        this.parent.trigger(events.beforeImageDrop, args, function (e) {\n            var imgElement = _this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n            var isImgOrFileDrop = (imgElement && imgElement.tagName === 'IMG') || e.dataTransfer.files.length > 0;\n            if (!e.cancel && isImgOrFileDrop) {\n                _this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n                    if (actionBeginArgs.cancel) {\n                        e.preventDefault();\n                    }\n                    else {\n                        if (closest(e.target, '#' + _this.parent.getID() + '_toolbar') ||\n                            _this.parent.inputElement.contentEditable === 'false') {\n                            e.preventDefault();\n                            return;\n                        }\n                        if (_this.parent.element.querySelector('.' + classes.CLS_IMG_RESIZE)) {\n                            detach(_this.imgResizeDiv);\n                        }\n                        e.preventDefault();\n                        var range = void 0;\n                        if (_this.contentModule.getDocument().caretRangeFromPoint) { //For chrome\n                            range = _this.contentModule.getDocument().caretRangeFromPoint(e.clientX, e.clientY);\n                        }\n                        else if ((e.rangeParent)) { //For mozilla firefox\n                            range = _this.contentModule.getDocument().createRange();\n                            range.setStart(e.rangeParent, e.rangeOffset);\n                        }\n                        else {\n                            range = _this.getDropRange(e.clientX, e.clientY); //For internet explorer\n                        }\n                        _this.parent.notify(events.selectRange, { range: range });\n                        var uploadArea = _this.parent.element.querySelector('.' + classes.CLS_DROPAREA);\n                        if (uploadArea) {\n                            return;\n                        }\n                        _this.insertDragImage(e);\n                    }\n                });\n            }\n            else {\n                if (isImgOrFileDrop) {\n                    e.preventDefault();\n                }\n            }\n        });\n    };\n    /**\n     * Used to calculate range on internet explorer\n     *\n     * @param {number} x - specifies the x range.\n     * @param {number} y - specifies the y range.\n     * @returns {void}\n     */\n    Image.prototype.getDropRange = function (x, y) {\n        var startRange = this.contentModule.getDocument().createRange();\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), startRange);\n        var elem = this.contentModule.getDocument().elementFromPoint(x, y);\n        var startNode = (elem.childNodes.length > 0 ? elem.childNodes[0] : elem);\n        var startCharIndexCharacter = 0;\n        if (this.parent.inputElement.firstChild.innerHTML === '<br>') {\n            startRange.setStart(startNode, startCharIndexCharacter);\n            startRange.setEnd(startNode, startCharIndexCharacter);\n        }\n        else {\n            var rangeRect = void 0;\n            do {\n                startCharIndexCharacter++;\n                startRange.setStart(startNode, startCharIndexCharacter);\n                startRange.setEnd(startNode, startCharIndexCharacter + 1);\n                rangeRect = startRange.getBoundingClientRect();\n            } while (rangeRect.left < x && startCharIndexCharacter < startNode.length - 1);\n        }\n        return startRange;\n    };\n    Image.prototype.insertDragImage = function (e) {\n        var _this = this;\n        e.preventDefault();\n        var activePopupElement = this.parent.element.querySelector('' + classes.CLS_POPUP_OPEN);\n        this.parent.notify(events.drop, { args: e });\n        if (activePopupElement) {\n            activePopupElement.classList.add(classes.CLS_HIDE);\n        }\n        var imgElement = this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n        if (e.dataTransfer.files.length > 0 && imgElement === null) { //For external image drag and drop\n            if (e.dataTransfer.files.length > 1) {\n                return;\n            }\n            var imgFiles = e.dataTransfer.files;\n            var fileName = imgFiles[0].name;\n            var imgType = fileName.substring(fileName.lastIndexOf('.'));\n            var allowedTypes = this.parent.insertImageSettings.allowedTypes;\n            for (var i = 0; i < allowedTypes.length; i++) {\n                if (imgType.toLocaleLowerCase() === allowedTypes[i].toLowerCase()) {\n                    if (this.parent.insertImageSettings.saveUrl) {\n                        this.onSelect(e);\n                    }\n                    else {\n                        var args = { args: e, text: '', file: imgFiles[0] };\n                        e.preventDefault();\n                        this.imagePaste(args);\n                    }\n                }\n            }\n        }\n        else { //For internal image drag and drop\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            if (imgElement && imgElement.tagName === 'IMG') {\n                if (imgElement.nextElementSibling) {\n                    if (imgElement.nextElementSibling.classList.contains(classes.CLS_IMG_INNER)) {\n                        range.insertNode(imgElement.parentElement.parentElement);\n                    }\n                    else {\n                        range.insertNode(imgElement);\n                    }\n                }\n                else {\n                    range.insertNode(imgElement);\n                }\n                imgElement.classList.remove(classes.CLS_RTE_DRAG_IMAGE);\n                var imgArgs_1 = { elements: [imgElement] };\n                imgElement.addEventListener('load', function () {\n                    _this.parent.trigger(events.actionComplete, imgArgs_1);\n                });\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                var args = e;\n                this.resizeStart(args, imgElement);\n                this.hideImageQuickToolbar();\n            }\n        }\n    };\n    Image.prototype.onSelect = function (args) {\n        var _this = this;\n        // eslint-disable-next-line\n        var proxy = this;\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var parentElement = this.parent.createElement('ul', { className: classes.CLS_UPLOAD_FILES });\n        this.parent.element.appendChild(parentElement);\n        var validFiles = {\n            name: '',\n            size: 0,\n            status: '',\n            statusCode: '',\n            type: '',\n            rawFile: args.dataTransfer.files[0],\n            validationMessages: {}\n        };\n        var imageTag = this.parent.createElement('IMG');\n        imageTag.style.opacity = '0.5';\n        imageTag.classList.add(classes.CLS_RTE_IMAGE);\n        imageTag.classList.add(classes.CLS_IMGINLINE);\n        imageTag.classList.add(classes.CLS_RESIZE);\n        var file = validFiles.rawFile;\n        var reader = new FileReader();\n        reader.addEventListener('load', function () {\n            var url = URL.createObjectURL(convertToBlob(reader.result));\n            imageTag.src = proxy.parent.insertImageSettings.saveFormat === 'Blob' ? url : reader.result;\n        });\n        if (file) {\n            reader.readAsDataURL(file);\n        }\n        range.insertNode(imageTag);\n        this.uploadMethod(args, imageTag);\n        var e = { elements: [imageTag] };\n        imageTag.addEventListener('load', function () {\n            _this.parent.trigger(events.actionComplete, e);\n        });\n        detach(parentElement);\n    };\n    /**\n     * Rendering uploader and popup for drag and drop\n     *\n     * @param {DragEvent} dragEvent - specifies the event.\n     * @param {HTMLImageElement} imageElement - specifies the element.\n     * @returns {void}\n     */\n    Image.prototype.uploadMethod = function (dragEvent, imageElement) {\n        var _this = this;\n        var isUploading = false;\n        // eslint-disable-next-line\n        var proxy = this;\n        var popupEle = this.parent.createElement('div');\n        this.parent.element.appendChild(popupEle);\n        var uploadEle = this.parent.createElement('input', {\n            id: this.rteID + '_upload', attrs: { type: 'File', name: 'UploadFiles' }\n        });\n        var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n        this.popupObj = new Popup(popupEle, {\n            relateTo: imageElement,\n            height: '85px',\n            width: '300px',\n            offsetY: offsetY,\n            content: uploadEle,\n            viewPortElement: this.parent.element,\n            position: { X: 'center', Y: 'top' },\n            enableRtl: this.parent.enableRtl,\n            zIndex: 10001,\n            // eslint-disable-next-line\n            close: function (event) {\n                _this.parent.isBlur = false;\n                _this.popupObj.destroy();\n                detach(_this.popupObj.element);\n                _this.popupObj = null;\n                if (!_this.parent.inlineMode.enable) {\n                    _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(false);\n                }\n            }\n        });\n        this.popupObj.element.style.display = 'none';\n        addClass([this.popupObj.element], classes.CLS_POPUP_OPEN);\n        addClass([this.popupObj.element], classes.CLS_RTE_UPLOAD_POPUP);\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var timeOut = dragEvent.dataTransfer.files[0].size > 1000000 ? 300 : 100;\n        setTimeout(function () {\n            proxy.refreshPopup(imageElement);\n        }, timeOut);\n        var rawFile;\n        var beforeUploadArgs;\n        this.uploadObj = new Uploader({\n            asyncSettings: {\n                saveUrl: this.parent.insertImageSettings.saveUrl,\n                removeUrl: this.parent.insertImageSettings.removeUrl\n            },\n            cssClass: classes.CLS_RTE_DIALOG_UPLOAD,\n            dropArea: this.parent.element,\n            allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n            removing: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                isUploading = false;\n                detach(imageElement);\n                _this.popupObj.close();\n            },\n            canceling: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                isUploading = false;\n                detach(imageElement);\n                _this.popupObj.close();\n                _this.quickToolObj.imageQTBar.hidePopup();\n                setTimeout(function () {\n                    _this.uploadObj.destroy();\n                }, 900);\n            },\n            beforeUpload: function (args) {\n                if (_this.parent.isServerRendered) {\n                    beforeUploadArgs = JSON.parse(JSON.stringify(args));\n                    beforeUploadArgs.filesData = rawFile;\n                    isUploading = true;\n                    args.cancel = true;\n                    _this.parent.trigger(events.imageUploading, beforeUploadArgs, function (beforeUploadArgs) {\n                        if (beforeUploadArgs.cancel) {\n                            return;\n                        }\n                        if (!_this.parent.inlineMode.enable) {\n                            _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n                        }\n                        /* eslint-disable */\n                        _this.uploadObj.currentRequestHeader = beforeUploadArgs.currentRequest ?\n                            beforeUploadArgs.currentRequest : _this.uploadObj.currentRequestHeader;\n                        _this.uploadObj.customFormDatas = beforeUploadArgs.customFormData && beforeUploadArgs.customFormData.length > 0 ?\n                            beforeUploadArgs.customFormData : _this.uploadObj.customFormDatas;\n                        _this.uploadObj.uploadFiles(rawFile, null);\n                        _this.parent.inputElement.contentEditable = 'false';\n                        /* eslint-enable */\n                    });\n                }\n                else {\n                    _this.parent.trigger(events.beforeImageUpload, args);\n                    if (!_this.parent.inlineMode.enable) {\n                        _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n                    }\n                }\n            },\n            uploading: function (e) {\n                if (!_this.parent.isServerRendered) {\n                    isUploading = true;\n                    _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n                        if (imageUploadingArgs.cancel) {\n                            if (!isNullOrUndefined(imageElement)) {\n                                detach(imageElement);\n                            }\n                            if (!isNullOrUndefined(_this.popupObj.element)) {\n                                detach(_this.popupObj.element);\n                            }\n                        }\n                        else {\n                            _this.parent.inputElement.contentEditable = 'false';\n                        }\n                    });\n                }\n            },\n            selected: function (e) {\n                if (isUploading) {\n                    e.cancel = true;\n                }\n                if (_this.parent.isServerRendered) {\n                    rawFile = e.filesData;\n                }\n            },\n            failure: function (e) {\n                isUploading = false;\n                _this.parent.inputElement.contentEditable = 'true';\n                var args = {\n                    args: dragEvent,\n                    type: 'Images',\n                    isNotify: undefined,\n                    elements: imageElement\n                };\n                setTimeout(function () {\n                    _this.uploadFailure(imageElement, args, e);\n                }, 900);\n            },\n            success: function (e) {\n                if (e.operation === \"cancel\") {\n                    return;\n                }\n                isUploading = false;\n                _this.parent.inputElement.contentEditable = 'true';\n                var args = {\n                    args: dragEvent,\n                    type: 'Images',\n                    isNotify: undefined,\n                    elements: imageElement\n                };\n                setTimeout(function () {\n                    _this.uploadSuccess(imageElement, dragEvent, args, e);\n                }, 900);\n            }\n        });\n        this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n        this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap').style.display = 'none';\n        range.selectNodeContents(imageElement);\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), range);\n    };\n    Image.prototype.refreshPopup = function (imageElement) {\n        var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop +\n            imageElement.offsetTop : imageElement.offsetTop;\n        var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n        if (imgPosition > rtePosition) {\n            this.popupObj.relateTo = this.parent.inputElement;\n            this.popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n            this.popupObj.element.style.display = 'block';\n        }\n        else {\n            if (this.popupObj) {\n                this.popupObj.refreshPosition(imageElement);\n                this.popupObj.element.style.display = 'block';\n            }\n        }\n    };\n    /**\n     * Called when drop image upload was failed\n     *\n     * @param {HTMLElement} imgEle - specifies the image element.\n     * @param {IShowPopupArgs} args - specifies the arguments.\n     * @param {Object} e - specfies the object.\n     * @returns {void}\n     */\n    Image.prototype.uploadFailure = function (imgEle, args, e) {\n        detach(imgEle);\n        if (this.popupObj) {\n            this.popupObj.close();\n        }\n        this.parent.trigger(events.imageUploadFailed, e);\n        this.uploadObj.destroy();\n    };\n    /**\n     * Called when drop image upload was successful\n     *\n     * @param {HTMLElement} imageElement - specifies the image element.\n     * @param {DragEvent} dragEvent - specifies the drag event.\n     * @param {IShowPopupArgs} args - specifies the arguments.\n     * @param {ImageSuccessEventArgs} e - specifies the success event.\n     * @returns {void}\n     */\n    Image.prototype.uploadSuccess = function (imageElement, dragEvent, args, e) {\n        var _this = this;\n        imageElement.style.opacity = '1';\n        imageElement.classList.add(classes.CLS_IMG_FOCUS);\n        e.element = imageElement;\n        this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n            if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                var url = _this.parent.insertImageSettings.path + e.file.name;\n                imageElement.src = url;\n                imageElement.setAttribute('alt', e.file.name);\n            }\n        });\n        if (this.popupObj) {\n            this.popupObj.close();\n            this.uploadObj.destroy();\n        }\n        this.showImageQuickToolbar(args);\n        this.resizeStart(dragEvent, imageElement);\n    };\n    Image.prototype.imagePaste = function (args) {\n        var _this = this;\n        if (args.text.length === 0 && !isNullOrUndefined(args.file)) {\n            // eslint-disable-next-line\n            var proxy_1 = this;\n            var reader_2 = new FileReader();\n            args.args.preventDefault();\n            // eslint-disable-next-line\n            reader_2.addEventListener('load', function (e) {\n                var url = {\n                    cssClass: (proxy_1.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK),\n                    url: _this.parent.insertImageSettings.saveFormat === 'Base64' || !isNullOrUndefined(args.callBack) ?\n                        reader_2.result : URL.createObjectURL(convertToBlob(reader_2.result)),\n                    width: {\n                        width: proxy_1.parent.insertImageSettings.width, minWidth: proxy_1.parent.insertImageSettings.minWidth,\n                        maxWidth: proxy_1.parent.getInsertImgMaxWidth()\n                    },\n                    height: {\n                        height: proxy_1.parent.insertImageSettings.height, minHeight: proxy_1.parent.insertImageSettings.minHeight,\n                        maxHeight: proxy_1.parent.insertImageSettings.maxHeight\n                    }\n                };\n                if (!isNullOrUndefined(args.callBack)) {\n                    args.callBack(url);\n                    return;\n                }\n                else {\n                    proxy_1.parent.formatter.process(proxy_1.parent, { item: { command: 'Images', subCommand: 'Image' } }, args.args, url);\n                    _this.showPopupToolBar(args, url);\n                }\n            });\n            reader_2.readAsDataURL(args.file);\n        }\n    };\n    Image.prototype.showPopupToolBar = function (e, url) {\n        var _this = this;\n        var imageSrc = 'img[src=\"' + url.url + '\"]';\n        var imageElement = this.parent.inputElement.querySelector(imageSrc);\n        this.parent.quickToolbarModule.createQTBar('Image', 'MultiRow', this.parent.quickToolbarSettings.image, RenderType.ImageToolbar);\n        var args = {\n            args: e.args,\n            type: 'Images',\n            isNotify: undefined,\n            elements: imageElement\n        };\n        if (imageElement) {\n            setTimeout(function () {\n                _this.showImageQuickToolbar(args);\n                _this.resizeStart(e.args, imageElement);\n            }, 0);\n        }\n    };\n    /* eslint-disable */\n    /**\n     * Destroys the ToolBar.\n     *\n     * @method destroy\n     * @returns {void}\n     * @hidden\n\n     */\n    /* eslint-enable */\n    Image.prototype.destroy = function () {\n        this.prevSelectedImgEle = undefined;\n        this.removeEventListener();\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {void}\n     */\n    Image.prototype.getModuleName = function () {\n        return 'image';\n    };\n    return Image;\n}());\nexport { Image };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}