{"ast":null,"code":"/* eslint-disable @typescript-eslint/no-explicit-any */\n\n/* eslint-disable max-len */\nimport { isNullOrUndefined, closest, extend, EventHandler } from '@syncfusion/ej2-base';\nimport { createElement, prepend, append, addClass, removeClass } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Predicate } from '@syncfusion/ej2-data';\nimport { generate, getDateFromRecurrenceDateString } from '../../recurrence-editor/date-generator';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\nimport * as event from '../base/constant';\n/**\n * EventBase for appointment rendering\n */\n\nvar EventBase =\n/** @class */\nfunction () {\n  /**\n   * Constructor for EventBase\n   *\n   * @param {Schedule} parent Accepts the schedule instance\n   */\n  function EventBase(parent) {\n    this.slots = [];\n    this.isDoubleTapped = false;\n    this.parent = parent;\n  }\n\n  EventBase.prototype.processData = function (events, timeZonePropChanged, oldTimezone) {\n    var _this = this;\n\n    var start = this.parent.activeView.startDate();\n    var end = this.parent.activeView.endDate();\n    var fields = this.parent.eventFields;\n    var processed = [];\n    var temp = 1;\n    var generateID = false;\n    var resourceCollection = this.parent.resourceBase ? this.parent.resourceBase.resourceCollection : [];\n\n    if (events.length > 0 && isNullOrUndefined(events[0][fields.id])) {\n      generateID = true;\n    }\n\n    var _loop_1 = function (event_1) {\n      if (generateID) {\n        event_1[fields.id] = temp++;\n      }\n\n      event_1 = this_1.updateEventDateTime(event_1);\n\n      if (timeZonePropChanged) {\n        this_1.processTimezoneChange(event_1, oldTimezone);\n      } else if (!this_1.parent.isPrinting && !this_1.parent.uiStateValues.isResize) {\n        event_1 = this_1.processTimezone(event_1);\n      }\n\n      for (var level = 0; level < resourceCollection.length; level++) {\n        if (event_1[resourceCollection[level].field] === null || event_1[resourceCollection[level].field] === 0) {\n          event_1[resourceCollection[level].field] = undefined;\n        }\n      }\n\n      if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && event_1[fields.recurrenceRule] === '') {\n        event_1[fields.recurrenceRule] = null;\n      }\n\n      if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && isNullOrUndefined(event_1[fields.recurrenceID]) && !(this_1.parent.crudModule && this_1.parent.crudModule.crudObj.isCrudAction)) {\n        processed = processed.concat(this_1.generateOccurrence(event_1, null, oldTimezone, true));\n      } else {\n        if (this_1.parent.crudModule && this_1.parent.crudModule.crudObj.isCrudAction) {\n          if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && isNullOrUndefined(event_1[fields.recurrenceID])) {\n            var recurrenceEvent = this_1.generateOccurrence(event_1, null, oldTimezone, true);\n\n            var _loop_2 = function (occurrence) {\n              var app = this_1.parent.eventsProcessed.filter(function (data) {\n                return data[fields.startTime].getTime() - occurrence[fields.startTime].getTime() === 0 && data[fields.id] === occurrence[fields.id];\n              });\n              occurrence.Guid = app.length > 0 ? app[0].Guid : this_1.generateGuid();\n              processed.push(occurrence);\n            };\n\n            for (var _i = 0, recurrenceEvent_1 = recurrenceEvent; _i < recurrenceEvent_1.length; _i++) {\n              var occurrence = recurrenceEvent_1[_i];\n\n              _loop_2(occurrence);\n            }\n          } else {\n            var app = this_1.parent.eventsProcessed.filter(function (data) {\n              return data[_this.parent.eventFields.id] === event_1[_this.parent.eventFields.id];\n            });\n            event_1.Guid = app.length > 0 ? app[0].Guid : this_1.generateGuid();\n            processed.push(event_1);\n          }\n        } else {\n          event_1.Guid = this_1.generateGuid();\n          processed.push(event_1);\n        }\n      }\n    };\n\n    var this_1 = this;\n\n    for (var _i = 0, events_1 = events; _i < events_1.length; _i++) {\n      var event_1 = events_1[_i];\n\n      _loop_1(event_1);\n    }\n\n    this.parent.eventsProcessed = [];\n    var eventData = processed.filter(function (data) {\n      return !data[_this.parent.eventFields.isBlock];\n    });\n    this.parent.eventsProcessed = this.filterEvents(start, end, eventData);\n    var blockData = processed.filter(function (data) {\n      return data[_this.parent.eventFields.isBlock];\n    });\n\n    for (var _a = 0, blockData_1 = blockData; _a < blockData_1.length; _a++) {\n      var eventObj = blockData_1[_a];\n\n      if (eventObj[fields.isAllDay]) {\n        var isDifferentDate = util.resetTime(new Date(eventObj[fields.startTime].getTime())) < util.resetTime(new Date(eventObj[fields.endTime].getTime()));\n\n        if (!isDifferentDate) {\n          eventObj[fields.startTime] = util.resetTime(eventObj[fields.startTime]);\n          eventObj[fields.endTime] = util.addDays(util.resetTime(eventObj[fields.endTime]), 1);\n        }\n      }\n    }\n\n    this.parent.blockProcessed = blockData;\n    return eventData;\n  };\n\n  EventBase.prototype.updateEventDateTime = function (eventData) {\n    if (typeof eventData[this.parent.eventFields.startTime] === 'string') {\n      eventData[this.parent.eventFields.startTime] = util.getDateFromString(eventData[this.parent.eventFields.startTime]);\n    }\n\n    if (typeof eventData[this.parent.eventFields.endTime] === 'string') {\n      eventData[this.parent.eventFields.endTime] = util.getDateFromString(eventData[this.parent.eventFields.endTime]);\n    }\n\n    return eventData;\n  };\n\n  EventBase.prototype.getProcessedEvents = function (eventCollection) {\n    if (eventCollection === void 0) {\n      eventCollection = this.parent.eventsData;\n    }\n\n    var processed = [];\n\n    for (var _i = 0, eventCollection_1 = eventCollection; _i < eventCollection_1.length; _i++) {\n      var event_2 = eventCollection_1[_i];\n\n      if (!isNullOrUndefined(event_2[this.parent.eventFields.recurrenceRule]) && isNullOrUndefined(event_2[this.parent.eventFields.recurrenceID])) {\n        processed = processed.concat(this.generateOccurrence(event_2));\n      } else {\n        processed.push(event_2);\n      }\n    }\n\n    return processed;\n  };\n\n  EventBase.prototype.timezonePropertyChange = function (oldTimezone) {\n    var data = this.parent.eventsData.concat(this.parent.blockData);\n    var processed = this.processData(data, true, oldTimezone);\n    this.parent.notify(event.dataReady, {\n      processedData: processed\n    });\n  };\n\n  EventBase.prototype.timezoneConvert = function (eventData) {\n    var fields = this.parent.eventFields;\n    eventData[fields.startTimezone] = eventData[fields.startTimezone] || eventData[fields.endTimezone];\n    eventData[fields.endTimezone] = eventData[fields.endTimezone] || eventData[fields.startTimezone];\n\n    if (this.parent.timezone) {\n      var startTz = eventData[fields.startTimezone];\n      var endTz = eventData[fields.endTimezone];\n      eventData[fields.startTime] = this.parent.tzModule.convert(eventData[fields.startTime], this.parent.timezone, startTz);\n      eventData[fields.endTime] = this.parent.tzModule.convert(eventData[fields.endTime], this.parent.timezone, endTz);\n    }\n  };\n\n  EventBase.prototype.processTimezoneChange = function (event, oldTimezone) {\n    var fields = this.parent.eventFields;\n\n    if (event[fields.isAllDay]) {\n      return;\n    }\n\n    if (oldTimezone && this.parent.timezone) {\n      event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], oldTimezone, this.parent.timezone);\n      event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], oldTimezone, this.parent.timezone);\n    } else if (!oldTimezone && this.parent.timezone) {\n      event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], this.parent.timezone);\n      event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], this.parent.timezone);\n    } else if (oldTimezone && !this.parent.timezone) {\n      event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], oldTimezone);\n      event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], oldTimezone);\n    }\n  };\n\n  EventBase.prototype.processTimezone = function (event, isReverse) {\n    if (isReverse === void 0) {\n      isReverse = false;\n    }\n\n    var fields = this.parent.eventFields;\n\n    if (event[fields.startTimezone] || event[fields.endTimezone]) {\n      var startTimezone = event[fields.startTimezone] || event[fields.endTimezone];\n      var endTimezone = event[fields.endTimezone] || event[fields.startTimezone];\n\n      if (isReverse) {\n        if (this.parent.timezone) {\n          event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], startTimezone, this.parent.timezone);\n          event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], endTimezone, this.parent.timezone);\n          event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], this.parent.timezone);\n          event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], this.parent.timezone);\n        } else {\n          event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], startTimezone);\n          event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], endTimezone);\n        }\n      } else {\n        event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], startTimezone);\n        event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], endTimezone);\n\n        if (this.parent.timezone) {\n          event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], startTimezone, this.parent.timezone);\n          event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], endTimezone, this.parent.timezone);\n        }\n      }\n    } else if (this.parent.timezone) {\n      if (isReverse) {\n        event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], this.parent.timezone);\n        event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], this.parent.timezone);\n      } else {\n        event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], this.parent.timezone);\n        event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], this.parent.timezone);\n      }\n    }\n\n    return event;\n  };\n\n  EventBase.prototype.filterBlockEvents = function (eventObj) {\n    var fields = this.parent.eventFields;\n    var eStart = eventObj[fields.startTime];\n    var eEnd = eventObj[fields.endTime];\n    var resourceData;\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      var data = this.getGroupIndexFromEvent(eventObj);\n      resourceData = this.parent.resourceBase.lastResourceLevel[data];\n    }\n\n    var blockEvents = extend([], this.parent.blockProcessed, null, true);\n\n    for (var _i = 0, blockEvents_1 = blockEvents; _i < blockEvents_1.length; _i++) {\n      var eventObj_1 = blockEvents_1[_i];\n\n      if (eventObj_1[fields.isAllDay]) {\n        var isDifferentTime = eventObj_1[fields.endTime].getTime() > util.resetTime(new Date(eventObj_1[fields.endTime].getTime())).getTime();\n\n        if (isDifferentTime) {\n          eventObj_1[fields.startTime] = util.resetTime(eventObj_1[fields.startTime]);\n          eventObj_1[fields.endTime] = util.addDays(util.resetTime(eventObj_1[fields.endTime]), 1);\n        }\n      }\n    }\n\n    return this.filterEvents(eStart, eEnd, blockEvents, resourceData);\n  };\n\n  EventBase.prototype.filterEvents = function (startDate, endDate, appointments, resourceTdData) {\n    if (appointments === void 0) {\n      appointments = this.parent.eventsProcessed;\n    }\n\n    var fieldMapping = this.parent.eventFields;\n    var predicate = new Predicate(fieldMapping.startTime, 'greaterthanorequal', startDate).and(new Predicate(fieldMapping.endTime, 'greaterthanorequal', startDate)).and(new Predicate(fieldMapping.startTime, 'lessthan', endDate)).or(new Predicate(fieldMapping.startTime, 'lessthanorequal', startDate).and(new Predicate(fieldMapping.endTime, 'greaterthan', startDate)));\n    var filter = new DataManager({\n      json: appointments\n    }).executeLocal(new Query().where(predicate));\n\n    if (resourceTdData) {\n      filter = this.filterEventsByResource(resourceTdData, filter);\n    }\n\n    return this.sortByTime(filter);\n  };\n\n  EventBase.prototype.filterEventsByRange = function (eventCollection, startDate, endDate) {\n    var _this = this;\n\n    var filteredEvents = [];\n\n    if (startDate && endDate) {\n      filteredEvents = this.filterEvents(startDate, endDate, eventCollection);\n    } else if (startDate && !endDate) {\n      filteredEvents = eventCollection.filter(function (e) {\n        return e[_this.parent.eventFields.startTime] >= startDate;\n      });\n    } else if (!startDate && endDate) {\n      filteredEvents = eventCollection.filter(function (e) {\n        return e[_this.parent.eventFields.endTime] <= endDate;\n      });\n    } else {\n      filteredEvents = eventCollection;\n    }\n\n    return this.sortByTime(filteredEvents);\n  };\n\n  EventBase.prototype.filterEventsByResource = function (resourceTdData, appointments) {\n    if (appointments === void 0) {\n      appointments = this.parent.eventsProcessed;\n    }\n\n    var predicate = {};\n    var resourceCollection = this.parent.resourceBase.resourceCollection;\n\n    for (var level = 0; level < resourceCollection.length; level++) {\n      predicate[resourceCollection[level].field] = resourceTdData.groupOrder[level];\n    }\n\n    var keys = Object.keys(predicate);\n    var filteredCollection = appointments.filter(function (eventObj) {\n      return keys.every(function (key) {\n        if (eventObj[key] instanceof Array) {\n          return eventObj[key].indexOf(predicate[key]) > -1;\n        } else {\n          return eventObj[key] === predicate[key];\n        }\n      });\n    });\n    return filteredCollection;\n  };\n\n  EventBase.prototype.sortByTime = function (appointmentsCollection) {\n    if (this.parent.eventSettings.sortComparer) {\n      appointmentsCollection = this.parent.eventSettings.sortComparer.call(this.parent, appointmentsCollection);\n    } else {\n      var fieldMappings_1 = this.parent.eventFields;\n      appointmentsCollection.sort(function (a, b) {\n        var d1 = a[fieldMappings_1.startTime];\n        var d2 = b[fieldMappings_1.startTime];\n        return d1.getTime() - d2.getTime();\n      });\n    }\n\n    return appointmentsCollection;\n  };\n\n  EventBase.prototype.sortByDateTime = function (appointments) {\n    if (this.parent.eventSettings.sortComparer) {\n      appointments = this.parent.eventSettings.sortComparer.call(this.parent, appointments);\n    } else {\n      var fieldMapping_1 = this.parent.eventFields;\n      appointments.sort(function (object1, object2) {\n        var d3 = object1[fieldMapping_1.startTime];\n        var d4 = object2[fieldMapping_1.startTime];\n        var d5 = object1[fieldMapping_1.endTime];\n        var d6 = object2[fieldMapping_1.endTime];\n        var d1 = d5.getTime() - d3.getTime();\n        var d2 = d6.getTime() - d4.getTime();\n        return d3.getTime() - d4.getTime() || d2 - d1;\n      });\n    }\n\n    return appointments;\n  };\n\n  EventBase.prototype.getSmallestMissingNumber = function (array) {\n    var large = Math.max.apply(Math, array);\n\n    for (var i = 0; i < large; i++) {\n      if (array.indexOf(i) === -1) {\n        return i;\n      }\n    }\n\n    return large + 1;\n  };\n\n  EventBase.prototype.splitEventByDay = function (event) {\n    var eventFields = this.parent.eventFields;\n    var data = [];\n    var eventStartTime = event[eventFields.startTime];\n    var eventEndTime = event[eventFields.endTime];\n    var isDifferentDate = util.resetTime(new Date(eventStartTime.getTime())) < util.resetTime(new Date(eventEndTime.getTime()));\n\n    if (isDifferentDate) {\n      var start = new Date(eventStartTime.getTime());\n      var end = util.addDays(util.resetTime(new Date(eventStartTime.getTime())), 1);\n      var endDate = eventEndTime.getHours() === 0 && eventEndTime.getMinutes() === 0 ? eventEndTime : util.addDays(eventEndTime, 1);\n      var index = 1;\n      var eventLength = util.getDaysCount(eventStartTime.getTime(), endDate.getTime());\n\n      while (end <= eventEndTime && start.getTime() !== end.getTime()) {\n        var app = extend({}, event);\n        app[eventFields.startTime] = start;\n        app[eventFields.endTime] = end;\n        app.data = {\n          index: index,\n          count: eventLength\n        };\n        app.Guid = this.generateGuid();\n        app.isSpanned = true;\n        data.push(app);\n        start = end;\n\n        if (util.resetTime(new Date(start.getTime())).getTime() === util.resetTime(new Date(eventEndTime.getTime())).getTime() && !(end.getTime() === eventEndTime.getTime())) {\n          end = new Date(start.getTime());\n          end = new Date(end.setHours(eventEndTime.getHours(), eventEndTime.getMinutes(), eventEndTime.getSeconds()));\n        } else {\n          end = util.addDays(util.resetTime(new Date(start.getTime())), 1);\n        }\n\n        index++;\n      }\n    } else {\n      data.push(event);\n    }\n\n    return data;\n  };\n\n  EventBase.prototype.splitEvent = function (event, dateRender) {\n    var fields = this.parent.eventFields;\n    var start = util.resetTime(event[fields.startTime]).getTime();\n    var end = util.resetTime(event[fields.endTime]).getTime();\n\n    if (util.getDateInMs(event[fields.endTime]) <= 0) {\n      var temp = util.addDays(util.resetTime(event[fields.endTime]), -1).getTime();\n      end = start > temp ? start : temp;\n    }\n\n    var orgStart = start;\n    var orgEnd = end;\n    var ranges = [];\n\n    if (start !== end) {\n      if (start < dateRender[0].getTime()) {\n        start = dateRender[0].getTime();\n      }\n\n      if (end > dateRender[dateRender.length - 1].getTime()) {\n        end = dateRender[dateRender.length - 1].getTime();\n      }\n\n      var cStart = start;\n\n      for (var level = 0; level < this.slots.length; level++) {\n        var slot = this.slots[level];\n\n        if (this.parent.currentView === 'WorkWeek' || this.parent.currentView === 'TimelineWorkWeek' || this.parent.activeViewOptions.group.byDate || this.parent.activeViewOptions.showWeekend) {\n          var slotDates = [];\n\n          for (var _i = 0, slot_1 = slot; _i < slot_1.length; _i++) {\n            var s = slot_1[_i];\n            slotDates.push(new Date(s));\n          }\n\n          var renderedDates = this.getRenderedDates(slotDates);\n\n          if (!isNullOrUndefined(renderedDates) && renderedDates.length > 0) {\n            slot = [];\n\n            for (var _a = 0, renderedDates_1 = renderedDates; _a < renderedDates_1.length; _a++) {\n              var date = renderedDates_1[_a];\n              slot.push(date.getTime());\n            }\n          }\n        }\n\n        if (typeof slot === 'number') {\n          var temp = slot;\n          slot = [];\n          slot.push(temp);\n        }\n\n        var firstSlot = slot[0];\n        cStart = cStart <= firstSlot && end >= firstSlot ? firstSlot : cStart;\n\n        if (cStart > end || firstSlot > end) {\n          break;\n        }\n\n        if (!this.parent.activeViewOptions.group.byDate && this.parent.activeViewOptions.showWeekend && this.parent.currentView !== 'WorkWeek' && this.parent.currentView !== 'TimelineWorkWeek') {\n          var startIndex = slot.indexOf(cStart);\n\n          if (startIndex !== -1) {\n            var endIndex = slot.indexOf(end);\n            var hasBreak = endIndex !== -1;\n            endIndex = hasBreak ? endIndex : slot.length - 1;\n            var count = endIndex - startIndex + 1;\n            var isLeft = slot[startIndex] !== orgStart;\n            var isRight = slot[endIndex] !== orgEnd;\n            ranges.push(this.cloneEventObject(event, slot[startIndex], slot[endIndex], count, isLeft, isRight));\n\n            if (hasBreak) {\n              break;\n            }\n          }\n        } else {\n          if (this.dateInRange(cStart, slot[0], slot[slot.length - 1])) {\n            var availSlot = [];\n\n            for (var i = 0; i < slot.length; i++) {\n              if (this.dateInRange(slot[i], orgStart, orgEnd)) {\n                availSlot.push(slot[i]);\n              }\n            }\n\n            if (availSlot.length > 0) {\n              if (!this.parent.activeViewOptions.group.byDate) {\n                var isLeft = availSlot[0] !== orgStart;\n                var isRight = availSlot[availSlot.length - 1] !== orgEnd;\n                ranges.push(this.cloneEventObject(event, availSlot[0], availSlot[availSlot.length - 1], availSlot.length, isLeft, isRight));\n              } else {\n                for (var _b = 0, availSlot_1 = availSlot; _b < availSlot_1.length; _b++) {\n                  var slot_2 = availSlot_1[_b];\n                  ranges.push(this.cloneEventObject(event, slot_2, slot_2, 1, slot_2 !== orgStart, slot_2 !== orgEnd));\n                }\n              }\n            }\n          }\n        }\n      }\n    } else {\n      ranges.push(this.cloneEventObject(event, start, end, 1, false, false));\n    }\n\n    return ranges;\n  };\n\n  EventBase.prototype.cloneEventObject = function (event, start, end, count, isLeft, isRight) {\n    var fields = this.parent.eventFields;\n    var e = extend({}, event, null, true);\n    var data = {\n      count: count,\n      isLeft: isLeft,\n      isRight: isRight\n    };\n    data[fields.startTime] = event[fields.startTime];\n    data[fields.endTime] = event[fields.endTime];\n    e.data = data;\n    e[fields.startTime] = new Date(start);\n    e[fields.endTime] = new Date(end);\n    return e;\n  };\n\n  EventBase.prototype.dateInRange = function (date, start, end) {\n    return start <= date && date <= end;\n  };\n\n  EventBase.prototype.getSelectedEventElements = function (target) {\n    this.removeSelectedAppointmentClass();\n\n    if (this.parent.selectedElements.length <= 0) {\n      this.parent.selectedElements.push(target);\n    } else {\n      var isAlreadySelected = this.parent.selectedElements.filter(function (element) {\n        return element.getAttribute('data-guid') === target.getAttribute('data-guid');\n      });\n\n      if (isAlreadySelected.length <= 0) {\n        var elementSelector = 'div[data-guid=\"' + target.getAttribute('data-guid') + '\"]';\n        var focusElements = [].slice.call(this.parent.element.querySelectorAll(elementSelector));\n\n        for (var _i = 0, focusElements_1 = focusElements; _i < focusElements_1.length; _i++) {\n          var element = focusElements_1[_i];\n          this.parent.selectedElements.push(element);\n        }\n      } else {\n        var selectedElements = this.parent.selectedElements.filter(function (element) {\n          return element.getAttribute('data-guid') !== target.getAttribute('data-guid');\n        });\n        this.parent.selectedElements = selectedElements;\n      }\n    }\n\n    if (target && this.parent.selectedElements.length > 0) {\n      this.addSelectedAppointments(this.parent.selectedElements);\n    }\n\n    return this.parent.selectedElements;\n  };\n\n  EventBase.prototype.getSelectedEvents = function () {\n    var _this = this;\n\n    var eventSelect = [];\n    var elementSelect = [];\n    var selectAppointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\n    selectAppointments.filter(function (element) {\n      var isAlreadyAdded = eventSelect.filter(function (event) {\n        return event.Guid === element.getAttribute('data-guid');\n      });\n\n      if (isAlreadyAdded.length === 0) {\n        eventSelect.push(_this.getEventByGuid(element.getAttribute('data-guid')));\n      }\n\n      elementSelect.push(element);\n    });\n    return {\n      event: eventSelect.length > 1 ? eventSelect : eventSelect[0],\n      element: elementSelect.length > 1 ? elementSelect : elementSelect[0]\n    };\n  };\n\n  EventBase.prototype.removeSelectedAppointmentClass = function () {\n    var selectedAppointments = this.getSelectedAppointments();\n\n    for (var _i = 0, selectedAppointments_1 = selectedAppointments; _i < selectedAppointments_1.length; _i++) {\n      var appointment = selectedAppointments_1[_i];\n      appointment.setAttribute('aria-selected', 'false');\n    }\n\n    removeClass(selectedAppointments, cls.APPOINTMENT_BORDER);\n\n    if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n      removeClass(selectedAppointments, cls.AGENDA_SELECTED_CELL);\n    }\n  };\n\n  EventBase.prototype.addSelectedAppointments = function (cells) {\n    for (var _i = 0, cells_1 = cells; _i < cells_1.length; _i++) {\n      var cell = cells_1[_i];\n      cell.setAttribute('aria-selected', 'true');\n    }\n\n    if (this.parent.currentView !== 'MonthAgenda') {\n      this.parent.removeSelectedClass();\n    }\n\n    addClass(cells, cls.APPOINTMENT_BORDER);\n  };\n\n  EventBase.prototype.getSelectedAppointments = function () {\n    return [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER + ',.' + cls.APPOINTMENT_CLASS + ':focus'));\n  };\n\n  EventBase.prototype.focusElement = function (isFocused) {\n    if (this.parent.eventWindow.dialogObject && this.parent.eventWindow.dialogObject.visible) {\n      return;\n    }\n\n    var activeEle = document.activeElement;\n    var selectedCell = this.parent.getSelectedElements();\n\n    if (selectedCell.length > 0 && (activeEle && (this.parent.element.contains(activeEle) || selectedCell.indexOf(activeEle) !== -1) || isFocused)) {\n      if (this.parent.keyboardInteractionModule) {\n        var target = !isNullOrUndefined(this.parent.activeCellsData) && this.parent.activeCellsData.element || selectedCell[selectedCell.length - 1];\n        this.parent.keyboardInteractionModule.selectCells(target instanceof Array, target);\n      }\n\n      return;\n    }\n\n    var selectedAppointments = this.getSelectedAppointments();\n\n    if (selectedAppointments.length > 0) {\n      selectedAppointments[selectedAppointments.length - 1].focus();\n      return;\n    }\n  };\n\n  EventBase.prototype.selectWorkCellByTime = function (eventsData) {\n    var target;\n\n    if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n      return target;\n    }\n\n    if (eventsData.length > 0) {\n      var selectedObject = eventsData[eventsData.length - 1];\n      var eventStartTime = selectedObject[this.parent.eventFields.startTime];\n      var nearestTime = new Date(+eventStartTime).setMinutes(0, 0, 0);\n      var isAllDay = this.isAllDayAppointment(selectedObject);\n\n      if (this.parent.currentView === 'Month' || isAllDay) {\n        nearestTime = new Date(+eventStartTime).setHours(0, 0, 0, 0);\n      }\n\n      var targetArea = void 0;\n\n      if (isAllDay && ['Day', 'Week', 'WorkWeek'].indexOf(this.parent.currentView) !== -1) {\n        targetArea = this.parent.getAllDayRow();\n      } else {\n        targetArea = this.parent.getContentTable();\n      }\n\n      var queryString = '[data-date=\"' + new Date(nearestTime).getTime() + '\"]';\n\n      if (this.parent.activeViewOptions.group.resources.length > 0) {\n        queryString += '[data-group-index=\"' + this.getGroupIndexFromEvent(selectedObject) + '\"]';\n      }\n\n      target = targetArea.querySelector(queryString);\n\n      if (target) {\n        this.parent.activeCellsData = this.parent.getCellDetails(target);\n\n        if (this.parent.keyboardInteractionModule) {\n          this.parent.keyboardInteractionModule.selectCells(false, target);\n        }\n\n        return target;\n      }\n    }\n\n    return target;\n  };\n\n  EventBase.prototype.getGroupIndexFromEvent = function (eventData) {\n    var levelIndex;\n    var resource;\n    var levelName;\n    var idField;\n\n    for (var i = this.parent.resourceBase.resourceCollection.length - 1; i >= 0; i--) {\n      var resourceData = eventData[this.parent.resourceBase.resourceCollection[i].field];\n\n      if (!isNullOrUndefined(resourceData)) {\n        resource = this.parent.resourceBase.resourceCollection[i];\n        levelIndex = i;\n        levelName = resource.name;\n        idField = resource.field;\n        break;\n      }\n    }\n\n    if (isNullOrUndefined(levelName) && isNullOrUndefined(levelIndex)) {\n      levelName = this.parent.resourceCollection.slice(-1)[0].name;\n      levelIndex = this.parent.resourceCollection.length - 1;\n      idField = this.parent.resourceCollection.slice(-1)[0].field;\n      resource = this.parent.resourceCollection.filter(function (e, index) {\n        if (e.name === levelName) {\n          levelIndex = index;\n          return e;\n        }\n\n        return null;\n      })[0];\n    }\n\n    var id = eventData[idField] instanceof Array ? eventData[idField][0] : eventData[idField];\n\n    if (levelIndex > 0) {\n      var parentField = this.parent.resourceCollection[levelIndex - 1].field;\n      return this.parent.resourceBase.getIndexFromResourceId(id, levelName, resource, eventData, parentField);\n    } else {\n      return this.parent.resourceBase.getIndexFromResourceId(id, levelName, resource);\n    }\n  };\n\n  EventBase.prototype.isAllDayAppointment = function (event) {\n    var fieldMapping = this.parent.eventFields;\n    var isAllDay = event[fieldMapping.isAllDay];\n    var isFullDay = (event[fieldMapping.endTime].getTime() - event[fieldMapping.startTime].getTime()) / util.MS_PER_DAY >= 1;\n    return isAllDay || this.parent.eventSettings.spannedEventPlacement !== 'TimeSlot' && isFullDay ? true : false;\n  };\n\n  EventBase.prototype.addEventListener = function () {\n    this.parent.on(event.documentClick, this.appointmentBorderRemove, this);\n  };\n\n  EventBase.prototype.removeEventListener = function () {\n    this.parent.off(event.documentClick, this.appointmentBorderRemove);\n  };\n\n  EventBase.prototype.appointmentBorderRemove = function (event) {\n    var element = event.event.target;\n\n    if (closest(element, '.' + cls.APPOINTMENT_CLASS)) {\n      if (this.parent.currentView !== 'MonthAgenda') {\n        this.parent.removeSelectedClass();\n      }\n    } else if (!closest(element, '.' + cls.POPUP_OPEN)) {\n      this.removeSelectedAppointmentClass();\n    }\n  };\n\n  EventBase.prototype.wireAppointmentEvents = function (element, event, isPreventCrud) {\n    if (isPreventCrud === void 0) {\n      isPreventCrud = false;\n    }\n\n    var isReadOnly = !isNullOrUndefined(event) ? event[this.parent.eventFields.isReadonly] : false;\n    EventHandler.add(element, 'click', this.eventClick, this);\n\n    if (!this.parent.isAdaptive && !this.parent.activeViewOptions.readonly && !isReadOnly) {\n      EventHandler.add(element, 'touchstart', this.eventTouchClick, this);\n      EventHandler.add(element, 'dblclick', this.eventDoubleClick, this);\n    }\n\n    if (!this.parent.activeViewOptions.readonly && !isReadOnly && !isPreventCrud) {\n      if (this.parent.resizeModule) {\n        this.parent.resizeModule.wireResizeEvent(element);\n      }\n\n      if (this.parent.dragAndDropModule) {\n        this.parent.dragAndDropModule.wireDragEvent(element);\n      }\n    }\n  };\n\n  EventBase.prototype.eventTouchClick = function (e) {\n    var _this = this;\n\n    setTimeout(function () {\n      return _this.isDoubleTapped = false;\n    }, 250);\n    e.preventDefault();\n\n    if (this.isDoubleTapped) {\n      this.eventDoubleClick(e);\n    } else if (!this.isDoubleTapped) {\n      this.isDoubleTapped = true;\n      this.eventClick(e);\n    }\n  };\n\n  EventBase.prototype.renderResizeHandler = function (element, spanEvent, isReadOnly) {\n    if (!this.parent.resizeModule || !this.parent.allowResizing || this.parent.activeViewOptions.readonly || isReadOnly) {\n      return;\n    }\n\n    for (var _i = 0, _a = Object.keys(spanEvent); _i < _a.length; _i++) {\n      var resizeEdge = _a[_i];\n      var resizeHandler = createElement('div', {\n        className: cls.EVENT_RESIZE_CLASS\n      });\n\n      switch (resizeEdge) {\n        case 'isLeft':\n          if (!spanEvent.isLeft) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-left-right-resize'\n            }));\n            addClass([resizeHandler], this.parent.enableRtl ? cls.RIGHT_RESIZE_HANDLER : cls.LEFT_RESIZE_HANDLER);\n            prepend([resizeHandler], element);\n          }\n\n          break;\n\n        case 'isRight':\n          if (!spanEvent.isRight) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-left-right-resize'\n            }));\n            addClass([resizeHandler], this.parent.enableRtl ? cls.LEFT_RESIZE_HANDLER : cls.RIGHT_RESIZE_HANDLER);\n            append([resizeHandler], element);\n          }\n\n          break;\n\n        case 'isTop':\n          if (!spanEvent.isTop) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-top-bottom-resize'\n            }));\n            addClass([resizeHandler], cls.TOP_RESIZE_HANDLER);\n            prepend([resizeHandler], element);\n          }\n\n          break;\n\n        case 'isBottom':\n          if (!spanEvent.isBottom) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-top-bottom-resize'\n            }));\n            addClass([resizeHandler], cls.BOTTOM_RESIZE_HANDLER);\n            append([resizeHandler], element);\n          }\n\n          break;\n      }\n    }\n  };\n\n  EventBase.prototype.eventClick = function (eventData) {\n    var _this = this;\n\n    var target = eventData.target;\n\n    if (target.classList.contains(cls.DRAG_CLONE_CLASS) || target.classList.contains(cls.RESIZE_CLONE_CLASS) || target.classList.contains(cls.INLINE_SUBJECT_CLASS)) {\n      return;\n    }\n\n    if ((eventData.ctrlKey || eventData.metaKey) && eventData.which === 1 && this.parent.keyboardInteractionModule) {\n      this.parent.quickPopup.quickPopup.hide();\n      this.parent.selectedElements = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\n      var target_1 = closest(eventData.target, '.' + cls.APPOINTMENT_CLASS);\n      this.getSelectedEventElements(target_1);\n      this.activeEventData(eventData, false);\n      var selectArgs = {\n        data: this.parent.activeEventData.event,\n        element: this.parent.activeEventData.element,\n        event: eventData,\n        requestType: 'eventSelect'\n      };\n      this.parent.trigger(event.select, selectArgs);\n      var args = extend(this.parent.activeEventData, {\n        cancel: false,\n        originalEvent: eventData\n      });\n      this.parent.trigger(event.eventClick, args);\n    } else {\n      this.removeSelectedAppointmentClass();\n      this.activeEventData(eventData, true);\n      var selectEventArgs = {\n        data: this.parent.activeEventData.event,\n        element: this.parent.activeEventData.element,\n        event: eventData,\n        requestType: 'eventSelect'\n      };\n      this.parent.trigger(event.select, selectEventArgs);\n      var args = extend(this.parent.activeEventData, {\n        cancel: false,\n        originalEvent: eventData\n      });\n      this.parent.trigger(event.eventClick, args, function (eventClickArgs) {\n        if (eventClickArgs.cancel) {\n          _this.removeSelectedAppointmentClass();\n\n          if (_this.parent.quickPopup) {\n            _this.parent.quickPopup.quickPopupHide();\n          }\n        } else {\n          if (_this.parent.currentView === 'Agenda' || _this.parent.currentView === 'MonthAgenda') {\n            addClass([_this.parent.activeEventData.element], cls.AGENDA_SELECTED_CELL);\n          }\n\n          if (_this.parent.allowInline) {\n            var inlineArgs = {\n              data: eventClickArgs.event,\n              element: eventClickArgs.element,\n              type: 'Event'\n            };\n\n            _this.parent.notify(event.inlineClick, inlineArgs);\n          } else {\n            _this.parent.notify(event.eventClick, eventClickArgs);\n          }\n        }\n      });\n    }\n  };\n\n  EventBase.prototype.eventDoubleClick = function (e) {\n    if (this.parent.quickPopup) {\n      this.parent.quickPopup.quickPopupHide(true);\n    }\n\n    if (e.type === 'touchstart') {\n      this.activeEventData(e, true);\n    }\n\n    this.removeSelectedAppointmentClass();\n\n    if (this.parent.activeEventData.element.classList.contains(cls.INLINE_APPOINTMENT_CLASS) || this.parent.activeEventData.element.querySelector('.' + cls.INLINE_SUBJECT_CLASS)) {\n      return;\n    }\n\n    if (!isNullOrUndefined(this.parent.activeEventData.event) && isNullOrUndefined(this.parent.activeEventData.event[this.parent.eventFields.recurrenceID])) {\n      this.parent.eventWindow.openEditor(this.parent.activeEventData.event, 'Save');\n    } else {\n      this.parent.currentAction = 'EditOccurrence';\n      this.parent.quickPopup.openRecurrenceAlert();\n    }\n  };\n\n  EventBase.prototype.getEventByGuid = function (guid) {\n    return this.parent.eventsProcessed.filter(function (data) {\n      return data.Guid === guid;\n    })[0];\n  };\n\n  EventBase.prototype.getEventById = function (id) {\n    var _this = this;\n\n    return this.parent.eventsData.filter(function (data) {\n      return data[_this.parent.eventFields.id] === id;\n    })[0];\n  };\n\n  EventBase.prototype.generateGuid = function () {\n    return 'xyxxxxyx-xxxy-yxxx-xyxx-xxyxxxxyyxxx'.replace(/[xy]/g, function (c) {\n      var r = Math.random() * 16 | 0;\n      var v = c === 'x' ? r : r & 0x3 | 0x8;\n      return v.toString(16);\n    });\n  };\n\n  EventBase.prototype.getEventIDType = function () {\n    if (this.parent.eventsData.length !== 0) {\n      return typeof this.parent.eventsData[0][this.parent.eventFields.id];\n    }\n\n    if (this.parent.blockData.length !== 0) {\n      return typeof this.parent.blockData[0][this.parent.eventFields.id];\n    }\n\n    return 'string';\n  };\n\n  EventBase.prototype.getEventMaxID = function (resourceId) {\n    var _this = this;\n\n    if (this.parent.eventsData.length < 1 && this.parent.blockData.length < 1) {\n      return 1;\n    }\n\n    var eventId;\n    var idType = this.getEventIDType();\n\n    if (idType === 'string') {\n      eventId = this.generateGuid();\n    }\n\n    if (idType === 'number') {\n      var datas = this.parent.eventsData.concat(this.parent.blockData);\n      var maxId = Math.max.apply(Math, datas.map(function (event) {\n        return event[_this.parent.eventFields.id];\n      }));\n      maxId = isNullOrUndefined(resourceId) ? maxId : maxId + resourceId;\n      eventId = maxId + 1;\n    }\n\n    return eventId;\n  };\n\n  EventBase.prototype.activeEventData = function (eventData, isMultiple) {\n    var _this = this;\n\n    var target = closest(eventData.target, '.' + cls.APPOINTMENT_CLASS);\n    var guid = target.getAttribute('data-guid');\n\n    if (isMultiple) {\n      this.addSelectedAppointments([].slice.call(this.parent.element.querySelectorAll('div[data-guid=\"' + guid + '\"]')));\n      target.focus();\n    }\n\n    var eventObject = this.getEventByGuid(guid);\n\n    if (eventObject && eventObject.isSpanned) {\n      eventObject = this.parent.eventsData.filter(function (obj) {\n        return obj[_this.parent.eventFields.id] === eventObject[_this.parent.eventFields.id];\n      })[0];\n    }\n\n    this.parent.activeEventData = {\n      event: eventObject,\n      element: target\n    };\n  };\n\n  EventBase.prototype.generateOccurrence = function (event, viewDate, oldTimezone, isMaxCount) {\n    var startDate = event[this.parent.eventFields.startTime];\n    var endDate = event[this.parent.eventFields.endTime];\n    var eventRule = event[this.parent.eventFields.recurrenceRule];\n    var duration = endDate.getTime() - startDate.getTime();\n    viewDate = new Date((viewDate || this.parent.activeView.startDate()).getTime() - duration);\n    var exception = event[this.parent.eventFields.recurrenceException];\n    var maxCount;\n\n    if (this.parent.currentView !== 'Agenda' && isMaxCount) {\n      maxCount = util.getDateCount(this.parent.activeView.startDate(), this.parent.activeView.endDate()) + 1;\n    }\n\n    var newTimezone = this.parent.timezone || this.parent.tzModule.getLocalTimezoneName();\n    var firstDay = this.parent.activeViewOptions.firstDayOfWeek;\n    var calendarMode = this.parent.calendarMode;\n    var dates = generate(startDate, eventRule, exception, firstDay, maxCount, viewDate, calendarMode, oldTimezone, newTimezone);\n\n    if (this.parent.currentView === 'Agenda' && eventRule.indexOf('COUNT') === -1 && eventRule.indexOf('UNTIL') === -1) {\n      if (isNullOrUndefined(event.generatedDates)) {\n        event.generatedDates = {\n          start: new Date(dates[0]),\n          end: new Date(dates[dates.length - 1])\n        };\n      } else {\n        if (dates[0] < event.generatedDates.start.getTime()) {\n          event.generatedDates.start = new Date(dates[0]);\n        }\n\n        if (dates[dates.length - 1] > event.generatedDates.end.getTime()) {\n          event.generatedDates.end = new Date(dates[dates.length - 1]);\n        }\n      }\n    }\n\n    var occurrenceCollection = [];\n\n    for (var _i = 0, dates_1 = dates; _i < dates_1.length; _i++) {\n      var date = dates_1[_i];\n      var clonedObject = extend({}, event, null, true);\n      clonedObject[this.parent.eventFields.startTime] = new Date(date);\n      clonedObject[this.parent.eventFields.endTime] = new Date(new Date(date).setMilliseconds(duration));\n      clonedObject[this.parent.eventFields.recurrenceID] = clonedObject[this.parent.eventFields.id];\n      delete clonedObject[this.parent.eventFields.recurrenceException];\n      delete clonedObject[this.parent.eventFields.followingID];\n      clonedObject.Guid = this.generateGuid();\n      occurrenceCollection.push(clonedObject);\n    }\n\n    return occurrenceCollection;\n  };\n\n  EventBase.prototype.getParentEvent = function (eventObj, isParent) {\n    if (isParent === void 0) {\n      isParent = false;\n    }\n\n    var parentEvent;\n\n    do {\n      eventObj = this.getFollowingEvent(eventObj);\n\n      if (eventObj) {\n        parentEvent = extend({}, eventObj, null, true);\n      }\n    } while (eventObj && isParent);\n\n    if (isParent && parentEvent) {\n      var collection = this.getEventCollections(parentEvent);\n      var followObj = collection.follow.slice(-1)[0];\n\n      if (collection.occurrence.length > 0 && !parentEvent[this.parent.eventFields.recurrenceException]) {\n        followObj = collection.occurrence.slice(-1)[0];\n      }\n\n      if (followObj) {\n        parentEvent[this.parent.eventFields.recurrenceRule] = followObj[this.parent.eventFields.recurrenceRule];\n      }\n    }\n\n    return parentEvent;\n  };\n\n  EventBase.prototype.getEventCollections = function (parentObj, childObj) {\n    var followingCollection = [];\n    var occurrenceCollection = [];\n    var followingEvent = parentObj;\n\n    do {\n      followingEvent = this.getFollowingEvent(followingEvent, true);\n\n      if (followingEvent) {\n        followingCollection.push(followingEvent);\n      }\n\n      occurrenceCollection = occurrenceCollection.concat(this.getOccurrenceEvent(followingEvent || parentObj));\n    } while (followingEvent);\n\n    var collections = {};\n\n    if (childObj) {\n      var fields_1 = this.parent.eventFields;\n      collections = {\n        follow: followingCollection.filter(function (eventData) {\n          return eventData[fields_1.startTime] >= childObj[fields_1.startTime];\n        }),\n        occurrence: occurrenceCollection.filter(function (eventData) {\n          return eventData[fields_1.startTime] >= childObj[fields_1.startTime];\n        })\n      };\n    } else {\n      collections = {\n        follow: followingCollection,\n        occurrence: occurrenceCollection\n      };\n    }\n\n    return collections;\n  };\n\n  EventBase.prototype.getFollowingEvent = function (parentObj, isReverse) {\n    var fields = this.parent.eventFields;\n    var fieldValue;\n\n    if (isReverse) {\n      fieldValue = parentObj[fields.id];\n    } else {\n      fieldValue = parentObj[fields.recurrenceID] || parentObj[fields.followingID];\n    }\n\n    var parentApp = this.parent.eventsData.filter(function (data) {\n      return data[isReverse ? fields.followingID : fields.id] === fieldValue;\n    });\n    return parentApp.shift();\n  };\n\n  EventBase.prototype.isFollowingEvent = function (parentObj, childObj) {\n    var parentStart = parentObj[this.parent.eventFields.startTime];\n    var childStart = childObj[this.parent.eventFields.startTime];\n    return parentStart.getHours() === childStart.getHours() && parentStart.getMinutes() === childStart.getMinutes() && parentStart.getSeconds() === childStart.getSeconds();\n  };\n\n  EventBase.prototype.getOccurrenceEvent = function (eventObj, isGuid, isFollowing) {\n    if (isGuid === void 0) {\n      isGuid = false;\n    }\n\n    if (isFollowing === void 0) {\n      isFollowing = false;\n    }\n\n    var idField = isGuid ? 'Guid' : isFollowing ? this.parent.eventFields.followingID : this.parent.eventFields.recurrenceID;\n    var fieldKey = isGuid ? 'Guid' : this.parent.eventFields.id;\n    var dataSource = isGuid ? this.parent.eventsProcessed : this.parent.eventsData;\n    return dataSource.filter(function (data) {\n      return data[idField] === eventObj[fieldKey];\n    });\n  };\n\n  EventBase.prototype.getOccurrencesByID = function (id) {\n    var fields = this.parent.eventFields;\n    var occurrenceCollection = [];\n    var parentObject = this.parent.eventsData.filter(function (obj) {\n      return obj[fields.id] === id;\n    });\n\n    for (var _i = 0, parentObject_1 = parentObject; _i < parentObject_1.length; _i++) {\n      var event_3 = parentObject_1[_i];\n\n      if (!isNullOrUndefined(event_3[fields.recurrenceRule])) {\n        occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_3));\n      }\n    }\n\n    return occurrenceCollection;\n  };\n\n  EventBase.prototype.getOccurrencesByRange = function (startTime, endTime) {\n    var fields = this.parent.eventFields;\n    var occurrenceCollection = [];\n\n    for (var _i = 0, _a = this.parent.eventsData; _i < _a.length; _i++) {\n      var event_4 = _a[_i];\n\n      if (!isNullOrUndefined(event_4[fields.recurrenceRule])) {\n        occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_4));\n      }\n    }\n\n    var filter = occurrenceCollection.filter(function (obj) {\n      return obj[fields.startTime] >= startTime && obj[fields.endTime] <= endTime && !isNullOrUndefined(obj[fields.recurrenceID]);\n    });\n    return filter;\n  };\n\n  EventBase.prototype.getDeletedOccurrences = function (recurrenceData) {\n    var fields = this.parent.eventFields;\n    var parentObject;\n    var deletedOccurrences = [];\n\n    if (typeof recurrenceData === 'string' || typeof recurrenceData === 'number') {\n      parentObject = this.parent.eventsData.filter(function (obj) {\n        return obj[fields.id] === recurrenceData;\n      })[0];\n    } else {\n      parentObject = extend({}, recurrenceData, null, true);\n    }\n\n    if (parentObject[fields.recurrenceException]) {\n      var exDateString_1 = parentObject[fields.recurrenceException].split(',');\n\n      var _loop_3 = function (i, len) {\n        var edited = this_2.parent.eventsData.filter(function (eventObj) {\n          return eventObj[fields.recurrenceID] === parentObject[fields.id] && eventObj[fields.recurrenceException] === exDateString_1[i];\n        });\n\n        if (edited.length === 0) {\n          var exDate = getDateFromRecurrenceDateString(exDateString_1[i]);\n          var childObject = extend({}, recurrenceData, null, true);\n          childObject[fields.recurrenceID] = parentObject[fields.id];\n          delete childObject[fields.followingID];\n          childObject[fields.recurrenceException] = exDateString_1[i];\n          var startDate = new Date(exDate.getTime());\n          var time = parentObject[fields.endTime].getTime() - parentObject[fields.startTime].getTime();\n          var endDate = new Date(startDate.getTime());\n          endDate.setMilliseconds(time);\n          childObject[fields.startTime] = new Date(startDate.getTime());\n          childObject[fields.endTime] = new Date(endDate.getTime());\n          deletedOccurrences.push(childObject);\n        }\n      };\n\n      var this_2 = this;\n\n      for (var i = 0, len = exDateString_1.length; i < len; i++) {\n        _loop_3(i, len);\n      }\n    }\n\n    return deletedOccurrences;\n  };\n\n  EventBase.prototype.applyResourceColor = function (element, data, type, index, alpha) {\n    if (!this.parent.resourceBase) {\n      return;\n    }\n\n    var alphaColor = function (color, alpha) {\n      color = color.replace('#', '');\n      var r = parseInt(color.substring(0, color.length / 3), 16);\n      var g = parseInt(color.substring(color.length / 3, 2 * color.length / 3), 16);\n      var b = parseInt(color.substring(2 * color.length / 3, 3 * color.length / 3), 16);\n      return \"rgba(\" + r + \", \" + g + \", \" + b + \", \" + alpha + \")\";\n    }; // index refers groupOrder\n\n\n    var color = this.parent.resourceBase.getResourceColor(data, index);\n\n    if (color) {\n      element.style[type] = !isNullOrUndefined(alpha) ? alphaColor(color, alpha) : color;\n    }\n  };\n\n  EventBase.prototype.createBlockAppointmentElement = function (record, resIndex) {\n    var eventSubject = record[this.parent.eventFields.subject] || this.parent.eventSettings.fields.subject.default;\n    var appointmentWrapper = createElement('div', {\n      className: cls.BLOCK_APPOINTMENT_CLASS,\n      attrs: {\n        'data-id': 'Appointment_' + record[this.parent.eventFields.id],\n        'aria-readonly': 'true',\n        'aria-selected': 'false'\n      }\n    });\n    var templateElement;\n\n    if (!isNullOrUndefined(this.parent.activeViewOptions.eventTemplate)) {\n      var scheduleId = this.parent.element.id + '_';\n      var viewName = this.parent.activeViewOptions.eventTemplateName;\n      var templateId = scheduleId + viewName + 'eventTemplate';\n      var templateName = 'eventTemplate' + (this.parent.activeViewOptions.group.resources.length > 0 && this.parent.currentView.indexOf('Year') === -1 ? '_' + resIndex : '');\n      templateElement = this.parent.getAppointmentTemplate()(record, this.parent, templateName, templateId, false);\n    } else {\n      var appointmentSubject = createElement('div', {\n        className: cls.SUBJECT_CLASS,\n        innerHTML: eventSubject\n      });\n      templateElement = [appointmentSubject];\n    }\n\n    append(templateElement, appointmentWrapper);\n    this.setWrapperAttributes(appointmentWrapper, resIndex);\n    return appointmentWrapper;\n  };\n\n  EventBase.prototype.setWrapperAttributes = function (appointmentWrapper, resIndex) {\n    if (!isNullOrUndefined(this.cssClass)) {\n      addClass([appointmentWrapper], this.cssClass);\n    }\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      appointmentWrapper.setAttribute('data-group-index', resIndex.toString());\n    }\n  };\n\n  EventBase.prototype.getReadonlyAttribute = function (event) {\n    return (event[this.parent.eventFields.isReadonly] || this.parent.readonly).toString();\n  };\n\n  EventBase.prototype.isBlockRange = function (eventData) {\n    var eventCollection = eventData instanceof Array ? eventData : [eventData];\n    var isBlockAlert = false;\n    var fields = this.parent.eventFields;\n\n    for (var _i = 0, _a = eventCollection; _i < _a.length; _i++) {\n      var event_5 = _a[_i];\n      var dataCol = [];\n\n      if (!isNullOrUndefined(event_5[fields.recurrenceRule]) && (isNullOrUndefined(event_5[fields.recurrenceID]) || event_5[fields.id] === event_5[fields.recurrenceID])) {\n        dataCol = this.generateOccurrence(event_5);\n      } else {\n        dataCol.push(event_5);\n      }\n\n      for (var _b = 0, dataCol_1 = dataCol; _b < dataCol_1.length; _b++) {\n        var data = dataCol_1[_b];\n        var filterBlockEvents = this.filterBlockEvents(data);\n\n        if (filterBlockEvents.length > 0) {\n          isBlockAlert = true;\n          break;\n        }\n      }\n    }\n\n    this.parent.uiStateValues.isBlock = isBlockAlert;\n    return isBlockAlert;\n  };\n\n  EventBase.prototype.getFilterEventsList = function (dataSource, query) {\n    return new DataManager(dataSource).executeLocal(new Query().where(query));\n  };\n\n  EventBase.prototype.getSeriesEvents = function (parentEvent, startTime) {\n    var fields = this.parent.eventFields;\n    startTime = isNullOrUndefined(startTime) ? parentEvent[fields.startTime] : startTime;\n    var deleteFutureEditEvents;\n    var futureEvents;\n    var deleteFutureEditEventList = [];\n    var delId = parentEvent[fields.id];\n    var followingId = parentEvent[fields.followingID];\n    var deleteFutureEvent;\n    var startTimeQuery = this.parent.currentAction === 'EditSeries' ? 'greaterthan' : 'greaterthanorequal';\n\n    do {\n      deleteFutureEvent = new Predicate(fields.followingID, 'equal', delId).and(new Predicate(fields.startTime, startTimeQuery, startTime));\n      futureEvents = this.getFilterEventsList(this.parent.eventsData, deleteFutureEvent);\n      deleteFutureEditEvents = futureEvents.slice(-1)[0];\n\n      if (!isNullOrUndefined(deleteFutureEditEvents) && deleteFutureEditEvents[fields.id] !== followingId) {\n        deleteFutureEditEventList.push(deleteFutureEditEvents);\n        delId = deleteFutureEditEvents[fields.id];\n        followingId = deleteFutureEditEvents[fields.followingID];\n      } else {\n        followingId = null;\n      }\n    } while (futureEvents.length === 1 && !isNullOrUndefined(deleteFutureEditEvents[fields.followingID]));\n\n    return deleteFutureEditEventList;\n  };\n\n  EventBase.prototype.getEditedOccurrences = function (deleteFutureEditEventList, startTime) {\n    var fields = this.parent.eventFields;\n    var deleteRecurrenceEventList = [];\n    var delEditedEvents;\n\n    for (var _i = 0, deleteFutureEditEventList_1 = deleteFutureEditEventList; _i < deleteFutureEditEventList_1.length; _i++) {\n      var event_6 = deleteFutureEditEventList_1[_i];\n      var delEventQuery = new Predicate(fields.recurrenceID, 'equal', event_6[fields.id]).or(new Predicate(fields.recurrenceID, 'equal', event_6[fields.followingID]).and(new Predicate(fields.recurrenceID, 'notequal', undefined)).and(new Predicate(fields.recurrenceID, 'notequal', null)));\n\n      if (this.parent.currentAction === 'EditFollowingEvents' || this.parent.currentAction === 'DeleteFollowingEvents') {\n        delEventQuery = delEventQuery.and(new Predicate(fields.startTime, 'greaterthanorequal', startTime));\n      }\n\n      delEditedEvents = this.getFilterEventsList(this.parent.eventsData, delEventQuery);\n      deleteRecurrenceEventList = deleteRecurrenceEventList.concat(delEditedEvents);\n    }\n\n    return deleteRecurrenceEventList;\n  };\n\n  EventBase.prototype.getRenderedDates = function (dateRender) {\n    var firstDate = 0;\n    var lastDate = dateRender.length;\n    var filteredDates;\n\n    if (dateRender[0] < this.parent.minDate && dateRender[dateRender.length - 1] > this.parent.maxDate) {\n      for (var i = 0; i < dateRender.length; i++) {\n        if (util.resetTime(dateRender[i]).getTime() === util.resetTime(new Date(this.parent.minDate)).getTime()) {\n          firstDate = i;\n        }\n\n        if (util.resetTime(dateRender[i]).getTime() === util.resetTime(new Date(this.parent.maxDate)).getTime()) {\n          lastDate = i;\n        }\n      }\n\n      filteredDates = dateRender.filter(function (date) {\n        return date >= dateRender[firstDate] && date <= dateRender[lastDate];\n      });\n    }\n\n    return filteredDates;\n  };\n\n  EventBase.prototype.isValidEvent = function (eventObj, start, end, schedule) {\n    var isHourRange = end.getTime() > schedule.startHour.getTime() && start.getTime() < schedule.endHour.getTime();\n    var isSameRange = schedule.startHour.getTime() <= start.getTime() && eventObj[this.parent.eventFields.startTime].getTime() >= schedule.startHour.getTime() && eventObj[this.parent.eventFields.endTime].getTime() < schedule.endHour.getTime() && start.getTime() === end.getTime();\n    return isHourRange || isSameRange;\n  };\n\n  EventBase.prototype.allDayExpandScroll = function (dateHeader) {\n    var indentHeight = 0;\n    var headerRows = [].slice.call(this.parent.element.querySelectorAll('.' + cls.HEADER_ROW_CLASS));\n    headerRows.forEach(function (element) {\n      var tdEle = [].slice.call(element.children);\n      tdEle.forEach(function (ele) {\n        ele.style.top = indentHeight + 'px';\n      });\n      indentHeight += element.offsetHeight;\n    });\n    indentHeight = dateHeader.offsetHeight - indentHeight;\n    this.parent.element.querySelector('.' + cls.ALLDAY_CELLS_CLASS).style.height = indentHeight / 12 + 'em';\n\n    if (this.parent.uiStateValues.expand) {\n      addClass([dateHeader], cls.ALLDAY_APPOINTMENT_SCROLL);\n    } else {\n      removeClass([dateHeader], cls.ALLDAY_APPOINTMENT_SCROLL);\n    }\n  };\n\n  EventBase.prototype.updateEventMinimumDuration = function (startEndHours, startTime, endTime) {\n    var eventDuration = (util.getUniversalTime(endTime) - util.getUniversalTime(startTime)) / util.MS_PER_MINUTE;\n\n    if (eventDuration < this.parent.eventSettings.minimumEventDuration) {\n      var tempEnd = new Date(startTime);\n      tempEnd.setMinutes(tempEnd.getMinutes() + this.parent.eventSettings.minimumEventDuration);\n      endTime = tempEnd;\n\n      if (endTime.getTime() > startEndHours.endHour.getTime()) {\n        var tempStart = new Date(startEndHours.endHour.getTime());\n        tempStart.setMinutes(tempStart.getMinutes() - this.parent.eventSettings.minimumEventDuration);\n        startTime = tempStart;\n        endTime = startEndHours.endHour;\n      }\n    }\n\n    return {\n      startDate: startTime,\n      endDate: endTime\n    };\n  };\n\n  EventBase.prototype.unWireEvents = function () {\n    var appElements = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n\n    for (var _i = 0, appElements_1 = appElements; _i < appElements_1.length; _i++) {\n      var element = appElements_1[_i];\n      EventHandler.clearEvents(element);\n    }\n  };\n\n  EventBase.prototype.destroy = function () {\n    this.unWireEvents();\n    this.parent = null;\n  };\n\n  return EventBase;\n}();\n\nexport { EventBase };","map":{"version":3,"names":["isNullOrUndefined","closest","extend","EventHandler","createElement","prepend","append","addClass","removeClass","DataManager","Query","Predicate","generate","getDateFromRecurrenceDateString","util","cls","event","EventBase","parent","slots","isDoubleTapped","prototype","processData","events","timeZonePropChanged","oldTimezone","_this","start","activeView","startDate","end","endDate","fields","eventFields","processed","temp","generateID","resourceCollection","resourceBase","length","id","_loop_1","event_1","this_1","updateEventDateTime","processTimezoneChange","isPrinting","uiStateValues","isResize","processTimezone","level","field","undefined","recurrenceRule","recurrenceID","crudModule","crudObj","isCrudAction","concat","generateOccurrence","recurrenceEvent","_loop_2","occurrence","app","eventsProcessed","filter","data","startTime","getTime","Guid","generateGuid","push","_i","recurrenceEvent_1","events_1","eventData","isBlock","filterEvents","blockData","_a","blockData_1","eventObj","isAllDay","isDifferentDate","resetTime","Date","endTime","addDays","blockProcessed","getDateFromString","getProcessedEvents","eventCollection","eventsData","eventCollection_1","event_2","timezonePropertyChange","notify","dataReady","processedData","timezoneConvert","startTimezone","endTimezone","timezone","startTz","endTz","tzModule","convert","add","remove","isReverse","filterBlockEvents","eStart","eEnd","resourceData","activeViewOptions","group","resources","getGroupIndexFromEvent","lastResourceLevel","blockEvents","blockEvents_1","eventObj_1","isDifferentTime","appointments","resourceTdData","fieldMapping","predicate","and","or","json","executeLocal","where","filterEventsByResource","sortByTime","filterEventsByRange","filteredEvents","e","groupOrder","keys","Object","filteredCollection","every","key","Array","indexOf","appointmentsCollection","eventSettings","sortComparer","call","fieldMappings_1","sort","a","b","d1","d2","sortByDateTime","fieldMapping_1","object1","object2","d3","d4","d5","d6","getSmallestMissingNumber","array","large","Math","max","apply","i","splitEventByDay","eventStartTime","eventEndTime","getHours","getMinutes","index","eventLength","getDaysCount","count","isSpanned","setHours","getSeconds","splitEvent","dateRender","getDateInMs","orgStart","orgEnd","ranges","cStart","slot","currentView","byDate","showWeekend","slotDates","slot_1","s","renderedDates","getRenderedDates","renderedDates_1","date","firstSlot","startIndex","endIndex","hasBreak","isLeft","isRight","cloneEventObject","dateInRange","availSlot","_b","availSlot_1","slot_2","getSelectedEventElements","target","removeSelectedAppointmentClass","selectedElements","isAlreadySelected","element","getAttribute","elementSelector","focusElements","slice","querySelectorAll","focusElements_1","addSelectedAppointments","getSelectedEvents","eventSelect","elementSelect","selectAppointments","APPOINTMENT_BORDER","isAlreadyAdded","getEventByGuid","selectedAppointments","getSelectedAppointments","selectedAppointments_1","appointment","setAttribute","AGENDA_SELECTED_CELL","cells","cells_1","cell","removeSelectedClass","APPOINTMENT_CLASS","focusElement","isFocused","eventWindow","dialogObject","visible","activeEle","document","activeElement","selectedCell","getSelectedElements","contains","keyboardInteractionModule","activeCellsData","selectCells","focus","selectWorkCellByTime","selectedObject","nearestTime","setMinutes","isAllDayAppointment","targetArea","getAllDayRow","getContentTable","queryString","querySelector","getCellDetails","levelIndex","resource","levelName","idField","name","parentField","getIndexFromResourceId","isFullDay","MS_PER_DAY","spannedEventPlacement","addEventListener","on","documentClick","appointmentBorderRemove","removeEventListener","off","POPUP_OPEN","wireAppointmentEvents","isPreventCrud","isReadOnly","isReadonly","eventClick","isAdaptive","readonly","eventTouchClick","eventDoubleClick","resizeModule","wireResizeEvent","dragAndDropModule","wireDragEvent","setTimeout","preventDefault","renderResizeHandler","spanEvent","allowResizing","resizeEdge","resizeHandler","className","EVENT_RESIZE_CLASS","appendChild","enableRtl","RIGHT_RESIZE_HANDLER","LEFT_RESIZE_HANDLER","isTop","TOP_RESIZE_HANDLER","isBottom","BOTTOM_RESIZE_HANDLER","classList","DRAG_CLONE_CLASS","RESIZE_CLONE_CLASS","INLINE_SUBJECT_CLASS","ctrlKey","metaKey","which","quickPopup","hide","target_1","activeEventData","selectArgs","requestType","trigger","select","args","cancel","originalEvent","selectEventArgs","eventClickArgs","quickPopupHide","allowInline","inlineArgs","type","inlineClick","INLINE_APPOINTMENT_CLASS","openEditor","currentAction","openRecurrenceAlert","guid","getEventById","replace","c","r","random","v","toString","getEventIDType","getEventMaxID","resourceId","eventId","idType","datas","maxId","map","isMultiple","eventObject","obj","viewDate","isMaxCount","eventRule","duration","exception","recurrenceException","maxCount","getDateCount","newTimezone","getLocalTimezoneName","firstDay","firstDayOfWeek","calendarMode","dates","generatedDates","occurrenceCollection","dates_1","clonedObject","setMilliseconds","followingID","getParentEvent","isParent","parentEvent","getFollowingEvent","collection","getEventCollections","followObj","follow","parentObj","childObj","followingCollection","followingEvent","getOccurrenceEvent","collections","fields_1","fieldValue","parentApp","shift","isFollowingEvent","parentStart","childStart","isGuid","isFollowing","fieldKey","dataSource","getOccurrencesByID","parentObject","parentObject_1","event_3","getOccurrencesByRange","event_4","getDeletedOccurrences","recurrenceData","deletedOccurrences","exDateString_1","split","_loop_3","len","edited","this_2","exDate","childObject","time","applyResourceColor","alpha","alphaColor","color","parseInt","substring","g","getResourceColor","style","createBlockAppointmentElement","record","resIndex","eventSubject","subject","default","appointmentWrapper","BLOCK_APPOINTMENT_CLASS","attrs","templateElement","eventTemplate","scheduleId","viewName","eventTemplateName","templateId","templateName","getAppointmentTemplate","appointmentSubject","SUBJECT_CLASS","innerHTML","setWrapperAttributes","cssClass","getReadonlyAttribute","isBlockRange","isBlockAlert","event_5","dataCol","dataCol_1","getFilterEventsList","query","getSeriesEvents","deleteFutureEditEvents","futureEvents","deleteFutureEditEventList","delId","followingId","deleteFutureEvent","startTimeQuery","getEditedOccurrences","deleteRecurrenceEventList","delEditedEvents","deleteFutureEditEventList_1","event_6","delEventQuery","firstDate","lastDate","filteredDates","minDate","maxDate","isValidEvent","schedule","isHourRange","startHour","endHour","isSameRange","allDayExpandScroll","dateHeader","indentHeight","headerRows","HEADER_ROW_CLASS","forEach","tdEle","children","ele","top","offsetHeight","ALLDAY_CELLS_CLASS","height","expand","ALLDAY_APPOINTMENT_SCROLL","updateEventMinimumDuration","startEndHours","eventDuration","getUniversalTime","MS_PER_MINUTE","minimumEventDuration","tempEnd","tempStart","unWireEvents","appElements","appElements_1","clearEvents","destroy"],"sources":["C:/Users/shahj/OneDrive/Documents/GitHub/Multifunctional-React-Dashboard/node_modules/@syncfusion/ej2-schedule/src/schedule/event-renderer/event-base.js"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable max-len */\nimport { isNullOrUndefined, closest, extend, EventHandler } from '@syncfusion/ej2-base';\nimport { createElement, prepend, append, addClass, removeClass } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Predicate } from '@syncfusion/ej2-data';\nimport { generate, getDateFromRecurrenceDateString } from '../../recurrence-editor/date-generator';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\nimport * as event from '../base/constant';\n/**\n * EventBase for appointment rendering\n */\nvar EventBase = /** @class */ (function () {\n    /**\n     * Constructor for EventBase\n     *\n     * @param {Schedule} parent Accepts the schedule instance\n     */\n    function EventBase(parent) {\n        this.slots = [];\n        this.isDoubleTapped = false;\n        this.parent = parent;\n    }\n    EventBase.prototype.processData = function (events, timeZonePropChanged, oldTimezone) {\n        var _this = this;\n        var start = this.parent.activeView.startDate();\n        var end = this.parent.activeView.endDate();\n        var fields = this.parent.eventFields;\n        var processed = [];\n        var temp = 1;\n        var generateID = false;\n        var resourceCollection = this.parent.resourceBase ? this.parent.resourceBase.resourceCollection : [];\n        if (events.length > 0 && isNullOrUndefined(events[0][fields.id])) {\n            generateID = true;\n        }\n        var _loop_1 = function (event_1) {\n            if (generateID) {\n                event_1[fields.id] = temp++;\n            }\n            event_1 = this_1.updateEventDateTime(event_1);\n            if (timeZonePropChanged) {\n                this_1.processTimezoneChange(event_1, oldTimezone);\n            }\n            else if (!this_1.parent.isPrinting && !this_1.parent.uiStateValues.isResize) {\n                event_1 = this_1.processTimezone(event_1);\n            }\n            for (var level = 0; level < resourceCollection.length; level++) {\n                if (event_1[resourceCollection[level].field] === null || event_1[resourceCollection[level].field] === 0) {\n                    event_1[resourceCollection[level].field] = undefined;\n                }\n            }\n            if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && event_1[fields.recurrenceRule] === '') {\n                event_1[fields.recurrenceRule] = null;\n            }\n            if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && isNullOrUndefined(event_1[fields.recurrenceID]) &&\n                !(this_1.parent.crudModule && this_1.parent.crudModule.crudObj.isCrudAction)) {\n                processed = processed.concat(this_1.generateOccurrence(event_1, null, oldTimezone, true));\n            }\n            else {\n                if (this_1.parent.crudModule && this_1.parent.crudModule.crudObj.isCrudAction) {\n                    if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && isNullOrUndefined(event_1[fields.recurrenceID])) {\n                        var recurrenceEvent = this_1.generateOccurrence(event_1, null, oldTimezone, true);\n                        var _loop_2 = function (occurrence) {\n                            var app = this_1.parent.eventsProcessed.filter(function (data) {\n                                return data[fields.startTime].getTime() - occurrence[fields.startTime].getTime() === 0 &&\n                                    data[fields.id] === occurrence[fields.id];\n                            });\n                            occurrence.Guid = (app.length > 0) ? app[0].Guid : this_1.generateGuid();\n                            processed.push(occurrence);\n                        };\n                        for (var _i = 0, recurrenceEvent_1 = recurrenceEvent; _i < recurrenceEvent_1.length; _i++) {\n                            var occurrence = recurrenceEvent_1[_i];\n                            _loop_2(occurrence);\n                        }\n                    }\n                    else {\n                        var app = this_1.parent.eventsProcessed.filter(function (data) {\n                            return data[_this.parent.eventFields.id] === event_1[_this.parent.eventFields.id];\n                        });\n                        event_1.Guid = (app.length > 0) ? app[0].Guid : this_1.generateGuid();\n                        processed.push(event_1);\n                    }\n                }\n                else {\n                    event_1.Guid = this_1.generateGuid();\n                    processed.push(event_1);\n                }\n            }\n        };\n        var this_1 = this;\n        for (var _i = 0, events_1 = events; _i < events_1.length; _i++) {\n            var event_1 = events_1[_i];\n            _loop_1(event_1);\n        }\n        this.parent.eventsProcessed = [];\n        var eventData = processed.filter(function (data) {\n            return !data[_this.parent.eventFields.isBlock];\n        });\n        this.parent.eventsProcessed = this.filterEvents(start, end, eventData);\n        var blockData = processed.filter(function (data) {\n            return data[_this.parent.eventFields.isBlock];\n        });\n        for (var _a = 0, blockData_1 = blockData; _a < blockData_1.length; _a++) {\n            var eventObj = blockData_1[_a];\n            if (eventObj[fields.isAllDay]) {\n                var isDifferentDate = util.resetTime(new Date(eventObj[fields.startTime].getTime())) <\n                    util.resetTime(new Date(eventObj[fields.endTime].getTime()));\n                if (!isDifferentDate) {\n                    eventObj[fields.startTime] = util.resetTime(eventObj[fields.startTime]);\n                    eventObj[fields.endTime] = util.addDays(util.resetTime(eventObj[fields.endTime]), 1);\n                }\n            }\n        }\n        this.parent.blockProcessed = blockData;\n        return eventData;\n    };\n    EventBase.prototype.updateEventDateTime = function (eventData) {\n        if (typeof eventData[this.parent.eventFields.startTime] === 'string') {\n            eventData[this.parent.eventFields.startTime] = util.getDateFromString(eventData[this.parent.eventFields.startTime]);\n        }\n        if (typeof eventData[this.parent.eventFields.endTime] === 'string') {\n            eventData[this.parent.eventFields.endTime] = util.getDateFromString(eventData[this.parent.eventFields.endTime]);\n        }\n        return eventData;\n    };\n    EventBase.prototype.getProcessedEvents = function (eventCollection) {\n        if (eventCollection === void 0) { eventCollection = this.parent.eventsData; }\n        var processed = [];\n        for (var _i = 0, eventCollection_1 = eventCollection; _i < eventCollection_1.length; _i++) {\n            var event_2 = eventCollection_1[_i];\n            if (!isNullOrUndefined(event_2[this.parent.eventFields.recurrenceRule]) &&\n                isNullOrUndefined(event_2[this.parent.eventFields.recurrenceID])) {\n                processed = processed.concat(this.generateOccurrence(event_2));\n            }\n            else {\n                processed.push(event_2);\n            }\n        }\n        return processed;\n    };\n    EventBase.prototype.timezonePropertyChange = function (oldTimezone) {\n        var data = this.parent.eventsData.concat(this.parent.blockData);\n        var processed = this.processData(data, true, oldTimezone);\n        this.parent.notify(event.dataReady, { processedData: processed });\n    };\n    EventBase.prototype.timezoneConvert = function (eventData) {\n        var fields = this.parent.eventFields;\n        eventData[fields.startTimezone] = eventData[fields.startTimezone] || eventData[fields.endTimezone];\n        eventData[fields.endTimezone] = eventData[fields.endTimezone] || eventData[fields.startTimezone];\n        if (this.parent.timezone) {\n            var startTz = eventData[fields.startTimezone];\n            var endTz = eventData[fields.endTimezone];\n            eventData[fields.startTime] = this.parent.tzModule.convert(eventData[fields.startTime], this.parent.timezone, startTz);\n            eventData[fields.endTime] = this.parent.tzModule.convert(eventData[fields.endTime], this.parent.timezone, endTz);\n        }\n    };\n    EventBase.prototype.processTimezoneChange = function (event, oldTimezone) {\n        var fields = this.parent.eventFields;\n        if (event[fields.isAllDay]) {\n            return;\n        }\n        if (oldTimezone && this.parent.timezone) {\n            event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], oldTimezone, this.parent.timezone);\n            event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], oldTimezone, this.parent.timezone);\n        }\n        else if (!oldTimezone && this.parent.timezone) {\n            event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], this.parent.timezone);\n            event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], this.parent.timezone);\n        }\n        else if (oldTimezone && !this.parent.timezone) {\n            event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], oldTimezone);\n            event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], oldTimezone);\n        }\n    };\n    EventBase.prototype.processTimezone = function (event, isReverse) {\n        if (isReverse === void 0) { isReverse = false; }\n        var fields = this.parent.eventFields;\n        if (event[fields.startTimezone] || event[fields.endTimezone]) {\n            var startTimezone = event[fields.startTimezone] || event[fields.endTimezone];\n            var endTimezone = event[fields.endTimezone] || event[fields.startTimezone];\n            if (isReverse) {\n                if (this.parent.timezone) {\n                    event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], startTimezone, this.parent.timezone);\n                    event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], endTimezone, this.parent.timezone);\n                    event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], this.parent.timezone);\n                    event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], this.parent.timezone);\n                }\n                else {\n                    event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], startTimezone);\n                    event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], endTimezone);\n                }\n            }\n            else {\n                event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], startTimezone);\n                event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], endTimezone);\n                if (this.parent.timezone) {\n                    event[fields.startTime] = this.parent.tzModule.convert(event[fields.startTime], startTimezone, this.parent.timezone);\n                    event[fields.endTime] = this.parent.tzModule.convert(event[fields.endTime], endTimezone, this.parent.timezone);\n                }\n            }\n        }\n        else if (this.parent.timezone) {\n            if (isReverse) {\n                event[fields.startTime] = this.parent.tzModule.remove(event[fields.startTime], this.parent.timezone);\n                event[fields.endTime] = this.parent.tzModule.remove(event[fields.endTime], this.parent.timezone);\n            }\n            else {\n                event[fields.startTime] = this.parent.tzModule.add(event[fields.startTime], this.parent.timezone);\n                event[fields.endTime] = this.parent.tzModule.add(event[fields.endTime], this.parent.timezone);\n            }\n        }\n        return event;\n    };\n    EventBase.prototype.filterBlockEvents = function (eventObj) {\n        var fields = this.parent.eventFields;\n        var eStart = eventObj[fields.startTime];\n        var eEnd = eventObj[fields.endTime];\n        var resourceData;\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            var data = this.getGroupIndexFromEvent(eventObj);\n            resourceData = this.parent.resourceBase.lastResourceLevel[data];\n        }\n        var blockEvents = extend([], this.parent.blockProcessed, null, true);\n        for (var _i = 0, blockEvents_1 = blockEvents; _i < blockEvents_1.length; _i++) {\n            var eventObj_1 = blockEvents_1[_i];\n            if (eventObj_1[fields.isAllDay]) {\n                var isDifferentTime = eventObj_1[fields.endTime].getTime() >\n                    util.resetTime(new Date(eventObj_1[fields.endTime].getTime())).getTime();\n                if (isDifferentTime) {\n                    eventObj_1[fields.startTime] = util.resetTime(eventObj_1[fields.startTime]);\n                    eventObj_1[fields.endTime] = util.addDays(util.resetTime(eventObj_1[fields.endTime]), 1);\n                }\n            }\n        }\n        return this.filterEvents(eStart, eEnd, blockEvents, resourceData);\n    };\n    EventBase.prototype.filterEvents = function (startDate, endDate, appointments, resourceTdData) {\n        if (appointments === void 0) { appointments = this.parent.eventsProcessed; }\n        var fieldMapping = this.parent.eventFields;\n        var predicate = new Predicate(fieldMapping.startTime, 'greaterthanorequal', startDate).\n            and(new Predicate(fieldMapping.endTime, 'greaterthanorequal', startDate)).\n            and(new Predicate(fieldMapping.startTime, 'lessthan', endDate)).\n            or(new Predicate(fieldMapping.startTime, 'lessthanorequal', startDate).\n            and(new Predicate(fieldMapping.endTime, 'greaterthan', startDate)));\n        var filter = new DataManager({ json: appointments }).executeLocal(new Query().where(predicate));\n        if (resourceTdData) {\n            filter = this.filterEventsByResource(resourceTdData, filter);\n        }\n        return this.sortByTime(filter);\n    };\n    EventBase.prototype.filterEventsByRange = function (eventCollection, startDate, endDate) {\n        var _this = this;\n        var filteredEvents = [];\n        if (startDate && endDate) {\n            filteredEvents = this.filterEvents(startDate, endDate, eventCollection);\n        }\n        else if (startDate && !endDate) {\n            filteredEvents = eventCollection.filter(function (e) { return e[_this.parent.eventFields.startTime] >= startDate; });\n        }\n        else if (!startDate && endDate) {\n            filteredEvents = eventCollection.filter(function (e) { return e[_this.parent.eventFields.endTime] <= endDate; });\n        }\n        else {\n            filteredEvents = eventCollection;\n        }\n        return this.sortByTime(filteredEvents);\n    };\n    EventBase.prototype.filterEventsByResource = function (resourceTdData, appointments) {\n        if (appointments === void 0) { appointments = this.parent.eventsProcessed; }\n        var predicate = {};\n        var resourceCollection = this.parent.resourceBase.resourceCollection;\n        for (var level = 0; level < resourceCollection.length; level++) {\n            predicate[resourceCollection[level].field] = resourceTdData.groupOrder[level];\n        }\n        var keys = Object.keys(predicate);\n        var filteredCollection = appointments.filter(function (eventObj) { return keys.every(function (key) {\n            if (eventObj[key] instanceof Array) {\n                return eventObj[key].indexOf(predicate[key]) > -1;\n            }\n            else {\n                return eventObj[key] === predicate[key];\n            }\n        }); });\n        return filteredCollection;\n    };\n    EventBase.prototype.sortByTime = function (appointmentsCollection) {\n        if (this.parent.eventSettings.sortComparer) {\n            appointmentsCollection = this.parent.eventSettings.sortComparer.call(this.parent, appointmentsCollection);\n        }\n        else {\n            var fieldMappings_1 = this.parent.eventFields;\n            appointmentsCollection.sort(function (a, b) {\n                var d1 = a[fieldMappings_1.startTime];\n                var d2 = b[fieldMappings_1.startTime];\n                return d1.getTime() - d2.getTime();\n            });\n        }\n        return appointmentsCollection;\n    };\n    EventBase.prototype.sortByDateTime = function (appointments) {\n        if (this.parent.eventSettings.sortComparer) {\n            appointments = this.parent.eventSettings.sortComparer.call(this.parent, appointments);\n        }\n        else {\n            var fieldMapping_1 = this.parent.eventFields;\n            appointments.sort(function (object1, object2) {\n                var d3 = object1[fieldMapping_1.startTime];\n                var d4 = object2[fieldMapping_1.startTime];\n                var d5 = object1[fieldMapping_1.endTime];\n                var d6 = object2[fieldMapping_1.endTime];\n                var d1 = d5.getTime() - d3.getTime();\n                var d2 = d6.getTime() - d4.getTime();\n                return (d3.getTime() - d4.getTime() || d2 - d1);\n            });\n        }\n        return appointments;\n    };\n    EventBase.prototype.getSmallestMissingNumber = function (array) {\n        var large = Math.max.apply(Math, array);\n        for (var i = 0; i < large; i++) {\n            if (array.indexOf(i) === -1) {\n                return i;\n            }\n        }\n        return large + 1;\n    };\n    EventBase.prototype.splitEventByDay = function (event) {\n        var eventFields = this.parent.eventFields;\n        var data = [];\n        var eventStartTime = event[eventFields.startTime];\n        var eventEndTime = event[eventFields.endTime];\n        var isDifferentDate = util.resetTime(new Date(eventStartTime.getTime())) <\n            util.resetTime(new Date(eventEndTime.getTime()));\n        if (isDifferentDate) {\n            var start = new Date(eventStartTime.getTime());\n            var end = util.addDays(util.resetTime(new Date(eventStartTime.getTime())), 1);\n            var endDate = (eventEndTime.getHours() === 0 && eventEndTime.getMinutes() === 0) ?\n                eventEndTime : util.addDays(eventEndTime, 1);\n            var index = 1;\n            var eventLength = util.getDaysCount(eventStartTime.getTime(), endDate.getTime());\n            while (end <= eventEndTime && start.getTime() !== end.getTime()) {\n                var app = extend({}, event);\n                app[eventFields.startTime] = start;\n                app[eventFields.endTime] = end;\n                app.data = { index: index, count: eventLength };\n                app.Guid = this.generateGuid();\n                app.isSpanned = true;\n                data.push(app);\n                start = end;\n                if ((util.resetTime(new Date(start.getTime())).getTime() === util.resetTime(new Date(eventEndTime.getTime())).getTime())\n                    && !(end.getTime() === eventEndTime.getTime())) {\n                    end = new Date(start.getTime());\n                    end = new Date(end.setHours(eventEndTime.getHours(), eventEndTime.getMinutes(), eventEndTime.getSeconds()));\n                }\n                else {\n                    end = util.addDays(util.resetTime(new Date(start.getTime())), 1);\n                }\n                index++;\n            }\n        }\n        else {\n            data.push(event);\n        }\n        return data;\n    };\n    EventBase.prototype.splitEvent = function (event, dateRender) {\n        var fields = this.parent.eventFields;\n        var start = util.resetTime(event[fields.startTime]).getTime();\n        var end = util.resetTime(event[fields.endTime]).getTime();\n        if (util.getDateInMs(event[fields.endTime]) <= 0) {\n            var temp = util.addDays(util.resetTime(event[fields.endTime]), -1).getTime();\n            end = start > temp ? start : temp;\n        }\n        var orgStart = start;\n        var orgEnd = end;\n        var ranges = [];\n        if (start !== end) {\n            if (start < dateRender[0].getTime()) {\n                start = dateRender[0].getTime();\n            }\n            if (end > dateRender[dateRender.length - 1].getTime()) {\n                end = dateRender[dateRender.length - 1].getTime();\n            }\n            var cStart = start;\n            for (var level = 0; level < this.slots.length; level++) {\n                var slot = this.slots[level];\n                if (this.parent.currentView === 'WorkWeek' || this.parent.currentView === 'TimelineWorkWeek'\n                    || this.parent.activeViewOptions.group.byDate || this.parent.activeViewOptions.showWeekend) {\n                    var slotDates = [];\n                    for (var _i = 0, slot_1 = slot; _i < slot_1.length; _i++) {\n                        var s = slot_1[_i];\n                        slotDates.push(new Date(s));\n                    }\n                    var renderedDates = this.getRenderedDates(slotDates);\n                    if (!isNullOrUndefined(renderedDates) && renderedDates.length > 0) {\n                        slot = [];\n                        for (var _a = 0, renderedDates_1 = renderedDates; _a < renderedDates_1.length; _a++) {\n                            var date = renderedDates_1[_a];\n                            slot.push(date.getTime());\n                        }\n                    }\n                }\n                if (typeof (slot) === 'number') {\n                    var temp = slot;\n                    slot = [];\n                    slot.push(temp);\n                }\n                var firstSlot = slot[0];\n                cStart = (cStart <= firstSlot && end >= firstSlot) ? firstSlot : cStart;\n                if (cStart > end || firstSlot > end) {\n                    break;\n                }\n                if (!this.parent.activeViewOptions.group.byDate && this.parent.activeViewOptions.showWeekend &&\n                    this.parent.currentView !== 'WorkWeek' && this.parent.currentView !== 'TimelineWorkWeek') {\n                    var startIndex = slot.indexOf(cStart);\n                    if (startIndex !== -1) {\n                        var endIndex = slot.indexOf(end);\n                        var hasBreak = endIndex !== -1;\n                        endIndex = hasBreak ? endIndex : slot.length - 1;\n                        var count = ((endIndex - startIndex) + 1);\n                        var isLeft = (slot[startIndex] !== orgStart);\n                        var isRight = (slot[endIndex] !== orgEnd);\n                        ranges.push(this.cloneEventObject(event, slot[startIndex], slot[endIndex], count, isLeft, isRight));\n                        if (hasBreak) {\n                            break;\n                        }\n                    }\n                }\n                else {\n                    if (this.dateInRange(cStart, slot[0], slot[slot.length - 1])) {\n                        var availSlot = [];\n                        for (var i = 0; i < slot.length; i++) {\n                            if (this.dateInRange(slot[i], orgStart, orgEnd)) {\n                                availSlot.push(slot[i]);\n                            }\n                        }\n                        if (availSlot.length > 0) {\n                            if (!this.parent.activeViewOptions.group.byDate) {\n                                var isLeft = (availSlot[0] !== orgStart);\n                                var isRight = (availSlot[availSlot.length - 1] !== orgEnd);\n                                ranges.push(this.cloneEventObject(event, availSlot[0], availSlot[availSlot.length - 1], availSlot.length, isLeft, isRight));\n                            }\n                            else {\n                                for (var _b = 0, availSlot_1 = availSlot; _b < availSlot_1.length; _b++) {\n                                    var slot_2 = availSlot_1[_b];\n                                    ranges.push(this.cloneEventObject(event, slot_2, slot_2, 1, (slot_2 !== orgStart), (slot_2 !== orgEnd)));\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        else {\n            ranges.push(this.cloneEventObject(event, start, end, 1, false, false));\n        }\n        return ranges;\n    };\n    EventBase.prototype.cloneEventObject = function (event, start, end, count, isLeft, isRight) {\n        var fields = this.parent.eventFields;\n        var e = extend({}, event, null, true);\n        var data = { count: count, isLeft: isLeft, isRight: isRight };\n        data[fields.startTime] = event[fields.startTime];\n        data[fields.endTime] = event[fields.endTime];\n        e.data = data;\n        e[fields.startTime] = new Date(start);\n        e[fields.endTime] = new Date(end);\n        return e;\n    };\n    EventBase.prototype.dateInRange = function (date, start, end) {\n        return start <= date && date <= end;\n    };\n    EventBase.prototype.getSelectedEventElements = function (target) {\n        this.removeSelectedAppointmentClass();\n        if (this.parent.selectedElements.length <= 0) {\n            this.parent.selectedElements.push(target);\n        }\n        else {\n            var isAlreadySelected = this.parent.selectedElements.filter(function (element) {\n                return element.getAttribute('data-guid') === target.getAttribute('data-guid');\n            });\n            if (isAlreadySelected.length <= 0) {\n                var elementSelector = 'div[data-guid=\"' + target.getAttribute('data-guid') + '\"]';\n                var focusElements = [].slice.call(this.parent.element.querySelectorAll(elementSelector));\n                for (var _i = 0, focusElements_1 = focusElements; _i < focusElements_1.length; _i++) {\n                    var element = focusElements_1[_i];\n                    this.parent.selectedElements.push(element);\n                }\n            }\n            else {\n                var selectedElements = this.parent.selectedElements.filter(function (element) {\n                    return element.getAttribute('data-guid') !== target.getAttribute('data-guid');\n                });\n                this.parent.selectedElements = selectedElements;\n            }\n        }\n        if (target && this.parent.selectedElements.length > 0) {\n            this.addSelectedAppointments(this.parent.selectedElements);\n        }\n        return this.parent.selectedElements;\n    };\n    EventBase.prototype.getSelectedEvents = function () {\n        var _this = this;\n        var eventSelect = [];\n        var elementSelect = [];\n        var selectAppointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\n        selectAppointments.filter(function (element) {\n            var isAlreadyAdded = eventSelect.filter(function (event) {\n                return event.Guid === element.getAttribute('data-guid');\n            });\n            if (isAlreadyAdded.length === 0) {\n                eventSelect.push(_this.getEventByGuid(element.getAttribute('data-guid')));\n            }\n            elementSelect.push(element);\n        });\n        return {\n            event: eventSelect.length > 1 ? eventSelect : eventSelect[0],\n            element: elementSelect.length > 1 ? elementSelect : elementSelect[0]\n        };\n    };\n    EventBase.prototype.removeSelectedAppointmentClass = function () {\n        var selectedAppointments = this.getSelectedAppointments();\n        for (var _i = 0, selectedAppointments_1 = selectedAppointments; _i < selectedAppointments_1.length; _i++) {\n            var appointment = selectedAppointments_1[_i];\n            appointment.setAttribute('aria-selected', 'false');\n        }\n        removeClass(selectedAppointments, cls.APPOINTMENT_BORDER);\n        if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n            removeClass(selectedAppointments, cls.AGENDA_SELECTED_CELL);\n        }\n    };\n    EventBase.prototype.addSelectedAppointments = function (cells) {\n        for (var _i = 0, cells_1 = cells; _i < cells_1.length; _i++) {\n            var cell = cells_1[_i];\n            cell.setAttribute('aria-selected', 'true');\n        }\n        if (this.parent.currentView !== 'MonthAgenda') {\n            this.parent.removeSelectedClass();\n        }\n        addClass(cells, cls.APPOINTMENT_BORDER);\n    };\n    EventBase.prototype.getSelectedAppointments = function () {\n        return [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER + ',.' + cls.APPOINTMENT_CLASS + ':focus'));\n    };\n    EventBase.prototype.focusElement = function (isFocused) {\n        if (this.parent.eventWindow.dialogObject && this.parent.eventWindow.dialogObject.visible) {\n            return;\n        }\n        var activeEle = document.activeElement;\n        var selectedCell = this.parent.getSelectedElements();\n        if (selectedCell.length > 0 && ((activeEle && (this.parent.element.contains(activeEle) ||\n            selectedCell.indexOf(activeEle) !== -1)) || isFocused)) {\n            if (this.parent.keyboardInteractionModule) {\n                var target = ((!isNullOrUndefined(this.parent.activeCellsData) &&\n                    this.parent.activeCellsData.element) || selectedCell[selectedCell.length - 1]);\n                this.parent.keyboardInteractionModule.selectCells(target instanceof Array, target);\n            }\n            return;\n        }\n        var selectedAppointments = this.getSelectedAppointments();\n        if (selectedAppointments.length > 0) {\n            selectedAppointments[selectedAppointments.length - 1].focus();\n            return;\n        }\n    };\n    EventBase.prototype.selectWorkCellByTime = function (eventsData) {\n        var target;\n        if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n            return target;\n        }\n        if (eventsData.length > 0) {\n            var selectedObject = eventsData[eventsData.length - 1];\n            var eventStartTime = selectedObject[this.parent.eventFields.startTime];\n            var nearestTime = new Date(+eventStartTime).setMinutes(0, 0, 0);\n            var isAllDay = this.isAllDayAppointment(selectedObject);\n            if (this.parent.currentView === 'Month' || isAllDay) {\n                nearestTime = new Date(+eventStartTime).setHours(0, 0, 0, 0);\n            }\n            var targetArea = void 0;\n            if (isAllDay && ['Day', 'Week', 'WorkWeek'].indexOf(this.parent.currentView) !== -1) {\n                targetArea = this.parent.getAllDayRow();\n            }\n            else {\n                targetArea = this.parent.getContentTable();\n            }\n            var queryString = '[data-date=\"' + new Date(nearestTime).getTime() + '\"]';\n            if (this.parent.activeViewOptions.group.resources.length > 0) {\n                queryString += '[data-group-index=\"' + this.getGroupIndexFromEvent(selectedObject) + '\"]';\n            }\n            target = targetArea.querySelector(queryString);\n            if (target) {\n                this.parent.activeCellsData = this.parent.getCellDetails(target);\n                if (this.parent.keyboardInteractionModule) {\n                    this.parent.keyboardInteractionModule.selectCells(false, target);\n                }\n                return target;\n            }\n        }\n        return target;\n    };\n    EventBase.prototype.getGroupIndexFromEvent = function (eventData) {\n        var levelIndex;\n        var resource;\n        var levelName;\n        var idField;\n        for (var i = this.parent.resourceBase.resourceCollection.length - 1; i >= 0; i--) {\n            var resourceData = eventData[this.parent.resourceBase.resourceCollection[i].field];\n            if (!isNullOrUndefined(resourceData)) {\n                resource = this.parent.resourceBase.resourceCollection[i];\n                levelIndex = i;\n                levelName = resource.name;\n                idField = resource.field;\n                break;\n            }\n        }\n        if (isNullOrUndefined(levelName) && isNullOrUndefined(levelIndex)) {\n            levelName = this.parent.resourceCollection.slice(-1)[0].name;\n            levelIndex = this.parent.resourceCollection.length - 1;\n            idField = this.parent.resourceCollection.slice(-1)[0].field;\n            resource = this.parent.resourceCollection.filter(function (e, index) {\n                if (e.name === levelName) {\n                    levelIndex = index;\n                    return e;\n                }\n                return null;\n            })[0];\n        }\n        var id = ((eventData[idField] instanceof Array) ?\n            eventData[idField][0] : eventData[idField]);\n        if (levelIndex > 0) {\n            var parentField = this.parent.resourceCollection[levelIndex - 1].field;\n            return this.parent.resourceBase.getIndexFromResourceId(id, levelName, resource, eventData, parentField);\n        }\n        else {\n            return this.parent.resourceBase.getIndexFromResourceId(id, levelName, resource);\n        }\n    };\n    EventBase.prototype.isAllDayAppointment = function (event) {\n        var fieldMapping = this.parent.eventFields;\n        var isAllDay = event[fieldMapping.isAllDay];\n        var isFullDay = ((event[fieldMapping.endTime].getTime() - event[fieldMapping.startTime].getTime())\n            / util.MS_PER_DAY) >= 1;\n        return (isAllDay || (this.parent.eventSettings.spannedEventPlacement !== 'TimeSlot' && isFullDay)) ? true : false;\n    };\n    EventBase.prototype.addEventListener = function () {\n        this.parent.on(event.documentClick, this.appointmentBorderRemove, this);\n    };\n    EventBase.prototype.removeEventListener = function () {\n        this.parent.off(event.documentClick, this.appointmentBorderRemove);\n    };\n    EventBase.prototype.appointmentBorderRemove = function (event) {\n        var element = event.event.target;\n        if (closest(element, '.' + cls.APPOINTMENT_CLASS)) {\n            if (this.parent.currentView !== 'MonthAgenda') {\n                this.parent.removeSelectedClass();\n            }\n        }\n        else if (!closest(element, '.' + cls.POPUP_OPEN)) {\n            this.removeSelectedAppointmentClass();\n        }\n    };\n    EventBase.prototype.wireAppointmentEvents = function (element, event, isPreventCrud) {\n        if (isPreventCrud === void 0) { isPreventCrud = false; }\n        var isReadOnly = (!isNullOrUndefined(event)) ? event[this.parent.eventFields.isReadonly] : false;\n        EventHandler.add(element, 'click', this.eventClick, this);\n        if (!this.parent.isAdaptive && !this.parent.activeViewOptions.readonly && !isReadOnly) {\n            EventHandler.add(element, 'touchstart', this.eventTouchClick, this);\n            EventHandler.add(element, 'dblclick', this.eventDoubleClick, this);\n        }\n        if (!this.parent.activeViewOptions.readonly && !isReadOnly && !isPreventCrud) {\n            if (this.parent.resizeModule) {\n                this.parent.resizeModule.wireResizeEvent(element);\n            }\n            if (this.parent.dragAndDropModule) {\n                this.parent.dragAndDropModule.wireDragEvent(element);\n            }\n        }\n    };\n    EventBase.prototype.eventTouchClick = function (e) {\n        var _this = this;\n        setTimeout(function () { return _this.isDoubleTapped = false; }, 250);\n        e.preventDefault();\n        if (this.isDoubleTapped) {\n            this.eventDoubleClick(e);\n        }\n        else if (!this.isDoubleTapped) {\n            this.isDoubleTapped = true;\n            this.eventClick(e);\n        }\n    };\n    EventBase.prototype.renderResizeHandler = function (element, spanEvent, isReadOnly) {\n        if (!this.parent.resizeModule || !this.parent.allowResizing || this.parent.activeViewOptions.readonly || isReadOnly) {\n            return;\n        }\n        for (var _i = 0, _a = Object.keys(spanEvent); _i < _a.length; _i++) {\n            var resizeEdge = _a[_i];\n            var resizeHandler = createElement('div', { className: cls.EVENT_RESIZE_CLASS });\n            switch (resizeEdge) {\n                case 'isLeft':\n                    if (!spanEvent.isLeft) {\n                        resizeHandler.appendChild(createElement('div', { className: 'e-left-right-resize' }));\n                        addClass([resizeHandler], this.parent.enableRtl ? cls.RIGHT_RESIZE_HANDLER : cls.LEFT_RESIZE_HANDLER);\n                        prepend([resizeHandler], element);\n                    }\n                    break;\n                case 'isRight':\n                    if (!spanEvent.isRight) {\n                        resizeHandler.appendChild(createElement('div', { className: 'e-left-right-resize' }));\n                        addClass([resizeHandler], this.parent.enableRtl ? cls.LEFT_RESIZE_HANDLER : cls.RIGHT_RESIZE_HANDLER);\n                        append([resizeHandler], element);\n                    }\n                    break;\n                case 'isTop':\n                    if (!spanEvent.isTop) {\n                        resizeHandler.appendChild(createElement('div', { className: 'e-top-bottom-resize' }));\n                        addClass([resizeHandler], cls.TOP_RESIZE_HANDLER);\n                        prepend([resizeHandler], element);\n                    }\n                    break;\n                case 'isBottom':\n                    if (!spanEvent.isBottom) {\n                        resizeHandler.appendChild(createElement('div', { className: 'e-top-bottom-resize' }));\n                        addClass([resizeHandler], cls.BOTTOM_RESIZE_HANDLER);\n                        append([resizeHandler], element);\n                    }\n                    break;\n            }\n        }\n    };\n    EventBase.prototype.eventClick = function (eventData) {\n        var _this = this;\n        var target = eventData.target;\n        if (target.classList.contains(cls.DRAG_CLONE_CLASS) || target.classList.contains(cls.RESIZE_CLONE_CLASS) ||\n            target.classList.contains(cls.INLINE_SUBJECT_CLASS)) {\n            return;\n        }\n        if ((eventData.ctrlKey || eventData.metaKey) && eventData.which === 1 && this.parent.keyboardInteractionModule) {\n            this.parent.quickPopup.quickPopup.hide();\n            this.parent.selectedElements = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\n            var target_1 = closest(eventData.target, '.' + cls.APPOINTMENT_CLASS);\n            this.getSelectedEventElements(target_1);\n            this.activeEventData(eventData, false);\n            var selectArgs = {\n                data: this.parent.activeEventData.event,\n                element: this.parent.activeEventData.element,\n                event: eventData, requestType: 'eventSelect'\n            };\n            this.parent.trigger(event.select, selectArgs);\n            var args = extend(this.parent.activeEventData, { cancel: false, originalEvent: eventData });\n            this.parent.trigger(event.eventClick, args);\n        }\n        else {\n            this.removeSelectedAppointmentClass();\n            this.activeEventData(eventData, true);\n            var selectEventArgs = {\n                data: this.parent.activeEventData.event,\n                element: this.parent.activeEventData.element,\n                event: eventData, requestType: 'eventSelect'\n            };\n            this.parent.trigger(event.select, selectEventArgs);\n            var args = extend(this.parent.activeEventData, { cancel: false, originalEvent: eventData });\n            this.parent.trigger(event.eventClick, args, function (eventClickArgs) {\n                if (eventClickArgs.cancel) {\n                    _this.removeSelectedAppointmentClass();\n                    if (_this.parent.quickPopup) {\n                        _this.parent.quickPopup.quickPopupHide();\n                    }\n                }\n                else {\n                    if (_this.parent.currentView === 'Agenda' || _this.parent.currentView === 'MonthAgenda') {\n                        addClass([_this.parent.activeEventData.element], cls.AGENDA_SELECTED_CELL);\n                    }\n                    if (_this.parent.allowInline) {\n                        var inlineArgs = {\n                            data: eventClickArgs.event,\n                            element: eventClickArgs.element,\n                            type: 'Event'\n                        };\n                        _this.parent.notify(event.inlineClick, inlineArgs);\n                    }\n                    else {\n                        _this.parent.notify(event.eventClick, eventClickArgs);\n                    }\n                }\n            });\n        }\n    };\n    EventBase.prototype.eventDoubleClick = function (e) {\n        if (this.parent.quickPopup) {\n            this.parent.quickPopup.quickPopupHide(true);\n        }\n        if (e.type === 'touchstart') {\n            this.activeEventData(e, true);\n        }\n        this.removeSelectedAppointmentClass();\n        if (this.parent.activeEventData.element.classList.contains(cls.INLINE_APPOINTMENT_CLASS) ||\n            this.parent.activeEventData.element.querySelector('.' + cls.INLINE_SUBJECT_CLASS)) {\n            return;\n        }\n        if (!isNullOrUndefined(this.parent.activeEventData.event) &&\n            isNullOrUndefined(this.parent.activeEventData.event[this.parent.eventFields.recurrenceID])) {\n            this.parent.eventWindow.openEditor(this.parent.activeEventData.event, 'Save');\n        }\n        else {\n            this.parent.currentAction = 'EditOccurrence';\n            this.parent.quickPopup.openRecurrenceAlert();\n        }\n    };\n    EventBase.prototype.getEventByGuid = function (guid) {\n        return this.parent.eventsProcessed.filter(function (data) { return data.Guid === guid; })[0];\n    };\n    EventBase.prototype.getEventById = function (id) {\n        var _this = this;\n        return this.parent.eventsData.filter(function (data) {\n            return data[_this.parent.eventFields.id] === id;\n        })[0];\n    };\n    EventBase.prototype.generateGuid = function () {\n        return 'xyxxxxyx-xxxy-yxxx-xyxx-xxyxxxxyyxxx'.replace(/[xy]/g, function (c) {\n            var r = Math.random() * 16 | 0;\n            var v = (c === 'x') ? r : (r & 0x3 | 0x8);\n            return v.toString(16);\n        });\n    };\n    EventBase.prototype.getEventIDType = function () {\n        if (this.parent.eventsData.length !== 0) {\n            return typeof (this.parent.eventsData[0][this.parent.eventFields.id]);\n        }\n        if (this.parent.blockData.length !== 0) {\n            return typeof (this.parent.blockData[0][this.parent.eventFields.id]);\n        }\n        return 'string';\n    };\n    EventBase.prototype.getEventMaxID = function (resourceId) {\n        var _this = this;\n        if (this.parent.eventsData.length < 1 && this.parent.blockData.length < 1) {\n            return 1;\n        }\n        var eventId;\n        var idType = this.getEventIDType();\n        if (idType === 'string') {\n            eventId = this.generateGuid();\n        }\n        if (idType === 'number') {\n            var datas = this.parent.eventsData.concat(this.parent.blockData);\n            var maxId = Math.max.apply(Math, datas.map(function (event) { return event[_this.parent.eventFields.id]; }));\n            maxId = isNullOrUndefined(resourceId) ? maxId : maxId + resourceId;\n            eventId = maxId + 1;\n        }\n        return eventId;\n    };\n    EventBase.prototype.activeEventData = function (eventData, isMultiple) {\n        var _this = this;\n        var target = closest(eventData.target, '.' + cls.APPOINTMENT_CLASS);\n        var guid = target.getAttribute('data-guid');\n        if (isMultiple) {\n            this.addSelectedAppointments([].slice.call(this.parent.element.querySelectorAll('div[data-guid=\"' + guid + '\"]')));\n            target.focus();\n        }\n        var eventObject = this.getEventByGuid(guid);\n        if (eventObject && eventObject.isSpanned) {\n            eventObject = this.parent.eventsData.filter(function (obj) {\n                return obj[_this.parent.eventFields.id] === eventObject[_this.parent.eventFields.id];\n            })[0];\n        }\n        this.parent.activeEventData = { event: eventObject, element: target };\n    };\n    EventBase.prototype.generateOccurrence = function (event, viewDate, oldTimezone, isMaxCount) {\n        var startDate = event[this.parent.eventFields.startTime];\n        var endDate = event[this.parent.eventFields.endTime];\n        var eventRule = event[this.parent.eventFields.recurrenceRule];\n        var duration = endDate.getTime() - startDate.getTime();\n        viewDate = new Date((viewDate || this.parent.activeView.startDate()).getTime() - duration);\n        var exception = event[this.parent.eventFields.recurrenceException];\n        var maxCount;\n        if (this.parent.currentView !== 'Agenda' && isMaxCount) {\n            maxCount = util.getDateCount(this.parent.activeView.startDate(), this.parent.activeView.endDate()) + 1;\n        }\n        var newTimezone = this.parent.timezone || this.parent.tzModule.getLocalTimezoneName();\n        var firstDay = this.parent.activeViewOptions.firstDayOfWeek;\n        var calendarMode = this.parent.calendarMode;\n        var dates = generate(startDate, eventRule, exception, firstDay, maxCount, viewDate, calendarMode, oldTimezone, newTimezone);\n        if (this.parent.currentView === 'Agenda' && eventRule.indexOf('COUNT') === -1 && eventRule.indexOf('UNTIL') === -1) {\n            if (isNullOrUndefined(event.generatedDates)) {\n                event.generatedDates = { start: new Date(dates[0]), end: new Date(dates[dates.length - 1]) };\n            }\n            else {\n                if (dates[0] < event.generatedDates.start.getTime()) {\n                    event.generatedDates.start = new Date(dates[0]);\n                }\n                if (dates[dates.length - 1] > event.generatedDates.end.getTime()) {\n                    event.generatedDates.end = new Date(dates[dates.length - 1]);\n                }\n            }\n        }\n        var occurrenceCollection = [];\n        for (var _i = 0, dates_1 = dates; _i < dates_1.length; _i++) {\n            var date = dates_1[_i];\n            var clonedObject = extend({}, event, null, true);\n            clonedObject[this.parent.eventFields.startTime] = new Date(date);\n            clonedObject[this.parent.eventFields.endTime] = new Date(new Date(date).setMilliseconds(duration));\n            clonedObject[this.parent.eventFields.recurrenceID] = clonedObject[this.parent.eventFields.id];\n            delete clonedObject[this.parent.eventFields.recurrenceException];\n            delete clonedObject[this.parent.eventFields.followingID];\n            clonedObject.Guid = this.generateGuid();\n            occurrenceCollection.push(clonedObject);\n        }\n        return occurrenceCollection;\n    };\n    EventBase.prototype.getParentEvent = function (eventObj, isParent) {\n        if (isParent === void 0) { isParent = false; }\n        var parentEvent;\n        do {\n            eventObj = this.getFollowingEvent(eventObj);\n            if (eventObj) {\n                parentEvent = extend({}, eventObj, null, true);\n            }\n        } while (eventObj && isParent);\n        if (isParent && parentEvent) {\n            var collection = this.getEventCollections(parentEvent);\n            var followObj = collection.follow.slice(-1)[0];\n            if (collection.occurrence.length > 0 && !parentEvent[this.parent.eventFields.recurrenceException]) {\n                followObj = collection.occurrence.slice(-1)[0];\n            }\n            if (followObj) {\n                parentEvent[this.parent.eventFields.recurrenceRule] = followObj[this.parent.eventFields.recurrenceRule];\n            }\n        }\n        return parentEvent;\n    };\n    EventBase.prototype.getEventCollections = function (parentObj, childObj) {\n        var followingCollection = [];\n        var occurrenceCollection = [];\n        var followingEvent = parentObj;\n        do {\n            followingEvent = this.getFollowingEvent(followingEvent, true);\n            if (followingEvent) {\n                followingCollection.push(followingEvent);\n            }\n            occurrenceCollection = occurrenceCollection.concat(this.getOccurrenceEvent(followingEvent || parentObj));\n        } while (followingEvent);\n        var collections = {};\n        if (childObj) {\n            var fields_1 = this.parent.eventFields;\n            collections = {\n                follow: followingCollection.filter(function (eventData) {\n                    return eventData[fields_1.startTime] >= childObj[fields_1.startTime];\n                }),\n                occurrence: occurrenceCollection.filter(function (eventData) {\n                    return eventData[fields_1.startTime] >= childObj[fields_1.startTime];\n                })\n            };\n        }\n        else {\n            collections = { follow: followingCollection, occurrence: occurrenceCollection };\n        }\n        return collections;\n    };\n    EventBase.prototype.getFollowingEvent = function (parentObj, isReverse) {\n        var fields = this.parent.eventFields;\n        var fieldValue;\n        if (isReverse) {\n            fieldValue = parentObj[fields.id];\n        }\n        else {\n            fieldValue = (parentObj[fields.recurrenceID] || parentObj[fields.followingID]);\n        }\n        var parentApp = this.parent.eventsData.filter(function (data) {\n            return data[isReverse ? fields.followingID : fields.id] === fieldValue;\n        });\n        return parentApp.shift();\n    };\n    EventBase.prototype.isFollowingEvent = function (parentObj, childObj) {\n        var parentStart = parentObj[this.parent.eventFields.startTime];\n        var childStart = childObj[this.parent.eventFields.startTime];\n        return parentStart.getHours() === childStart.getHours() && parentStart.getMinutes() === childStart.getMinutes() &&\n            parentStart.getSeconds() === childStart.getSeconds();\n    };\n    EventBase.prototype.getOccurrenceEvent = function (eventObj, isGuid, isFollowing) {\n        if (isGuid === void 0) { isGuid = false; }\n        if (isFollowing === void 0) { isFollowing = false; }\n        var idField = isGuid ? 'Guid' : (isFollowing) ? this.parent.eventFields.followingID : this.parent.eventFields.recurrenceID;\n        var fieldKey = isGuid ? 'Guid' : this.parent.eventFields.id;\n        var dataSource = isGuid ? this.parent.eventsProcessed : this.parent.eventsData;\n        return dataSource.filter(function (data) { return data[idField] === eventObj[fieldKey]; });\n    };\n    EventBase.prototype.getOccurrencesByID = function (id) {\n        var fields = this.parent.eventFields;\n        var occurrenceCollection = [];\n        var parentObject = this.parent.eventsData.filter(function (obj) { return obj[fields.id] === id; });\n        for (var _i = 0, parentObject_1 = parentObject; _i < parentObject_1.length; _i++) {\n            var event_3 = parentObject_1[_i];\n            if (!isNullOrUndefined(event_3[fields.recurrenceRule])) {\n                occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_3));\n            }\n        }\n        return occurrenceCollection;\n    };\n    EventBase.prototype.getOccurrencesByRange = function (startTime, endTime) {\n        var fields = this.parent.eventFields;\n        var occurrenceCollection = [];\n        for (var _i = 0, _a = this.parent.eventsData; _i < _a.length; _i++) {\n            var event_4 = _a[_i];\n            if (!isNullOrUndefined(event_4[fields.recurrenceRule])) {\n                occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_4));\n            }\n        }\n        var filter = occurrenceCollection.filter(function (obj) {\n            return obj[fields.startTime] >= startTime && obj[fields.endTime] <= endTime && !isNullOrUndefined(obj[fields.recurrenceID]);\n        });\n        return filter;\n    };\n    EventBase.prototype.getDeletedOccurrences = function (recurrenceData) {\n        var fields = this.parent.eventFields;\n        var parentObject;\n        var deletedOccurrences = [];\n        if (typeof recurrenceData === 'string' || typeof recurrenceData === 'number') {\n            parentObject = this.parent.eventsData.filter(function (obj) {\n                return obj[fields.id] === recurrenceData;\n            })[0];\n        }\n        else {\n            parentObject = extend({}, recurrenceData, null, true);\n        }\n        if (parentObject[fields.recurrenceException]) {\n            var exDateString_1 = parentObject[fields.recurrenceException].split(',');\n            var _loop_3 = function (i, len) {\n                var edited = this_2.parent.eventsData.filter(function (eventObj) {\n                    return eventObj[fields.recurrenceID] === parentObject[fields.id] && eventObj[fields.recurrenceException] === exDateString_1[i];\n                });\n                if (edited.length === 0) {\n                    var exDate = getDateFromRecurrenceDateString(exDateString_1[i]);\n                    var childObject = extend({}, recurrenceData, null, true);\n                    childObject[fields.recurrenceID] = parentObject[fields.id];\n                    delete childObject[fields.followingID];\n                    childObject[fields.recurrenceException] = exDateString_1[i];\n                    var startDate = new Date(exDate.getTime());\n                    var time = parentObject[fields.endTime].getTime() - parentObject[fields.startTime].getTime();\n                    var endDate = new Date(startDate.getTime());\n                    endDate.setMilliseconds(time);\n                    childObject[fields.startTime] = new Date(startDate.getTime());\n                    childObject[fields.endTime] = new Date(endDate.getTime());\n                    deletedOccurrences.push(childObject);\n                }\n            };\n            var this_2 = this;\n            for (var i = 0, len = exDateString_1.length; i < len; i++) {\n                _loop_3(i, len);\n            }\n        }\n        return deletedOccurrences;\n    };\n    EventBase.prototype.applyResourceColor = function (element, data, type, index, alpha) {\n        if (!this.parent.resourceBase) {\n            return;\n        }\n        var alphaColor = function (color, alpha) {\n            color = color.replace('#', '');\n            var r = parseInt(color.substring(0, color.length / 3), 16);\n            var g = parseInt(color.substring(color.length / 3, 2 * color.length / 3), 16);\n            var b = parseInt(color.substring(2 * color.length / 3, 3 * color.length / 3), 16);\n            return \"rgba(\" + r + \", \" + g + \", \" + b + \", \" + alpha + \")\";\n        };\n        // index refers groupOrder\n        var color = this.parent.resourceBase.getResourceColor(data, index);\n        if (color) {\n            element.style[type] = !isNullOrUndefined(alpha) ? alphaColor(color, alpha) : color;\n        }\n    };\n    EventBase.prototype.createBlockAppointmentElement = function (record, resIndex) {\n        var eventSubject = (record[this.parent.eventFields.subject] || this.parent.eventSettings.fields.subject.default);\n        var appointmentWrapper = createElement('div', {\n            className: cls.BLOCK_APPOINTMENT_CLASS,\n            attrs: {\n                'data-id': 'Appointment_' + record[this.parent.eventFields.id],\n                'aria-readonly': 'true', 'aria-selected': 'false'\n            }\n        });\n        var templateElement;\n        if (!isNullOrUndefined(this.parent.activeViewOptions.eventTemplate)) {\n            var scheduleId = this.parent.element.id + '_';\n            var viewName = this.parent.activeViewOptions.eventTemplateName;\n            var templateId = scheduleId + viewName + 'eventTemplate';\n            var templateName = 'eventTemplate' + (this.parent.activeViewOptions.group.resources.length > 0 &&\n                this.parent.currentView.indexOf('Year') === -1 ? '_' + resIndex : '');\n            templateElement = this.parent.getAppointmentTemplate()(record, this.parent, templateName, templateId, false);\n        }\n        else {\n            var appointmentSubject = createElement('div', {\n                className: cls.SUBJECT_CLASS, innerHTML: eventSubject\n            });\n            templateElement = [appointmentSubject];\n        }\n        append(templateElement, appointmentWrapper);\n        this.setWrapperAttributes(appointmentWrapper, resIndex);\n        return appointmentWrapper;\n    };\n    EventBase.prototype.setWrapperAttributes = function (appointmentWrapper, resIndex) {\n        if (!isNullOrUndefined(this.cssClass)) {\n            addClass([appointmentWrapper], this.cssClass);\n        }\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            appointmentWrapper.setAttribute('data-group-index', resIndex.toString());\n        }\n    };\n    EventBase.prototype.getReadonlyAttribute = function (event) {\n        return (event[this.parent.eventFields.isReadonly] || this.parent.readonly).toString();\n    };\n    EventBase.prototype.isBlockRange = function (eventData) {\n        var eventCollection = (eventData instanceof Array) ? eventData : [eventData];\n        var isBlockAlert = false;\n        var fields = this.parent.eventFields;\n        for (var _i = 0, _a = eventCollection; _i < _a.length; _i++) {\n            var event_5 = _a[_i];\n            var dataCol = [];\n            if (!isNullOrUndefined(event_5[fields.recurrenceRule]) &&\n                (isNullOrUndefined(event_5[fields.recurrenceID]) || event_5[fields.id] === event_5[fields.recurrenceID])) {\n                dataCol = this.generateOccurrence(event_5);\n            }\n            else {\n                dataCol.push(event_5);\n            }\n            for (var _b = 0, dataCol_1 = dataCol; _b < dataCol_1.length; _b++) {\n                var data = dataCol_1[_b];\n                var filterBlockEvents = this.filterBlockEvents(data);\n                if (filterBlockEvents.length > 0) {\n                    isBlockAlert = true;\n                    break;\n                }\n            }\n        }\n        this.parent.uiStateValues.isBlock = isBlockAlert;\n        return isBlockAlert;\n    };\n    EventBase.prototype.getFilterEventsList = function (dataSource, query) {\n        return new DataManager(dataSource).executeLocal(new Query().where(query));\n    };\n    EventBase.prototype.getSeriesEvents = function (parentEvent, startTime) {\n        var fields = this.parent.eventFields;\n        startTime = isNullOrUndefined(startTime) ? parentEvent[fields.startTime] : startTime;\n        var deleteFutureEditEvents;\n        var futureEvents;\n        var deleteFutureEditEventList = [];\n        var delId = parentEvent[fields.id];\n        var followingId = parentEvent[fields.followingID];\n        var deleteFutureEvent;\n        var startTimeQuery = this.parent.currentAction === 'EditSeries' ? 'greaterthan' : 'greaterthanorequal';\n        do {\n            deleteFutureEvent = ((new Predicate(fields.followingID, 'equal', delId))).\n                and(new Predicate(fields.startTime, startTimeQuery, startTime));\n            futureEvents = this.getFilterEventsList(this.parent.eventsData, deleteFutureEvent);\n            deleteFutureEditEvents = futureEvents.slice(-1)[0];\n            if (!isNullOrUndefined(deleteFutureEditEvents) && deleteFutureEditEvents[fields.id] !== followingId) {\n                deleteFutureEditEventList.push(deleteFutureEditEvents);\n                delId = deleteFutureEditEvents[fields.id];\n                followingId = deleteFutureEditEvents[fields.followingID];\n            }\n            else {\n                followingId = null;\n            }\n        } while (futureEvents.length === 1 && !isNullOrUndefined(deleteFutureEditEvents[fields.followingID]));\n        return deleteFutureEditEventList;\n    };\n    EventBase.prototype.getEditedOccurrences = function (deleteFutureEditEventList, startTime) {\n        var fields = this.parent.eventFields;\n        var deleteRecurrenceEventList = [];\n        var delEditedEvents;\n        for (var _i = 0, deleteFutureEditEventList_1 = deleteFutureEditEventList; _i < deleteFutureEditEventList_1.length; _i++) {\n            var event_6 = deleteFutureEditEventList_1[_i];\n            var delEventQuery = new Predicate(fields.recurrenceID, 'equal', event_6[fields.id]).\n                or(new Predicate(fields.recurrenceID, 'equal', event_6[fields.followingID]).\n                and(new Predicate(fields.recurrenceID, 'notequal', undefined)).\n                and(new Predicate(fields.recurrenceID, 'notequal', null)));\n            if (this.parent.currentAction === 'EditFollowingEvents' || this.parent.currentAction === 'DeleteFollowingEvents') {\n                delEventQuery = delEventQuery.and(new Predicate(fields.startTime, 'greaterthanorequal', startTime));\n            }\n            delEditedEvents = this.getFilterEventsList(this.parent.eventsData, delEventQuery);\n            deleteRecurrenceEventList = deleteRecurrenceEventList.concat(delEditedEvents);\n        }\n        return deleteRecurrenceEventList;\n    };\n    EventBase.prototype.getRenderedDates = function (dateRender) {\n        var firstDate = 0;\n        var lastDate = dateRender.length;\n        var filteredDates;\n        if (dateRender[0] < this.parent.minDate && dateRender[dateRender.length - 1] > this.parent.maxDate) {\n            for (var i = 0; i < dateRender.length; i++) {\n                if (util.resetTime(dateRender[i]).getTime() === util.resetTime(new Date(this.parent.minDate)).getTime()) {\n                    firstDate = i;\n                }\n                if (util.resetTime(dateRender[i]).getTime() === util.resetTime(new Date(this.parent.maxDate)).getTime()) {\n                    lastDate = i;\n                }\n            }\n            filteredDates = dateRender.filter(function (date) { return date >= dateRender[firstDate] && date <= dateRender[lastDate]; });\n        }\n        return filteredDates;\n    };\n    EventBase.prototype.isValidEvent = function (eventObj, start, end, schedule) {\n        var isHourRange = end.getTime() > schedule.startHour.getTime() && start.getTime() < schedule.endHour.getTime();\n        var isSameRange = schedule.startHour.getTime() <= start.getTime() &&\n            eventObj[this.parent.eventFields.startTime].getTime() >= schedule.startHour.getTime() &&\n            eventObj[this.parent.eventFields.endTime].getTime() < schedule.endHour.getTime() && start.getTime() === end.getTime();\n        return isHourRange || isSameRange;\n    };\n    EventBase.prototype.allDayExpandScroll = function (dateHeader) {\n        var indentHeight = 0;\n        var headerRows = [].slice.call(this.parent.element.querySelectorAll('.' + cls.HEADER_ROW_CLASS));\n        headerRows.forEach(function (element) {\n            var tdEle = [].slice.call(element.children);\n            tdEle.forEach(function (ele) { ele.style.top = indentHeight + 'px'; });\n            indentHeight += element.offsetHeight;\n        });\n        indentHeight = dateHeader.offsetHeight - indentHeight;\n        this.parent.element.querySelector('.' + cls.ALLDAY_CELLS_CLASS).style.height = (indentHeight / 12) + 'em';\n        if (this.parent.uiStateValues.expand) {\n            addClass([dateHeader], cls.ALLDAY_APPOINTMENT_SCROLL);\n        }\n        else {\n            removeClass([dateHeader], cls.ALLDAY_APPOINTMENT_SCROLL);\n        }\n    };\n    EventBase.prototype.updateEventMinimumDuration = function (startEndHours, startTime, endTime) {\n        var eventDuration = (util.getUniversalTime(endTime) - util.getUniversalTime(startTime)) / util.MS_PER_MINUTE;\n        if (eventDuration < this.parent.eventSettings.minimumEventDuration) {\n            var tempEnd = new Date(startTime);\n            tempEnd.setMinutes(tempEnd.getMinutes() + this.parent.eventSettings.minimumEventDuration);\n            endTime = tempEnd;\n            if (endTime.getTime() > startEndHours.endHour.getTime()) {\n                var tempStart = new Date(startEndHours.endHour.getTime());\n                tempStart.setMinutes(tempStart.getMinutes() - this.parent.eventSettings.minimumEventDuration);\n                startTime = tempStart;\n                endTime = startEndHours.endHour;\n            }\n        }\n        return { startDate: startTime, endDate: endTime };\n    };\n    EventBase.prototype.unWireEvents = function () {\n        var appElements = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n        for (var _i = 0, appElements_1 = appElements; _i < appElements_1.length; _i++) {\n            var element = appElements_1[_i];\n            EventHandler.clearEvents(element);\n        }\n    };\n    EventBase.prototype.destroy = function () {\n        this.unWireEvents();\n        this.parent = null;\n    };\n    return EventBase;\n}());\nexport { EventBase };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}