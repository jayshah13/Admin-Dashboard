{"ast":null,"code":"/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { KeyboardEvents, closest, EventHandler, extend } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, addClass, removeClass } from '@syncfusion/ej2-base';\nimport * as event from '../base/constant';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\n/**\n * Keyboard interaction\n */\n\nvar KeyboardInteraction =\n/** @class */\nfunction () {\n  function KeyboardInteraction(parent) {\n    this.selectedCells = [];\n    this.keyConfigs = {\n      downArrow: 'downarrow',\n      upArrow: 'uparrow',\n      rightArrow: 'rightarrow',\n      leftArrow: 'leftarrow',\n      shiftDownArrow: 'shift+downarrow',\n      shiftUpArrow: 'shift+uparrow',\n      shiftRightArrow: 'shift+rightarrow',\n      shiftLeftArrow: 'shift+leftarrow',\n      ctrlLeftArrow: 'ctrl+leftarrow',\n      ctrlRightArrow: 'ctrl+rightarrow',\n      altOne: 'alt+1',\n      altTwo: 'alt+2',\n      altThree: 'alt+3',\n      altFour: 'alt+4',\n      altFive: 'alt+5',\n      altSix: 'alt+6',\n      altSeven: 'alt+7',\n      altEight: 'alt+8',\n      altNine: 'alt+9',\n      enter: 'enter',\n      escape: 'escape',\n      delete: 'delete',\n      home: 'home',\n      pageUp: 'pageup',\n      pageDown: 'pagedown',\n      tab: 'tab',\n      shiftTab: 'shift+tab',\n      ctrlShiftUpArrow: 'ctrl+shift+uparrow',\n      ctrlShiftDownArrow: 'ctrl+shift+downarrow',\n      ctrlShiftLeftArrow: 'ctrl+shift+leftarrow',\n      ctrlShiftRightArrow: 'ctrl+shift+rightarrow'\n    };\n    this.parent = parent;\n    this.parent.element.tabIndex = this.parent.element.tabIndex === -1 ? 0 : this.parent.element.tabIndex;\n    this.keyboardModule = new KeyboardEvents(this.parent.element, {\n      keyAction: this.keyActionHandler.bind(this),\n      keyConfigs: this.keyConfigs,\n      eventName: 'keydown'\n    });\n    this.addEventListener();\n  }\n\n  KeyboardInteraction.prototype.keyActionHandler = function (e) {\n    switch (e.action) {\n      case 'downArrow':\n      case 'shiftDownArrow':\n        this.processDown(e, e.shiftKey);\n        break;\n\n      case 'upArrow':\n      case 'shiftUpArrow':\n        this.processUp(e, e.shiftKey);\n        break;\n\n      case 'leftArrow':\n      case 'shiftLeftArrow':\n        this.processLeft(e, e.shiftKey);\n        break;\n\n      case 'rightArrow':\n      case 'shiftRightArrow':\n        this.processRight(e, e.shiftKey);\n        break;\n\n      case 'ctrlLeftArrow':\n        this.parent.changeDate(this.parent.activeView.getNextPreviousDate('previous'), e);\n\n        if (this.parent.headerModule) {\n          this.parent.headerModule.element.querySelector('.e-prev button').focus();\n        }\n\n        break;\n\n      case 'ctrlRightArrow':\n        this.parent.changeDate(this.parent.activeView.getNextPreviousDate('next'), e);\n\n        if (this.parent.headerModule) {\n          this.parent.headerModule.element.querySelector('.e-next button').focus();\n        }\n\n        break;\n\n      case 'altOne':\n      case 'altTwo':\n      case 'altThree':\n      case 'altFour':\n      case 'altFive':\n      case 'altSix':\n      case 'altSeven':\n      case 'altEight':\n      case 'altNine':\n        this.processViewNavigation(e);\n        break;\n\n      case 'enter':\n        this.processEnter(e);\n        break;\n\n      case 'home':\n        this.focusFirstCell();\n        break;\n\n      case 'tab':\n      case 'shiftTab':\n        this.processTab(e, e.shiftKey);\n        break;\n\n      case 'delete':\n        this.processDelete(e);\n        break;\n\n      case 'ctrlShiftUpArrow':\n      case 'ctrlShiftDownArrow':\n      case 'ctrlShiftLeftArrow':\n      case 'ctrlShiftRightArrow':\n        this.processCtrlShiftNavigationArrows(e);\n        break;\n\n      case 'escape':\n        this.processEscape(e);\n        break;\n\n      case 'fTwelve':\n        if (this.parent.allowInline && this.parent.inlineModule) {\n          e.preventDefault();\n          this.processFTwelve(e);\n        }\n\n        break;\n    }\n  };\n\n  KeyboardInteraction.prototype.processFTwelve = function (e) {\n    var target = e.target;\n\n    if (target.classList.contains(cls.WORK_CELLS_CLASS) || target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      this.parent.activeCellsData = this.getSelectedElements(target);\n      var args = extend(this.parent.activeCellsData, {\n        cancel: false,\n        event: e\n      });\n      var inlineArgs = {\n        element: args.element,\n        groupIndex: args.groupIndex,\n        type: 'Cell'\n      };\n      this.parent.notify(event.inlineClick, inlineArgs);\n    }\n\n    if (target.classList.contains(cls.APPOINTMENT_CLASS)) {\n      target.click();\n      return;\n    }\n  };\n\n  KeyboardInteraction.prototype.addEventListener = function () {\n    this.parent.on(event.cellMouseDown, this.onCellMouseDown, this);\n  };\n\n  KeyboardInteraction.prototype.removeEventListener = function () {\n    this.parent.off(event.cellMouseDown, this.onCellMouseDown);\n  };\n\n  KeyboardInteraction.prototype.onCellMouseDown = function (e) {\n    if (e.event.shiftKey) {\n      return;\n    }\n\n    this.initialTarget = this.getClosestCell(e.event);\n\n    if (this.parent.activeViewOptions.readonly || this.parent.currentView === 'MonthAgenda' || !this.initialTarget) {\n      return;\n    }\n\n    if (e.event.target.classList.contains(cls.WORK_CELLS_CLASS) && e.event.which !== 3) {\n      this.parent.removeSelectedClass();\n      EventHandler.add(this.parent.getContentTable(), 'mousemove', this.onMouseSelection, this);\n      EventHandler.add(this.parent.getContentTable(), 'mouseup', this.onMoveUp, this);\n    }\n\n    if (e.event.target.classList.contains(cls.ALLDAY_CELLS_CLASS) && e.event.which !== 3) {\n      this.parent.removeSelectedClass();\n      var allDayRow = this.parent.getAllDayRow();\n      EventHandler.add(allDayRow, 'mousemove', this.onMouseSelection, this);\n      EventHandler.add(allDayRow, 'mouseup', this.onMoveUp, this);\n    }\n  };\n\n  KeyboardInteraction.prototype.onMouseSelection = function (e) {\n    var appointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n    addClass(appointments, 'e-allow-select');\n    var selectionEdges = this.parent.boundaryValidation(e.pageY, e.pageX);\n\n    if (selectionEdges.bottom || selectionEdges.top || selectionEdges.left || selectionEdges.right) {\n      var parent_1 = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n      var yInBounds = parent_1.offsetHeight <= parent_1.scrollHeight && parent_1.scrollTop >= 0 && parent_1.scrollTop + parent_1.offsetHeight <= parent_1.scrollHeight;\n      var xInBounds = parent_1.offsetWidth <= parent_1.scrollWidth && parent_1.scrollLeft >= 0 && parent_1.scrollLeft + parent_1.offsetWidth <= parent_1.scrollWidth;\n\n      if (yInBounds && (selectionEdges.top || selectionEdges.bottom)) {\n        parent_1.scrollTop += selectionEdges.top ? -e.target.offsetHeight : e.target.offsetHeight;\n      }\n\n      if (xInBounds && (selectionEdges.left || selectionEdges.right)) {\n        parent_1.scrollLeft += selectionEdges.left ? -e.target.offsetWidth : e.target.offsetWidth;\n      }\n    }\n\n    var target = this.getClosestCell(e);\n\n    if (target) {\n      this.selectCells(true, target);\n    }\n  };\n\n  KeyboardInteraction.prototype.getClosestCell = function (e) {\n    return closest(e.target, '.' + cls.WORK_CELLS_CLASS + ',.' + cls.ALLDAY_CELLS_CLASS);\n  };\n\n  KeyboardInteraction.prototype.onMoveUp = function (e) {\n    var _this = this;\n\n    var appointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n    removeClass(appointments, 'e-allow-select');\n\n    if (e.target.classList.contains(cls.WORK_CELLS_CLASS)) {\n      EventHandler.remove(this.parent.getContentTable(), 'mousemove', this.onMouseSelection);\n      EventHandler.remove(this.parent.getContentTable(), 'mouseup', this.onMoveUp);\n    }\n\n    if (e.target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      var allDayRow = this.parent.getAllDayRow();\n      EventHandler.remove(allDayRow, 'mousemove', this.onMouseSelection);\n      EventHandler.remove(allDayRow, 'mouseup', this.onMoveUp);\n    }\n\n    if (this.isPreventAction(e)) {\n      return;\n    }\n\n    var queryStr = '.' + cls.WORK_CELLS_CLASS + ',.' + cls.ALLDAY_CELLS_CLASS + ',.' + cls.HEADER_CELLS_CLASS;\n    var target = closest(e.target, queryStr);\n\n    if (this.parent.currentView === 'TimelineYear' && target.classList.contains(cls.OTHERMONTH_CLASS)) {\n      return;\n    }\n\n    this.parent.activeCellsData = this.getSelectedElements(target);\n    var cellData = {};\n\n    if (this.parent.eventWindow) {\n      this.parent.eventWindow.convertToEventData(this.parent.activeCellsData, cellData);\n    }\n\n    var selectedCells = this.parent.getSelectedElements();\n    var args = {\n      data: cellData,\n      element: this.parent.activeCellsData.element,\n      event: e,\n      requestType: 'cellSelect',\n      showQuickPopup: false\n    };\n    this.parent.trigger(event.select, args, function (selectArgs) {\n      var isPopupShow = selectArgs.showQuickPopup || _this.parent.quickInfoOnSelectionEnd;\n\n      if (isPopupShow && selectedCells.length > 1) {\n        var cellArgs = extend(_this.parent.activeCellsData, {\n          cancel: false,\n          event: e,\n          name: 'cellClick'\n        });\n\n        _this.parent.notify(event.cellClick, cellArgs);\n      }\n    });\n  };\n\n  KeyboardInteraction.prototype.processEnter = function (e) {\n    if (this.parent.activeViewOptions.readonly && !e.target.classList.contains(cls.APPOINTMENT_CLASS) || this.isPreventAction(e)) {\n      return;\n    }\n\n    if (this.parent.currentView === 'TimelineYear' && e.target.classList.contains(cls.OTHERMONTH_CLASS)) {\n      return;\n    }\n\n    var target = e.target;\n\n    if (closest(target, '.' + cls.POPUP_WRAPPER_CLASS)) {\n      if (target.classList.contains(cls.QUICK_POPUP_EVENT_DETAILS_CLASS) || target.classList.contains(cls.EVENT_CREATE_CLASS) || target.classList.contains(cls.EDIT_EVENT_CLASS) || target.classList.contains(cls.DELETE_EVENT_CLASS) || target.classList.contains(cls.CLOSE_CLASS)) {\n        target.click();\n        e.preventDefault();\n      } else if (target.classList.contains(cls.SUBJECT_CLASS)) {\n        this.parent.element.querySelector('.' + cls.EVENT_CREATE_CLASS).click();\n        e.preventDefault();\n      }\n\n      return;\n    }\n\n    if (target.classList.contains(cls.RESOURCE_CELLS_CLASS) && target.classList.contains(cls.RESOURCE_PARENT_CLASS)) {\n      var resourceIcon = target.querySelector('.' + cls.RESOURCE_TREE_ICON_CLASS);\n\n      if (resourceIcon) {\n        resourceIcon.click();\n      }\n\n      return;\n    }\n\n    if (target.classList.contains(cls.WORK_CELLS_CLASS) || target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      this.parent.activeCellsData = this.getSelectedElements(target);\n      var args = extend(this.parent.activeCellsData, {\n        cancel: false,\n        event: e\n      });\n\n      if (this.parent.allowInline) {\n        var inlineArgs = {\n          element: args.element,\n          groupIndex: args.groupIndex,\n          type: 'Cell'\n        };\n        this.parent.notify(event.inlineClick, inlineArgs);\n      } else {\n        if (this.parent.currentView === 'Year') {\n          target.click();\n        } else {\n          this.parent.notify(event.cellClick, args);\n        }\n      }\n\n      return;\n    }\n\n    if (target.classList.contains(cls.INLINE_SUBJECT_CLASS) && this.parent.inlineModule) {\n      this.parent.inlineModule.inlineCrudActions(target);\n      return;\n    }\n\n    if (target.classList.contains(cls.APPOINTMENT_CLASS) || target.classList.contains(cls.MORE_EVENT_CLOSE_CLASS) || target.classList.contains(cls.ALLDAY_APPOINTMENT_SECTION_CLASS) || target.classList.contains(cls.MORE_INDICATOR_CLASS)) {\n      target.click();\n      return;\n    }\n\n    if (target.classList.contains(cls.MORE_EVENT_HEADER_DATE_CLASS)) {\n      this.parent.setProperties({\n        selectedDate: this.parent.getDateFromElement(target)\n      }, true);\n      this.parent.changeView(this.parent.getNavigateView(), e);\n      this.processEscape(e);\n      return;\n    }\n  };\n\n  KeyboardInteraction.prototype.getSelectedElements = function (target) {\n    var cellDetails;\n\n    if (this.selectedCells.length > 1 && target.classList.contains(cls.SELECTED_CELL_CLASS)) {\n      var start = this.parent.getCellDetails(this.selectedCells[0]);\n      var end = this.parent.getCellDetails(this.selectedCells.slice(-1)[0]);\n      start.endTime = end.endTime;\n      start.element = target;\n      cellDetails = start;\n    } else {\n      cellDetails = this.parent.getCellDetails(target);\n    }\n\n    return cellDetails;\n  };\n\n  KeyboardInteraction.prototype.getCells = function (isInverseTable, start, end) {\n    var tableEle = this.parent.getContentTable();\n    var isTimelineYear = this.parent.currentView === 'TimelineYear';\n    var query = isTimelineYear && !isInverseTable ? '.' + cls.WORK_CELLS_CLASS + ':not(.' + cls.OTHERMONTH_CLASS + ')' : 'td';\n    var cells = [].slice.call(tableEle.querySelectorAll(query));\n    var maxRow = tableEle.rows.length;\n    var maxColumn = tableEle.rows[0].cells.length;\n\n    if (start && start.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      var allDayRow = this.parent.getAllDayRow();\n      cells = [].slice.call(allDayRow.cells);\n      maxRow = 1;\n      maxColumn = allDayRow.cells.length;\n    }\n\n    var startIndex = cells.indexOf(start);\n    var endIndex = cells.indexOf(end);\n    var inverseCells = [];\n\n    if (isInverseTable) {\n      for (var i = 0; i < maxColumn; i++) {\n        for (var j = 0; j < maxRow; j++) {\n          var cell = cells[maxColumn * j + i];\n\n          if (isTimelineYear && cell.classList.contains(cls.OTHERMONTH_CLASS)) {\n            continue;\n          }\n\n          inverseCells.push(cell);\n        }\n      }\n\n      startIndex = inverseCells.indexOf(start);\n      endIndex = inverseCells.indexOf(end);\n    }\n\n    if (startIndex > endIndex) {\n      var temp = startIndex;\n      startIndex = endIndex;\n      endIndex = temp;\n    }\n\n    var sCells = isInverseTable ? inverseCells : cells;\n    return sCells.slice(startIndex, endIndex + 1);\n  };\n\n  KeyboardInteraction.prototype.focusFirstCell = function () {\n    if (this.parent.currentView === 'Agenda') {\n      var focusCell = this.parent.getContentTable().querySelector('.' + cls.AGENDA_CELLS_CLASS);\n      focusCell.setAttribute('tabindex', '0');\n      focusCell.focus();\n      return;\n    }\n\n    this.parent.eventBase.removeSelectedAppointmentClass();\n\n    if (this.parent.activeView.isTimelineView() && this.parent.currentView !== 'TimelineYear') {\n      var cell = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS + ' tr:not(.' + cls.HIDDEN_CLASS + ') .' + cls.WORK_CELLS_CLASS + ':not(.' + cls.RESOURCE_GROUP_CELLS_CLASS + ')');\n      this.selectCells(false, cell);\n    } else if (this.parent.currentView.indexOf('Year') > -1) {\n      var query = '.' + cls.WORK_CELLS_CLASS + ':not(.' + cls.OTHERMONTH_CLASS + ')' + ':not(.' + cls.RESOURCE_GROUP_CELLS_CLASS + ')';\n      var isVerticalYear = this.parent.currentView === 'TimelineYear' && this.parent.activeViewOptions.orientation === 'Vertical';\n      query += isVerticalYear ? '[data-date=\"' + this.parent.activeView.startDate().getTime() + '\"]' : '';\n      this.selectCells(false, this.parent.element.querySelector(query));\n    } else {\n      this.selectCells(false, this.parent.getWorkCellElements()[0]);\n    }\n  };\n\n  KeyboardInteraction.prototype.isInverseTableSelect = function () {\n    return this.parent.activeView.isInverseTableSelect;\n  };\n  /**\n   * Internal method to select cells\n   *\n   * @param {boolean} isMultiple Accepts to select multiple cells or not\n   * @param {HTMLTableCellElement} targetCell Accepts the target cells\n   * @returns {void}\n   * @private\n   */\n\n\n  KeyboardInteraction.prototype.selectCells = function (isMultiple, targetCell) {\n    var _this = this;\n\n    this.parent.removeSelectedClass();\n    var target = targetCell instanceof Array ? targetCell.slice(-1)[0] : targetCell;\n\n    if (isMultiple) {\n      var initialId_1;\n      var views_1 = ['Day', 'Week', 'WorkWeek', 'TimelineDay', 'TimelineWeek', 'TimelineWorkWeek', 'TimelineMonth', 'TimelineYear'];\n      var args = {\n        element: targetCell,\n        requestType: 'mousemove',\n        allowMultipleRow: true\n      };\n      this.parent.inlineModule.removeInlineAppointmentElement();\n      this.parent.trigger(event.select, args, function (selectArgs) {\n        var allowMultipleRow = !selectArgs.allowMultipleRow || !_this.parent.allowMultiRowSelection;\n\n        if (allowMultipleRow) {\n          var isTimelineYear = _this.parent.currentView === 'TimelineYear';\n\n          if (isTimelineYear && _this.parent.activeViewOptions.orientation === 'Horizontal' || _this.parent.currentView === 'Month') {\n            var isGroupYear = isTimelineYear && _this.parent.activeViewOptions.group.resources.length > 0;\n            target = isGroupYear ? _this.initialTarget : _this.initialTarget.parentElement.children[target.cellIndex];\n          } else if (views_1.indexOf(_this.parent.currentView) > -1) {\n            target = target.parentElement.children[_this.initialTarget.cellIndex];\n          }\n        }\n\n        var selectedCells = _this.getCells(_this.isInverseTableSelect(), _this.initialTarget, target);\n\n        if (_this.parent.activeViewOptions.group.resources.length > 0) {\n          initialId_1 = _this.initialTarget.getAttribute('data-group-index');\n          var resourceSelectedCells = [];\n\n          for (var _i = 0, selectedCells_1 = selectedCells; _i < selectedCells_1.length; _i++) {\n            var cell = selectedCells_1[_i];\n\n            if (cell.getAttribute('data-group-index') === initialId_1) {\n              resourceSelectedCells.push(cell);\n            }\n          }\n\n          selectedCells = resourceSelectedCells;\n        }\n\n        if (!_this.parent.allowMultiCellSelection) {\n          selectedCells = [_this.initialTarget];\n        }\n\n        _this.selectedCells = selectedCells;\n\n        if (selectedCells.length > 2 && !target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n          var allDayCells = _this.getAllDayCells(selectedCells);\n\n          if (_this.parent.activeViewOptions.group.resources.length > 0) {\n            var resourceAllDayCells = [];\n\n            for (var _a = 0, allDayCells_1 = allDayCells; _a < allDayCells_1.length; _a++) {\n              var cell = allDayCells_1[_a];\n\n              if (cell.getAttribute('data-group-index') === initialId_1) {\n                resourceAllDayCells.push(cell);\n              }\n            }\n\n            allDayCells = resourceAllDayCells;\n          }\n\n          selectedCells = selectedCells.concat(allDayCells);\n        }\n\n        if (target.getAttribute('data-group-index') !== initialId_1 && _this.parent.activeViewOptions.group.resources.length > 0) {\n          target = _this.selectedCells[_this.selectedCells.length - 1];\n        }\n\n        _this.parent.addSelectedClass(selectedCells, target);\n      });\n    } else {\n      this.initialTarget = target;\n      this.selectedCells = [target];\n      this.parent.addSelectedClass([target], target);\n    }\n  };\n\n  KeyboardInteraction.prototype.selectAppointment = function (isReverse, target) {\n    var appointments = this.getAppointmentElements();\n\n    if (appointments.length < 0) {\n      return;\n    }\n\n    this.parent.eventBase.removeSelectedAppointmentClass();\n    var nextAppEle;\n\n    if (target.classList.contains(cls.APPOINTMENT_CLASS)) {\n      var targetIndex = appointments.indexOf(target);\n      nextAppEle = appointments[isReverse ? targetIndex - 1 : targetIndex + 1];\n    } else {\n      nextAppEle = isReverse ? appointments[appointments.length - 1] : appointments[0];\n    }\n\n    if (nextAppEle) {\n      this.parent.eventBase.addSelectedAppointments([nextAppEle]);\n      nextAppEle.focus();\n      addClass([nextAppEle], cls.AGENDA_SELECTED_CELL);\n    }\n  };\n\n  KeyboardInteraction.prototype.selectAppointmentElementFromWorkCell = function (isReverse, target) {\n    var _this = this;\n\n    this.parent.eventBase.removeSelectedAppointmentClass();\n    this.parent.removeSelectedClass();\n\n    if (target.classList.contains(cls.WORK_CELLS_CLASS) || target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      var appointmentElements_1 = this.getUniqueAppointmentElements();\n      var filteredElements_1 = [];\n      var selectedDate_1 = this.parent.getDateFromElement(target).getTime();\n      var selectedSeriesEvents = this.parent.eventsProcessed.filter(function (eventObject) {\n        return !isReverse ? eventObject[_this.parent.eventFields.startTime].getTime() >= selectedDate_1 : eventObject[_this.parent.eventFields.startTime].getTime() <= selectedDate_1;\n      });\n      selectedSeriesEvents.filter(function (event) {\n        appointmentElements_1.filter(function (element) {\n          if (JSON.stringify(event.Guid) === JSON.stringify(element.getAttribute('data-guid'))) {\n            filteredElements_1.push(element);\n          }\n        });\n      });\n\n      if (filteredElements_1.length > 0) {\n        var selectedElement = isReverse ? filteredElements_1[filteredElements_1.length - 1] : filteredElements_1[0];\n        var focusElements = this.getAppointmentElementsByGuid(selectedElement.getAttribute('data-guid'));\n        this.parent.eventBase.addSelectedAppointments(focusElements);\n        focusElements[focusElements.length - 1].focus();\n      }\n    }\n  };\n\n  KeyboardInteraction.prototype.getAllDayCells = function (cells) {\n    var allDayRow = this.parent.getAllDayRow();\n\n    if (!allDayRow) {\n      return [];\n    }\n\n    var startCell = cells[0];\n    var endCell = cells[cells.length - 1];\n    var start = this.parent.getCellDetails(startCell);\n    var end = this.parent.getCellDetails(endCell);\n\n    if (end.endTime.getTime() - start.startTime.getTime() >= util.MS_PER_DAY) {\n      var allDayCells = [].slice.call(allDayRow.cells);\n      return allDayCells.slice(startCell.cellIndex, endCell.cellIndex + 1);\n    }\n\n    return [];\n  };\n\n  KeyboardInteraction.prototype.getAppointmentElements = function () {\n    return [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n  };\n\n  KeyboardInteraction.prototype.getAppointmentElementsByGuid = function (guid) {\n    return [].slice.call(this.parent.element.querySelectorAll('div[data-guid=\"' + guid + '\"]'));\n  };\n\n  KeyboardInteraction.prototype.getUniqueAppointmentElements = function () {\n    var appointments = this.getAppointmentElements();\n    var appointmentElements = [];\n    appointments.map(function (value) {\n      return value.getAttribute('data-guid');\n    }).filter(function (value, index, self) {\n      if (self.indexOf(value) === index) {\n        appointmentElements.push(appointments[index]);\n      }\n    });\n    return appointmentElements;\n  };\n\n  KeyboardInteraction.prototype.getWorkCellFromAppointmentElement = function (target) {\n    var selectedObject = this.parent.eventBase.getEventByGuid(target.getAttribute('data-guid'));\n    return this.parent.eventBase.selectWorkCellByTime([selectedObject]);\n  };\n\n  KeyboardInteraction.prototype.processViewNavigation = function (e) {\n    var index = parseInt(e.key, 10) - 1;\n\n    if (index < this.parent.views.length) {\n      var view = this.parent.viewCollections[index].option;\n      this.parent.changeView(view, e, undefined, index);\n\n      if (this.parent.headerModule) {\n        this.parent.headerModule.element.querySelector('.e-active-view button').focus();\n      }\n    }\n  };\n\n  KeyboardInteraction.prototype.cancelUpDownAction = function (isTimelineYear) {\n    var isVerticalYear = isTimelineYear && this.parent.activeViewOptions.orientation === 'Vertical';\n    var isGroup = this.parent.activeViewOptions.group.resources.length > 0;\n\n    if (isVerticalYear && isGroup || isTimelineYear && this.initialTarget.classList.contains(cls.OTHERMONTH_CLASS)) {\n      return true;\n    }\n\n    if (this.parent.activeView.isTimelineView() && !isTimelineYear || this.parent.currentView === 'MonthAgenda') {\n      return true;\n    }\n\n    return false;\n  };\n\n  KeyboardInteraction.prototype.processUp = function (e, isMultiple) {\n    var isTimelineYear = this.parent.currentView === 'TimelineYear';\n\n    if (isMultiple && this.cancelUpDownAction(isTimelineYear)) {\n      return;\n    }\n\n    var target = e.target;\n    var selectedElements = this.parent.getSelectedElements();\n    var selectedEventElements = this.parent.eventBase.getSelectedAppointments();\n    var moreEventWrapper = this.parent.element.querySelector('.' + cls.MORE_POPUP_WRAPPER_CLASS);\n    var quickPopupWrapper = this.getQuickPopupElement();\n\n    if (selectedElements.length > 0 && !e.target.classList.contains(cls.WORK_CELLS_CLASS)) {\n      target = selectedElements[selectedElements.length - 1];\n    }\n\n    if (selectedEventElements.length > 0 && !moreEventWrapper.classList.contains(cls.POPUP_OPEN) && !quickPopupWrapper.classList.contains(cls.POPUP_OPEN) && ['Day', 'Week', 'WorkWeek', 'Month'].indexOf(this.parent.currentView) !== -1) {\n      target = this.getWorkCellFromAppointmentElement(selectedEventElements[selectedEventElements.length - 1]);\n      this.parent.eventBase.removeSelectedAppointmentClass();\n    }\n\n    if (!target) {\n      return;\n    }\n\n    if (target.classList.contains(cls.WORK_CELLS_CLASS) && !this.parent.element.querySelector('.' + cls.POPUP_OPEN)) {\n      var tableRows = this.parent.getTableRows();\n      var curRowIndex = tableRows.indexOf(target.parentElement);\n      var targetCell = void 0;\n\n      if (isTimelineYear && isMultiple && this.parent.activeViewOptions.group.resources.length === 0) {\n        targetCell = this.isInverseTableSelect() ? this.getVerticalUpDownCell(tableRows, target, curRowIndex, true) : this.getHorizontalUpDownCell(tableRows, target, curRowIndex, true);\n      }\n\n      if ((curRowIndex > 0 || targetCell) && curRowIndex < tableRows.length) {\n        targetCell = targetCell ? targetCell : tableRows[curRowIndex - 1].cells[target.cellIndex];\n\n        if (this.parent.currentView === 'Year' && targetCell.classList.contains(cls.OTHERMONTH_CLASS)) {\n          if (this.parent.activeView.getStartDate().getTime() < +targetCell.getAttribute('data-date')) {\n            targetCell = this.getYearUpDownCell(tableRows, curRowIndex - 1, target.cellIndex, true);\n          } else {\n            return;\n          }\n        }\n\n        this.selectCells(isMultiple, targetCell);\n      }\n    } else if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n      this.selectAppointment(true, target);\n    }\n  };\n\n  KeyboardInteraction.prototype.processDown = function (e, isMultiple) {\n    var isTimelineYear = this.parent.currentView === 'TimelineYear';\n\n    if (isMultiple && this.cancelUpDownAction(isTimelineYear)) {\n      return;\n    }\n\n    var target = e.target;\n    var selectedCells = this.parent.getSelectedElements();\n    var selectedElements = this.parent.eventBase.getSelectedAppointments();\n    var moreEventWrapper = this.parent.element.querySelector('.' + cls.MORE_POPUP_WRAPPER_CLASS);\n    var quickPopupWrapper = this.getQuickPopupElement();\n\n    if (selectedCells.length > 0 && !e.target.classList.contains(cls.WORK_CELLS_CLASS)) {\n      target = selectedCells[selectedCells.length - 1];\n    }\n\n    if (selectedElements.length > 0 && !moreEventWrapper.classList.contains(cls.POPUP_OPEN) && !quickPopupWrapper.classList.contains(cls.POPUP_OPEN) && ['Day', 'Week', 'WorkWeek', 'Month'].indexOf(this.parent.currentView) !== -1) {\n      target = this.getWorkCellFromAppointmentElement(selectedElements[selectedElements.length - 1]);\n      this.parent.eventBase.removeSelectedAppointmentClass();\n    }\n\n    var tableRows = this.parent.getTableRows();\n\n    if (!target) {\n      return;\n    }\n\n    if (target.classList.contains(cls.WORK_CELLS_CLASS) && !this.parent.element.querySelector('.' + cls.POPUP_OPEN)) {\n      var curRowIndex = tableRows.indexOf(target.parentElement);\n      var targetCell = void 0;\n\n      if (isTimelineYear && isMultiple && this.parent.activeViewOptions.group.resources.length === 0) {\n        targetCell = this.isInverseTableSelect() ? this.getVerticalUpDownCell(tableRows, target, curRowIndex, false) : this.getHorizontalUpDownCell(tableRows, target, curRowIndex, false);\n      }\n\n      if (curRowIndex >= 0 && (curRowIndex < tableRows.length - 1 || targetCell)) {\n        targetCell = targetCell ? targetCell : tableRows[curRowIndex + 1].cells[target.cellIndex];\n\n        if (this.parent.currentView === 'Year' && targetCell.classList.contains(cls.OTHERMONTH_CLASS)) {\n          if (this.parent.activeView.getEndDate().getTime() > +targetCell.getAttribute('data-date')) {\n            targetCell = this.getYearUpDownCell(tableRows, curRowIndex + 1, target.cellIndex, false);\n          } else {\n            return;\n          }\n        }\n\n        this.selectCells(isMultiple, targetCell);\n      }\n    } else if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n      this.selectAppointment(false, target);\n    }\n  };\n\n  KeyboardInteraction.prototype.getYearUpDownCell = function (tableRows, rowIndex, cellIndex, isUp) {\n    while (tableRows[rowIndex] && tableRows[rowIndex].cells[cellIndex].classList.contains(cls.OTHERMONTH_CLASS)) {\n      rowIndex = rowIndex + (isUp ? -1 : 1);\n    }\n\n    return tableRows[rowIndex].cells[cellIndex];\n  }; // eslint-disable-next-line max-len\n\n\n  KeyboardInteraction.prototype.getHorizontalUpDownCell = function (tableRows, target, curRowIndex, isUp) {\n    var row = tableRows[curRowIndex + (isUp ? -1 : 1)];\n    var cell = row ? row.cells[target.cellIndex] : target;\n\n    if (cell.classList.contains(cls.OTHERMONTH_CLASS)) {\n      var workCell = row.querySelector('.' + cls.WORK_CELLS_CLASS + ':not(.' + cls.OTHERMONTH_CLASS + ')');\n      var date = new Date(+workCell.getAttribute('data-date'));\n      var query = '[data-date=\"' + new Date(date.getFullYear(), date.getMonth() + 1, 0).getTime() + '\"]';\n      cell = cell.cellIndex < workCell.cellIndex ? workCell : row.querySelector(query);\n    }\n\n    return cell;\n  }; // eslint-disable-next-line max-len\n\n\n  KeyboardInteraction.prototype.getVerticalUpDownCell = function (tableRows, target, curRowIndex, isUp) {\n    var hasRow = isUp && curRowIndex > 0 || !isUp && curRowIndex < tableRows.length - 1;\n    var targetCell = hasRow ? tableRows[curRowIndex + (isUp ? -1 : 1)].cells[target.cellIndex] : undefined;\n\n    if (!targetCell || targetCell.classList.contains(cls.OTHERMONTH_CLASS)) {\n      var column = tableRows[curRowIndex].cells[target.cellIndex - (isUp ? 1 : -1)];\n\n      if (column) {\n        var dateAttr = +target.getAttribute('data-date') - (isUp ? util.MS_PER_DAY : -util.MS_PER_DAY);\n        return this.parent.getContentTable().querySelector('.' + cls.WORK_CELLS_CLASS + '[data-date=\"' + dateAttr + '\"]');\n      }\n\n      targetCell = target;\n    }\n\n    return targetCell;\n  };\n\n  KeyboardInteraction.prototype.processLeftRight = function (target) {\n    var tableEle = this.parent.currentView === 'Year' ? target.closest('tbody') : this.parent.getContentTable();\n    var curRowIndex = target.parentNode.sectionRowIndex;\n    var key = {\n      element: tableEle,\n      rowIndex: curRowIndex,\n      columnIndex: target.cellIndex,\n      maxIndex: tableEle.rows[curRowIndex].cells.length\n    };\n    return key;\n  };\n\n  KeyboardInteraction.prototype.getQuickPopupElement = function () {\n    return (this.parent.isAdaptive ? document.body : this.parent.element).querySelector('.' + cls.POPUP_WRAPPER_CLASS);\n  };\n\n  KeyboardInteraction.prototype.isCancelLeftRightAction = function (e, isMultiple, isTimelineYear) {\n    var prevent = this.parent.currentView === 'MonthAgenda' || isTimelineYear && this.initialTarget.classList.contains(cls.OTHERMONTH_CLASS);\n\n    if (this.parent.currentView === 'Agenda' || isMultiple && prevent) {\n      return true;\n    }\n\n    if (this.isPreventAction(e) && isMultiple) {\n      return true;\n    }\n\n    var moreEventWrapper = this.parent.element.querySelector('.' + cls.MORE_POPUP_WRAPPER_CLASS);\n    var quickPopupWrapper = this.getQuickPopupElement();\n\n    if (moreEventWrapper.classList.contains(cls.POPUP_OPEN) || quickPopupWrapper.classList.contains(cls.POPUP_OPEN)) {\n      return true;\n    }\n\n    return false;\n  };\n\n  KeyboardInteraction.prototype.processRight = function (e, isMultiple) {\n    var isTimelineYear = this.parent.currentView === 'TimelineYear';\n\n    if (this.isCancelLeftRightAction(e, isMultiple, isTimelineYear)) {\n      return;\n    }\n\n    var selectedCells = this.parent.getSelectedElements();\n    var targetCell;\n    var selectedAppointments = this.parent.eventBase.getSelectedAppointments();\n    var target = e.target;\n\n    if (selectedCells.length > 0 && !target.classList.contains(cls.WORK_CELLS_CLASS) && !target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      target = selectedCells[selectedCells.length - 1];\n    }\n\n    if (selectedAppointments.length > 0) {\n      target = this.getWorkCellFromAppointmentElement(selectedAppointments[selectedAppointments.length - 1]);\n      this.parent.eventBase.removeSelectedAppointmentClass();\n\n      if (!target) {\n        return;\n      }\n    }\n\n    if (target.classList.contains(cls.WORK_CELLS_CLASS) && e.target.classList.contains(cls.WORK_CELLS_CLASS)) {\n      var key = this.processLeftRight(target);\n      var targetDate = new Date(+target.getAttribute('data-date'));\n      var isMonthEnd = this.parent.currentView === 'Year' && targetDate.getTime() === util.lastDateOfMonth(targetDate).getTime();\n\n      if (key.columnIndex >= 0 && key.columnIndex < key.maxIndex - 1 && !isMonthEnd) {\n        targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex].cells[target.cellIndex + 1], 'right');\n\n        if (isTimelineYear && isMultiple && targetCell.classList.contains(cls.OTHERMONTH_CLASS)) {\n          targetCell = this.getTimelineYearTargetCell(key, target, true);\n        }\n\n        if (!isNullOrUndefined(targetCell)) {\n          this.selectCells(isMultiple, targetCell);\n        }\n      } else if (key.columnIndex === key.maxIndex - 1 || isMonthEnd) {\n        if (!this.isInverseTableSelect() && key.rowIndex < key.element.rows.length - 1 && !isMonthEnd) {\n          targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex + 1].cells[0], 'right');\n          var changeTargetCell = isTimelineYear && isMultiple && targetCell.classList.contains(cls.OTHERMONTH_CLASS);\n          targetCell = changeTargetCell ? this.getHorizontalLeftRightCell(key, target, true) : targetCell;\n\n          if (!isNullOrUndefined(targetCell)) {\n            this.selectCells(isMultiple, targetCell);\n          }\n        } else if (!isMultiple) {\n          if (isMonthEnd && targetDate.getTime() !== this.parent.activeView.getEndDate().getTime()) {\n            this.selectCells(isMultiple, this.parent.element.querySelector(':not(.' + cls.OTHERMONTH_CLASS + ')[data-date=\"' + (targetDate.getTime() + util.MS_PER_DAY) + '\"]'));\n            return;\n          }\n\n          var rowIndex = this.isInverseTableSelect() ? key.rowIndex : 0;\n          this.parent.changeDate(this.parent.activeView.getNextPreviousDate('next'), e);\n          var tableEle = this.parent.getContentTable();\n          var cell = isMonthEnd ? tableEle.rows[rowIndex].querySelector('.' + cls.WORK_CELLS_CLASS + ':not(.' + cls.OTHERMONTH_CLASS + ')') : tableEle.rows[rowIndex].cells[0];\n          this.selectCells(false, cell);\n        }\n      }\n    } else if (target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      var curColIndex = target.cellIndex;\n      var allDayRow = this.parent.getAllDayRow();\n      var maxColIndex = allDayRow.cells.length;\n\n      if (curColIndex >= 0 && curColIndex < maxColIndex - 1) {\n        this.selectCells(isMultiple, allDayRow.cells[curColIndex + 1]);\n      } else if (curColIndex === maxColIndex - 1 && !isMultiple) {\n        this.parent.changeDate(this.parent.activeView.getNextPreviousDate('next'), e);\n        var allDayRow_1 = this.parent.getAllDayRow();\n        this.selectCells(false, allDayRow_1.cells[0]);\n      }\n    }\n  };\n\n  KeyboardInteraction.prototype.processLeft = function (e, isMultiple) {\n    var isTimelineYear = this.parent.currentView === 'TimelineYear';\n\n    if (this.isCancelLeftRightAction(e, isMultiple, isTimelineYear)) {\n      return;\n    }\n\n    var target = e.target;\n    var selectedCells = this.parent.getSelectedElements();\n    var targetCell;\n\n    if (selectedCells.length > 0 && !target.classList.contains(cls.WORK_CELLS_CLASS) && !target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      target = selectedCells[selectedCells.length - 1];\n    }\n\n    var selectedElements = this.parent.eventBase.getSelectedAppointments();\n\n    if (selectedElements.length > 0) {\n      target = this.getWorkCellFromAppointmentElement(selectedElements[selectedElements.length - 1]);\n      this.parent.eventBase.removeSelectedAppointmentClass();\n\n      if (!target) {\n        return;\n      }\n    }\n\n    if (e.target.classList.contains(cls.WORK_CELLS_CLASS) && target.classList.contains(cls.WORK_CELLS_CLASS)) {\n      var key = this.processLeftRight(target);\n      var targetDate = new Date(+target.getAttribute('data-date'));\n      var isMonthStart = this.parent.currentView === 'Year' && targetDate.getTime() === util.firstDateOfMonth(targetDate).getTime();\n\n      if (key.columnIndex > 0 && key.columnIndex < key.maxIndex && !isMonthStart) {\n        targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex].cells[target.cellIndex - 1], 'left');\n\n        if (isTimelineYear && isMultiple && targetCell.classList.contains(cls.OTHERMONTH_CLASS)) {\n          targetCell = this.getTimelineYearTargetCell(key, target, false);\n        }\n\n        if (!isNullOrUndefined(targetCell)) {\n          this.selectCells(isMultiple, targetCell);\n        }\n      } else if (key.columnIndex === 0 || isMonthStart) {\n        if (!this.isInverseTableSelect() && key.rowIndex > 0) {\n          targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex - 1].cells[key.maxIndex - 1], 'left');\n          var otherMonthCell = isTimelineYear && isMultiple && targetCell.classList.contains(cls.OTHERMONTH_CLASS);\n          targetCell = otherMonthCell ? this.getHorizontalLeftRightCell(key, target, false) : targetCell;\n\n          if (!isNullOrUndefined(targetCell)) {\n            this.selectCells(isMultiple, targetCell);\n          }\n        } else if (!isMultiple) {\n          if (isMonthStart && targetDate.getTime() !== this.parent.activeView.getStartDate().getTime()) {\n            this.selectCells(isMultiple, this.parent.element.querySelector('[data-date=\"' + (targetDate.getTime() - util.MS_PER_DAY) + '\"]'));\n            return;\n          }\n\n          this.parent.changeDate(this.parent.activeView.getNextPreviousDate('previous'), e);\n          var tableEle = this.parent.getContentTable();\n          var rowIndex = this.isInverseTableSelect() ? key.rowIndex : tableEle.rows.length - 1;\n          var cell = tableEle.rows[rowIndex].cells[key.maxIndex - 1];\n\n          if (isMonthStart) {\n            var tbody = this.parent.element.querySelectorAll('.' + cls.CONTENT_TABLE_CLASS + ' tbody');\n            cell = tbody.item(tbody.length - 1).querySelector(':not(.' + cls.OTHERMONTH_CLASS + ')[data-date=\"' + this.parent.activeView.getEndDate().getTime() + '\"]');\n          }\n\n          this.selectCells(false, cell);\n        }\n      }\n    } else if (target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n      var curColIndex = target.cellIndex;\n      var allDayRow = this.parent.getAllDayRow();\n      var maxColIndex = allDayRow.cells.length;\n\n      if (curColIndex > 0 && curColIndex < maxColIndex) {\n        this.selectCells(isMultiple, allDayRow.cells[curColIndex - 1]);\n      } else if (curColIndex === 0 && !isMultiple) {\n        this.parent.changeDate(this.parent.activeView.getNextPreviousDate('previous'), e);\n        var allDayRow_2 = this.parent.getAllDayRow();\n        this.selectCells(false, allDayRow_2.cells[maxColIndex - 1]);\n      }\n    }\n  };\n\n  KeyboardInteraction.prototype.getTimelineYearTargetCell = function (key, target, isRight) {\n    return this.isInverseTableSelect() ? this.getVerticalLeftRightCell(target, isRight) : this.getHorizontalLeftRightCell(key, target, isRight);\n  };\n\n  KeyboardInteraction.prototype.getHorizontalLeftRightCell = function (key, target, isRight) {\n    var row = key.element.rows[target.parentNode.sectionRowIndex + (isRight ? 1 : -1)];\n\n    if (row) {\n      var query = isRight ? '.' + cls.WORK_CELLS_CLASS + ':not(.' + cls.OTHERMONTH_CLASS + ')' : '[data-date=\"' + (+target.getAttribute('data-date') - util.MS_PER_DAY) + '\"]';\n      return row.querySelector(query);\n    }\n\n    return target;\n  };\n\n  KeyboardInteraction.prototype.getVerticalLeftRightCell = function (target, isRight) {\n    var date = new Date(+target.getAttribute('data-date'));\n    var start = new Date(date.getFullYear(), date.getMonth() + (isRight ? 1 : -1), 1);\n    var tableEle = this.parent.getContentTable();\n    var targetCell = tableEle.querySelector('[data-date=\"' + start.getTime() + '\"]');\n\n    if (targetCell.parentNode.sectionRowIndex > target.parentNode.sectionRowIndex) {\n      return targetCell;\n    }\n\n    return tableEle.querySelector('[data-date=\"' + new Date(start.getFullYear(), start.getMonth() + 1, 0).getTime() + '\"]');\n  };\n\n  KeyboardInteraction.prototype.calculateNextPrevDate = function (currentCell, target, type) {\n    var initialId = this.initialTarget.getAttribute('data-group-index');\n\n    if (this.parent.activeViewOptions.group.resources.length > 0 && this.parent.currentView === 'Month') {\n      if (currentCell && target && target.getAttribute('data-group-index') !== initialId) {\n        var currentDate = this.parent.getDateFromElement(currentCell);\n        var nextPrevDate = type === 'right' ? new Date(currentDate.setDate(currentDate.getDate() + 1)) : new Date(currentDate.setDate(currentDate.getDate() - 1));\n        target = [].slice.call(this.parent.element.querySelectorAll('td[data-date=\"' + nextPrevDate.getTime().toString() + '\"]' + '[data-group-index=\"' + initialId + '\"]'))[0];\n      }\n    }\n\n    return target;\n  };\n\n  KeyboardInteraction.prototype.getFocusableElements = function (container) {\n    var queryString = 'a[href]:not([tabindex=\"-1\"]),input:not([disabled]):not([tabindex=\"-1\"]),' + 'textarea:not([disabled]):not([tabindex=\"-1\"]),button:not([disabled]):not([tabindex=\"-1\"]),' + 'select:not([disabled]):not([tabindex=\"-1\"]),[tabindex]:not([tabindex=\"-1\"]),[contentEditable=true]:not([tabindex=\"-1\"])';\n    return [].slice.call(container.querySelectorAll(queryString));\n  };\n\n  KeyboardInteraction.prototype.processTabOnPopup = function (e, popupElement) {\n    var _this = this;\n\n    var focusableElements = this.getFocusableElements(popupElement);\n    focusableElements = focusableElements.filter(function (element) {\n      var footerEle = _this.parent.element.querySelector('.' + cls.POPUP_FOOTER_CLASS);\n\n      if (footerEle && footerEle.offsetParent) {\n        return !(element.classList.contains(cls.EDIT_CLASS) || element.classList.contains(cls.DELETE_CLASS));\n      } else {\n        return !(element.classList.contains(cls.EDIT_EVENT_CLASS) || element.classList.contains(cls.DELETE_EVENT_CLASS));\n      }\n    });\n    var firstEle = focusableElements[0];\n    var lastEle = focusableElements[focusableElements.length - 1];\n\n    if (!isNullOrUndefined(lastEle) && document.activeElement === lastEle && !e.shiftKey) {\n      e.preventDefault();\n      firstEle.focus();\n    }\n\n    if (!isNullOrUndefined(firstEle) && document.activeElement === firstEle && e.shiftKey) {\n      e.preventDefault();\n      lastEle.focus();\n    }\n  };\n\n  KeyboardInteraction.prototype.processTab = function (e, isReverse) {\n    var target = e.target;\n\n    if (target.classList.contains(cls.INLINE_SUBJECT_CLASS) && this.parent.inlineModule) {\n      target = target.closest('.e-appointment');\n      this.parent.inlineModule.inlineCrudActions(e.target);\n    }\n\n    if (this.parent.currentView === 'TimelineYear' && target.classList.contains(cls.OTHERMONTH_CLASS)) {\n      if (target.classList.contains(cls.SELECTED_CELL_CLASS)) {\n        this.parent.removeSelectedClass();\n      }\n\n      return;\n    }\n\n    var popupWrapper = closest(target, '.' + cls.POPUP_WRAPPER_CLASS + ',.' + cls.MORE_POPUP_WRAPPER_CLASS);\n\n    if (popupWrapper && popupWrapper.classList.contains(cls.POPUP_OPEN)) {\n      if (popupWrapper.classList.contains(cls.MORE_POPUP_WRAPPER_CLASS)) {\n        this.parent.eventBase.removeSelectedAppointmentClass();\n      }\n\n      this.processTabOnPopup(e, popupWrapper);\n      return;\n    }\n\n    if (target.classList.contains(cls.ROOT)) {\n      this.parent.eventBase.removeSelectedAppointmentClass();\n      return;\n    }\n\n    if (target.classList.contains(cls.RESOURCE_CELLS_CLASS) && this.parent.activeView.isTimelineView() && this.parent.activeViewOptions.group.resources.length > 0) {\n      var index = parseInt(target.getAttribute('data-group-index'), 10);\n      var appSelector = \".\" + cls.APPOINTMENT_CLASS + \"[data-group-index=\\\"\" + (isReverse ? index - 1 : index) + \"\\\"]\";\n      var appElements = [].slice.call(this.parent.element.querySelectorAll(appSelector));\n\n      if (appElements.length > 0) {\n        this.parent.eventBase.removeSelectedAppointmentClass();\n        var focusAppointment = isReverse ? appElements.slice(-1)[0] : appElements[0];\n        this.parent.eventBase.addSelectedAppointments([focusAppointment]);\n        focusAppointment.focus();\n        e.preventDefault();\n      } else if (index + 1 === this.parent.resourceBase.lastResourceLevel.length) {\n        this.parent.element.focus();\n        e.preventDefault();\n      } else if (this.parent.virtualScrollModule) {\n        var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n        var averageRowHeight = Math.round(virtual.offsetHeight / this.parent.resourceBase.expandedResources.length);\n        this.parent.element.querySelector('.e-content-wrap').scrollTop = (isReverse ? index - 1 : index + 1) * averageRowHeight;\n        this.parent.virtualScrollModule.virtualScrolling();\n      } else {\n        this.setScrollPosition(index);\n      }\n\n      return;\n    }\n\n    if (target.classList.contains(cls.APPOINTMENT_CLASS)) {\n      var appElements = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n      var isTimelineYear = this.parent.currentView === 'TimelineYear';\n      var isTimeline = this.parent.activeView.isTimelineView() && !isTimelineYear;\n\n      if ((isTimeline || isTimelineYear && this.parent.activeViewOptions.orientation === 'Vertical') && this.parent.activeViewOptions.group.resources.length > 0) {\n        var index = parseInt(target.getAttribute('data-group-index'), 10);\n        appElements = [].slice.call(this.parent.element.querySelectorAll(\".\" + cls.APPOINTMENT_CLASS + \"[data-group-index=\\\"\" + index + \"\\\"]\"));\n        var resCellSelector = \".\" + cls.RESOURCE_CELLS_CLASS + \"[data-group-index=\\\"\" + (isReverse ? index : index + 1) + \"\\\"]\";\n        var resourceCell = this.parent.element.querySelector(resCellSelector);\n\n        if (resourceCell && (isReverse && target.getAttribute('data-guid') === appElements[0].getAttribute('data-guid') || !isReverse && target.getAttribute('data-guid') === appElements.slice(-1)[0].getAttribute('data-guid'))) {\n          this.parent.eventBase.removeSelectedAppointmentClass();\n\n          if (this.parent.virtualScrollModule) {\n            resourceCell.focus({\n              preventScroll: true\n            });\n          } else {\n            resourceCell.focus();\n          }\n\n          if (this.parent.activeView.isTimelineView() && this.parent.activeViewOptions.group.resources.length > 0 && isNullOrUndefined(this.parent.virtualScrollModule)) {\n            this.setScrollPosition(index);\n          }\n\n          e.preventDefault();\n          return;\n        }\n      }\n\n      var selectedAppointments = this.parent.eventBase.getSelectedAppointments();\n\n      if (selectedAppointments.length > 0) {\n        target = selectedAppointments[selectedAppointments.length - 1];\n      }\n\n      this.parent.eventBase.removeSelectedAppointmentClass();\n\n      if (!isReverse && target.getAttribute('data-guid') === appElements[appElements.length - 1].getAttribute('data-guid') || isReverse && target.getAttribute('data-guid') === appElements[0].getAttribute('data-guid')) {\n        return;\n      }\n\n      if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n        this.selectAppointment(isReverse, target);\n        e.preventDefault();\n      }\n\n      return;\n    }\n\n    var selectedCells = this.parent.getSelectedElements();\n\n    if (selectedCells.length > 0 && !target.classList.contains(cls.APPOINTMENT_CLASS)) {\n      target = selectedCells[selectedCells.length - 1];\n      this.selectAppointmentElementFromWorkCell(isReverse, target);\n      e.preventDefault();\n      return;\n    }\n\n    if (target && !target.classList.contains(cls.RESOURCE_CELLS_CLASS) && this.parent.activeView.isTimelineView() && this.parent.activeViewOptions.group.resources.length > 0) {\n      this.processTabOnResourceCells(target, isReverse);\n    }\n  };\n\n  KeyboardInteraction.prototype.processDelete = function (e) {\n    var activeEle = document.activeElement;\n\n    if (this.parent.currentView === 'MonthAgenda') {\n      var selectedEle = this.parent.eventBase.getSelectedEvents().element;\n      activeEle = selectedEle && isNullOrUndefined(selectedEle.length) ? selectedEle : selectedEle[0];\n    }\n\n    if (activeEle && activeEle.classList.contains(cls.APPOINTMENT_CLASS)) {\n      addClass([activeEle], cls.APPOINTMENT_BORDER);\n      this.parent.activeEventData = this.parent.eventBase.getSelectedEvents();\n\n      if (this.parent.activeViewOptions.readonly || activeEle.classList.contains(cls.READ_ONLY) || !this.parent.eventSettings.allowDeleting) {\n        return;\n      }\n\n      this.parent.quickPopup.deleteClick(e);\n    }\n  };\n\n  KeyboardInteraction.prototype.processCtrlShiftNavigationArrows = function (e) {\n    if (this.parent.activeViewOptions.group.resources.length > 0 && document.activeElement.classList.contains(cls.APPOINTMENT_CLASS)) {\n      var groupIndex = parseInt(document.activeElement.getAttribute('data-group-index'), 10);\n      var index = e.action === 'ctrlShiftLeftArrow' || e.action === 'ctrlShiftUpArrow' ? groupIndex - 1 : groupIndex + 1;\n      index = index < 0 ? 0 : index > this.parent.resourceBase.lastResourceLevel.length ? this.parent.resourceBase.lastResourceLevel.length : index;\n      var eventEle = [];\n\n      while (eventEle.length === 0 && index >= 0 && index <= this.parent.resourceBase.lastResourceLevel.length) {\n        eventEle = [].slice.call(this.parent.element.querySelectorAll(\".\" + cls.APPOINTMENT_CLASS + \"[data-group-index=\\\"\" + index + \"\\\"]\"));\n        index = e.action === 'ctrlShiftLeftArrow' || e.action === 'ctrlShiftUpArrow' ? index - 1 : index + 1;\n      }\n\n      var nextAppEle = eventEle[0];\n\n      if (nextAppEle) {\n        this.parent.eventBase.removeSelectedAppointmentClass();\n        this.parent.eventBase.addSelectedAppointments([nextAppEle]);\n        nextAppEle.focus();\n      }\n    } else if (this.parent.activeViewOptions.group.resources.length > 0 && !document.activeElement.classList.contains(cls.APPOINTMENT_CLASS)) {\n      var index = this.parent.resourceBase.renderedResources[0].groupIndex;\n      var appSelector = \".\" + cls.APPOINTMENT_CLASS + \"[data-group-index=\\\"\" + index + \"\\\"]\";\n      var appElements = [].slice.call(this.parent.element.querySelectorAll(appSelector));\n\n      if (appElements.length > 0) {\n        this.parent.eventBase.removeSelectedAppointmentClass();\n        var focusAppointment = appElements[0];\n        this.parent.eventBase.addSelectedAppointments([focusAppointment]);\n        focusAppointment.focus();\n        e.preventDefault();\n      }\n    }\n  };\n\n  KeyboardInteraction.prototype.processEscape = function (event) {\n    this.parent.quickPopup.onClosePopup(event);\n    this.parent.quickPopup.morePopup.hide();\n\n    if (this.parent.headerModule) {\n      this.parent.headerModule.hideHeaderPopup();\n    }\n\n    if (this.parent.inlineModule) {\n      this.parent.inlineModule.removeInlineAppointmentElement();\n    }\n  };\n\n  KeyboardInteraction.prototype.isPreventAction = function (e) {\n    var target = closest(e.target, '.' + cls.RESOURCE_GROUP_CELLS_CLASS);\n\n    if (this.parent.activeView.isTimelineView() && !isNullOrUndefined(target)) {\n      return true;\n    }\n\n    return false;\n  };\n\n  KeyboardInteraction.prototype.processTabOnResourceCells = function (target, isReverse) {\n    var tabElements = [].slice.call(this.parent.element.querySelectorAll('[tabIndex=\"0\"]'));\n    var currentTabIndex = tabElements.indexOf(target);\n    var nextTabElement = !isReverse ? tabElements[currentTabIndex + 1] : tabElements[currentTabIndex - 1];\n\n    if (nextTabElement && nextTabElement.classList.contains(cls.RESOURCE_CELLS_CLASS)) {\n      var groupIndex = parseInt(nextTabElement.getAttribute('data-group-index'), 10);\n\n      if (this.parent.virtualScrollModule) {\n        var resColWrap_1 = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n        var resCells = [].slice.call(this.parent.element.querySelectorAll('.' + cls.RESOURCE_CELLS_CLASS));\n        resCells.forEach(function (element) {\n          if (element.getBoundingClientRect().top < resColWrap_1.getBoundingClientRect().top) {\n            element.setAttribute('tabindex', '-1');\n          }\n        });\n      } else {\n        this.setScrollPosition(groupIndex);\n      }\n    }\n  };\n\n  KeyboardInteraction.prototype.setScrollPosition = function (index) {\n    var workCell = this.parent.element.querySelector(\".\" + cls.WORK_CELLS_CLASS + \"[data-group-index=\\\"\" + index + \"\\\"]\");\n\n    if (workCell) {\n      this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS).scrollTop = workCell.offsetTop;\n    }\n  };\n  /**\n   * Get module name.\n   *\n   * @returns {string} Returns the module name.\n   */\n\n\n  KeyboardInteraction.prototype.getModuleName = function () {\n    return 'keyboard';\n  };\n  /**\n   * To destroy the keyboard module.\n   *\n   * @returns {void}\n   * @private\n   */\n\n\n  KeyboardInteraction.prototype.destroy = function () {\n    this.removeEventListener();\n    this.keyboardModule.destroy();\n  };\n\n  return KeyboardInteraction;\n}();\n\nexport { KeyboardInteraction };","map":{"version":3,"names":["KeyboardEvents","closest","EventHandler","extend","isNullOrUndefined","addClass","removeClass","event","util","cls","KeyboardInteraction","parent","selectedCells","keyConfigs","downArrow","upArrow","rightArrow","leftArrow","shiftDownArrow","shiftUpArrow","shiftRightArrow","shiftLeftArrow","ctrlLeftArrow","ctrlRightArrow","altOne","altTwo","altThree","altFour","altFive","altSix","altSeven","altEight","altNine","enter","escape","delete","home","pageUp","pageDown","tab","shiftTab","ctrlShiftUpArrow","ctrlShiftDownArrow","ctrlShiftLeftArrow","ctrlShiftRightArrow","element","tabIndex","keyboardModule","keyAction","keyActionHandler","bind","eventName","addEventListener","prototype","e","action","processDown","shiftKey","processUp","processLeft","processRight","changeDate","activeView","getNextPreviousDate","headerModule","querySelector","focus","processViewNavigation","processEnter","focusFirstCell","processTab","processDelete","processCtrlShiftNavigationArrows","processEscape","allowInline","inlineModule","preventDefault","processFTwelve","target","classList","contains","WORK_CELLS_CLASS","ALLDAY_CELLS_CLASS","activeCellsData","getSelectedElements","args","cancel","inlineArgs","groupIndex","type","notify","inlineClick","APPOINTMENT_CLASS","click","on","cellMouseDown","onCellMouseDown","removeEventListener","off","initialTarget","getClosestCell","activeViewOptions","readonly","currentView","which","removeSelectedClass","add","getContentTable","onMouseSelection","onMoveUp","allDayRow","getAllDayRow","appointments","slice","call","querySelectorAll","selectionEdges","boundaryValidation","pageY","pageX","bottom","top","left","right","parent_1","CONTENT_WRAP_CLASS","yInBounds","offsetHeight","scrollHeight","scrollTop","xInBounds","offsetWidth","scrollWidth","scrollLeft","selectCells","_this","remove","isPreventAction","queryStr","HEADER_CELLS_CLASS","OTHERMONTH_CLASS","cellData","eventWindow","convertToEventData","data","requestType","showQuickPopup","trigger","select","selectArgs","isPopupShow","quickInfoOnSelectionEnd","length","cellArgs","name","cellClick","POPUP_WRAPPER_CLASS","QUICK_POPUP_EVENT_DETAILS_CLASS","EVENT_CREATE_CLASS","EDIT_EVENT_CLASS","DELETE_EVENT_CLASS","CLOSE_CLASS","SUBJECT_CLASS","RESOURCE_CELLS_CLASS","RESOURCE_PARENT_CLASS","resourceIcon","RESOURCE_TREE_ICON_CLASS","INLINE_SUBJECT_CLASS","inlineCrudActions","MORE_EVENT_CLOSE_CLASS","ALLDAY_APPOINTMENT_SECTION_CLASS","MORE_INDICATOR_CLASS","MORE_EVENT_HEADER_DATE_CLASS","setProperties","selectedDate","getDateFromElement","changeView","getNavigateView","cellDetails","SELECTED_CELL_CLASS","start","getCellDetails","end","endTime","getCells","isInverseTable","tableEle","isTimelineYear","query","cells","maxRow","rows","maxColumn","startIndex","indexOf","endIndex","inverseCells","i","j","cell","push","temp","sCells","focusCell","AGENDA_CELLS_CLASS","setAttribute","eventBase","removeSelectedAppointmentClass","isTimelineView","CONTENT_TABLE_CLASS","HIDDEN_CLASS","RESOURCE_GROUP_CELLS_CLASS","isVerticalYear","orientation","startDate","getTime","getWorkCellElements","isInverseTableSelect","isMultiple","targetCell","Array","initialId_1","views_1","allowMultipleRow","removeInlineAppointmentElement","allowMultiRowSelection","isGroupYear","group","resources","parentElement","children","cellIndex","getAttribute","resourceSelectedCells","_i","selectedCells_1","allowMultiCellSelection","allDayCells","getAllDayCells","resourceAllDayCells","_a","allDayCells_1","concat","addSelectedClass","selectAppointment","isReverse","getAppointmentElements","nextAppEle","targetIndex","addSelectedAppointments","AGENDA_SELECTED_CELL","selectAppointmentElementFromWorkCell","appointmentElements_1","getUniqueAppointmentElements","filteredElements_1","selectedDate_1","selectedSeriesEvents","eventsProcessed","filter","eventObject","eventFields","startTime","JSON","stringify","Guid","selectedElement","focusElements","getAppointmentElementsByGuid","startCell","endCell","MS_PER_DAY","guid","appointmentElements","map","value","index","self","getWorkCellFromAppointmentElement","selectedObject","getEventByGuid","selectWorkCellByTime","parseInt","key","views","view","viewCollections","option","undefined","cancelUpDownAction","isGroup","selectedElements","selectedEventElements","getSelectedAppointments","moreEventWrapper","MORE_POPUP_WRAPPER_CLASS","quickPopupWrapper","getQuickPopupElement","POPUP_OPEN","tableRows","getTableRows","curRowIndex","getVerticalUpDownCell","getHorizontalUpDownCell","getStartDate","getYearUpDownCell","getEndDate","rowIndex","isUp","row","workCell","date","Date","getFullYear","getMonth","hasRow","column","dateAttr","processLeftRight","parentNode","sectionRowIndex","columnIndex","maxIndex","isAdaptive","document","body","isCancelLeftRightAction","prevent","selectedAppointments","targetDate","isMonthEnd","lastDateOfMonth","calculateNextPrevDate","getTimelineYearTargetCell","changeTargetCell","getHorizontalLeftRightCell","curColIndex","maxColIndex","allDayRow_1","isMonthStart","firstDateOfMonth","otherMonthCell","tbody","item","allDayRow_2","isRight","getVerticalLeftRightCell","currentCell","initialId","currentDate","nextPrevDate","setDate","getDate","toString","getFocusableElements","container","queryString","processTabOnPopup","popupElement","focusableElements","footerEle","POPUP_FOOTER_CLASS","offsetParent","EDIT_CLASS","DELETE_CLASS","firstEle","lastEle","activeElement","popupWrapper","ROOT","appSelector","appElements","focusAppointment","resourceBase","lastResourceLevel","virtualScrollModule","virtual","VIRTUAL_TRACK_CLASS","averageRowHeight","Math","round","expandedResources","virtualScrolling","setScrollPosition","isTimeline","resCellSelector","resourceCell","preventScroll","processTabOnResourceCells","activeEle","selectedEle","getSelectedEvents","APPOINTMENT_BORDER","activeEventData","READ_ONLY","eventSettings","allowDeleting","quickPopup","deleteClick","eventEle","renderedResources","onClosePopup","morePopup","hide","hideHeaderPopup","tabElements","currentTabIndex","nextTabElement","resColWrap_1","RESOURCE_COLUMN_WRAP_CLASS","resCells","forEach","getBoundingClientRect","offsetTop","getModuleName","destroy"],"sources":["C:/Users/shahj/OneDrive/Documents/GitHub/Multifunctional-React-Dashboard/node_modules/@syncfusion/ej2-schedule/src/schedule/actions/keyboard.js"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { KeyboardEvents, closest, EventHandler, extend } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, addClass, removeClass } from '@syncfusion/ej2-base';\nimport * as event from '../base/constant';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\n/**\n * Keyboard interaction\n */\nvar KeyboardInteraction = /** @class */ (function () {\n    function KeyboardInteraction(parent) {\n        this.selectedCells = [];\n        this.keyConfigs = {\n            downArrow: 'downarrow',\n            upArrow: 'uparrow',\n            rightArrow: 'rightarrow',\n            leftArrow: 'leftarrow',\n            shiftDownArrow: 'shift+downarrow',\n            shiftUpArrow: 'shift+uparrow',\n            shiftRightArrow: 'shift+rightarrow',\n            shiftLeftArrow: 'shift+leftarrow',\n            ctrlLeftArrow: 'ctrl+leftarrow',\n            ctrlRightArrow: 'ctrl+rightarrow',\n            altOne: 'alt+1',\n            altTwo: 'alt+2',\n            altThree: 'alt+3',\n            altFour: 'alt+4',\n            altFive: 'alt+5',\n            altSix: 'alt+6',\n            altSeven: 'alt+7',\n            altEight: 'alt+8',\n            altNine: 'alt+9',\n            enter: 'enter',\n            escape: 'escape',\n            delete: 'delete',\n            home: 'home',\n            pageUp: 'pageup',\n            pageDown: 'pagedown',\n            tab: 'tab',\n            shiftTab: 'shift+tab',\n            ctrlShiftUpArrow: 'ctrl+shift+uparrow',\n            ctrlShiftDownArrow: 'ctrl+shift+downarrow',\n            ctrlShiftLeftArrow: 'ctrl+shift+leftarrow',\n            ctrlShiftRightArrow: 'ctrl+shift+rightarrow'\n        };\n        this.parent = parent;\n        this.parent.element.tabIndex = this.parent.element.tabIndex === -1 ? 0 : this.parent.element.tabIndex;\n        this.keyboardModule = new KeyboardEvents(this.parent.element, {\n            keyAction: this.keyActionHandler.bind(this),\n            keyConfigs: this.keyConfigs,\n            eventName: 'keydown'\n        });\n        this.addEventListener();\n    }\n    KeyboardInteraction.prototype.keyActionHandler = function (e) {\n        switch (e.action) {\n            case 'downArrow':\n            case 'shiftDownArrow':\n                this.processDown(e, e.shiftKey);\n                break;\n            case 'upArrow':\n            case 'shiftUpArrow':\n                this.processUp(e, e.shiftKey);\n                break;\n            case 'leftArrow':\n            case 'shiftLeftArrow':\n                this.processLeft(e, e.shiftKey);\n                break;\n            case 'rightArrow':\n            case 'shiftRightArrow':\n                this.processRight(e, e.shiftKey);\n                break;\n            case 'ctrlLeftArrow':\n                this.parent.changeDate(this.parent.activeView.getNextPreviousDate('previous'), e);\n                if (this.parent.headerModule) {\n                    this.parent.headerModule.element.querySelector('.e-prev button').focus();\n                }\n                break;\n            case 'ctrlRightArrow':\n                this.parent.changeDate(this.parent.activeView.getNextPreviousDate('next'), e);\n                if (this.parent.headerModule) {\n                    this.parent.headerModule.element.querySelector('.e-next button').focus();\n                }\n                break;\n            case 'altOne':\n            case 'altTwo':\n            case 'altThree':\n            case 'altFour':\n            case 'altFive':\n            case 'altSix':\n            case 'altSeven':\n            case 'altEight':\n            case 'altNine':\n                this.processViewNavigation(e);\n                break;\n            case 'enter':\n                this.processEnter(e);\n                break;\n            case 'home':\n                this.focusFirstCell();\n                break;\n            case 'tab':\n            case 'shiftTab':\n                this.processTab(e, e.shiftKey);\n                break;\n            case 'delete':\n                this.processDelete(e);\n                break;\n            case 'ctrlShiftUpArrow':\n            case 'ctrlShiftDownArrow':\n            case 'ctrlShiftLeftArrow':\n            case 'ctrlShiftRightArrow':\n                this.processCtrlShiftNavigationArrows(e);\n                break;\n            case 'escape':\n                this.processEscape(e);\n                break;\n            case 'fTwelve':\n                if (this.parent.allowInline && this.parent.inlineModule) {\n                    e.preventDefault();\n                    this.processFTwelve(e);\n                }\n                break;\n        }\n    };\n    KeyboardInteraction.prototype.processFTwelve = function (e) {\n        var target = e.target;\n        if (target.classList.contains(cls.WORK_CELLS_CLASS) || target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            this.parent.activeCellsData = this.getSelectedElements(target);\n            var args = extend(this.parent.activeCellsData, { cancel: false, event: e });\n            var inlineArgs = {\n                element: args.element,\n                groupIndex: args.groupIndex, type: 'Cell'\n            };\n            this.parent.notify(event.inlineClick, inlineArgs);\n        }\n        if (target.classList.contains(cls.APPOINTMENT_CLASS)) {\n            target.click();\n            return;\n        }\n    };\n    KeyboardInteraction.prototype.addEventListener = function () {\n        this.parent.on(event.cellMouseDown, this.onCellMouseDown, this);\n    };\n    KeyboardInteraction.prototype.removeEventListener = function () {\n        this.parent.off(event.cellMouseDown, this.onCellMouseDown);\n    };\n    KeyboardInteraction.prototype.onCellMouseDown = function (e) {\n        if (e.event.shiftKey) {\n            return;\n        }\n        this.initialTarget = this.getClosestCell(e.event);\n        if (this.parent.activeViewOptions.readonly || this.parent.currentView === 'MonthAgenda' || !this.initialTarget) {\n            return;\n        }\n        if (e.event.target.classList.contains(cls.WORK_CELLS_CLASS) && e.event.which !== 3) {\n            this.parent.removeSelectedClass();\n            EventHandler.add(this.parent.getContentTable(), 'mousemove', this.onMouseSelection, this);\n            EventHandler.add(this.parent.getContentTable(), 'mouseup', this.onMoveUp, this);\n        }\n        if (e.event.target.classList.contains(cls.ALLDAY_CELLS_CLASS) && e.event.which !== 3) {\n            this.parent.removeSelectedClass();\n            var allDayRow = this.parent.getAllDayRow();\n            EventHandler.add(allDayRow, 'mousemove', this.onMouseSelection, this);\n            EventHandler.add(allDayRow, 'mouseup', this.onMoveUp, this);\n        }\n    };\n    KeyboardInteraction.prototype.onMouseSelection = function (e) {\n        var appointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n        addClass(appointments, 'e-allow-select');\n        var selectionEdges = this.parent.boundaryValidation(e.pageY, e.pageX);\n        if (selectionEdges.bottom || selectionEdges.top || selectionEdges.left || selectionEdges.right) {\n            var parent_1 = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS);\n            var yInBounds = parent_1.offsetHeight <= parent_1.scrollHeight && parent_1.scrollTop >= 0 &&\n                parent_1.scrollTop + parent_1.offsetHeight <= parent_1.scrollHeight;\n            var xInBounds = parent_1.offsetWidth <= parent_1.scrollWidth && parent_1.scrollLeft >= 0 &&\n                parent_1.scrollLeft + parent_1.offsetWidth <= parent_1.scrollWidth;\n            if (yInBounds && (selectionEdges.top || selectionEdges.bottom)) {\n                parent_1.scrollTop += selectionEdges.top ? -e.target.offsetHeight : e.target.offsetHeight;\n            }\n            if (xInBounds && (selectionEdges.left || selectionEdges.right)) {\n                parent_1.scrollLeft += selectionEdges.left ? -e.target.offsetWidth : e.target.offsetWidth;\n            }\n        }\n        var target = this.getClosestCell(e);\n        if (target) {\n            this.selectCells(true, target);\n        }\n    };\n    KeyboardInteraction.prototype.getClosestCell = function (e) {\n        return closest(e.target, '.' + cls.WORK_CELLS_CLASS + ',.' + cls.ALLDAY_CELLS_CLASS);\n    };\n    KeyboardInteraction.prototype.onMoveUp = function (e) {\n        var _this = this;\n        var appointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n        removeClass(appointments, 'e-allow-select');\n        if (e.target.classList.contains(cls.WORK_CELLS_CLASS)) {\n            EventHandler.remove(this.parent.getContentTable(), 'mousemove', this.onMouseSelection);\n            EventHandler.remove(this.parent.getContentTable(), 'mouseup', this.onMoveUp);\n        }\n        if (e.target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            var allDayRow = this.parent.getAllDayRow();\n            EventHandler.remove(allDayRow, 'mousemove', this.onMouseSelection);\n            EventHandler.remove(allDayRow, 'mouseup', this.onMoveUp);\n        }\n        if (this.isPreventAction(e)) {\n            return;\n        }\n        var queryStr = '.' + cls.WORK_CELLS_CLASS + ',.' + cls.ALLDAY_CELLS_CLASS + ',.' + cls.HEADER_CELLS_CLASS;\n        var target = closest(e.target, queryStr);\n        if (this.parent.currentView === 'TimelineYear' && target.classList.contains(cls.OTHERMONTH_CLASS)) {\n            return;\n        }\n        this.parent.activeCellsData = this.getSelectedElements(target);\n        var cellData = {};\n        if (this.parent.eventWindow) {\n            this.parent.eventWindow.convertToEventData(this.parent.activeCellsData, cellData);\n        }\n        var selectedCells = this.parent.getSelectedElements();\n        var args = {\n            data: cellData, element: this.parent.activeCellsData.element, event: e,\n            requestType: 'cellSelect', showQuickPopup: false\n        };\n        this.parent.trigger(event.select, args, function (selectArgs) {\n            var isPopupShow = selectArgs.showQuickPopup || _this.parent.quickInfoOnSelectionEnd;\n            if (isPopupShow && selectedCells.length > 1) {\n                var cellArgs = extend(_this.parent.activeCellsData, { cancel: false, event: e, name: 'cellClick' });\n                _this.parent.notify(event.cellClick, cellArgs);\n            }\n        });\n    };\n    KeyboardInteraction.prototype.processEnter = function (e) {\n        if ((this.parent.activeViewOptions.readonly && !e.target.classList.contains(cls.APPOINTMENT_CLASS))\n            || this.isPreventAction(e)) {\n            return;\n        }\n        if (this.parent.currentView === 'TimelineYear' && e.target.classList.contains(cls.OTHERMONTH_CLASS)) {\n            return;\n        }\n        var target = e.target;\n        if (closest(target, '.' + cls.POPUP_WRAPPER_CLASS)) {\n            if (target.classList.contains(cls.QUICK_POPUP_EVENT_DETAILS_CLASS) ||\n                target.classList.contains(cls.EVENT_CREATE_CLASS) ||\n                target.classList.contains(cls.EDIT_EVENT_CLASS) ||\n                target.classList.contains(cls.DELETE_EVENT_CLASS) ||\n                target.classList.contains(cls.CLOSE_CLASS)) {\n                target.click();\n                e.preventDefault();\n            }\n            else if (target.classList.contains(cls.SUBJECT_CLASS)) {\n                this.parent.element.querySelector('.' + cls.EVENT_CREATE_CLASS).click();\n                e.preventDefault();\n            }\n            return;\n        }\n        if (target.classList.contains(cls.RESOURCE_CELLS_CLASS) && target.classList.contains(cls.RESOURCE_PARENT_CLASS)) {\n            var resourceIcon = target.querySelector('.' + cls.RESOURCE_TREE_ICON_CLASS);\n            if (resourceIcon) {\n                resourceIcon.click();\n            }\n            return;\n        }\n        if (target.classList.contains(cls.WORK_CELLS_CLASS) || target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            this.parent.activeCellsData = this.getSelectedElements(target);\n            var args = extend(this.parent.activeCellsData, { cancel: false, event: e });\n            if (this.parent.allowInline) {\n                var inlineArgs = {\n                    element: args.element,\n                    groupIndex: args.groupIndex, type: 'Cell'\n                };\n                this.parent.notify(event.inlineClick, inlineArgs);\n            }\n            else {\n                if (this.parent.currentView === 'Year') {\n                    target.click();\n                }\n                else {\n                    this.parent.notify(event.cellClick, args);\n                }\n            }\n            return;\n        }\n        if (target.classList.contains(cls.INLINE_SUBJECT_CLASS) && this.parent.inlineModule) {\n            this.parent.inlineModule.inlineCrudActions(target);\n            return;\n        }\n        if (target.classList.contains(cls.APPOINTMENT_CLASS) || target.classList.contains(cls.MORE_EVENT_CLOSE_CLASS) ||\n            target.classList.contains(cls.ALLDAY_APPOINTMENT_SECTION_CLASS) || target.classList.contains(cls.MORE_INDICATOR_CLASS)) {\n            target.click();\n            return;\n        }\n        if (target.classList.contains(cls.MORE_EVENT_HEADER_DATE_CLASS)) {\n            this.parent.setProperties({ selectedDate: this.parent.getDateFromElement(target) }, true);\n            this.parent.changeView(this.parent.getNavigateView(), e);\n            this.processEscape(e);\n            return;\n        }\n    };\n    KeyboardInteraction.prototype.getSelectedElements = function (target) {\n        var cellDetails;\n        if (this.selectedCells.length > 1 && target.classList.contains(cls.SELECTED_CELL_CLASS)) {\n            var start = this.parent.getCellDetails(this.selectedCells[0]);\n            var end = this.parent.getCellDetails(this.selectedCells.slice(-1)[0]);\n            start.endTime = end.endTime;\n            start.element = target;\n            cellDetails = start;\n        }\n        else {\n            cellDetails = this.parent.getCellDetails(target);\n        }\n        return cellDetails;\n    };\n    KeyboardInteraction.prototype.getCells = function (isInverseTable, start, end) {\n        var tableEle = this.parent.getContentTable();\n        var isTimelineYear = this.parent.currentView === 'TimelineYear';\n        var query = isTimelineYear && !isInverseTable ? '.' + cls.WORK_CELLS_CLASS + ':not(.' + cls.OTHERMONTH_CLASS + ')' : 'td';\n        var cells = [].slice.call(tableEle.querySelectorAll(query));\n        var maxRow = tableEle.rows.length;\n        var maxColumn = tableEle.rows[0].cells.length;\n        if (start && start.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            var allDayRow = this.parent.getAllDayRow();\n            cells = [].slice.call(allDayRow.cells);\n            maxRow = 1;\n            maxColumn = allDayRow.cells.length;\n        }\n        var startIndex = cells.indexOf(start);\n        var endIndex = cells.indexOf(end);\n        var inverseCells = [];\n        if (isInverseTable) {\n            for (var i = 0; i < maxColumn; i++) {\n                for (var j = 0; j < maxRow; j++) {\n                    var cell = cells[maxColumn * j + i];\n                    if (isTimelineYear && cell.classList.contains(cls.OTHERMONTH_CLASS)) {\n                        continue;\n                    }\n                    inverseCells.push(cell);\n                }\n            }\n            startIndex = inverseCells.indexOf(start);\n            endIndex = inverseCells.indexOf(end);\n        }\n        if (startIndex > endIndex) {\n            var temp = startIndex;\n            startIndex = endIndex;\n            endIndex = temp;\n        }\n        var sCells = isInverseTable ? inverseCells : cells;\n        return sCells.slice(startIndex, endIndex + 1);\n    };\n    KeyboardInteraction.prototype.focusFirstCell = function () {\n        if (this.parent.currentView === 'Agenda') {\n            var focusCell = this.parent.getContentTable().querySelector('.' + cls.AGENDA_CELLS_CLASS);\n            focusCell.setAttribute('tabindex', '0');\n            focusCell.focus();\n            return;\n        }\n        this.parent.eventBase.removeSelectedAppointmentClass();\n        if (this.parent.activeView.isTimelineView() && this.parent.currentView !== 'TimelineYear') {\n            var cell = this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS +\n                ' tr:not(.' + cls.HIDDEN_CLASS + ') .' + cls.WORK_CELLS_CLASS + ':not(.' + cls.RESOURCE_GROUP_CELLS_CLASS + ')');\n            this.selectCells(false, cell);\n        }\n        else if (this.parent.currentView.indexOf('Year') > -1) {\n            var query = '.' + cls.WORK_CELLS_CLASS + ':not(.' + cls.OTHERMONTH_CLASS + ')' + ':not(.' + cls.RESOURCE_GROUP_CELLS_CLASS + ')';\n            var isVerticalYear = this.parent.currentView === 'TimelineYear' && this.parent.activeViewOptions.orientation === 'Vertical';\n            query += isVerticalYear ? '[data-date=\"' + this.parent.activeView.startDate().getTime() + '\"]' : '';\n            this.selectCells(false, this.parent.element.querySelector(query));\n        }\n        else {\n            this.selectCells(false, this.parent.getWorkCellElements()[0]);\n        }\n    };\n    KeyboardInteraction.prototype.isInverseTableSelect = function () {\n        return this.parent.activeView.isInverseTableSelect;\n    };\n    /**\n     * Internal method to select cells\n     *\n     * @param {boolean} isMultiple Accepts to select multiple cells or not\n     * @param {HTMLTableCellElement} targetCell Accepts the target cells\n     * @returns {void}\n     * @private\n     */\n    KeyboardInteraction.prototype.selectCells = function (isMultiple, targetCell) {\n        var _this = this;\n        this.parent.removeSelectedClass();\n        var target = (targetCell instanceof Array) ? targetCell.slice(-1)[0] : targetCell;\n        if (isMultiple) {\n            var initialId_1;\n            var views_1 = ['Day', 'Week', 'WorkWeek', 'TimelineDay', 'TimelineWeek', 'TimelineWorkWeek', 'TimelineMonth', 'TimelineYear'];\n            var args = { element: targetCell, requestType: 'mousemove', allowMultipleRow: true };\n            this.parent.inlineModule.removeInlineAppointmentElement();\n            this.parent.trigger(event.select, args, function (selectArgs) {\n                var allowMultipleRow = (!selectArgs.allowMultipleRow) || (!_this.parent.allowMultiRowSelection);\n                if (allowMultipleRow) {\n                    var isTimelineYear = _this.parent.currentView === 'TimelineYear';\n                    if (isTimelineYear && _this.parent.activeViewOptions.orientation === 'Horizontal' || _this.parent.currentView === 'Month') {\n                        var isGroupYear = isTimelineYear && _this.parent.activeViewOptions.group.resources.length > 0;\n                        target = isGroupYear ? _this.initialTarget :\n                            _this.initialTarget.parentElement.children[target.cellIndex];\n                    }\n                    else if (views_1.indexOf(_this.parent.currentView) > -1) {\n                        target = target.parentElement.children[_this.initialTarget.cellIndex];\n                    }\n                }\n                var selectedCells = _this.getCells(_this.isInverseTableSelect(), _this.initialTarget, target);\n                if (_this.parent.activeViewOptions.group.resources.length > 0) {\n                    initialId_1 = _this.initialTarget.getAttribute('data-group-index');\n                    var resourceSelectedCells = [];\n                    for (var _i = 0, selectedCells_1 = selectedCells; _i < selectedCells_1.length; _i++) {\n                        var cell = selectedCells_1[_i];\n                        if (cell.getAttribute('data-group-index') === initialId_1) {\n                            resourceSelectedCells.push(cell);\n                        }\n                    }\n                    selectedCells = resourceSelectedCells;\n                }\n                if (!_this.parent.allowMultiCellSelection) {\n                    selectedCells = [_this.initialTarget];\n                }\n                _this.selectedCells = selectedCells;\n                if (selectedCells.length > 2 && !target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n                    var allDayCells = _this.getAllDayCells(selectedCells);\n                    if (_this.parent.activeViewOptions.group.resources.length > 0) {\n                        var resourceAllDayCells = [];\n                        for (var _a = 0, allDayCells_1 = allDayCells; _a < allDayCells_1.length; _a++) {\n                            var cell = allDayCells_1[_a];\n                            if (cell.getAttribute('data-group-index') === initialId_1) {\n                                resourceAllDayCells.push(cell);\n                            }\n                        }\n                        allDayCells = resourceAllDayCells;\n                    }\n                    selectedCells = selectedCells.concat(allDayCells);\n                }\n                if ((target.getAttribute('data-group-index') !== initialId_1) && _this.parent.activeViewOptions.group.resources.length > 0) {\n                    target = _this.selectedCells[_this.selectedCells.length - 1];\n                }\n                _this.parent.addSelectedClass(selectedCells, target);\n            });\n        }\n        else {\n            this.initialTarget = target;\n            this.selectedCells = [target];\n            this.parent.addSelectedClass([target], target);\n        }\n    };\n    KeyboardInteraction.prototype.selectAppointment = function (isReverse, target) {\n        var appointments = this.getAppointmentElements();\n        if (appointments.length < 0) {\n            return;\n        }\n        this.parent.eventBase.removeSelectedAppointmentClass();\n        var nextAppEle;\n        if (target.classList.contains(cls.APPOINTMENT_CLASS)) {\n            var targetIndex = appointments.indexOf(target);\n            nextAppEle = appointments[(isReverse ? targetIndex - 1 : targetIndex + 1)];\n        }\n        else {\n            nextAppEle = isReverse ? appointments[appointments.length - 1] : appointments[0];\n        }\n        if (nextAppEle) {\n            this.parent.eventBase.addSelectedAppointments([nextAppEle]);\n            nextAppEle.focus();\n            addClass([nextAppEle], cls.AGENDA_SELECTED_CELL);\n        }\n    };\n    KeyboardInteraction.prototype.selectAppointmentElementFromWorkCell = function (isReverse, target) {\n        var _this = this;\n        this.parent.eventBase.removeSelectedAppointmentClass();\n        this.parent.removeSelectedClass();\n        if (target.classList.contains(cls.WORK_CELLS_CLASS) || target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            var appointmentElements_1 = this.getUniqueAppointmentElements();\n            var filteredElements_1 = [];\n            var selectedDate_1 = this.parent.getDateFromElement(target).getTime();\n            var selectedSeriesEvents = this.parent.eventsProcessed.filter(function (eventObject) {\n                return (!isReverse ? (eventObject[_this.parent.eventFields.startTime].getTime() >= selectedDate_1) :\n                    (eventObject[_this.parent.eventFields.startTime].getTime() <= selectedDate_1));\n            });\n            selectedSeriesEvents.filter(function (event) {\n                appointmentElements_1.filter(function (element) {\n                    if (JSON.stringify(event.Guid) === JSON.stringify(element.getAttribute('data-guid'))) {\n                        filteredElements_1.push(element);\n                    }\n                });\n            });\n            if (filteredElements_1.length > 0) {\n                var selectedElement = isReverse ? filteredElements_1[filteredElements_1.length - 1] : filteredElements_1[0];\n                var focusElements = this.getAppointmentElementsByGuid(selectedElement.getAttribute('data-guid'));\n                this.parent.eventBase.addSelectedAppointments(focusElements);\n                (focusElements[focusElements.length - 1]).focus();\n            }\n        }\n    };\n    KeyboardInteraction.prototype.getAllDayCells = function (cells) {\n        var allDayRow = this.parent.getAllDayRow();\n        if (!allDayRow) {\n            return [];\n        }\n        var startCell = cells[0];\n        var endCell = cells[cells.length - 1];\n        var start = this.parent.getCellDetails(startCell);\n        var end = this.parent.getCellDetails(endCell);\n        if (end.endTime.getTime() - start.startTime.getTime() >= util.MS_PER_DAY) {\n            var allDayCells = [].slice.call(allDayRow.cells);\n            return allDayCells.slice(startCell.cellIndex, endCell.cellIndex + 1);\n        }\n        return [];\n    };\n    KeyboardInteraction.prototype.getAppointmentElements = function () {\n        return [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n    };\n    KeyboardInteraction.prototype.getAppointmentElementsByGuid = function (guid) {\n        return [].slice.call(this.parent.element.querySelectorAll('div[data-guid=\"' + guid + '\"]'));\n    };\n    KeyboardInteraction.prototype.getUniqueAppointmentElements = function () {\n        var appointments = this.getAppointmentElements();\n        var appointmentElements = [];\n        appointments.map(function (value) { return value.getAttribute('data-guid'); }).filter(function (value, index, self) {\n            if (self.indexOf(value) === index) {\n                appointmentElements.push(appointments[index]);\n            }\n        });\n        return appointmentElements;\n    };\n    KeyboardInteraction.prototype.getWorkCellFromAppointmentElement = function (target) {\n        var selectedObject = this.parent.eventBase.getEventByGuid(target.getAttribute('data-guid'));\n        return this.parent.eventBase.selectWorkCellByTime([selectedObject]);\n    };\n    KeyboardInteraction.prototype.processViewNavigation = function (e) {\n        var index = parseInt(e.key, 10) - 1;\n        if (index < this.parent.views.length) {\n            var view = this.parent.viewCollections[index].option;\n            this.parent.changeView(view, e, undefined, index);\n            if (this.parent.headerModule) {\n                this.parent.headerModule.element.querySelector('.e-active-view button').focus();\n            }\n        }\n    };\n    KeyboardInteraction.prototype.cancelUpDownAction = function (isTimelineYear) {\n        var isVerticalYear = isTimelineYear && this.parent.activeViewOptions.orientation === 'Vertical';\n        var isGroup = this.parent.activeViewOptions.group.resources.length > 0;\n        if (isVerticalYear && isGroup || isTimelineYear && this.initialTarget.classList.contains(cls.OTHERMONTH_CLASS)) {\n            return true;\n        }\n        if (this.parent.activeView.isTimelineView() && !isTimelineYear || this.parent.currentView === 'MonthAgenda') {\n            return true;\n        }\n        return false;\n    };\n    KeyboardInteraction.prototype.processUp = function (e, isMultiple) {\n        var isTimelineYear = this.parent.currentView === 'TimelineYear';\n        if (isMultiple && this.cancelUpDownAction(isTimelineYear)) {\n            return;\n        }\n        var target = (e.target);\n        var selectedElements = this.parent.getSelectedElements();\n        var selectedEventElements = this.parent.eventBase.getSelectedAppointments();\n        var moreEventWrapper = this.parent.element.querySelector('.' + cls.MORE_POPUP_WRAPPER_CLASS);\n        var quickPopupWrapper = this.getQuickPopupElement();\n        if (selectedElements.length > 0 && !e.target.classList.contains(cls.WORK_CELLS_CLASS)) {\n            target = selectedElements[selectedElements.length - 1];\n        }\n        if (selectedEventElements.length > 0 && !moreEventWrapper.classList.contains(cls.POPUP_OPEN) &&\n            !quickPopupWrapper.classList.contains(cls.POPUP_OPEN) &&\n            ['Day', 'Week', 'WorkWeek', 'Month'].indexOf(this.parent.currentView) !== -1) {\n            target = this.getWorkCellFromAppointmentElement(selectedEventElements[selectedEventElements.length - 1]);\n            this.parent.eventBase.removeSelectedAppointmentClass();\n        }\n        if (!target) {\n            return;\n        }\n        if (target.classList.contains(cls.WORK_CELLS_CLASS) && !this.parent.element.querySelector('.' + cls.POPUP_OPEN)) {\n            var tableRows = this.parent.getTableRows();\n            var curRowIndex = tableRows.indexOf(target.parentElement);\n            var targetCell = void 0;\n            if (isTimelineYear && isMultiple && this.parent.activeViewOptions.group.resources.length === 0) {\n                targetCell = this.isInverseTableSelect() ? this.getVerticalUpDownCell(tableRows, target, curRowIndex, true) :\n                    this.getHorizontalUpDownCell(tableRows, target, curRowIndex, true);\n            }\n            if ((curRowIndex > 0 || targetCell) && curRowIndex < tableRows.length) {\n                targetCell = targetCell ? targetCell : (tableRows[curRowIndex - 1]).cells[target.cellIndex];\n                if (this.parent.currentView === 'Year' && targetCell.classList.contains(cls.OTHERMONTH_CLASS)) {\n                    if (this.parent.activeView.getStartDate().getTime() < +targetCell.getAttribute('data-date')) {\n                        targetCell = this.getYearUpDownCell(tableRows, curRowIndex - 1, target.cellIndex, true);\n                    }\n                    else {\n                        return;\n                    }\n                }\n                this.selectCells(isMultiple, targetCell);\n            }\n        }\n        else if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n            this.selectAppointment(true, target);\n        }\n    };\n    KeyboardInteraction.prototype.processDown = function (e, isMultiple) {\n        var isTimelineYear = this.parent.currentView === 'TimelineYear';\n        if (isMultiple && this.cancelUpDownAction(isTimelineYear)) {\n            return;\n        }\n        var target = (e.target);\n        var selectedCells = this.parent.getSelectedElements();\n        var selectedElements = this.parent.eventBase.getSelectedAppointments();\n        var moreEventWrapper = this.parent.element.querySelector('.' + cls.MORE_POPUP_WRAPPER_CLASS);\n        var quickPopupWrapper = this.getQuickPopupElement();\n        if (selectedCells.length > 0 && !e.target.classList.contains(cls.WORK_CELLS_CLASS)) {\n            target = selectedCells[selectedCells.length - 1];\n        }\n        if (selectedElements.length > 0 && !moreEventWrapper.classList.contains(cls.POPUP_OPEN) &&\n            !quickPopupWrapper.classList.contains(cls.POPUP_OPEN) &&\n            ['Day', 'Week', 'WorkWeek', 'Month'].indexOf(this.parent.currentView) !== -1) {\n            target = this.getWorkCellFromAppointmentElement(selectedElements[selectedElements.length - 1]);\n            this.parent.eventBase.removeSelectedAppointmentClass();\n        }\n        var tableRows = this.parent.getTableRows();\n        if (!target) {\n            return;\n        }\n        if (target.classList.contains(cls.WORK_CELLS_CLASS) && !this.parent.element.querySelector('.' + cls.POPUP_OPEN)) {\n            var curRowIndex = tableRows.indexOf(target.parentElement);\n            var targetCell = void 0;\n            if (isTimelineYear && isMultiple && this.parent.activeViewOptions.group.resources.length === 0) {\n                targetCell = this.isInverseTableSelect() ? this.getVerticalUpDownCell(tableRows, target, curRowIndex, false)\n                    : this.getHorizontalUpDownCell(tableRows, target, curRowIndex, false);\n            }\n            if (curRowIndex >= 0 && ((curRowIndex < tableRows.length - 1) || targetCell)) {\n                targetCell = targetCell ? targetCell : (tableRows[curRowIndex + 1]).cells[target.cellIndex];\n                if (this.parent.currentView === 'Year' && targetCell.classList.contains(cls.OTHERMONTH_CLASS)) {\n                    if (this.parent.activeView.getEndDate().getTime() > +targetCell.getAttribute('data-date')) {\n                        targetCell = this.getYearUpDownCell(tableRows, curRowIndex + 1, target.cellIndex, false);\n                    }\n                    else {\n                        return;\n                    }\n                }\n                this.selectCells(isMultiple, targetCell);\n            }\n        }\n        else if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n            this.selectAppointment(false, target);\n        }\n    };\n    KeyboardInteraction.prototype.getYearUpDownCell = function (tableRows, rowIndex, cellIndex, isUp) {\n        while (tableRows[rowIndex] && tableRows[rowIndex].cells[cellIndex].classList.contains(cls.OTHERMONTH_CLASS)) {\n            rowIndex = rowIndex + (isUp ? -1 : 1);\n        }\n        return tableRows[rowIndex].cells[cellIndex];\n    };\n    // eslint-disable-next-line max-len\n    KeyboardInteraction.prototype.getHorizontalUpDownCell = function (tableRows, target, curRowIndex, isUp) {\n        var row = tableRows[curRowIndex + (isUp ? -1 : 1)];\n        var cell = row ? row.cells[target.cellIndex] : target;\n        if (cell.classList.contains(cls.OTHERMONTH_CLASS)) {\n            var workCell = row.querySelector('.' + cls.WORK_CELLS_CLASS + ':not(.' + cls.OTHERMONTH_CLASS + ')');\n            var date = new Date(+workCell.getAttribute('data-date'));\n            var query = '[data-date=\"' + new Date(date.getFullYear(), date.getMonth() + 1, 0).getTime() + '\"]';\n            cell = cell.cellIndex < workCell.cellIndex ? workCell : row.querySelector(query);\n        }\n        return cell;\n    };\n    // eslint-disable-next-line max-len\n    KeyboardInteraction.prototype.getVerticalUpDownCell = function (tableRows, target, curRowIndex, isUp) {\n        var hasRow = isUp && curRowIndex > 0 || !isUp && curRowIndex < tableRows.length - 1;\n        var targetCell = hasRow ? tableRows[curRowIndex + (isUp ? -1 : 1)].cells[target.cellIndex] : undefined;\n        if (!targetCell || targetCell.classList.contains(cls.OTHERMONTH_CLASS)) {\n            var column = tableRows[curRowIndex].cells[target.cellIndex - (isUp ? 1 : -1)];\n            if (column) {\n                var dateAttr = +target.getAttribute('data-date') - (isUp ? util.MS_PER_DAY : -util.MS_PER_DAY);\n                return this.parent.getContentTable().querySelector('.' + cls.WORK_CELLS_CLASS + '[data-date=\"' + dateAttr + '\"]');\n            }\n            targetCell = target;\n        }\n        return targetCell;\n    };\n    KeyboardInteraction.prototype.processLeftRight = function (target) {\n        var tableEle = (this.parent.currentView === 'Year' ? target.closest('tbody') : this.parent.getContentTable());\n        var curRowIndex = target.parentNode.sectionRowIndex;\n        var key = {\n            element: tableEle,\n            rowIndex: curRowIndex,\n            columnIndex: target.cellIndex,\n            maxIndex: tableEle.rows[curRowIndex].cells.length\n        };\n        return key;\n    };\n    KeyboardInteraction.prototype.getQuickPopupElement = function () {\n        return (this.parent.isAdaptive ? document.body : this.parent.element).querySelector('.' + cls.POPUP_WRAPPER_CLASS);\n    };\n    KeyboardInteraction.prototype.isCancelLeftRightAction = function (e, isMultiple, isTimelineYear) {\n        var prevent = this.parent.currentView === 'MonthAgenda' || isTimelineYear && this.initialTarget.classList.contains(cls.OTHERMONTH_CLASS);\n        if (this.parent.currentView === 'Agenda' || (isMultiple && prevent)) {\n            return true;\n        }\n        if (this.isPreventAction(e) && isMultiple) {\n            return true;\n        }\n        var moreEventWrapper = this.parent.element.querySelector('.' + cls.MORE_POPUP_WRAPPER_CLASS);\n        var quickPopupWrapper = this.getQuickPopupElement();\n        if (moreEventWrapper.classList.contains(cls.POPUP_OPEN) || quickPopupWrapper.classList.contains(cls.POPUP_OPEN)) {\n            return true;\n        }\n        return false;\n    };\n    KeyboardInteraction.prototype.processRight = function (e, isMultiple) {\n        var isTimelineYear = this.parent.currentView === 'TimelineYear';\n        if (this.isCancelLeftRightAction(e, isMultiple, isTimelineYear)) {\n            return;\n        }\n        var selectedCells = this.parent.getSelectedElements();\n        var targetCell;\n        var selectedAppointments = this.parent.eventBase.getSelectedAppointments();\n        var target = (e.target);\n        if (selectedCells.length > 0 && !target.classList.contains(cls.WORK_CELLS_CLASS) &&\n            !target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            target = selectedCells[selectedCells.length - 1];\n        }\n        if (selectedAppointments.length > 0) {\n            target = this.getWorkCellFromAppointmentElement(selectedAppointments[selectedAppointments.length - 1]);\n            this.parent.eventBase.removeSelectedAppointmentClass();\n            if (!target) {\n                return;\n            }\n        }\n        if (target.classList.contains(cls.WORK_CELLS_CLASS) &&\n            (e.target).classList.contains(cls.WORK_CELLS_CLASS)) {\n            var key = this.processLeftRight(target);\n            var targetDate = new Date(+target.getAttribute('data-date'));\n            var isMonthEnd = this.parent.currentView === 'Year' && targetDate.getTime() === util.lastDateOfMonth(targetDate).getTime();\n            if (key.columnIndex >= 0 && key.columnIndex < key.maxIndex - 1 && !isMonthEnd) {\n                targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex].cells[target.cellIndex + 1], 'right');\n                if (isTimelineYear && isMultiple && targetCell.classList.contains(cls.OTHERMONTH_CLASS)) {\n                    targetCell = this.getTimelineYearTargetCell(key, target, true);\n                }\n                if (!isNullOrUndefined(targetCell)) {\n                    this.selectCells(isMultiple, targetCell);\n                }\n            }\n            else if (key.columnIndex === key.maxIndex - 1 || isMonthEnd) {\n                if (!this.isInverseTableSelect() && key.rowIndex < key.element.rows.length - 1 && !isMonthEnd) {\n                    targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex + 1].cells[0], 'right');\n                    var changeTargetCell = isTimelineYear && isMultiple && targetCell.classList.contains(cls.OTHERMONTH_CLASS);\n                    targetCell = changeTargetCell ? this.getHorizontalLeftRightCell(key, target, true) : targetCell;\n                    if (!isNullOrUndefined(targetCell)) {\n                        this.selectCells(isMultiple, targetCell);\n                    }\n                }\n                else if (!isMultiple) {\n                    if (isMonthEnd && targetDate.getTime() !== this.parent.activeView.getEndDate().getTime()) {\n                        this.selectCells(isMultiple, this.parent.element.querySelector(':not(.' + cls.OTHERMONTH_CLASS + ')[data-date=\"' + (targetDate.getTime() + util.MS_PER_DAY) + '\"]'));\n                        return;\n                    }\n                    var rowIndex = this.isInverseTableSelect() ? key.rowIndex : 0;\n                    this.parent.changeDate(this.parent.activeView.getNextPreviousDate('next'), e);\n                    var tableEle = this.parent.getContentTable();\n                    var cell = isMonthEnd ? tableEle.rows[rowIndex].querySelector('.' + cls.WORK_CELLS_CLASS + ':not(.' + cls.OTHERMONTH_CLASS + ')') : tableEle.rows[rowIndex].cells[0];\n                    this.selectCells(false, cell);\n                }\n            }\n        }\n        else if (target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            var curColIndex = target.cellIndex;\n            var allDayRow = this.parent.getAllDayRow();\n            var maxColIndex = allDayRow.cells.length;\n            if (curColIndex >= 0 && curColIndex < maxColIndex - 1) {\n                this.selectCells(isMultiple, allDayRow.cells[curColIndex + 1]);\n            }\n            else if (curColIndex === maxColIndex - 1 && !isMultiple) {\n                this.parent.changeDate(this.parent.activeView.getNextPreviousDate('next'), e);\n                var allDayRow_1 = this.parent.getAllDayRow();\n                this.selectCells(false, allDayRow_1.cells[0]);\n            }\n        }\n    };\n    KeyboardInteraction.prototype.processLeft = function (e, isMultiple) {\n        var isTimelineYear = this.parent.currentView === 'TimelineYear';\n        if (this.isCancelLeftRightAction(e, isMultiple, isTimelineYear)) {\n            return;\n        }\n        var target = (e.target);\n        var selectedCells = this.parent.getSelectedElements();\n        var targetCell;\n        if (selectedCells.length > 0 && !target.classList.contains(cls.WORK_CELLS_CLASS) &&\n            !target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            target = selectedCells[selectedCells.length - 1];\n        }\n        var selectedElements = this.parent.eventBase.getSelectedAppointments();\n        if (selectedElements.length > 0) {\n            target = this.getWorkCellFromAppointmentElement(selectedElements[selectedElements.length - 1]);\n            this.parent.eventBase.removeSelectedAppointmentClass();\n            if (!target) {\n                return;\n            }\n        }\n        if ((e.target).classList.contains(cls.WORK_CELLS_CLASS) &&\n            target.classList.contains(cls.WORK_CELLS_CLASS)) {\n            var key = this.processLeftRight(target);\n            var targetDate = new Date(+target.getAttribute('data-date'));\n            var isMonthStart = this.parent.currentView === 'Year' && targetDate.getTime() === util.firstDateOfMonth(targetDate).getTime();\n            if (key.columnIndex > 0 && key.columnIndex < key.maxIndex && !isMonthStart) {\n                targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex].cells[target.cellIndex - 1], 'left');\n                if (isTimelineYear && isMultiple && targetCell.classList.contains(cls.OTHERMONTH_CLASS)) {\n                    targetCell = this.getTimelineYearTargetCell(key, target, false);\n                }\n                if (!isNullOrUndefined(targetCell)) {\n                    this.selectCells(isMultiple, targetCell);\n                }\n            }\n            else if (key.columnIndex === 0 || isMonthStart) {\n                if (!this.isInverseTableSelect() && key.rowIndex > 0) {\n                    targetCell = this.calculateNextPrevDate(target, key.element.rows[key.rowIndex - 1].cells[key.maxIndex - 1], 'left');\n                    var otherMonthCell = isTimelineYear && isMultiple && targetCell.classList.contains(cls.OTHERMONTH_CLASS);\n                    targetCell = otherMonthCell ? this.getHorizontalLeftRightCell(key, target, false) : targetCell;\n                    if (!isNullOrUndefined(targetCell)) {\n                        this.selectCells(isMultiple, targetCell);\n                    }\n                }\n                else if (!isMultiple) {\n                    if (isMonthStart && targetDate.getTime() !== this.parent.activeView.getStartDate().getTime()) {\n                        this.selectCells(isMultiple, this.parent.element.querySelector('[data-date=\"' + (targetDate.getTime() - util.MS_PER_DAY) + '\"]'));\n                        return;\n                    }\n                    this.parent.changeDate(this.parent.activeView.getNextPreviousDate('previous'), e);\n                    var tableEle = this.parent.getContentTable();\n                    var rowIndex = this.isInverseTableSelect() ? key.rowIndex : tableEle.rows.length - 1;\n                    var cell = tableEle.rows[rowIndex].cells[key.maxIndex - 1];\n                    if (isMonthStart) {\n                        var tbody = this.parent.element.querySelectorAll('.' + cls.CONTENT_TABLE_CLASS + ' tbody');\n                        cell = tbody.item(tbody.length - 1).querySelector(':not(.' + cls.OTHERMONTH_CLASS + ')[data-date=\"' + this.parent.activeView.getEndDate().getTime() + '\"]');\n                    }\n                    this.selectCells(false, cell);\n                }\n            }\n        }\n        else if (target.classList.contains(cls.ALLDAY_CELLS_CLASS)) {\n            var curColIndex = target.cellIndex;\n            var allDayRow = this.parent.getAllDayRow();\n            var maxColIndex = allDayRow.cells.length;\n            if (curColIndex > 0 && curColIndex < maxColIndex) {\n                this.selectCells(isMultiple, allDayRow.cells[curColIndex - 1]);\n            }\n            else if (curColIndex === 0 && !isMultiple) {\n                this.parent.changeDate(this.parent.activeView.getNextPreviousDate('previous'), e);\n                var allDayRow_2 = this.parent.getAllDayRow();\n                this.selectCells(false, allDayRow_2.cells[maxColIndex - 1]);\n            }\n        }\n    };\n    KeyboardInteraction.prototype.getTimelineYearTargetCell = function (key, target, isRight) {\n        return this.isInverseTableSelect() ? this.getVerticalLeftRightCell(target, isRight) :\n            this.getHorizontalLeftRightCell(key, target, isRight);\n    };\n    KeyboardInteraction.prototype.getHorizontalLeftRightCell = function (key, target, isRight) {\n        var row = key.element.rows[target.parentNode.sectionRowIndex + (isRight ? 1 : -1)];\n        if (row) {\n            var query = isRight ? '.' + cls.WORK_CELLS_CLASS + ':not(.' + cls.OTHERMONTH_CLASS + ')'\n                : '[data-date=\"' + ((+target.getAttribute('data-date')) - util.MS_PER_DAY) + '\"]';\n            return row.querySelector(query);\n        }\n        return target;\n    };\n    KeyboardInteraction.prototype.getVerticalLeftRightCell = function (target, isRight) {\n        var date = new Date(+target.getAttribute('data-date'));\n        var start = new Date(date.getFullYear(), date.getMonth() + (isRight ? 1 : -1), 1);\n        var tableEle = this.parent.getContentTable();\n        var targetCell = tableEle.querySelector('[data-date=\"' + start.getTime() + '\"]');\n        if (targetCell.parentNode.sectionRowIndex > target.parentNode.sectionRowIndex) {\n            return targetCell;\n        }\n        return tableEle.querySelector('[data-date=\"' + new Date(start.getFullYear(), start.getMonth() + 1, 0).getTime() + '\"]');\n    };\n    KeyboardInteraction.prototype.calculateNextPrevDate = function (currentCell, target, type) {\n        var initialId = this.initialTarget.getAttribute('data-group-index');\n        if (this.parent.activeViewOptions.group.resources.length > 0 && this.parent.currentView === 'Month') {\n            if (currentCell && target && target.getAttribute('data-group-index') !== initialId) {\n                var currentDate = this.parent.getDateFromElement(currentCell);\n                var nextPrevDate = (type === 'right') ? new Date(currentDate.setDate(currentDate.getDate() + 1))\n                    : new Date(currentDate.setDate(currentDate.getDate() - 1));\n                target = [].slice.call(this.parent.element.querySelectorAll('td[data-date=\"'\n                    + nextPrevDate.getTime().toString() + '\"]' + '[data-group-index=\"' + initialId + '\"]'))[0];\n            }\n        }\n        return target;\n    };\n    KeyboardInteraction.prototype.getFocusableElements = function (container) {\n        var queryString = 'a[href]:not([tabindex=\"-1\"]),input:not([disabled]):not([tabindex=\"-1\"]),' +\n            'textarea:not([disabled]):not([tabindex=\"-1\"]),button:not([disabled]):not([tabindex=\"-1\"]),' +\n            'select:not([disabled]):not([tabindex=\"-1\"]),[tabindex]:not([tabindex=\"-1\"]),[contentEditable=true]:not([tabindex=\"-1\"])';\n        return [].slice.call(container.querySelectorAll(queryString));\n    };\n    KeyboardInteraction.prototype.processTabOnPopup = function (e, popupElement) {\n        var _this = this;\n        var focusableElements = this.getFocusableElements(popupElement);\n        focusableElements = focusableElements.filter(function (element) {\n            var footerEle = _this.parent.element.querySelector('.' + cls.POPUP_FOOTER_CLASS);\n            if (footerEle && footerEle.offsetParent) {\n                return !(element.classList.contains(cls.EDIT_CLASS) || element.classList.contains(cls.DELETE_CLASS));\n            }\n            else {\n                return !(element.classList.contains(cls.EDIT_EVENT_CLASS) || element.classList.contains(cls.DELETE_EVENT_CLASS));\n            }\n        });\n        var firstEle = focusableElements[0];\n        var lastEle = focusableElements[focusableElements.length - 1];\n        if (!isNullOrUndefined(lastEle) && document.activeElement === lastEle && !e.shiftKey) {\n            e.preventDefault();\n            firstEle.focus();\n        }\n        if (!isNullOrUndefined(firstEle) && document.activeElement === firstEle && e.shiftKey) {\n            e.preventDefault();\n            lastEle.focus();\n        }\n    };\n    KeyboardInteraction.prototype.processTab = function (e, isReverse) {\n        var target = e.target;\n        if (target.classList.contains(cls.INLINE_SUBJECT_CLASS) && this.parent.inlineModule) {\n            target = target.closest('.e-appointment');\n            this.parent.inlineModule.inlineCrudActions(e.target);\n        }\n        if (this.parent.currentView === 'TimelineYear' && target.classList.contains(cls.OTHERMONTH_CLASS)) {\n            if (target.classList.contains(cls.SELECTED_CELL_CLASS)) {\n                this.parent.removeSelectedClass();\n            }\n            return;\n        }\n        var popupWrapper = closest(target, '.' + cls.POPUP_WRAPPER_CLASS + ',.' + cls.MORE_POPUP_WRAPPER_CLASS);\n        if (popupWrapper && popupWrapper.classList.contains(cls.POPUP_OPEN)) {\n            if (popupWrapper.classList.contains(cls.MORE_POPUP_WRAPPER_CLASS)) {\n                this.parent.eventBase.removeSelectedAppointmentClass();\n            }\n            this.processTabOnPopup(e, popupWrapper);\n            return;\n        }\n        if (target.classList.contains(cls.ROOT)) {\n            this.parent.eventBase.removeSelectedAppointmentClass();\n            return;\n        }\n        if (target.classList.contains(cls.RESOURCE_CELLS_CLASS) && this.parent.activeView.isTimelineView()\n            && this.parent.activeViewOptions.group.resources.length > 0) {\n            var index = parseInt(target.getAttribute('data-group-index'), 10);\n            var appSelector = \".\" + cls.APPOINTMENT_CLASS + \"[data-group-index=\\\"\" + (isReverse ? index - 1 : index) + \"\\\"]\";\n            var appElements = [].slice.call(this.parent.element.querySelectorAll(appSelector));\n            if (appElements.length > 0) {\n                this.parent.eventBase.removeSelectedAppointmentClass();\n                var focusAppointment = isReverse ? appElements.slice(-1)[0] : appElements[0];\n                this.parent.eventBase.addSelectedAppointments([focusAppointment]);\n                focusAppointment.focus();\n                e.preventDefault();\n            }\n            else if (index + 1 === this.parent.resourceBase.lastResourceLevel.length) {\n                this.parent.element.focus();\n                e.preventDefault();\n            }\n            else if (this.parent.virtualScrollModule) {\n                var virtual = this.parent.element.querySelector('.' + cls.VIRTUAL_TRACK_CLASS);\n                var averageRowHeight = Math.round(virtual.offsetHeight / this.parent.resourceBase.expandedResources.length);\n                this.parent.element.querySelector('.e-content-wrap').scrollTop = ((isReverse ? index - 1 : index + 1) * averageRowHeight);\n                this.parent.virtualScrollModule.virtualScrolling();\n            }\n            else {\n                this.setScrollPosition(index);\n            }\n            return;\n        }\n        if (target.classList.contains(cls.APPOINTMENT_CLASS)) {\n            var appElements = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n            var isTimelineYear = this.parent.currentView === 'TimelineYear';\n            var isTimeline = this.parent.activeView.isTimelineView() && !isTimelineYear;\n            if ((isTimeline || isTimelineYear && this.parent.activeViewOptions.orientation === 'Vertical') && this.parent.activeViewOptions.group.resources.length > 0) {\n                var index = parseInt(target.getAttribute('data-group-index'), 10);\n                appElements = [].slice.call(this.parent.element.querySelectorAll(\".\" + cls.APPOINTMENT_CLASS + \"[data-group-index=\\\"\" + index + \"\\\"]\"));\n                var resCellSelector = \".\" + cls.RESOURCE_CELLS_CLASS + \"[data-group-index=\\\"\" + (isReverse ? index : index + 1) + \"\\\"]\";\n                var resourceCell = this.parent.element.querySelector(resCellSelector);\n                if (resourceCell && (isReverse && target.getAttribute('data-guid') === appElements[0].getAttribute('data-guid') ||\n                    !isReverse && target.getAttribute('data-guid') === appElements.slice(-1)[0].getAttribute('data-guid'))) {\n                    this.parent.eventBase.removeSelectedAppointmentClass();\n                    if (this.parent.virtualScrollModule) {\n                        resourceCell.focus({ preventScroll: true });\n                    }\n                    else {\n                        resourceCell.focus();\n                    }\n                    if (this.parent.activeView.isTimelineView() && this.parent.activeViewOptions.group.resources.length > 0 &&\n                        isNullOrUndefined(this.parent.virtualScrollModule)) {\n                        this.setScrollPosition(index);\n                    }\n                    e.preventDefault();\n                    return;\n                }\n            }\n            var selectedAppointments = this.parent.eventBase.getSelectedAppointments();\n            if (selectedAppointments.length > 0) {\n                target = selectedAppointments[selectedAppointments.length - 1];\n            }\n            this.parent.eventBase.removeSelectedAppointmentClass();\n            if (!isReverse && target.getAttribute('data-guid') === appElements[appElements.length - 1].getAttribute('data-guid') ||\n                isReverse && target.getAttribute('data-guid') === appElements[0].getAttribute('data-guid')) {\n                return;\n            }\n            if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n                this.selectAppointment(isReverse, target);\n                e.preventDefault();\n            }\n            return;\n        }\n        var selectedCells = this.parent.getSelectedElements();\n        if (selectedCells.length > 0 && !target.classList.contains(cls.APPOINTMENT_CLASS)) {\n            target = selectedCells[selectedCells.length - 1];\n            this.selectAppointmentElementFromWorkCell(isReverse, target);\n            e.preventDefault();\n            return;\n        }\n        if (target && !target.classList.contains(cls.RESOURCE_CELLS_CLASS) && this.parent.activeView.isTimelineView()\n            && this.parent.activeViewOptions.group.resources.length > 0) {\n            this.processTabOnResourceCells(target, isReverse);\n        }\n    };\n    KeyboardInteraction.prototype.processDelete = function (e) {\n        var activeEle = document.activeElement;\n        if (this.parent.currentView === 'MonthAgenda') {\n            var selectedEle = this.parent.eventBase.getSelectedEvents().element;\n            activeEle = ((selectedEle && isNullOrUndefined(selectedEle.length)) ? selectedEle : selectedEle[0]);\n        }\n        if (activeEle && activeEle.classList.contains(cls.APPOINTMENT_CLASS)) {\n            addClass([activeEle], cls.APPOINTMENT_BORDER);\n            this.parent.activeEventData = this.parent.eventBase.getSelectedEvents();\n            if (this.parent.activeViewOptions.readonly || activeEle.classList.contains(cls.READ_ONLY) ||\n                !this.parent.eventSettings.allowDeleting) {\n                return;\n            }\n            this.parent.quickPopup.deleteClick(e);\n        }\n    };\n    KeyboardInteraction.prototype.processCtrlShiftNavigationArrows = function (e) {\n        if (this.parent.activeViewOptions.group.resources.length > 0 && document.activeElement.classList.contains(cls.APPOINTMENT_CLASS)) {\n            var groupIndex = parseInt(document.activeElement.getAttribute('data-group-index'), 10);\n            var index = (e.action === 'ctrlShiftLeftArrow' || e.action === 'ctrlShiftUpArrow') ? groupIndex - 1 : groupIndex + 1;\n            index = index < 0 ? 0 : index > this.parent.resourceBase.lastResourceLevel.length ?\n                this.parent.resourceBase.lastResourceLevel.length : index;\n            var eventEle = [];\n            while (eventEle.length === 0 && index >= 0 && index <= this.parent.resourceBase.lastResourceLevel.length) {\n                eventEle = [].slice.call(this.parent.element.querySelectorAll(\".\" + cls.APPOINTMENT_CLASS + \"[data-group-index=\\\"\" + index + \"\\\"]\"));\n                index = (e.action === 'ctrlShiftLeftArrow' || e.action === 'ctrlShiftUpArrow') ? index - 1 : index + 1;\n            }\n            var nextAppEle = eventEle[0];\n            if (nextAppEle) {\n                this.parent.eventBase.removeSelectedAppointmentClass();\n                this.parent.eventBase.addSelectedAppointments([nextAppEle]);\n                nextAppEle.focus();\n            }\n        }\n        else if (this.parent.activeViewOptions.group.resources.length > 0 &&\n            !document.activeElement.classList.contains(cls.APPOINTMENT_CLASS)) {\n            var index = this.parent.resourceBase.renderedResources[0].groupIndex;\n            var appSelector = \".\" + cls.APPOINTMENT_CLASS + \"[data-group-index=\\\"\" + index + \"\\\"]\";\n            var appElements = [].slice.call(this.parent.element.querySelectorAll(appSelector));\n            if (appElements.length > 0) {\n                this.parent.eventBase.removeSelectedAppointmentClass();\n                var focusAppointment = appElements[0];\n                this.parent.eventBase.addSelectedAppointments([focusAppointment]);\n                focusAppointment.focus();\n                e.preventDefault();\n            }\n        }\n    };\n    KeyboardInteraction.prototype.processEscape = function (event) {\n        this.parent.quickPopup.onClosePopup(event);\n        this.parent.quickPopup.morePopup.hide();\n        if (this.parent.headerModule) {\n            this.parent.headerModule.hideHeaderPopup();\n        }\n        if (this.parent.inlineModule) {\n            this.parent.inlineModule.removeInlineAppointmentElement();\n        }\n    };\n    KeyboardInteraction.prototype.isPreventAction = function (e) {\n        var target = closest(e.target, '.' + cls.RESOURCE_GROUP_CELLS_CLASS);\n        if (this.parent.activeView.isTimelineView() && !isNullOrUndefined(target)) {\n            return true;\n        }\n        return false;\n    };\n    KeyboardInteraction.prototype.processTabOnResourceCells = function (target, isReverse) {\n        var tabElements = [].slice.call(this.parent.element.querySelectorAll('[tabIndex=\"0\"]'));\n        var currentTabIndex = tabElements.indexOf(target);\n        var nextTabElement = !isReverse ? tabElements[currentTabIndex + 1] : tabElements[currentTabIndex - 1];\n        if (nextTabElement && nextTabElement.classList.contains(cls.RESOURCE_CELLS_CLASS)) {\n            var groupIndex = parseInt(nextTabElement.getAttribute('data-group-index'), 10);\n            if (this.parent.virtualScrollModule) {\n                var resColWrap_1 = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_WRAP_CLASS);\n                var resCells = [].slice.call(this.parent.element.querySelectorAll('.' + cls.RESOURCE_CELLS_CLASS));\n                resCells.forEach(function (element) {\n                    if (element.getBoundingClientRect().top < resColWrap_1.getBoundingClientRect().top) {\n                        element.setAttribute('tabindex', '-1');\n                    }\n                });\n            }\n            else {\n                this.setScrollPosition(groupIndex);\n            }\n        }\n    };\n    KeyboardInteraction.prototype.setScrollPosition = function (index) {\n        var workCell = this.parent.element.querySelector(\".\" + cls.WORK_CELLS_CLASS + \"[data-group-index=\\\"\" + index + \"\\\"]\");\n        if (workCell) {\n            this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS).scrollTop = workCell.offsetTop;\n        }\n    };\n    /**\n     * Get module name.\n     *\n     * @returns {string} Returns the module name.\n     */\n    KeyboardInteraction.prototype.getModuleName = function () {\n        return 'keyboard';\n    };\n    /**\n     * To destroy the keyboard module.\n     *\n     * @returns {void}\n     * @private\n     */\n    KeyboardInteraction.prototype.destroy = function () {\n        this.removeEventListener();\n        this.keyboardModule.destroy();\n    };\n    return KeyboardInteraction;\n}());\nexport { KeyboardInteraction };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}